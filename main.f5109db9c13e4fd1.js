(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[179],{193:(Ya,Ja,ca)=>{"use strict";function jn(e){return"function"==typeof e}function ua(e){const n=e(s=>{Error.call(s),s.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const ve=ua(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((s,l)=>`${l+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Kn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const d of n)d.remove(this);else n.remove(this);const{initialTeardown:s}=this;if(jn(s))try{s()}catch(d){t=d instanceof ve?d.errors:[d]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const d of l)try{at(d)}catch(y){t=null!=t?t:[],y instanceof ve?t=[...t,...y.errors]:t.push(y)}}if(t)throw new ve(t)}}add(t){var n;if(t&&t!==this)if(this.closed)at(t);else{if(t instanceof Kn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof Kn&&t._removeParent(this)}}Kn.EMPTY=(()=>{const e=new Kn;return e.closed=!0,e})();const Yi=Kn.EMPTY;function Tr(e){return e instanceof Kn||e&&"closed"in e&&jn(e.remove)&&jn(e.add)&&jn(e.unsubscribe)}function at(e){jn(e)?e():e.unsubscribe()}const Lt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Be={setTimeout(e,t,...n){const{delegate:s}=Be;return(null==s?void 0:s.setTimeout)?s.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Be;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function jr(e){Be.setTimeout(()=>{const{onUnhandledError:t}=Lt;if(!t)throw e;t(e)})}function Vn(){}const Vo=U("C",void 0,void 0);function U(e,t,n){return{kind:e,value:t,error:n}}let $=null;function q(e){if(Lt.useDeprecatedSynchronousErrorHandling){const t=!$;if(t&&($={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:s}=$;if($=null,n)throw s}}else e()}class fe extends Kn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Tr(t)&&t.add(this)):this.destination=gn}static create(t,n,s){return new st(t,n,s)}next(t){this.isStopped?bt(function as(e){return U("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?bt(function Vr(e){return U("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?bt(Vo,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ge=Function.prototype.bind;function De(e,t){return ge.call(e,t)}class Ne{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(s){ht(s)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(s){ht(s)}else ht(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){ht(n)}}}class st extends fe{constructor(t,n,s){let l;if(super(),jn(t)||!t)l={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=s?s:void 0};else{let d;this&&Lt.useDeprecatedNextContext?(d=Object.create(t),d.unsubscribe=()=>this.unsubscribe(),l={next:t.next&&De(t.next,d),error:t.error&&De(t.error,d),complete:t.complete&&De(t.complete,d)}):l=t}this.destination=new Ne(l)}}function ht(e){Lt.useDeprecatedSynchronousErrorHandling?function ee(e){Lt.useDeprecatedSynchronousErrorHandling&&$&&($.errorThrown=!0,$.error=e)}(e):jr(e)}function bt(e,t){const{onStoppedNotification:n}=Lt;n&&Be.setTimeout(()=>n(e,t))}const gn={closed:!0,next:Vn,error:function Pt(e){throw e},complete:Vn},zn="function"==typeof Symbol&&Symbol.observable||"@@observable";function an(e){return e}let Rn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const s=new e;return s.source=this,s.operator=n,s}subscribe(n,s,l){const d=function ha(e){return e&&e instanceof fe||function Vc(e){return e&&jn(e.next)&&jn(e.error)&&jn(e.complete)}(e)&&Tr(e)}(n)?n:new st(n,s,l);return q(()=>{const{operator:y,source:w}=this;d.add(y?y.call(d,w):w?this._subscribe(d):this._trySubscribe(d))}),d}_trySubscribe(n){try{return this._subscribe(n)}catch(s){n.error(s)}}forEach(n,s){return new(s=ln(s))((l,d)=>{const y=new st({next:w=>{try{n(w)}catch(D){d(D),y.unsubscribe()}},error:d,complete:l});this.subscribe(y)})}_subscribe(n){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(n)}[zn](){return this}pipe(...n){return function si(e){return 0===e.length?an:1===e.length?e[0]:function(n){return e.reduce((s,l)=>l(s),n)}}(n)(this)}toPromise(n){return new(n=ln(n))((s,l)=>{let d;this.subscribe(y=>d=y,y=>l(y),()=>s(d))})}}return e.create=t=>new e(t),e})();function ln(e){var t;return null!==(t=null!=e?e:Lt.Promise)&&void 0!==t?t:Promise}const da=ua(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let mo=(()=>{class e extends Rn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const s=new pa(this,this);return s.operator=n,s}_throwIfClosed(){if(this.closed)throw new da}next(n){q(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(n)}})}error(n){q(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:s}=this;for(;s.length;)s.shift().error(n)}})}complete(){q(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:s,isStopped:l,observers:d}=this;return s||l?Yi:(this.currentObservers=null,d.push(n),new Kn(()=>{this.currentObservers=null,p(d,n)}))}_checkFinalizedStatuses(n){const{hasError:s,thrownError:l,isStopped:d}=this;s?n.error(l):d&&n.complete()}asObservable(){const n=new Rn;return n.source=this,n}}return e.create=(t,n)=>new pa(t,n),e})();class pa extends mo{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===s||s.call(n,t)}error(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===s||s.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,s;return null!==(s=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==s?s:Yi}}function go(e){return jn(null==e?void 0:e.lift)}function yr(e){return t=>{if(go(t))return t.lift(function(n){try{return e(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Dr(e,t,n,s,l){return new $c(e,t,n,s,l)}class $c extends fe{constructor(t,n,s,l,d,y){super(t),this.onFinalize=d,this.shouldUnsubscribe=y,this._next=n?function(w){try{n(w)}catch(D){t.error(D)}}:super._next,this._error=l?function(w){try{l(w)}catch(D){t.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Cn(e,t){return yr((n,s)=>{let l=0;n.subscribe(Dr(s,d=>{s.next(e.call(t,d,l++))}))})}function _o(e){return this instanceof _o?(this.v=e,this):new _o(e)}function Qi(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,s=n.apply(e,t||[]),d=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(Q){s[Q]&&(l[Q]=function(oe){return new Promise(function(Te,je){d.push([Q,oe,Te,je])>1||w(Q,oe)})})}function w(Q,oe){try{!function D(Q){Q.value instanceof _o?Promise.resolve(Q.value.v).then(A,F):V(d[0][2],Q)}(s[Q](oe))}catch(Te){V(d[0][3],Te)}}function A(Q){w("next",Q)}function F(Q){w("throw",Q)}function V(Q,oe){Q(oe),d.shift(),d.length&&w(d[0][0],d[0][1])}}function nl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Bs(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(d){n[d]=e[d]&&function(y){return new Promise(function(w,D){!function l(d,y,w,D){Promise.resolve(D).then(function(A){d({value:A,done:w})},y)}(w,D,(y=e[d](y)).done,y.value)})}}}const Ui=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function fa(e){return jn(null==e?void 0:e.then)}function vo(e){return jn(e[zn])}function ma(e){return Symbol.asyncIterator&&jn(null==e?void 0:e[Symbol.asyncIterator])}function Us(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const eo=function cs(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function us(e){return jn(null==e?void 0:e[eo])}function xo(e){return Qi(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:s,done:l}=yield _o(n.read());if(l)return yield _o(void 0);yield yield _o(s)}}finally{n.releaseLock()}})}function ga(e){return jn(null==e?void 0:e.getReader)}function vr(e){if(e instanceof Rn)return e;if(null!=e){if(vo(e))return function te(e){return new Rn(t=>{const n=e[zn]();if(jn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ui(e))return function O(e){return new Rn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(fa(e))return function j(e){return new Rn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,jr)})}(e);if(ma(e))return re(e);if(us(e))return function J(e){return new Rn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(ga(e))return function de(e){return re(xo(e))}(e)}throw Us(e)}function re(e){return new Rn(t=>{(function Ee(e,t){var n,s,l,d;return function Jl(e,t,n,s){return new(n||(n=Promise))(function(d,y){function w(F){try{A(s.next(F))}catch(V){y(V)}}function D(F){try{A(s.throw(F))}catch(V){y(V)}}function A(F){F.done?d(F.value):function l(d){return d instanceof n?d:new n(function(y){y(d)})}(F.value).then(w,D)}A((s=s.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=nl(e);!(s=yield n.next()).done;)if(t.next(s.value),t.closed)return}catch(y){l={error:y}}finally{try{s&&!s.done&&(d=n.return)&&(yield d.call(n))}finally{if(l)throw l.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function xe(e,t,n,s=0,l=!1){const d=t.schedule(function(){n(),l?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(d),!l)return d}function Ce(e,t,n=1/0){return jn(t)?Ce((s,l)=>Cn((d,y)=>t(s,d,l,y))(vr(e(s,l))),n):("number"==typeof t&&(n=t),yr((s,l)=>function me(e,t,n,s,l,d,y,w){const D=[];let A=0,F=0,V=!1;const Q=()=>{V&&!D.length&&!A&&t.complete()},oe=je=>A<s?Te(je):D.push(je),Te=je=>{d&&t.next(je),A++;let et=!1;vr(n(je,F++)).subscribe(Dr(t,Je=>{null==l||l(Je),d?oe(Je):t.next(Je)},()=>{et=!0},void 0,()=>{if(et)try{for(A--;D.length&&A<s;){const Je=D.shift();y?xe(t,y,()=>Te(Je)):Te(Je)}Q()}catch(Je){t.error(Je)}}))};return e.subscribe(Dr(t,oe,()=>{V=!0,Q()})),()=>{null==w||w()}}(s,l,e,n)))}function Re(e=1/0){return Ce(an,e)}const ze=new Rn(e=>e.complete());function wt(e){return e[e.length-1]}function jt(e){return function Mt(e){return e&&jn(e.schedule)}(wt(e))?e.pop():void 0}function Zn(e,t=0){return yr((n,s)=>{n.subscribe(Dr(s,l=>xe(s,e,()=>s.next(l),t),()=>xe(s,e,()=>s.complete(),t),l=>xe(s,e,()=>s.error(l),t)))})}function On(e,t=0){return yr((n,s)=>{s.add(e.schedule(()=>n.subscribe(s),t))})}function bo(e,t){if(!e)throw new Error("Iterable cannot be null");return new Rn(n=>{xe(n,t,()=>{const s=e[Symbol.asyncIterator]();xe(n,t,()=>{s.next().then(l=>{l.done?n.complete():n.next(l.value)})},0,!0)})})}function Pr(e,t){return t?function td(e,t){if(null!=e){if(vo(e))return function Yn(e,t){return vr(e).pipe(On(t),Zn(t))}(e,t);if(Ui(e))return function hs(e,t){return new Rn(n=>{let s=0;return t.schedule(function(){s===e.length?n.complete():(n.next(e[s++]),n.closed||this.schedule())})})}(e,t);if(fa(e))return function js(e,t){return vr(e).pipe(On(t),Zn(t))}(e,t);if(ma(e))return bo(e,t);if(us(e))return function Qr(e,t){return new Rn(n=>{let s;return xe(n,t,()=>{s=e[eo](),xe(n,t,()=>{let l,d;try{({value:l,done:d}=s.next())}catch(y){return void n.error(y)}d?n.complete():n.next(l)},0,!0)}),()=>jn(null==s?void 0:s.return)&&s.return()})}(e,t);if(ga(e))return function Wc(e,t){return bo(xo(e),t)}(e,t)}throw Us(e)}(e,t):vr(e)}function rl(e){return e<=0?()=>ze:yr((t,n)=>{let s=0;t.subscribe(Dr(n,l=>{++s<=e&&(n.next(l),e<=s&&n.complete())}))})}function il(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(rl(1)).subscribe(()=>e())}function Pn(e){for(let t in e)if(e[t]===Pn)return t;throw Error("Could not find renamed property on target object.")}function rn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(rn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function _a(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Go=Pn({__forward_ref__:Pn});function th(e){return e.__forward_ref__=th,e.toString=function(){return rn(this())},e}function Wt(e){return function ya(e){return"function"==typeof e&&e.hasOwnProperty(Go)&&e.__forward_ref__===th}(e)?e():e}class _n extends Error{constructor(t,n){super(function Kc(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Vt(e){return"string"==typeof e?e:null==e?"":String(e)}function $r(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Vt(e)}function Se(e,t){const n=t?` in ${t}`:"";throw new _n(-201,`No provider for ${$r(e)} found${n}`)}function kt(e,t){null==e&&function Bn(e,t,n,s){throw new Error(`ASSERTION ERROR: ${e}`+(null==s?"":` [Expected=> ${n} ${s} ${t} <=Actual]`))}(t,e,null,"!=")}function gt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ar(e){return{providers:e.providers||[],imports:e.imports||[]}}function ol(e){return wa(e,Ca)||wa(e,Bt)}function wa(e,t){return e.hasOwnProperty(t)?e[t]:null}function dn(e){return e&&(e.hasOwnProperty(oc)||e.hasOwnProperty(to))?e[oc]:null}const Ca=Pn({\u0275prov:Pn}),oc=Pn({\u0275inj:Pn}),Bt=Pn({ngInjectableDef:Pn}),to=Pn({ngInjectorDef:Pn});var Ut=(()=>((Ut=Ut||{})[Ut.Default=0]="Default",Ut[Ut.Host=1]="Host",Ut[Ut.Self=2]="Self",Ut[Ut.SkipSelf=4]="SkipSelf",Ut[Ut.Optional=8]="Optional",Ut))();let ll;function no(e){const t=ll;return ll=e,t}function ps(e,t,n){const s=ol(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:n&Ut.Optional?null:void 0!==t?t:void Se(rn(e),"Injector")}function Co(e){return{toString:e}.toString()}var hr=(()=>((hr=hr||{})[hr.OnPush=0]="OnPush",hr[hr.Default=1]="Default",hr))(),qo=(()=>{return(e=qo||(qo={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",qo;var e})();const Zo="undefined"!=typeof globalThis&&globalThis,nd="undefined"!=typeof window&&window,rd="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Mn=Zo||"undefined"!=typeof global&&global||nd||rd,Wo={},Gn=[],sc=Pn({\u0275cmp:Pn}),ac=Pn({\u0275dir:Pn}),Jc=Pn({\u0275pipe:Pn}),Qc=Pn({\u0275mod:Pn}),ms=Pn({\u0275fac:Pn}),ul=Pn({__NG_ELEMENT_ID__:Pn});let zp=0;function Gr(e){return Co(()=>{const n={},s={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===hr.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Gn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||qo.Emulated,id:"c",styles:e.styles||Gn,_:null,setInput:null,schemas:e.schemas||null,tView:null},l=e.directives,d=e.features,y=e.pipes;return s.id+=zp++,s.inputs=dl(e.inputs,n),s.outputs=dl(e.outputs),d&&d.forEach(w=>w(s)),s.directiveDefs=l?()=>("function"==typeof l?l():l).map(eu):null,s.pipeDefs=y?()=>("function"==typeof y?y():y).map(oh):null,s})}function eu(e){return kr(e)||function Eo(e){return e[ac]||null}(e)}function oh(e){return function To(e){return e[Jc]||null}(e)}const sh={};function wi(e){return Co(()=>{const t={type:e.type,bootstrap:e.bootstrap||Gn,declarations:e.declarations||Gn,imports:e.imports||Gn,exports:e.exports||Gn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(sh[e.id]=e.type),t})}function dl(e,t){if(null==e)return Wo;const n={};for(const s in e)if(e.hasOwnProperty(s)){let l=e[s],d=l;Array.isArray(l)&&(d=l[1],l=l[0]),n[l]=s,t&&(t[l]=d)}return n}const Mr=Gr;function Hr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function kr(e){return e[sc]||null}function ai(e,t){const n=e[Qc]||null;if(!n&&!0===t)throw new Error(`Type ${rn(e)} does not have '\u0275mod' property.`);return n}function ji(e){return Array.isArray(e)&&"object"==typeof e[1]}function qr(e){return Array.isArray(e)&&!0===e[1]}function tu(e){return 0!=(8&e.flags)}function ml(e){return 2==(2&e.flags)}function gl(e){return 1==(1&e.flags)}function oo(e){return null!==e.template}function ah(e){return 0!=(512&e[2])}function bs(e,t){return e.hasOwnProperty(ms)?e[ms]:null}class yl{constructor(t,n,s){this.previousValue=t,this.currentValue=n,this.firstChange=s}isFirstChange(){return this.firstChange}}function vl(e){return e.type.prototype.ngOnChanges&&(e.setInput=ud),uh}function uh(){const e=uc(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===Wo)e.previous=t;else for(let s in t)n[s]=t[s];e.current=null,this.ngOnChanges(t)}}function ud(e,t,n,s){const l=uc(e)||function so(e,t){return e[Ma]=t}(e,{previous:Wo,current:null}),d=l.current||(l.current={}),y=l.previous,w=this.declaredInputs[n],D=y[w];d[w]=new yl(D&&D.currentValue,t,y===Wo),e[s]=t}const Ma="__ngSimpleChanges__";function uc(e){return e[Ma]||null}let bl;function dr(e){return!!e.listen}const lu={createRenderer:(e,t)=>function Zs(){return void 0!==bl?bl:"undefined"!=typeof document?document:void 0}()};function pr(e){for(;Array.isArray(e);)e=e[0];return e}function Li(e,t){return pr(t[e.index])}function Sa(e,t){return e.data[t]}function Oi(e,t){const n=t[e];return ji(n)?n:n[0]}function Ws(e){return 128==(128&e[2])}function ws(e,t){return null==t?null:e[t]}function uu(e){e[18]=0}function dc(e,t){e[5]+=t;let n=e,s=e[3];for(;null!==s&&(1===t&&1===n[5]||-1===t&&0===n[5]);)s[5]+=t,n=s,s=s[3]}const zt={lFrame:Y(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function fh(){return zt.bindingsEnabled}function We(){return zt.lFrame.lView}function xn(){return zt.lFrame.tView}function El(e){return zt.lFrame.contextLView=e,e[8]}function Or(){let e=mh();for(;null!==e&&64===e.type;)e=e.parent;return e}function mh(){return zt.lFrame.currentTNode}function er(e,t){const n=zt.lFrame;n.currentTNode=e,n.isParent=t}function Pa(){return zt.lFrame.isParent}function Ts(){return zt.isInCheckNoChangesMode}function pc(e){zt.isInCheckNoChangesMode=e}function o(){return zt.lFrame.bindingIndex++}function b(e,t){const n=zt.lFrame;n.bindingIndex=n.bindingRootIndex=e,M(t)}function M(e){zt.lFrame.currentDirectiveIndex=e}function L(e){zt.lFrame.currentQueryIndex=e}function B(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function G(e,t,n){if(n&Ut.SkipSelf){let l=t,d=e;for(;!(l=l.parent,null!==l||n&Ut.Host||(l=B(d),null===l||(d=d[15],10&l.type))););if(null===l)return!1;t=l,e=d}const s=zt.lFrame=Z();return s.currentTNode=t,s.lView=e,!0}function K(e){const t=Z(),n=e[1];zt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Z(){const e=zt.lFrame,t=null===e?null:e.child;return null===t?Y(e):t}function Y(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function he(){const e=zt.lFrame;return zt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const W=he;function ae(){const e=he();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function ie(){return zt.lFrame.selectedIndex}function ue(e){zt.lFrame.selectedIndex=e}function ye(){const e=zt.lFrame;return Sa(e.tView,e.selectedIndex)}function Ie(){zt.lFrame.currentNamespace="svg"}function Ve(e,t){for(let n=t.directiveStart,s=t.directiveEnd;n<s;n++){const d=e.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:D,ngAfterViewChecked:A,ngOnDestroy:F}=d;y&&(e.contentHooks||(e.contentHooks=[])).push(-n,y),w&&((e.contentHooks||(e.contentHooks=[])).push(n,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,w)),D&&(e.viewHooks||(e.viewHooks=[])).push(-n,D),A&&((e.viewHooks||(e.viewHooks=[])).push(n,A),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,A)),null!=F&&(e.destroyHooks||(e.destroyHooks=[])).push(n,F)}}function Oe(e,t,n){Gt(e,t,3,n)}function mt(e,t,n,s){(3&e[2])===n&&Gt(e,t,n,s)}function Dt(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Gt(e,t,n,s){const d=null!=s?s:-1,y=t.length-1;let w=0;for(let D=void 0!==s?65535&e[18]:0;D<y;D++)if("number"==typeof t[D+1]){if(w=t[D],null!=s&&w>=s)break}else t[D]<0&&(e[18]+=65536),(w<d||-1==d)&&(Ye(e,n,t,D),e[18]=(4294901760&e[18])+D+2),D++}function Ye(e,t,n,s){const l=n[s]<0,d=n[s+1],w=e[l?-n[s]:n[s]];if(l){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{d.call(w)}finally{}}}else try{d.call(w)}finally{}}class Rt{constructor(t,n,s){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=s}}function Fi(e,t,n){const s=dr(e);let l=0;for(;l<n.length;){const d=n[l];if("number"==typeof d){if(0!==d)break;l++;const y=n[l++],w=n[l++],D=n[l++];s?e.setAttribute(t,w,D,y):t.setAttributeNS(y,w,D)}else{const y=d,w=n[++l];Ot(y)?s&&e.setProperty(t,y,w):s?e.setAttribute(t,y,w):t.setAttribute(y,w),l++}}return l}function cn(e){return 3===e||4===e||6===e}function Ot(e){return 64===e.charCodeAt(0)}function Kt(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let s=0;s<t.length;s++){const l=t[s];"number"==typeof l?n=l:0===n||tr(e,n,l,null,-1===n||2===n?t[++s]:null)}}return e}function tr(e,t,n,s,l){let d=0,y=e.length;if(-1===t)y=-1;else for(;d<e.length;){const w=e[d++];if("number"==typeof w){if(w===t){y=-1;break}if(w>t){y=d-1;break}}}for(;d<e.length;){const w=e[d];if("number"==typeof w)break;if(w===n){if(null===s)return void(null!==l&&(e[d+1]=l));if(s===e[d+1])return void(e[d+2]=l)}d++,null!==s&&d++,null!==l&&d++}-1!==y&&(e.splice(y,0,t),d=y+1),e.splice(d++,0,n),null!==s&&e.splice(d++,0,s),null!==l&&e.splice(d++,0,l)}function zi(e){return-1!==e}function Sn(e){return 32767&e}function Yo(e,t){let n=function $i(e){return e>>16}(e),s=t;for(;n>0;)s=s[15],n--;return s}let di=!0;function Jo(e){const t=di;return di=e,t}let ka=0;function Cr(e,t){const n=$p(e,t);if(-1!==n)return n;const s=t[1];s.firstCreatePass&&(e.injectorIndex=t.length,gd(s.data,e),gd(t,null),gd(s.blueprint,null));const l=Tl(e,t),d=e.injectorIndex;if(zi(l)){const y=Sn(l),w=Yo(l,t),D=w[1].data;for(let A=0;A<8;A++)t[d+A]=w[y+A]|D[y+A]}return t[d+8]=l,d}function gd(e,t){e.push(0,0,0,0,0,0,0,0,t)}function $p(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Tl(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,s=null,l=t;for(;null!==l;){const d=l[1],y=d.type;if(s=2===y?d.declTNode:1===y?l[6]:null,null===s)return-1;if(n++,l=l[15],-1!==s.injectorIndex)return s.injectorIndex|n<<16}return-1}function nr(e,t,n){!function Ks(e,t,n){let s;"string"==typeof n?s=n.charCodeAt(0)||0:n.hasOwnProperty(ul)&&(s=n[ul]),null==s&&(s=n[ul]=ka++);const l=255&s;t.data[e+(l>>5)]|=1<<l}(e,t,n)}function Gp(e,t,n){if(n&Ut.Optional)return e;Se(t,"NodeInjector")}function fc(e,t,n,s){if(n&Ut.Optional&&void 0===s&&(s=null),0==(n&(Ut.Self|Ut.Host))){const l=e[9],d=no(void 0);try{return l?l.get(t,s,n&Ut.Optional):ps(t,s,n&Ut.Optional)}finally{no(d)}}return Gp(s,t,n)}function mc(e,t,n,s=Ut.Default,l){if(null!==e){const d=function Hp(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ul)?e[ul]:void 0;return"number"==typeof t?t>=0?255&t:du:t}(n);if("function"==typeof d){if(!G(t,e,s))return s&Ut.Host?Gp(l,n,s):fc(t,n,s,l);try{const y=d(s);if(null!=y||s&Ut.Optional)return y;Se(n)}finally{W()}}else if("number"==typeof d){let y=null,w=$p(e,t),D=-1,A=s&Ut.Host?t[16][6]:null;for((-1===w||s&Ut.SkipSelf)&&(D=-1===w?Tl(e,t):t[w+8],-1!==D&&gh(s,!1)?(y=t[1],w=Sn(D),t=Yo(D,t)):w=-1);-1!==w;){const F=t[1];if(yd(d,w,F.data)){const V=Dl(w,t,n,y,s,A);if(V!==_d)return V}D=t[w+8],-1!==D&&gh(s,t[1].data[w+8]===A)&&yd(d,w,t)?(y=F,w=Sn(D),t=Yo(D,t)):w=-1}}}return fc(t,n,s,l)}const _d={};function du(){return new Ml(Or(),We())}function Dl(e,t,n,s,l,d){const y=t[1],w=y.data[e+8],F=function gc(e,t,n,s,l){const d=e.providerIndexes,y=t.data,w=1048575&d,D=e.directiveStart,F=d>>20,Q=l?w+F:e.directiveEnd;for(let oe=s?w:w+F;oe<Q;oe++){const Te=y[oe];if(oe<D&&n===Te||oe>=D&&Te.type===n)return oe}if(l){const oe=y[D];if(oe&&oo(oe)&&oe.type===n)return D}return null}(w,y,n,null==s?ml(w)&&di:s!=y&&0!=(3&w.type),l&Ut.Host&&d===w);return null!==F?_c(t,y,F,w):_d}function _c(e,t,n,s){let l=e[n];const d=t.data;if(function In(e){return e instanceof Rt}(l)){const y=l;y.resolving&&function Vs(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new _n(-200,`Circular dependency in DI detected for ${e}${n}`)}($r(d[n]));const w=Jo(y.canSeeViewProviders);y.resolving=!0;const D=y.injectImpl?no(y.injectImpl):null;G(e,s,Ut.Default);try{l=e[n]=y.factory(void 0,d,e,s),t.firstCreatePass&&n>=s.directiveStart&&function Me(e,t,n){const{ngOnChanges:s,ngOnInit:l,ngDoCheck:d}=t.type.prototype;if(s){const y=vl(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,y)}l&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,l),d&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d))}(n,d[n],t)}finally{null!==D&&no(D),Jo(w),y.resolving=!1,W()}}return l}function yd(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function gh(e,t){return!(e&Ut.Self||e&Ut.Host&&t)}class Ml{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,s){return mc(this._tNode,this._lView,t,s,n)}}const Ra="__parameters__";function Po(e,t,n){return Co(()=>{const s=function _h(e){return function(...n){if(e){const s=e(...n);for(const l in s)this[l]=s[l]}}}(t);function l(...d){if(this instanceof l)return s.apply(this,d),this;const y=new l(...d);return w.annotation=y,w;function w(D,A,F){const V=D.hasOwnProperty(Ra)?D[Ra]:Object.defineProperty(D,Ra,{value:[]})[Ra];for(;V.length<=F;)V.push(null);return(V[F]=V[F]||[]).push(y),D}}return n&&(l.prototype=Object.create(n.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}class yn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=gt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Km=new yn("AnalyzeForEntryComponents");function Ys(e,t){e.forEach(n=>Array.isArray(n)?Ys(n,t):t(n))}function gu(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function bd(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const vh={},Qp="__NG_DI_FLAG__",xh="ngTempTokenPath",Ms=/\n/gm,Jm="__source",Er=Pn({provide:String,useValue:Pn});let Ht;function Rl(e){const t=Ht;return Ht=e,t}function Qm(e,t=Ut.Default){if(void 0===Ht)throw new _n(203,"");return null===Ht?ps(e,void 0,t):Ht.get(e,t&Ut.Optional?null:void 0,t)}function it(e,t=Ut.Default){return(function br(){return ll}()||Qm)(Wt(e),t)}const eg=it;function Ll(e){const t=[];for(let n=0;n<e.length;n++){const s=Wt(e[n]);if(Array.isArray(s)){if(0===s.length)throw new _n(900,"");let l,d=Ut.Default;for(let y=0;y<s.length;y++){const w=s[y],D=Is(w);"number"==typeof D?-1===D?l=w.token:d|=D:l=w}t.push(it(l,d))}else t.push(it(s))}return t}function Qs(e,t){return e[Qp]=t,e.prototype[Qp]=t,e}function Is(e){return e[Qp]}const bh=Qs(Po("Inject",e=>({token:e})),-1),Ei=Qs(Po("Optional"),8),vc=Qs(Po("SkipSelf"),4);let za,Ch;function xu(e){var t;return(null===(t=function Ad(){if(void 0===za&&(za=null,Mn.trustedTypes))try{za=Mn.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(e){}return za}())||void 0===t?void 0:t.createHTML(e))||e}function es(e){var t;return(null===(t=function rf(){if(void 0===Ch&&(Ch=null,Mn.trustedTypes))try{Ch=Mn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(e){}return Ch}())||void 0===t?void 0:t.createScriptURL(e))||e}class Fl{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class wy extends Fl{getTypeName(){return"HTML"}}class og extends Fl{getTypeName(){return"Style"}}class Cy extends Fl{getTypeName(){return"Script"}}class Ey extends Fl{getTypeName(){return"URL"}}class sg extends Fl{getTypeName(){return"ResourceURL"}}function Hi(e){return e instanceof Fl?e.changingThisBreaksApplicationSecurity:e}function Ss(e,t){const n=Rd(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Rd(e){return e instanceof Fl&&e.getTypeName()||null}class My{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(xu(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.removeChild(n.firstChild),n)}catch(n){return null}}}class Ld{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);const s=this.inertDocument.createElement("body");n.appendChild(s)}}getInertBodyElement(t){const n=this.inertDocument.createElement("template");if("content"in n)return n.innerHTML=xu(t),n;const s=this.inertDocument.createElement("body");return s.innerHTML=xu(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(s),s}stripCustomNsAttrs(t){const n=t.attributes;for(let l=n.length-1;0<l;l--){const y=n.item(l).name;("xmlns:ns1"===y||0===y.indexOf("ns1:"))&&t.removeAttribute(y)}let s=t.firstChild;for(;s;)s.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(s),s=s.nextSibling}}const Od=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Bl=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Ba(e){return(e=String(e)).match(Od)||e.match(Bl)?e:"unsafe:"+e}function lg(e){return(e=String(e)).split(",").map(t=>Ba(t.trim())).join(", ")}function ta(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Eh(...e){const t={};for(const n of e)for(const s in n)n.hasOwnProperty(s)&&(t[s]=!0);return t}const cg=ta("area,br,col,hr,img,wbr"),ug=ta("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),hg=ta("rp,rt"),Nl=Eh(cg,Eh(ug,ta("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Eh(hg,ta("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Eh(hg,ug)),sf=ta("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),lr=ta("srcset"),Th=Eh(sf,lr,ta("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ta("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Fd=ta("script,style,template");class Dh{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let n=t.firstChild,s=!0;for(;n;)if(n.nodeType===Node.ELEMENT_NODE?s=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,s&&n.firstChild)n=n.firstChild;else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let l=this.checkClobberedElement(n,n.nextSibling);if(l){n=l;break}n=this.checkClobberedElement(n,n.parentNode)}return this.buf.join("")}startElement(t){const n=t.nodeName.toLowerCase();if(!Nl.hasOwnProperty(n))return this.sanitizedSomething=!0,!Fd.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const s=t.attributes;for(let l=0;l<s.length;l++){const d=s.item(l),y=d.name,w=y.toLowerCase();if(!Th.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let D=d.value;sf[w]&&(D=Ba(D)),lr[w]&&(D=lg(D)),this.buf.push(" ",y,'="',wu(D),'"')}return this.buf.push(">"),!0}endElement(t){const n=t.nodeName.toLowerCase();Nl.hasOwnProperty(n)&&!cg.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(wu(t))}checkClobberedElement(t,n){if(n&&(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return n}}const pg=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,fg=/([^\#-~ |!])/g;function wu(e){return e.replace(/&/g,"&amp;").replace(pg,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(fg,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Cu;function zd(e,t){let n=null;try{Cu=Cu||function ag(e){const t=new Ld(e);return function Iy(){try{return!!(new window.DOMParser).parseFromString(xu(""),"text/html")}catch(e){return!1}}()?new My(t):t}(e);let s=t?String(t):"";n=Cu.getInertBodyElement(s);let l=5,d=s;do{if(0===l)throw new Error("Failed to sanitize html because the input is unstable");l--,s=d,d=n.innerHTML,n=Cu.getInertBodyElement(s)}while(s!==d);return xu((new Dh).sanitizeChildren(lf(n)||n))}finally{if(n){const s=lf(n)||n;for(;s.firstChild;)s.removeChild(s.firstChild)}}}function lf(e){return"content"in e&&function mg(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Hn=(()=>((Hn=Hn||{})[Hn.NONE=0]="NONE",Hn[Hn.HTML=1]="HTML",Hn[Hn.STYLE=2]="STYLE",Hn[Hn.SCRIPT=3]="SCRIPT",Hn[Hn.URL=4]="URL",Hn[Hn.RESOURCE_URL=5]="RESOURCE_URL",Hn))();function Mh(e){const t=Tu();return t?t.sanitize(Hn.URL,e)||"":Ss(e,"URL")?Hi(e):Ba(Vt(e))}function Eu(e){const t=Tu();if(t)return es(t.sanitize(Hn.RESOURCE_URL,e)||"");if(Ss(e,"ResourceURL"))return es(Hi(e));throw new _n(904,"")}function Tu(){const e=We();return e&&e[12]}const df="__ngContext__";function Ti(e,t){e[df]=t}function pf(e){const t=function Ih(e){return e[df]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function gf(e){return e.ngOriginalError}function Ny(e,...t){e.error(...t)}class Ph{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),s=function By(e){return e&&e.ngErrorLogger||Ny}(t);s(this._console,"ERROR",t),n&&s(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&gf(t);for(;n&&gf(n);)n=gf(n);return n||null}}const qy=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Mn))();function ts(e){return e instanceof Function?e():e}var Di=(()=>((Di=Di||{})[Di.Important=1]="Important",Di[Di.DashCase=2]="DashCase",Di))();function xf(e,t){return undefined(e,t)}function Na(e){const t=e[3];return qr(t)?t[3]:t}function Vd(e){return na(e[13])}function $d(e){return na(e[4])}function na(e){for(;null!==e&&!qr(e);)e=e[4];return e}function wc(e,t,n,s,l){if(null!=s){let d,y=!1;qr(s)?d=s:ji(s)&&(y=!0,s=s[0]);const w=pr(s);0===e&&null!==n?null==l?Du(t,n,w):ri(t,n,w,l||null,!0):1===e&&null!==n?ri(t,n,w,l||null,!0):2===e?function Rf(e,t,n){const s=Tc(e,t);s&&function Mf(e,t,n,s){dr(e)?e.removeChild(t,n,s):t.removeChild(n)}(e,s,t,n)}(t,w,y):3===e&&t.destroyNode(w),null!=d&&function Sg(e,t,n,s,l){const d=n[7];d!==pr(n)&&wc(t,e,s,d,l);for(let w=10;w<n.length;w++){const D=n[w];Su(D[1],D,e,t,s,d)}}(t,e,d,n,l)}}function Cf(e,t,n){if(dr(e))return e.createElement(t,n);{const s=null!==n?function au(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(n):null;return null===s?e.createElement(t):e.createElementNS(s,t)}}function Cc(e,t){const n=e[9],s=n.indexOf(t),l=t[3];1024&t[2]&&(t[2]&=-1025,dc(l,-1)),n.splice(s,1)}function Hd(e,t){if(e.length<=10)return;const n=10+t,s=e[n];if(s){const l=s[17];null!==l&&l!==e&&Cc(l,s),t>0&&(e[n-1][4]=s[4]);const d=bd(e,10+t);!function Xy(e,t){Su(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(s[1],s);const y=d[19];null!==y&&y.detachView(d[1]),s[3]=null,s[4]=null,s[2]&=-129}return s}function Dg(e,t){if(!(256&t[2])){const n=t[11];dr(n)&&n.destroyNode&&Su(e,t,n,3,null,null),function Jy(e){let t=e[13];if(!t)return Ef(e[1],e);for(;t;){let n=null;if(ji(t))n=t[13];else{const s=t[10];s&&(n=s)}if(!n){for(;t&&!t[4]&&t!==e;)ji(t)&&Ef(t[1],t),t=t[3];null===t&&(t=e),ji(t)&&Ef(t[1],t),n=t&&t[4]}t=n}}(t)}}function Ef(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function Tf(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let s=0;s<n.length;s+=2){const l=t[n[s]];if(!(l instanceof Rt)){const d=n[s+1];if(Array.isArray(d))for(let y=0;y<d.length;y+=2){const w=l[d[y]],D=d[y+1];try{D.call(w)}finally{}}else try{d.call(l)}finally{}}}}(e,t),function ev(e,t){const n=e.cleanup,s=t[7];let l=-1;if(null!==n)for(let d=0;d<n.length-1;d+=2)if("string"==typeof n[d]){const y=n[d+1],w="function"==typeof y?y(t):pr(t[y]),D=s[l=n[d+2]],A=n[d+3];"boolean"==typeof A?w.removeEventListener(n[d],D,A):A>=0?s[l=A]():s[l=-A].unsubscribe(),d+=2}else{const y=s[l=n[d+1]];n[d].call(y)}if(null!==s){for(let d=l+1;d<s.length;d++)s[d]();t[7]=null}}(e,t),1===t[1].type&&dr(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&qr(t[3])){n!==t[3]&&Cc(n,t);const s=t[19];null!==s&&s.detachView(e)}}}function qd(e,t,n){return function Df(e,t,n){let s=t;for(;null!==s&&40&s.type;)s=(t=s).parent;if(null===s)return n[0];if(2&s.flags){const l=e.data[s.directiveStart].encapsulation;if(l===qo.None||l===qo.Emulated)return null}return Li(s,n)}(e,t.parent,n)}function ri(e,t,n,s,l){dr(e)?e.insertBefore(t,n,s,l):t.insertBefore(n,s,l)}function Du(e,t,n){dr(e)?e.appendChild(t,n):t.appendChild(n)}function Ec(e,t,n,s,l){null!==s?ri(e,t,n,s,l):Du(e,t,n)}function Tc(e,t){return dr(e)?e.parentNode(t):t.parentNode}let Mg=function Sf(e,t,n){return 40&e.type?Li(e,n):null};function Mu(e,t,n,s){const l=qd(e,s,t),d=t[11],w=function If(e,t,n){return Mg(e,t,n)}(s.parent||t[6],s,t);if(null!=l)if(Array.isArray(n))for(let D=0;D<n.length;D++)Ec(d,l,n[D],w,!1);else Ec(d,l,n,w,!1)}function Iu(e,t){if(null!==t){const n=t.type;if(3&n)return Li(t,e);if(4&n)return kf(-1,e[t.index]);if(8&n){const s=t.child;if(null!==s)return Iu(e,s);{const l=e[t.index];return qr(l)?kf(-1,l):pr(l)}}if(32&n)return xf(t,e)()||pr(e[t.index]);{const s=Pf(e,t);return null!==s?Array.isArray(s)?s[0]:Iu(Na(e[16]),s):Iu(e,t.next)}}return null}function Pf(e,t){return null!==t?e[16][6].projection[t.projection]:null}function kf(e,t){const n=10+e+1;if(n<t.length){const s=t[n],l=s[1].firstChild;if(null!==l)return Iu(s,l)}return t[7]}function As(e,t,n,s,l,d,y){for(;null!=n;){const w=s[n.index],D=n.type;if(y&&0===t&&(w&&Ti(pr(w),s),n.flags|=4),64!=(64&n.flags))if(8&D)As(e,t,n.child,s,l,d,!1),wc(t,e,l,w,d);else if(32&D){const A=xf(n,s);let F;for(;F=A();)wc(t,e,l,F,d);wc(t,e,l,w,d)}else 16&D?Lf(e,t,s,n,l,d):wc(t,e,l,w,d);n=y?n.projectionNext:n.next}}function Su(e,t,n,s,l,d){As(n,s,e.firstChild,t,l,d,!1)}function Lf(e,t,n,s,l,d){const y=n[16],D=y[6].projection[s.projection];if(Array.isArray(D))for(let A=0;A<D.length;A++)wc(t,e,l,D[A],d);else As(e,t,D,y[3],l,d,!0)}function Ag(e,t,n){dr(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Wd(e,t,n){dr(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Of(e,t,n){let s=e.length;for(;;){const l=e.indexOf(t,n);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const d=t.length;if(l+d===s||e.charCodeAt(l+d)<=32)return l}n=l+1}}const Ff="ng-template";function Pg(e,t,n){let s=0;for(;s<e.length;){let l=e[s++];if(n&&"class"===l){if(l=e[s],-1!==Of(l.toLowerCase(),t,0))return!0}else if(1===l){for(;s<e.length&&"string"==typeof(l=e[s++]);)if(l.toLowerCase()===t)return!0;return!1}}return!1}function Kd(e){return 4===e.type&&e.value!==Ff}function Au(e,t,n){return t===(4!==e.type||n?e.value:Ff)}function kg(e,t,n){let s=4;const l=e.attrs||[],d=function rv(e){for(let t=0;t<e.length;t++)if(cn(e[t]))return t;return e.length}(l);let y=!1;for(let w=0;w<t.length;w++){const D=t[w];if("number"!=typeof D){if(!y)if(4&s){if(s=2|1&s,""!==D&&!Au(e,D,n)||""===D&&1===t.length){if(lo(s))return!1;y=!0}}else{const A=8&s?D:t[++w];if(8&s&&null!==e.attrs){if(!Pg(e.attrs,A,n)){if(lo(s))return!1;y=!0}continue}const V=Rg(8&s?"class":D,l,Kd(e),n);if(-1===V){if(lo(s))return!1;y=!0;continue}if(""!==A){let Q;Q=V>d?"":l[V+1].toLowerCase();const oe=8&s?Q:null;if(oe&&-1!==Of(oe,A,0)||2&s&&A!==Q){if(lo(s))return!1;y=!0}}}}else{if(!y&&!lo(s)&&!lo(D))return!1;if(y&&lo(D))continue;y=!1,s=D|1&s}}return lo(s)||y}function lo(e){return 0==(1&e)}function Rg(e,t,n,s){if(null===t)return-1;let l=0;if(s||!n){let d=!1;for(;l<t.length;){const y=t[l];if(y===e)return l;if(3===y||6===y)d=!0;else{if(1===y||2===y){let w=t[++l];for(;"string"==typeof w;)w=t[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=d?1:2}return-1}return function iv(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const s=e[n];if("number"==typeof s)return-1;if(s===t)return n;n++}return-1}(t,e)}function Lh(e,t,n=!1){for(let s=0;s<t.length;s++)if(kg(e,t[s],n))return!0;return!1}function Lg(e,t){return e?":not("+t.trim()+")":t}function sv(e){let t=e[0],n=1,s=2,l="",d=!1;for(;n<e.length;){let y=e[n];if("string"==typeof y)if(2&s){const w=e[++n];l+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&s?l+="."+y:4&s&&(l+=" "+y);else""!==l&&!lo(y)&&(t+=Lg(d,l),l=""),s=y,d=d||!lo(s);n++}return""!==l&&(t+=Lg(d,l)),t}const Yt={};function Mi(e){Og(xn(),We(),ie()+e,Ts())}function Og(e,t,n,s){if(!s)if(3==(3&t[2])){const d=e.preOrderCheckHooks;null!==d&&Oe(t,d,n)}else{const d=e.preOrderHooks;null!==d&&mt(t,d,0,n)}ue(n)}function Xf(e,t){const n=e.contentQueries;if(null!==n)for(let s=0;s<n.length;s+=2){const l=n[s],d=n[s+1];if(-1!==d){const y=e.data[d];L(l),y.contentQueries(2,t[d],d)}}}function Fu(e,t,n,s,l,d,y,w,D,A){const F=t.blueprint.slice();return F[0]=l,F[2]=140|s,uu(F),F[3]=F[15]=e,F[8]=n,F[10]=y||e&&e[10],F[11]=w||e&&e[11],F[12]=D||e&&e[12]||null,F[9]=A||e&&e[9]||null,F[6]=d,F[16]=2==t.type?e[16]:F,F}function Dc(e,t,n,s,l){let d=e.data[t];if(null===d)d=function ia(e,t,n,s,l){const d=mh(),y=Pa(),D=e.data[t]=function Vl(e,t,n,s,l,d){return{type:n,index:s,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:d,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?d:d&&d.parent,n,t,s,l);return null===e.firstChild&&(e.firstChild=D),null!==d&&(y?null==d.child&&null!==D.parent&&(d.child=D):null===d.next&&(d.next=D)),D}(e,t,n,s,l),function g(){return zt.lFrame.inI18n}()&&(d.flags|=64);else if(64&d.type){d.type=n,d.value=s,d.attrs=l;const y=function Es(){const e=zt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();d.injectorIndex=null===y?-1:y.injectorIndex}return er(d,!0),d}function Mc(e,t,n,s){if(0===n)return-1;const l=t.length;for(let d=0;d<n;d++)t.push(s),e.blueprint.push(s),e.data.push(null);return l}function jl(e,t,n){K(t);try{const s=e.viewQuery;null!==s&&dp(1,s,n);const l=e.template;null!==l&&Kf(e,t,l,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Xf(e,t),e.staticViewQueries&&dp(2,e.viewQuery,n);const d=e.components;null!==d&&function Hg(e,t){for(let n=0;n<t.length;n++)cp(e,t[n])}(t,d)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{t[2]&=-5,ae()}}function zu(e,t,n,s){const l=t[2];if(256==(256&l))return;K(t);const d=Ts();try{uu(t),function m(e){return zt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Kf(e,t,n,2,s);const y=3==(3&l);if(!d)if(y){const A=e.preOrderCheckHooks;null!==A&&Oe(t,A,null)}else{const A=e.preOrderHooks;null!==A&&mt(t,A,0,null),Dt(t,0)}if(function Uh(e){for(let t=Vd(e);null!==t;t=$d(t)){if(!t[2])continue;const n=t[9];for(let s=0;s<n.length;s++){const l=n[s],d=l[3];0==(1024&l[2])&&dc(d,1),l[2]|=1024}}}(t),function Nh(e){for(let t=Vd(e);null!==t;t=$d(t))for(let n=10;n<t.length;n++){const s=t[n],l=s[1];Ws(s)&&zu(l,s,l.template,s[8])}}(t),null!==e.contentQueries&&Xf(e,t),!d)if(y){const A=e.contentCheckHooks;null!==A&&Oe(t,A)}else{const A=e.contentHooks;null!==A&&mt(t,A,1),Dt(t,1)}!function $g(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let s=0;s<n.length;s++){const l=n[s];if(l<0)ue(~l);else{const d=l,y=n[++s],w=n[++s];b(y,d),w(2,t[d])}}}finally{ue(-1)}}(e,t);const w=e.components;null!==w&&function Gg(e,t){for(let n=0;n<t.length;n++)jh(e,t[n])}(t,w);const D=e.viewQuery;if(null!==D&&dp(2,D,s),!d)if(y){const A=e.viewCheckHooks;null!==A&&Oe(t,A)}else{const A=e.viewHooks;null!==A&&mt(t,A,2),Dt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),d||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,dc(t[3],-1))}finally{ae()}}function Ic(e,t,n,s){const l=t[10],d=!Ts(),y=function wl(e){return 4==(4&e[2])}(t);try{d&&!y&&l.begin&&l.begin(),y&&jl(e,t,s),zu(e,t,n,s)}finally{d&&!y&&l.end&&l.end()}}function Kf(e,t,n,s,l){const d=ie(),y=2&s;try{ue(-1),y&&t.length>20&&Og(e,t,20,Ts()),n(s,l)}finally{ue(d)}}function Bu(e,t,n){!fh()||(function Xg(e,t,n,s){const l=n.directiveStart,d=n.directiveEnd;e.firstCreatePass||Cr(n,t),Ti(s,t);const y=n.initialInputs;for(let w=l;w<d;w++){const D=e.data[w],A=oo(D);A&&vv(t,n,D);const F=_c(t,e,w,n);Ti(F,t),null!==y&&Jg(0,w-l,F,D,0,y),A&&(Oi(n.index,t)[8]=F)}}(e,t,n,Li(n,t)),128==(128&n.flags)&&function tm(e,t,n){const s=n.directiveStart,l=n.directiveEnd,y=n.index,w=function E(){return zt.lFrame.currentDirectiveIndex}();try{ue(y);for(let D=s;D<l;D++){const A=e.data[D],F=t[D];M(D),(null!==A.hostBindings||0!==A.hostVars||null!==A.hostAttrs)&&Bh(A,F)}}finally{ue(-1),M(w)}}(e,t,n))}function op(e,t,n=Li){const s=t.localNames;if(null!==s){let l=t.index+1;for(let d=0;d<s.length;d+=2){const y=s[d+1],w=-1===y?n(t,e):e[y];e[l++]=w}}}function Jf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=sp(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function sp(e,t,n,s,l,d,y,w,D,A){const F=20+s,V=F+l,Q=function gv(e,t){const n=[];for(let s=0;s<t;s++)n.push(s<e?null:Yt);return n}(F,V),oe="function"==typeof A?A():A;return Q[1]={type:e,blueprint:Q,template:n,queries:null,viewQuery:w,declTNode:t,data:Q.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof d?d():d,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:oe,incompleteFirstPass:!1}}function zh(e,t,n){for(let s in e)if(e.hasOwnProperty(s)){const l=e[s];(n=null===n?{}:n).hasOwnProperty(s)?n[s].push(t,l):n[s]=[t,l]}return n}function uo(e,t,n,s,l,d,y,w){const D=Li(t,n);let F,A=t.inputs;!w&&null!=A&&(F=A[s])?(_(e,n,F,s,l),ml(t)&&function em(e,t){const n=Oi(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(s=function Qf(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),l=null!=y?y(l,t.value||"",s):l,dr(d)?d.setProperty(D,s,l):Ot(s)||(D.setProperty?D.setProperty(s,l):D[s]=l))}function Bi(e,t,n,s){let l=!1;if(fh()){const d=function Kg(e,t,n){const s=e.directiveRegistry;let l=null;if(s)for(let d=0;d<s.length;d++){const y=s[d];Lh(n,y.selectors,!1)&&(l||(l=[]),nr(Cr(n,t),e,y.type),oo(y)?(nm(e,n),l.unshift(y)):l.push(y))}return l}(e,t,n),y=null===s?null:{"":-1};if(null!==d){l=!0,Sc(n,e.data.length,d.length);for(let F=0;F<d.length;F++){const V=d[F];V.providersResolver&&V.providersResolver(V)}let w=!1,D=!1,A=Mc(e,t,d.length,null);for(let F=0;F<d.length;F++){const V=d[F];n.mergedAttrs=Kt(n.mergedAttrs,V.hostAttrs),im(e,n,t,A,V),rm(A,V,y),null!==V.contentQueries&&(n.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(n.flags|=128);const Q=V.type.prototype;!w&&(Q.ngOnChanges||Q.ngOnInit||Q.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),w=!0),!D&&(Q.ngOnChanges||Q.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),D=!0),A++}!function qg(e,t){const s=t.directiveEnd,l=e.data,d=t.attrs,y=[];let w=null,D=null;for(let A=t.directiveStart;A<s;A++){const F=l[A],V=F.inputs,Q=null===d||Kd(t)?null:xv(V,d);y.push(Q),w=zh(V,A,w),D=zh(F.outputs,A,D)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=16),w.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=y,t.inputs=w,t.outputs=D}(e,n)}y&&function Yg(e,t,n){if(t){const s=e.localNames=[];for(let l=0;l<t.length;l+=2){const d=n[t[l+1]];if(null==d)throw new _n(-301,!1);s.push(t[l],d)}}}(n,s,y)}return n.mergedAttrs=Kt(n.mergedAttrs,n.attrs),l}function Wg(e,t,n,s,l,d){const y=d.hostBindings;if(y){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const D=~t.index;(function ap(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=D&&w.push(D),w.push(s,l,y)}}function Bh(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function nm(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function rm(e,t,n){if(n){if(t.exportAs)for(let s=0;s<t.exportAs.length;s++)n[t.exportAs[s]]=e;oo(t)&&(n[""]=e)}}function Sc(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function im(e,t,n,s,l){e.data[s]=l;const d=l.factory||(l.factory=bs(l.type)),y=new Rt(d,oo(l),null);e.blueprint[s]=y,n[s]=y,Wg(e,t,0,s,Mc(e,n,l.hostVars,Yt),l)}function vv(e,t,n){const s=Li(t,e),l=Jf(n),d=e[10],y=up(e,Fu(e,l,null,n.onPush?64:16,s,t,d,d.createRenderer(s,n),null,null));e[t.index]=y}function Jg(e,t,n,s,l,d){const y=d[t];if(null!==y){const w=s.setInput;for(let D=0;D<y.length;){const A=y[D++],F=y[D++],V=y[D++];null!==w?s.setInput(n,V,A,F):n[F]=V}}}function xv(e,t){let n=null,s=0;for(;s<t.length;){const l=t[s];if(0!==l)if(5!==l){if("number"==typeof l)break;e.hasOwnProperty(l)&&(null===n&&(n=[]),n.push(l,e[l],t[s+1])),s+=2}else s+=2;else s+=4}return n}function Qg(e,t,n,s){return new Array(e,!0,!1,t,null,0,s,n,null,null)}function jh(e,t){const n=Oi(t,e);if(Ws(n)){const s=n[1];80&n[2]?zu(s,n,s.template,n[8]):n[5]>0&&Ac(n)}}function Ac(e){for(let s=Vd(e);null!==s;s=$d(s))for(let l=10;l<s.length;l++){const d=s[l];if(1024&d[2]){const y=d[1];zu(y,d,y.template,d[8])}else d[5]>0&&Ac(d)}const n=e[1].components;if(null!==n)for(let s=0;s<n.length;s++){const l=Oi(n[s],e);Ws(l)&&l[5]>0&&Ac(l)}}function cp(e,t){const n=Oi(t,e),s=n[1];(function bv(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(s,n),jl(s,n,n[8])}function up(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function Gl(e){for(;e;){e[2]|=64;const t=Na(e);if(ah(e)&&!t)return e;e=t}return null}function sm(e,t,n){const s=t[10];s.begin&&s.begin();try{zu(e,t,e.template,n)}catch(l){throw f(t,l),l}finally{s.end&&s.end()}}function am(e){!function om(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],s=pf(n),l=s[1];Ic(l,s,l.template,n)}}(e[8])}function dp(e,t,n){L(0),t(e,n)}const r=(()=>Promise.resolve(null))();function a(e){return e[7]||(e[7]=[])}function c(e){return e.cleanup||(e.cleanup=[])}function f(e,t){const n=e[9],s=n?n.get(Ph,null):null;s&&s.handleError(t)}function _(e,t,n,s,l){for(let d=0;d<n.length;){const y=n[d++],w=n[d++],D=t[y],A=e.data[y];null!==A.setInput?A.setInput(D,l,s,w):D[w]=l}}function x(e,t,n){const s=function Ia(e,t){return pr(t[e])}(t,e);!function Tg(e,t,n){dr(e)?e.setValue(t,n):t.textContent=n}(e[11],s,n)}function C(e,t,n){let s=n?e.styles:null,l=n?e.classes:null,d=0;if(null!==t)for(let y=0;y<t.length;y++){const w=t[y];"number"==typeof w?d=w:1==d?l=_a(l,w):2==d&&(s=_a(s,w+": "+t[++y]+";"))}n?e.styles=s:e.stylesWithoutHost=s,n?e.classes=l:e.classesWithoutHost=l}const P=new yn("INJECTOR",-1);class z{get(t,n=vh){if(n===vh){const s=new Error(`NullInjectorError: No provider for ${rn(t)}!`);throw s.name="NullInjectorError",s}return n}}const N=new yn("Set Injector scope."),H={},X={};let ne;function ce(){return void 0===ne&&(ne=new z),ne}function pe(e,t=null,n=null,s){const l=_e(e,t,n,s);return l._resolveInjectorDefTypes(),l}function _e(e,t=null,n=null,s){return new be(e,n,t||ce(),s)}class be{constructor(t,n,s,l=null){this.parent=s,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const d=[];n&&Ys(n,w=>this.processProvider(w,t,n)),Ys([t],w=>this.processInjectorType(w,[],d)),this.records.set(P,qe(void 0,this));const y=this.records.get(N);this.scope=null!=y?y.value:null,this.source=l||("object"==typeof t?null:rn(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=vh,s=Ut.Default){this.assertNotDestroyed();const l=Rl(this),d=no(void 0);try{if(!(s&Ut.SkipSelf)){let w=this.records.get(t);if(void 0===w){const D=function Un(e){return"function"==typeof e||"object"==typeof e&&e instanceof yn}(t)&&ol(t);w=D&&this.injectableDefInScope(D)?qe(we(t),H):null,this.records.set(t,w)}if(null!=w)return this.hydrate(t,w)}return(s&Ut.Self?ce():this.parent).get(t,n=s&Ut.Optional&&n===vh?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[xh]=y[xh]||[]).unshift(rn(t)),l)throw y;return function Fa(e,t,n,s){const l=e[xh];throw t[Jm]&&l.unshift(t[Jm]),e.message=function Qo(e,t,n,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let l=rn(t);if(Array.isArray(t))l=t.map(rn).join(" -> ");else if("object"==typeof t){let d=[];for(let y in t)if(t.hasOwnProperty(y)){let w=t[y];d.push(y+":"+("string"==typeof w?JSON.stringify(w):rn(w)))}l=`{${d.join(", ")}}`}return`${n}${s?"("+s+")":""}[${l}]: ${e.replace(Ms,"\n  ")}`}("\n"+e.message,l,n,s),e.ngTokenPath=l,e[xh]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{no(d),Rl(l)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((s,l)=>t.push(rn(l))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new _n(205,!1)}processInjectorType(t,n,s){if(!(t=Wt(t)))return!1;let l=dn(t);const d=null==l&&t.ngModule||void 0,y=void 0===d?t:d,w=-1!==s.indexOf(y);if(void 0!==d&&(l=dn(d)),null==l)return!1;if(null!=l.imports&&!w){let F;s.push(y);try{Ys(l.imports,V=>{this.processInjectorType(V,n,s)&&(void 0===F&&(F=[]),F.push(V))})}finally{}if(void 0!==F)for(let V=0;V<F.length;V++){const{ngModule:Q,providers:oe}=F[V];Ys(oe,Te=>this.processProvider(Te,Q,oe||Gn))}}this.injectorDefTypes.add(y);const D=bs(y)||(()=>new y);this.records.set(y,qe(D,H));const A=l.providers;if(null!=A&&!w){const F=t;Ys(A,V=>this.processProvider(V,F,A))}return void 0!==d&&void 0!==t.providers}processProvider(t,n,s){let l=Ue(t=Wt(t))?t:Wt(t&&t.provide);const d=function Pe(e,t,n){return Le(e)?qe(void 0,e.useValue):qe(function tt(e,t,n){let s;if(Ue(e)){const l=Wt(e);return bs(l)||we(l)}if(Le(e))s=()=>Wt(e.useValue);else if(function ot(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...Ll(e.deps||[]));else if(function Ke(e){return!(!e||!e.useExisting)}(e))s=()=>it(Wt(e.useExisting));else{const l=Wt(e&&(e.useClass||e.provide));if(!function dt(e){return!!e.deps}(e))return bs(l)||we(l);s=()=>new l(...Ll(e.deps))}return s}(e),H)}(t);if(Ue(t)||!0!==t.multi)this.records.get(l);else{let y=this.records.get(l);y||(y=qe(void 0,H,!0),y.factory=()=>Ll(y.multi),this.records.set(l,y)),l=t,y.multi.push(t)}this.records.set(l,d)}hydrate(t,n){return n.value===H&&(n.value=X,n.value=n.factory()),"object"==typeof n.value&&n.value&&function un(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Wt(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function we(e){const t=ol(e),n=null!==t?t.factory:bs(e);if(null!==n)return n;if(e instanceof yn)throw new _n(204,!1);if(e instanceof Function)return function Fe(e){const t=e.length;if(t>0)throw function Al(e,t){const n=[];for(let s=0;s<e;s++)n.push(t);return n}(t,"?"),new _n(204,!1);const n=function sl(e){const t=e&&(e[Ca]||e[Bt]);if(t){const n=function al(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new _n(204,!1)}function qe(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Le(e){return null!==e&&"object"==typeof e&&Er in e}function Ue(e){return"function"==typeof e}let Ft=(()=>{class e{static create(n,s){var l;if(Array.isArray(n))return pe({name:""},s,n,"");{const d=null!==(l=n.name)&&void 0!==l?l:"";return pe({name:d},n.parent,n.providers,d)}}}return e.THROW_IF_NOT_FOUND=vh,e.NULL=new z,e.\u0275prov=gt({token:e,providedIn:"any",factory:()=>it(P)}),e.__NG_ELEMENT_ID__=-1,e})();function Ni(e,t){Ve(pf(e)[1],Or())}let ju=null;function Wi(){if(!ju){const e=Mn.Symbol;if(e&&e.iterator)ju=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const s=t[n];"entries"!==s&&"size"!==s&&Map.prototype[s]===Map.prototype.entries&&(ju=s)}}}return ju}function kc(e){return!!function $h(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Wi()in e)}function Xn(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function fp(e,t,n,s){return Xn(e,o(),n)?t+Vt(n)+s:Yt}function um(e,t,n,s,l,d,y,w){const D=We(),A=xn(),F=e+20,V=A.firstCreatePass?function rT(e,t,n,s,l,d,y,w,D){const A=t.consts,F=Dc(t,e,4,y||null,ws(A,w));Bi(t,n,F,ws(A,D)),Ve(t,F);const V=F.tViews=sp(2,F,s,l,d,t.directiveRegistry,t.pipeRegistry,null,t.schemas,A);return null!==t.queries&&(t.queries.template(t,F),V.queries=t.queries.embeddedTView(F)),F}(F,A,D,t,n,s,l,d,y):A.data[F];er(V,!1);const Q=D[11].createComment("");Mu(A,D,Q,V),Ti(Q,D),up(D,D[F]=Qg(Q,D,Q,V)),gl(V)&&Bu(A,D,V),null!=y&&op(D,V,w)}function Et(e,t=Ut.Default){const n=We();return null===n?it(e,t):mc(Or(),n,Wt(e),t)}function Mv(){throw new Error("invalid")}function $u(e,t,n){const s=We();return Xn(s,o(),t)&&uo(xn(),ye(),s,e,t,s[11],n,!1),$u}function Iv(e,t,n,s,l){const y=l?"class":"style";_(e,n,t.inputs[y],y,s)}function Xe(e,t,n,s){const l=We(),d=xn(),y=20+e,w=l[11],D=l[y]=Cf(w,t,function Ae(){return zt.lFrame.currentNamespace}()),A=d.firstCreatePass?function TT(e,t,n,s,l,d,y){const w=t.consts,A=Dc(t,e,2,l,ws(w,d));return Bi(t,n,A,ws(w,y)),null!==A.attrs&&C(A,A.attrs,!1),null!==A.mergedAttrs&&C(A,A.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,A),A}(y,d,l,0,t,n,s):d.data[y];er(A,!0);const F=A.mergedAttrs;null!==F&&Fi(w,D,F);const V=A.classes;null!==V&&Wd(w,D,V);const Q=A.styles;return null!==Q&&Ag(w,D,Q),64!=(64&A.flags)&&Mu(d,l,D,A),0===function Wr(){return zt.lFrame.elementDepthCount}()&&Ti(D,l),function ph(){zt.lFrame.elementDepthCount++}(),gl(A)&&(Bu(d,l,A),function Yf(e,t,n){if(tu(t)){const l=t.directiveEnd;for(let d=t.directiveStart;d<l;d++){const y=e.data[d];y.contentQueries&&y.contentQueries(1,n[d],d)}}}(d,A,l)),null!==s&&op(l,A),Xe}function rt(){let e=Or();Pa()?function Xs(){zt.lFrame.isParent=!1}():(e=e.parent,er(e,!1));const t=e;!function Cs(){zt.lFrame.elementDepthCount--}();const n=xn();return n.firstCreatePass&&(Ve(n,e),tu(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Jn(e){return 0!=(16&e.flags)}(t)&&Iv(n,t,We(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Ir(e){return 0!=(32&e.flags)}(t)&&Iv(n,t,We(),t.stylesWithoutHost,!1),rt}function Zt(e,t,n,s){return Xe(e,t,n,s),rt(),Zt}function a_(){return We()}function l_(e){return!!e&&"function"==typeof e.then}const h1=function u1(e){return!!e&&"function"==typeof e.subscribe};function qn(e,t,n,s){const l=We(),d=xn(),y=Or();return function p1(e,t,n,s,l,d,y,w){const D=gl(s),F=e.firstCreatePass&&c(e),V=t[8],Q=a(t);let oe=!0;if(3&s.type||w){const et=Li(s,t),Je=w?w(et):et,ke=Q.length,It=w?Tt=>w(pr(Tt[s.index])):s.index;if(dr(n)){let Tt=null;if(!w&&D&&(Tt=function MT(e,t,n,s){const l=e.cleanup;if(null!=l)for(let d=0;d<l.length-1;d+=2){const y=l[d];if(y===n&&l[d+1]===s){const w=t[7],D=l[d+2];return w.length>D?w[D]:null}"string"==typeof y&&(d+=2)}return null}(e,t,l,s.index)),null!==Tt)(Tt.__ngLastListenerFn__||Tt).__ngNextListenerFn__=d,Tt.__ngLastListenerFn__=d,oe=!1;else{d=Pv(s,t,V,d,!1);const kn=n.listen(Je,l,d);Q.push(d,kn),F&&F.push(l,It,ke,ke+1)}}else d=Pv(s,t,V,d,!0),Je.addEventListener(l,d,y),Q.push(d),F&&F.push(l,It,ke,y)}else d=Pv(s,t,V,d,!1);const Te=s.outputs;let je;if(oe&&null!==Te&&(je=Te[l])){const et=je.length;if(et)for(let Je=0;Je<et;Je+=2){const jo=t[je[Je]][je[Je+1]].subscribe(d),jc=Q.length;Q.push(d,jo),F&&F.push(l,s.index,jc,-(jc+1))}}}(d,l,l[11],y,e,t,!!n,s),qn}function f1(e,t,n,s){try{return!1!==n(s)}catch(l){return f(e,l),!1}}function Pv(e,t,n,s,l){return function d(y){if(y===Function)return s;const w=2&e.flags?Oi(e.index,t):t;0==(32&t[2])&&Gl(w);let D=f1(t,0,s,y),A=d.__ngNextListenerFn__;for(;A;)D=f1(t,0,A,y)&&D,A=A.__ngNextListenerFn__;return l&&!1===D&&(y.preventDefault(),y.returnValue=!1),D}}function c_(e=1){return function le(e){return(zt.lFrame.contextLView=function se(e,t){for(;e>0;)t=t[15],e--;return t}(e,zt.lFrame.contextLView))[8]}(e)}function hm(e,t,n,s,l){const d=We(),y=fp(d,t,n,s);return y!==Yt&&uo(xn(),ye(),d,e,y,d[11],l,!1),hm}function xt(e,t=""){const n=We(),s=xn(),l=e+20,d=s.firstCreatePass?Dc(s,l,1,t,null):s.data[l],y=n[l]=function wf(e,t){return dr(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Mu(s,n,y,d),er(d,!1)}function Gh(e){return pm("",e,""),Gh}function pm(e,t,n){const s=We(),l=fp(s,e,t,n);return l!==Yt&&x(s,ie(),l),pm}const h_="en-US";let sb=h_;class Pb{}class _M{resolveComponentFactory(t){throw function gM(e){const t=Error(`No component factory found for ${rn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let ym=(()=>{class e{}return e.NULL=new _M,e})();function yM(){return Dp(Or(),We())}function Dp(e,t){return new Gu(Li(e,t))}let Gu=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=yM,e})();class Rb{}let wM=(()=>{class e{}return e.\u0275prov=gt({token:e,providedIn:"root",factory:()=>null}),e})();class __{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const CM=new __("13.2.7"),Nv={};function y_(e,t,n,s,l=!1){for(;null!==n;){const d=t[n.index];if(null!==d&&s.push(pr(d)),qr(d))for(let w=10;w<d.length;w++){const D=d[w],A=D[1].firstChild;null!==A&&y_(D[1],D,A,s)}const y=n.type;if(8&y)y_(e,t,n.child,s);else if(32&y){const w=xf(n,t);let D;for(;D=w();)s.push(D)}else if(16&y){const w=Pf(t,n);if(Array.isArray(w))s.push(...w);else{const D=Na(t[16]);y_(D[1],D,w,s,!0)}}n=l?n.projectionNext:n.next}return s}class vm{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return y_(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(qr(t)){const n=t[8],s=n?n.indexOf(this):-1;s>-1&&(Hd(t,s),bd(n,s))}this._attachedToViewContainer=!1}Dg(this._lView[1],this._lView)}onDestroy(t){!function Rs(e,t,n,s){const l=a(t);null===n?l.push(s):(l.push(n),e.firstCreatePass&&c(e).push(s,l.length-1))}(this._lView[1],this._lView,null,t)}markForCheck(){Gl(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){sm(this._lView[1],this._lView,this.context)}checkNoChanges(){!function wv(e,t,n){pc(!0);try{sm(e,t,n)}finally{pc(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new _n(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Yy(e,t){Su(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new _n(902,"");this._appRef=t}}class EM extends vm{constructor(t){super(t),this._view=t}detectChanges(){am(this._view)}checkNoChanges(){!function e_(e){pc(!0);try{am(e)}finally{pc(!1)}}(this._view)}get context(){return null}}class Lb extends ym{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=kr(t);return new Uv(n,this.ngModule)}}function Ob(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class Uv extends Pb{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Pu(e){return e.map(sv).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Ob(this.componentDef.inputs)}get outputs(){return Ob(this.componentDef.outputs)}create(t,n,s,l){const d=(l=l||this.ngModule)?function DM(e,t){return{get:(n,s,l)=>{const d=e.get(n,Nv,l);return d!==Nv||s===Nv?d:t.get(n,s,l)}}}(t,l.injector):t,y=d.get(Rb,lu),w=d.get(wM,null),D=y.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",F=s?function Va(e,t,n){if(dr(e))return e.selectRootElement(t,n===qo.ShadowDom);let s="string"==typeof t?e.querySelector(t):t;return s.textContent="",s}(D,s,this.componentDef.encapsulation):Cf(y.createRenderer(null,this.componentDef),A,function TM(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(A)),V=this.componentDef.onPush?576:528,Q=function _i(e,t){return{components:[],scheduler:e||qy,clean:r,playerHandler:t||null,flags:0}}(),oe=sp(0,null,null,1,0,null,null,null,null,null),Te=Fu(null,oe,Q,V,null,null,y,D,w,d);let je,et;K(Te);try{const Je=function gi(e,t,n,s,l,d){const y=n[1];n[20]=e;const D=Dc(y,20,2,"#host",null),A=D.mergedAttrs=t.hostAttrs;null!==A&&(C(D,A,!0),null!==e&&(Fi(l,e,A),null!==D.classes&&Wd(l,e,D.classes),null!==D.styles&&Ag(l,e,D.styles)));const F=s.createRenderer(e,t),V=Fu(n,Jf(t),null,t.onPush?64:16,n[20],D,s,F,d||null,null);return y.firstCreatePass&&(nr(Cr(D,n),y,t.type),nm(y,D),Sc(D,n.length,1)),up(n,V),n[20]=V}(F,this.componentDef,Te,y,D);if(F)if(s)Fi(D,F,["ng-version",CM.full]);else{const{attrs:ke,classes:It}=function zf(e){const t=[],n=[];let s=1,l=2;for(;s<e.length;){let d=e[s];if("string"==typeof d)2===l?""!==d&&t.push(d,e[++s]):8===l&&n.push(d);else{if(!lo(l))break;l=d}s++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);ke&&Fi(D,F,ke),It&&It.length>0&&Wd(D,F,It.join(" "))}if(et=Sa(oe,20),void 0!==n){const ke=et.projection=[];for(let It=0;It<this.ngContentSelectors.length;It++){const Tt=n[It];ke.push(null!=Tt?Array.from(Tt):null)}}je=function Ar(e,t,n,s,l){const d=n[1],y=function ho(e,t,n){const s=Or();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),im(e,s,t,Mc(e,t,1,null),n));const l=_c(t,e,s.directiveStart,s);Ti(l,t);const d=Li(s,t);return d&&Ti(d,t),l}(d,n,t);if(s.components.push(y),e[8]=y,l&&l.forEach(D=>D(y,t)),t.contentQueries){const D=Or();t.contentQueries(1,y,D.directiveStart)}const w=Or();return!d.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(ue(w.index),Wg(n[1],w,0,w.directiveStart,w.directiveEnd,t),Bh(t,y)),y}(Je,this.componentDef,Te,Q,[Ni]),jl(oe,Te,null)}finally{ae()}return new IM(this.componentType,je,Dp(et,Te),Te,et)}}class IM extends class mM{}{constructor(t,n,s,l,d){super(),this.location=s,this._rootLView=l,this._tNode=d,this.instance=n,this.hostView=this.changeDetectorRef=new EM(l),this.componentType=t}get injector(){return new Ml(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Rc{}class Fb{}const Mp=new Map;class Nb extends Rc{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Lb(this);const s=ai(t);this._bootstrapComponents=ts(s.bootstrap),this._r3Injector=_e(t,n,[{provide:Rc,useValue:this},{provide:ym,useValue:this.componentFactoryResolver}],rn(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=Ft.THROW_IF_NOT_FOUND,s=Ut.Default){return t===Ft||t===Rc||t===P?this:this._r3Injector.get(t,n,s)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class jv extends Fb{constructor(t){super(),this.moduleType=t,null!==ai(t)&&function AM(e){const t=new Set;!function n(s){const l=ai(s,!0),d=l.id;null!==d&&(function zb(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${rn(t)} vs ${rn(t.name)}`)}(d,Mp.get(d),s),Mp.set(d,s));const y=ts(l.imports);for(const w of y)t.has(w)||(t.add(w),n(w))}(e)}(t)}create(t){return new Nb(this.moduleType,t)}}function Ub(e,t,n,s,l,d){const y=t+n;return Xn(e,y,l)?function oa(e,t,n){return e[t]=n}(e,y+1,d?s.call(d,l):s(l)):function xm(e,t){const n=e[t];return n===Yt?void 0:n}(e,y+1)}function Vv(e,t){const n=xn();let s;const l=e+20;n.firstCreatePass?(s=function jM(e,t){if(t)for(let n=t.length-1;n>=0;n--){const s=t[n];if(e===s.name)return s}}(t,n.pipeRegistry),n.data[l]=s,s.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(l,s.onDestroy)):s=n.data[l];const d=s.factory||(s.factory=bs(s.type)),y=no(Et);try{const w=Jo(!1),D=d();return Jo(w),function iT(e,t,n,s){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=s}(n,We(),l,D),D}finally{no(y)}}function $v(e,t,n){const s=e+20,l=We(),d=function Aa(e,t){return e[t]}(l,s);return function bm(e,t){return e[1].data[t].pure}(l,s)?Ub(l,function Fr(){const e=zt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),t,d.transform,n,d):d.transform(n)}function Gv(e){return t=>{setTimeout(e,void 0,t)}}const Bo=class qM extends mo{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,s){var l,d,y;let w=t,D=n||(()=>null),A=s;if(t&&"object"==typeof t){const V=t;w=null===(l=V.next)||void 0===l?void 0:l.bind(V),D=null===(d=V.error)||void 0===d?void 0:d.bind(V),A=null===(y=V.complete)||void 0===y?void 0:y.bind(V)}this.__isAsync&&(D=Gv(D),w&&(w=Gv(w)),A&&(A=Gv(A)));const F=super.subscribe({next:w,error:D,complete:A});return t instanceof Kn&&t.add(F),F}};Symbol;let Lc=(()=>{class e{}return e.__NG_ELEMENT_ID__=KM,e})();const WM=Lc,XM=class extends WM{constructor(t,n,s){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=s}createEmbeddedView(t){const n=this._declarationTContainer.tViews,s=Fu(this._declarationLView,n,t,16,null,n.declTNode,null,null,null,null);s[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(s[19]=d.createEmbeddedView(n)),jl(n,s,t),new vm(s)}};function KM(){return function v_(e,t){return 4&e.type?new XM(t,e,Dp(e,t)):null}(Or(),We())}let qa=(()=>{class e{}return e.__NG_ELEMENT_ID__=YM,e})();function YM(){return function Zb(e,t){let n;const s=t[e.index];if(qr(s))n=s;else{let l;if(8&e.type)l=pr(s);else{const d=t[11];l=d.createComment("");const y=Li(e,t);ri(d,Tc(d,y),l,function tv(e,t){return dr(e)?e.nextSibling(t):t.nextSibling}(d,y),!1)}t[e.index]=n=Qg(s,t,l,e),up(t,n)}return new Hb(n,e,t)}(Or(),We())}const JM=qa,Hb=class extends JM{constructor(t,n,s){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=s}get element(){return Dp(this._hostTNode,this._hostLView)}get injector(){return new Ml(this._hostTNode,this._hostLView)}get parentInjector(){const t=Tl(this._hostTNode,this._hostLView);if(zi(t)){const n=Yo(t,this._hostLView),s=Sn(t);return new Ml(n[1].data[s+8],n)}return new Ml(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=qb(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,s){const l=t.createEmbeddedView(n||{});return this.insert(l,s),l}createComponent(t,n,s,l,d){const y=t&&!function mu(e){return"function"==typeof e}(t);let w;if(y)w=n;else{const V=n||{};w=V.index,s=V.injector,l=V.projectableNodes,d=V.ngModuleRef}const D=y?t:new Uv(kr(t)),A=s||this.parentInjector;if(!d&&null==D.ngModule){const Q=(y?A:this.parentInjector).get(Rc,null);Q&&(d=Q)}const F=D.create(A,l,void 0,d);return this.insert(F.hostView,w),F}insert(t,n){const s=t._lView,l=s[1];if(function dh(e){return qr(e[3])}(s)){const F=this.indexOf(t);if(-1!==F)this.detach(F);else{const V=s[3],Q=new Hb(V,V[6],V[3]);Q.detach(Q.indexOf(t))}}const d=this._adjustIndex(n),y=this._lContainer;!function Qy(e,t,n,s){const l=10+s,d=n.length;s>0&&(n[l-1][4]=t),s<d-10?(t[4]=n[l],gu(n,10+s,t)):(n.push(t),t[4]=null),t[3]=n;const y=t[17];null!==y&&n!==y&&function Gd(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(y,t);const w=t[19];null!==w&&w.insertView(e),t[2]|=128}(l,s,y,d);const w=kf(d,y),D=s[11],A=Tc(D,y[7]);return null!==A&&function Ky(e,t,n,s,l,d){s[0]=l,s[6]=t,Su(e,s,n,1,l,d)}(l,y[6],D,s,A,w),t.attachToViewContainerRef(),gu(qv(y),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=qb(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),s=Hd(this._lContainer,n);s&&(bd(qv(this._lContainer),n),Dg(s[1],s))}detach(t){const n=this._adjustIndex(t,-1),s=Hd(this._lContainer,n);return s&&null!=bd(qv(this._lContainer),n)?new vm(s):null}_adjustIndex(t,n=0){return null==t?this.length+n:t}};function qb(e){return e[8]}function qv(e){return e[8]||(e[8]=[])}function w_(...e){}const a0=new yn("Application Initializer");let l0=(()=>{class e{constructor(n){this.appInits=n,this.resolve=w_,this.reject=w_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,l)=>{this.resolve=s,this.reject=l})}runInitializers(){if(this.initialized)return;const n=[],s=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const d=this.appInits[l]();if(l_(d))n.push(d);else if(h1(d)){const y=new Promise((w,D)=>{d.subscribe({complete:w,error:D})});n.push(y)}}Promise.all(n).then(()=>{s()}).catch(l=>{this.reject(l)}),0===n.length&&s(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(it(a0,8))},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Cm=new yn("AppId",{providedIn:"root",factory:function mw(){return`${c0()}${c0()}${c0()}`}});function c0(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const gw=new yn("Platform Initializer"),C_=new yn("Platform ID"),_w=new yn("appBootstrapListener");let yw=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const Hu=new yn("LocaleId",{providedIn:"root",factory:()=>eg(Hu,Ut.Optional|Ut.SkipSelf)||function T2(){return"undefined"!=typeof $localize&&$localize.locale||h_}()});class M2{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let vw=(()=>{class e{compileModuleSync(n){return new jv(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const s=this.compileModuleSync(n),d=ts(ai(n).declarations).reduce((y,w)=>{const D=kr(w);return D&&y.push(new Uv(D)),y},[]);return new M2(s,d)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const S2=(()=>Promise.resolve(0))();function u0(e){"undefined"==typeof Zone?S2.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Xi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Bo(!1),this.onMicrotaskEmpty=new Bo(!1),this.onStable=new Bo(!1),this.onError=new Bo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!s&&n,l.shouldCoalesceRunChangeDetection=s,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function A2(){let e=Mn.requestAnimationFrame,t=Mn.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const s=t[Zone.__symbol__("OriginalDelegate")];s&&(t=s)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function R2(e){const t=()=>{!function k2(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Mn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,d0(e),e.isCheckStableRunning=!0,h0(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),d0(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,s,l,d,y,w)=>{try{return xw(e),n.invokeTask(l,d,y,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&t(),bw(e)}},onInvoke:(n,s,l,d,y,w,D)=>{try{return xw(e),n.invoke(l,d,y,w,D)}finally{e.shouldCoalesceRunChangeDetection&&t(),bw(e)}},onHasTask:(n,s,l,d)=>{n.hasTask(l,d),s===l&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,d0(e),h0(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(n,s,l,d)=>(n.handleError(l,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(l)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Xi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Xi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,s){return this._inner.run(t,n,s)}runTask(t,n,s,l){const d=this._inner,y=d.scheduleEventTask("NgZoneEvent: "+l,t,P2,w_,w_);try{return d.runTask(y,n,s)}finally{d.cancelTask(y)}}runGuarded(t,n,s){return this._inner.runGuarded(t,n,s)}runOutsideAngular(t){return this._outer.run(t)}}const P2={};function h0(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function d0(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function xw(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function bw(e){e._nesting--,h0(e)}class L2{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Bo,this.onMicrotaskEmpty=new Bo,this.onStable=new Bo,this.onError=new Bo}run(t,n,s){return t.apply(n,s)}runGuarded(t,n,s){return t.apply(n,s)}runOutsideAngular(t){return t()}runTask(t,n,s,l){return t.apply(n,s)}}let p0=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Xi.assertNotInAngularZone(),u0(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())u0(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(n)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,s,l){let d=-1;s&&s>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==d),n(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:n,timeoutId:d,updateCb:l})}whenStable(n,s,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,s,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,s,l){return[]}}return e.\u0275fac=function(n){return new(n||e)(it(Xi))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),ww=(()=>{class e{constructor(){this._applications=new Map,f0.addToWindow(this)}registerApplication(n,s){this._applications.set(n,s)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,s=!0){return f0.findTestabilityInTree(this,n,s)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();class O2{addToWindow(t){}findTestabilityInTree(t,n,s){return null}}let Za,f0=new O2;const Cw=new yn("AllowMultipleToken");class Ew{constructor(t,n){this.name=t,this.token=n}}function Tw(e,t,n=[]){const s=`Platform: ${t}`,l=new yn(s);return(d=[])=>{let y=Dw();if(!y||y.injector.get(Cw,!1))if(e)e(n.concat(d).concat({provide:l,useValue:!0}));else{const w=n.concat(d).concat({provide:l,useValue:!0},{provide:N,useValue:"platform"});!function N2(e){if(Za&&!Za.destroyed&&!Za.injector.get(Cw,!1))throw new _n(400,"");Za=e.get(Mw);const t=e.get(gw,null);t&&t.forEach(n=>n())}(Ft.create({providers:w,name:s}))}return function U2(e){const t=Dw();if(!t)throw new _n(401,"");return t}()}}function Dw(){return Za&&!Za.destroyed?Za:null}let Mw=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,s){const w=function j2(e,t){let n;return n="noop"===e?new L2:("zone.js"===e?void 0:e)||new Xi({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(s?s.ngZone:void 0,{ngZoneEventCoalescing:s&&s.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:s&&s.ngZoneRunCoalescing||!1}),D=[{provide:Xi,useValue:w}];return w.run(()=>{const A=Ft.create({providers:D,parent:this.injector,name:n.moduleType.name}),F=n.create(A),V=F.injector.get(Ph,null);if(!V)throw new _n(402,"");return w.runOutsideAngular(()=>{const Q=w.onError.subscribe({next:oe=>{V.handleError(oe)}});F.onDestroy(()=>{g0(this._modules,F),Q.unsubscribe()})}),function V2(e,t,n){try{const s=n();return l_(s)?s.catch(l=>{throw t.runOutsideAngular(()=>e.handleError(l)),l}):s}catch(s){throw t.runOutsideAngular(()=>e.handleError(s)),s}}(V,w,()=>{const Q=F.injector.get(l0);return Q.runInitializers(),Q.donePromise.then(()=>(function vD(e){kt(e,"Expected localeId to be defined"),"string"==typeof e&&(sb=e.toLowerCase().replace(/_/g,"-"))}(F.injector.get(Hu,h_)||h_),this._moduleDoBootstrap(F),F))})})}bootstrapModule(n,s=[]){const l=Iw({},s);return function z2(e,t,n){const s=new jv(n);return Promise.resolve(s)}(0,0,n).then(d=>this.bootstrapModuleFactory(d,l))}_moduleDoBootstrap(n){const s=n.injector.get(m0);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(l=>s.bootstrap(l));else{if(!n.instance.ngDoBootstrap)throw new _n(403,"");n.instance.ngDoBootstrap(s)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new _n(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(it(Ft))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();function Iw(e,t){return Array.isArray(t)?t.reduce(Iw,e):Object.assign(Object.assign({},e),t)}let m0=(()=>{class e{constructor(n,s,l,d,y){this._zone=n,this._injector=s,this._exceptionHandler=l,this._componentFactoryResolver=d,this._initStatus=y,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new Rn(A=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{A.next(this._stable),A.complete()})}),D=new Rn(A=>{let F;this._zone.runOutsideAngular(()=>{F=this._zone.onStable.subscribe(()=>{Xi.assertNotInAngularZone(),u0(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,A.next(!0))})})});const V=this._zone.onUnstable.subscribe(()=>{Xi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{A.next(!1)}))});return()=>{F.unsubscribe(),V.unsubscribe()}});this.isStable=function tc(...e){const t=jt(e),n=function $n(e,t){return"number"==typeof wt(e)?e.pop():t}(e,1/0),s=e;return s.length?1===s.length?vr(s[0]):Re(n)(Pr(s,t)):ze}(w,D.pipe(function Xc(e={}){const{connector:t=(()=>new mo),resetOnError:n=!0,resetOnComplete:s=!0,resetOnRefCountZero:l=!0}=e;return d=>{let y=null,w=null,D=null,A=0,F=!1,V=!1;const Q=()=>{null==w||w.unsubscribe(),w=null},oe=()=>{Q(),y=D=null,F=V=!1},Te=()=>{const je=y;oe(),null==je||je.unsubscribe()};return yr((je,et)=>{A++,!V&&!F&&Q();const Je=D=null!=D?D:t();et.add(()=>{A--,0===A&&!V&&!F&&(w=il(Te,l))}),Je.subscribe(et),y||(y=new st({next:ke=>Je.next(ke),error:ke=>{V=!0,Q(),w=il(oe,n,ke),Je.error(ke)},complete:()=>{F=!0,Q(),w=il(oe,s),Je.complete()}}),Pr(je).subscribe(y))})(d)}}()))}bootstrap(n,s){if(!this._initStatus.done)throw new _n(405,"");let l;l=n instanceof Pb?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(l.componentType);const d=function B2(e){return e.isBoundToModule}(l)?void 0:this._injector.get(Rc),w=l.create(Ft.NULL,[],s||l.selector,d),D=w.location.nativeElement,A=w.injector.get(p0,null),F=A&&w.injector.get(ww);return A&&F&&F.registerApplication(D,A),w.onDestroy(()=>{this.detachView(w.hostView),g0(this.components,w),F&&F.unregisterApplication(D)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new _n(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const s=n;this._views.push(s),s.attachToAppRef(this)}detachView(n){const s=n;g0(this._views,s),s.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(_w,[]).concat(this._bootstrapListeners).forEach(l=>l(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(it(Xi),it(Ft),it(Ph),it(ym),it(l0))},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function g0(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Aw=!0,_0=(()=>{class e{}return e.__NG_ELEMENT_ID__=H2,e})();function H2(e){return function q2(e,t,n){if(ml(e)&&!n){const s=Oi(e.index,t);return new vm(s,s)}return 47&e.type?new vm(t[16],t):null}(Or(),We(),16==(16&e))}class Ow{constructor(){}supports(t){return kc(t)}create(t){return new J2(t)}}const Y2=(e,t)=>t;class J2{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Y2}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,s=this._removalsHead,l=0,d=null;for(;n||s;){const y=!s||n&&n.currentIndex<zw(s,l,d)?n:s,w=zw(y,l,d),D=y.currentIndex;if(y===s)l--,s=s._nextRemoved;else if(n=n._next,null==y.previousIndex)l++;else{d||(d=[]);const A=w-l,F=D-l;if(A!=F){for(let Q=0;Q<A;Q++){const oe=Q<d.length?d[Q]:d[Q]=0,Te=oe+Q;F<=Te&&Te<A&&(d[Q]=oe+1)}d[y.previousIndex]=F-A}}w!==D&&t(y,w,D)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!kc(t))throw new _n(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let l,d,y,n=this._itHead,s=!1;if(Array.isArray(t)){this.length=t.length;for(let w=0;w<this.length;w++)d=t[w],y=this._trackByFn(w,d),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,d,y,w)),Object.is(n.item,d)||this._addIdentityChange(n,d)):(n=this._mismatch(n,d,y,w),s=!0),n=n._next}else l=0,function Hl(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Wi()]();let s;for(;!(s=n.next()).done;)t(s.value)}}(t,w=>{y=this._trackByFn(l,w),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,w,y,l)),Object.is(n.item,w)||this._addIdentityChange(n,w)):(n=this._mismatch(n,w,y,l),s=!0),n=n._next,l++}),this.length=l;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,s,l){let d;return null===t?d=this._itTail:(d=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,d,l)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(s,l))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,d,l)):t=this._addAfter(new Q2(n,s),d,l),t}_verifyReinsertion(t,n,s,l){let d=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==d?t=this._reinsertAfter(d,t._prev,l):t.currentIndex!=l&&(t.currentIndex=l,this._addToMoves(t,l)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const l=t._prevRemoved,d=t._nextRemoved;return null===l?this._removalsHead=d:l._nextRemoved=d,null===d?this._removalsTail=l:d._prevRemoved=l,this._insertAfter(t,n,s),this._addToMoves(t,s),t}_moveAfter(t,n,s){return this._unlink(t),this._insertAfter(t,n,s),this._addToMoves(t,s),t}_addAfter(t,n,s){return this._insertAfter(t,n,s),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,s){const l=null===n?this._itHead:n._next;return t._next=l,t._prev=n,null===l?this._itTail=t:l._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new Fw),this._linkedRecords.put(t),t.currentIndex=s,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,s=t._next;return null===n?this._itHead=s:n._next=s,null===s?this._itTail=n:s._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Fw),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Q2{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class eI{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===n||n<=s.currentIndex)&&Object.is(s.trackById,t))return s;return null}remove(t){const n=t._prevDup,s=t._nextDup;return null===n?this._head=s:n._nextDup=s,null===s?this._tail=n:s._prevDup=n,null===this._head}}class Fw{constructor(){this.map=new Map}put(t){const n=t.trackById;let s=this.map.get(n);s||(s=new eI,this.map.set(n,s)),s.add(t)}get(t,n){const l=this.map.get(t);return l?l.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function zw(e,t,n){const s=e.previousIndex;if(null===s)return s;let l=0;return n&&s<n.length&&(l=n[s]),s+t+l}function Nw(){return new D_([new Ow])}let D_=(()=>{class e{constructor(n){this.factories=n}static create(n,s){if(null!=s){const l=s.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:s=>e.create(n,s||Nw()),deps:[[e,new vc,new Ei]]}}find(n){const s=this.factories.find(l=>l.supports(n));if(null!=s)return s;throw new _n(901,"")}}return e.\u0275prov=gt({token:e,providedIn:"root",factory:Nw}),e})();const oI=Tw(null,"core",[{provide:C_,useValue:"unknown"},{provide:Mw,deps:[Ft]},{provide:ww,deps:[]},{provide:yw,deps:[]}]);let sI=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(it(m0))},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({}),e})(),M_=null;function qu(){return M_}const Uo=new yn("DocumentToken");let Zh=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:function(){return function uI(){return it(jw)}()},providedIn:"platform"}),e})();const hI=new yn("Location Initialized");let jw=(()=>{class e extends Zh{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return qu().getBaseHref(this._doc)}onPopState(n){const s=qu().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",n,!1),()=>s.removeEventListener("popstate",n)}onHashChange(n){const s=qu().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",n,!1),()=>s.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,s,l){Vw()?this._history.pushState(n,s,l):this.location.hash=l}replaceState(n,s,l){Vw()?this._history.replaceState(n,s,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(it(Uo))},e.\u0275prov=gt({token:e,factory:function(){return function dI(){return new jw(it(Uo))}()},providedIn:"platform"}),e})();function Vw(){return!!window.history.pushState}function w0(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function $w(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Oc(e){return e&&"?"!==e[0]?"?"+e:e}let Sp=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:function(){return function pI(e){const t=it(Uo).location;return new Gw(it(Zh),t&&t.origin||"")}()},providedIn:"root"}),e})();const C0=new yn("appBaseHref");let Gw=(()=>{class e extends Sp{constructor(n,s){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==s&&(s=this._platformLocation.getBaseHrefFromDOM()),null==s)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=s}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return w0(this._baseHref,n)}path(n=!1){const s=this._platformLocation.pathname+Oc(this._platformLocation.search),l=this._platformLocation.hash;return l&&n?`${s}${l}`:s}pushState(n,s,l,d){const y=this.prepareExternalUrl(l+Oc(d));this._platformLocation.pushState(n,s,y)}replaceState(n,s,l,d){const y=this.prepareExternalUrl(l+Oc(d));this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformLocation).historyGo)||void 0===l||l.call(s,n)}}return e.\u0275fac=function(n){return new(n||e)(it(Zh),it(C0,8))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),fI=(()=>{class e extends Sp{constructor(n,s){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=s&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let s=this._platformLocation.hash;return null==s&&(s="#"),s.length>0?s.substring(1):s}prepareExternalUrl(n){const s=w0(this._baseHref,n);return s.length>0?"#"+s:s}pushState(n,s,l,d){let y=this.prepareExternalUrl(l+Oc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,s,y)}replaceState(n,s,l,d){let y=this.prepareExternalUrl(l+Oc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformLocation).historyGo)||void 0===l||l.call(s,n)}}return e.\u0275fac=function(n){return new(n||e)(it(Zh),it(C0,8))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),E0=(()=>{class e{constructor(n,s){this._subject=new Bo,this._urlChangeListeners=[],this._platformStrategy=n;const l=this._platformStrategy.getBaseHref();this._platformLocation=s,this._baseHref=$w(Hw(l)),this._platformStrategy.onPopState(d=>{this._subject.emit({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,s=""){return this.path()==this.normalize(n+Oc(s))}normalize(n){return e.stripTrailingSlash(function gI(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Hw(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,s="",l=null){this._platformStrategy.pushState(l,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Oc(s)),l)}replaceState(n,s="",l=null){this._platformStrategy.replaceState(l,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Oc(s)),l)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformStrategy).historyGo)||void 0===l||l.call(s,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}))}_notifyUrlChangeListeners(n="",s){this._urlChangeListeners.forEach(l=>l(n,s))}subscribe(n,s,l){return this._subject.subscribe({next:n,error:s,complete:l})}}return e.normalizeQueryParams=Oc,e.joinWithSlash=w0,e.stripTrailingSlash=$w,e.\u0275fac=function(n){return new(n||e)(it(Sp),it(Zh))},e.\u0275prov=gt({token:e,factory:function(){return function mI(){return new E0(it(Sp),it(Zh))}()},providedIn:"root"}),e})();function Hw(e){return e.replace(/\/index.html$/,"")}function eC(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const s=n.indexOf("="),[l,d]=-1==s?[n,""]:[n.slice(0,s),n.slice(s+1)];if(l.trim()===t)return decodeURIComponent(d)}return null}class tS{constructor(t,n,s,l){this.$implicit=t,this.ngForOf=n,this.index=s,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let tC=(()=>{class e{constructor(n,s,l){this._viewContainer=n,this._template=s,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const s=this._viewContainer;n.forEachOperation((l,d,y)=>{if(null==l.previousIndex)s.createEmbeddedView(this._template,new tS(l.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)s.remove(null===d?void 0:d);else if(null!==d){const w=s.get(d);s.move(w,y),nC(w,l)}});for(let l=0,d=s.length;l<d;l++){const w=s.get(l).context;w.index=l,w.count=d,w.ngForOf=this._ngForOf}n.forEachIdentityChange(l=>{nC(s.get(l.currentIndex),l)})}static ngTemplateContextGuard(n,s){return!0}}return e.\u0275fac=function(n){return new(n||e)(Et(qa),Et(Lc),Et(D_))},e.\u0275dir=Mr({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();function nC(e,t){e.context.$implicit=t.item}let L0=(()=>{class e{constructor(n,s){this._viewContainer=n,this._context=new nS,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){rC("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){rC("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,s){return!0}}return e.\u0275fac=function(n){return new(n||e)(Et(qa),Et(Lc))},e.\u0275dir=Mr({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class nS{constructor(){this.$implicit=null,this.ngIf=null}}function rC(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${rn(t)}'.`)}let SS=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({}),e})();let RS=(()=>{class e{}return e.\u0275prov=gt({token:e,providedIn:"root",factory:()=>new LS(it(Uo),window)}),e})();class LS{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function OS(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const s=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=s.currentNode;for(;l;){const d=l.shadowRoot;if(d){const y=d.getElementById(t)||d.querySelector(`[name="${t}"]`);if(y)return y}l=s.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),s=n.left+this.window.pageXOffset,l=n.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(s-d[0],l-d[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=aC(this.window.history)||aC(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function aC(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class lC{}class N0 extends class FS extends class cI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function lI(e){M_||(M_=e)}(new N0)}onAndCancel(t,n,s){return t.addEventListener(n,s,!1),()=>{t.removeEventListener(n,s,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function zS(){return Mm=Mm||document.querySelector("base"),Mm?Mm.getAttribute("href"):null}();return null==n?null:function BS(e){z_=z_||document.createElement("a"),z_.setAttribute("href",e);const t=z_.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Mm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return eC(document.cookie,t)}}let z_,Mm=null;const cC=new yn("TRANSITION_ID"),US=[{provide:a0,useFactory:function NS(e,t,n){return()=>{n.get(l0).donePromise.then(()=>{const s=qu(),l=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let d=0;d<l.length;d++)s.remove(l[d])})}},deps:[cC,Uo,Ft],multi:!0}];class U0{static init(){!function F2(e){f0=e}(new U0)}addToWindow(t){Mn.getAngularTestability=(s,l=!0)=>{const d=t.findTestabilityInTree(s,l);if(null==d)throw new Error("Could not find testability for element.");return d},Mn.getAllAngularTestabilities=()=>t.getAllTestabilities(),Mn.getAllAngularRootElements=()=>t.getAllRootElements(),Mn.frameworkStabilizers||(Mn.frameworkStabilizers=[]),Mn.frameworkStabilizers.push(s=>{const l=Mn.getAllAngularTestabilities();let d=l.length,y=!1;const w=function(D){y=y||D,d--,0==d&&s(y)};l.forEach(function(D){D.whenStable(w)})})}findTestabilityInTree(t,n,s){if(null==n)return null;const l=t.getTestability(n);return null!=l?l:s?qu().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null}}let jS=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const B_=new yn("EventManagerPlugins");let N_=(()=>{class e{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(l=>l.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,s,l){return this._findPluginFor(s).addEventListener(n,s,l)}addGlobalEventListener(n,s,l){return this._findPluginFor(s).addGlobalEventListener(n,s,l)}getZone(){return this._zone}_findPluginFor(n){const s=this._eventNameToPlugin.get(n);if(s)return s;const l=this._plugins;for(let d=0;d<l.length;d++){const y=l[d];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(it(B_),it(Xi))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();class uC{constructor(t){this._doc=t}addGlobalEventListener(t,n,s){const l=qu().getGlobalEventTarget(this._doc,t);if(!l)throw new Error(`Unsupported event target ${l} for event ${n}`);return this.addEventListener(l,n,s)}}let hC=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const s=new Set;n.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),s.add(l))}),this.onStylesAdded(s)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),Im=(()=>{class e extends hC{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,s,l){n.forEach(d=>{const y=this._doc.createElement("style");y.textContent=d,l.push(s.appendChild(y))})}addHost(n){const s=[];this._addStylesToHost(this._stylesSet,n,s),this._hostNodes.set(n,s)}removeHost(n){const s=this._hostNodes.get(n);s&&s.forEach(dC),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((s,l)=>{this._addStylesToHost(n,l,s)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(dC))}}return e.\u0275fac=function(n){return new(n||e)(it(Uo))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();function dC(e){qu().remove(e)}const j0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},V0=/%COMP%/g;function U_(e,t,n){for(let s=0;s<t.length;s++){let l=t[s];Array.isArray(l)?U_(e,l,n):(l=l.replace(V0,e),n.push(l))}return n}function mC(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let $0=(()=>{class e{constructor(n,s,l){this.eventManager=n,this.sharedStylesHost=s,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new G0(n)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;switch(s.encapsulation){case qo.Emulated:{let l=this.rendererByCompId.get(s.id);return l||(l=new ZS(this.eventManager,this.sharedStylesHost,s,this.appId),this.rendererByCompId.set(s.id,l)),l.applyToHost(n),l}case 1:case qo.ShadowDom:return new WS(this.eventManager,this.sharedStylesHost,n,s);default:if(!this.rendererByCompId.has(s.id)){const l=U_(s.id,s.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(s.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(it(N_),it(Im),it(Cm))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();class G0{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(j0[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,s){t&&t.insertBefore(n,s)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let s="string"==typeof t?document.querySelector(t):t;if(!s)throw new Error(`The selector "${t}" did not match any elements`);return n||(s.textContent=""),s}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,s,l){if(l){n=l+":"+n;const d=j0[l];d?t.setAttributeNS(d,n,s):t.setAttribute(n,s)}else t.setAttribute(n,s)}removeAttribute(t,n,s){if(s){const l=j0[s];l?t.removeAttributeNS(l,n):t.removeAttribute(`${s}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,s,l){l&(Di.DashCase|Di.Important)?t.style.setProperty(n,s,l&Di.Important?"important":""):t.style[n]=s}removeStyle(t,n,s){s&Di.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,s){t[n]=s}setValue(t,n){t.nodeValue=n}listen(t,n,s){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,mC(s)):this.eventManager.addEventListener(t,n,mC(s))}}class ZS extends G0{constructor(t,n,s,l){super(t),this.component=s;const d=U_(l+"-"+s.id,s.styles,[]);n.addStyles(d),this.contentAttr=function GS(e){return"_ngcontent-%COMP%".replace(V0,e)}(l+"-"+s.id),this.hostAttr=function HS(e){return"_nghost-%COMP%".replace(V0,e)}(l+"-"+s.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const s=super.createElement(t,n);return super.setAttribute(s,this.contentAttr,""),s}}class WS extends G0{constructor(t,n,s,l){super(t),this.sharedStylesHost=n,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const d=U_(l.id,l.styles,[]);for(let y=0;y<d.length;y++){const w=document.createElement("style");w.textContent=d[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,s){return super.insertBefore(this.nodeOrShadowRoot(t),n,s)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let XS=(()=>{class e extends uC{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,l){return n.addEventListener(s,l,!1),()=>this.removeEventListener(n,s,l)}removeEventListener(n,s,l){return n.removeEventListener(s,l)}}return e.\u0275fac=function(n){return new(n||e)(it(Uo))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const _C=["alt","control","meta","shift"],YS={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},yC={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},JS={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let QS=(()=>{class e extends uC{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,s,l){const d=e.parseEventName(s),y=e.eventCallback(d.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>qu().onAndCancel(n,d.domEventName,y))}static parseEventName(n){const s=n.toLowerCase().split("."),l=s.shift();if(0===s.length||"keydown"!==l&&"keyup"!==l)return null;const d=e._normalizeKey(s.pop());let y="";if(_C.forEach(D=>{const A=s.indexOf(D);A>-1&&(s.splice(A,1),y+=D+".")}),y+=d,0!=s.length||0===d.length)return null;const w={};return w.domEventName=l,w.fullKey=y,w}static getEventFullKey(n){let s="",l=function eA(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&yC.hasOwnProperty(t)&&(t=yC[t]))}return YS[t]||t}(n);return l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),_C.forEach(d=>{d!=l&&JS[d](n)&&(s+=d+".")}),s+=l,s}static eventCallback(n,s,l){return d=>{e.getEventFullKey(d)===n&&l.runGuarded(()=>s(d))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(it(Uo))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const iA=Tw(oI,"browser",[{provide:C_,useValue:"browser"},{provide:gw,useValue:function tA(){N0.makeCurrent(),U0.init()},multi:!0},{provide:Uo,useFactory:function rA(){return function dd(e){bl=e}(document),document},deps:[]}]),oA=[{provide:N,useValue:"root"},{provide:Ph,useFactory:function nA(){return new Ph},deps:[]},{provide:B_,useClass:XS,multi:!0,deps:[Uo,Xi,C_]},{provide:B_,useClass:QS,multi:!0,deps:[Uo]},{provide:$0,useClass:$0,deps:[N_,Im,Cm]},{provide:Rb,useExisting:$0},{provide:hC,useExisting:Im},{provide:Im,useClass:Im,deps:[Uo]},{provide:p0,useClass:p0,deps:[Xi]},{provide:N_,useClass:N_,deps:[B_,Xi]},{provide:lC,useClass:jS,deps:[]}];let sA=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:Cm,useValue:n.appId},{provide:cC,useExisting:Cm},US]}}}return e.\u0275fac=function(n){return new(n||e)(it(e,12))},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({providers:oA,imports:[SS,sI]}),e})();"undefined"!=typeof window&&window;let bC=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:function(n){let s=null;return s=n?new(n||e):it(wC),s},providedIn:"root"}),e})(),wC=(()=>{class e extends bC{constructor(n){super(),this._doc=n}sanitize(n,s){if(null==s)return null;switch(n){case Hn.NONE:return s;case Hn.HTML:return Ss(s,"HTML")?Hi(s):zd(this._doc,String(s)).toString();case Hn.STYLE:return Ss(s,"Style")?Hi(s):s;case Hn.SCRIPT:if(Ss(s,"Script"))return Hi(s);throw new Error("unsafe value used in a script context");case Hn.URL:return Rd(s),Ss(s,"URL")?Hi(s):Ba(String(s));case Hn.RESOURCE_URL:if(Ss(s,"ResourceURL"))return Hi(s);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${n} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(n){return function zl(e){return new wy(e)}(n)}bypassSecurityTrustStyle(n){return function Ro(e){return new og(e)}(n)}bypassSecurityTrustScript(n){return function Ty(e){return new Cy(e)}(n)}bypassSecurityTrustUrl(n){return function of(e){return new Ey(e)}(n)}bypassSecurityTrustResourceUrl(n){return function Dy(e){return new sg(e)}(n)}}return e.\u0275fac=function(n){return new(n||e)(it(Uo))},e.\u0275prov=gt({token:e,factory:function(n){let s=null;return s=n?new n:function gA(e){return new wC(e.get(Uo))}(it(Ft)),s},providedIn:"root"}),e})();function hn(...e){return Pr(e,jt(e))}class Ka extends mo{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:s}=this;if(t)throw n;return this._throwIfClosed(),s}next(t){super.next(this._value=t)}}const{isArray:_A}=Array,{getPrototypeOf:yA,prototype:vA,keys:xA}=Object;const{isArray:CA}=Array;function MA(...e){const t=jt(e),n=function St(e){return jn(wt(e))?e.pop():void 0}(e),{args:s,keys:l}=function bA(e){if(1===e.length){const t=e[0];if(_A(t))return{args:t,keys:null};if(function wA(e){return e&&"object"==typeof e&&yA(e)===vA}(t)){const n=xA(t);return{args:n.map(s=>t[s]),keys:n}}}return{args:e,keys:null}}(e);if(0===s.length)return Pr([],t);const d=new Rn(function IA(e,t,n=an){return s=>{CC(t,()=>{const{length:l}=e,d=new Array(l);let y=l,w=l;for(let D=0;D<l;D++)CC(t,()=>{const A=Pr(e[D],t);let F=!1;A.subscribe(Dr(s,V=>{d[D]=V,F||(F=!0,w--),w||s.next(n(d.slice()))},()=>{--y||s.complete()}))},s)},s)}}(s,t,l?y=>function DA(e,t){return e.reduce((n,s,l)=>(n[s]=t[l],n),{})}(l,y):an));return n?d.pipe(function TA(e){return Cn(t=>function EA(e,t){return CA(t)?e(...t):e(t)}(e,t))}(n)):d}function CC(e,t,n){e?xe(n,e,t):t()}function j_(e,t){const n=jn(e)?e:()=>e,s=l=>l.error(n());return new Rn(t?l=>t.schedule(s,0,l):s)}const V_=ua(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function q0(...e){return function SA(){return Re(1)}()(Pr(e,jt(e)))}function EC(e){return new Rn(t=>{vr(e()).subscribe(t)})}function TC(){return yr((e,t)=>{let n=null;e._refCount++;const s=Dr(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const l=e._connection,d=n;n=null,l&&(!d||l===d)&&l.unsubscribe(),t.unsubscribe()});e.subscribe(s),s.closed||(n=e.connect())})}class AA extends Rn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,go(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Kn;const n=this.getSubject();t.add(this.source.subscribe(Dr(n,void 0,()=>{this._teardown(),n.complete()},s=>{this._teardown(),n.error(s)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Kn.EMPTY)}return t}refCount(){return TC()(this)}}function Wh(e,t){return yr((n,s)=>{let l=null,d=0,y=!1;const w=()=>y&&!l&&s.complete();n.subscribe(Dr(s,D=>{null==l||l.unsubscribe();let A=0;const F=d++;vr(e(D,F)).subscribe(l=Dr(s,V=>s.next(t?t(D,V,F,A++):V),()=>{l=null,w()}))},()=>{y=!0,w()}))})}function kA(e,t,n,s,l){return(d,y)=>{let w=n,D=t,A=0;d.subscribe(Dr(y,F=>{const V=A++;D=w?e(D,F,V):(w=!0,F),s&&y.next(D)},l&&(()=>{w&&y.next(D),y.complete()})))}}function DC(e,t){return yr(kA(e,t,arguments.length>=2,!0))}function Xh(e,t){return yr((n,s)=>{let l=0;n.subscribe(Dr(s,d=>e.call(t,d,l++)&&s.next(d)))})}function Wu(e){return yr((t,n)=>{let d,s=null,l=!1;s=t.subscribe(Dr(n,void 0,void 0,y=>{d=vr(e(y,Wu(e)(t))),s?(s.unsubscribe(),s=null,d.subscribe(n)):l=!0})),l&&(s.unsubscribe(),s=null,d.subscribe(n))})}function Ap(e,t){return jn(t)?Ce(e,t,1):Ce(e,1)}function Z0(e){return e<=0?()=>ze:yr((t,n)=>{let s=[];t.subscribe(Dr(n,l=>{s.push(l),e<s.length&&s.shift()},()=>{for(const l of s)n.next(l);n.complete()},void 0,()=>{s=null}))})}function MC(e=RA){return yr((t,n)=>{let s=!1;t.subscribe(Dr(n,l=>{s=!0,n.next(l)},()=>s?n.complete():n.error(e())))})}function RA(){return new V_}function IC(e){return yr((t,n)=>{let s=!1;t.subscribe(Dr(n,l=>{s=!0,n.next(l)},()=>{s||n.next(e),n.complete()}))})}function Pp(e,t){const n=arguments.length>=2;return s=>s.pipe(e?Xh((l,d)=>e(l,d,s)):an,rl(1),n?IC(t):MC(()=>new V_))}function Os(e,t,n){const s=jn(e)||t||n?{next:e,error:t,complete:n}:e;return s?yr((l,d)=>{var y;null===(y=s.subscribe)||void 0===y||y.call(s);let w=!0;l.subscribe(Dr(d,D=>{var A;null===(A=s.next)||void 0===A||A.call(s,D),d.next(D)},()=>{var D;w=!1,null===(D=s.complete)||void 0===D||D.call(s),d.complete()},D=>{var A;w=!1,null===(A=s.error)||void 0===A||A.call(s,D),d.error(D)},()=>{var D,A;w&&(null===(D=s.unsubscribe)||void 0===D||D.call(s)),null===(A=s.finalize)||void 0===A||A.call(s)}))}):an}class zc{constructor(t,n){this.id=t,this.url=n}}class W0 extends zc{constructor(t,n,s="imperative",l=null){super(t,n),this.navigationTrigger=s,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Sm extends zc{constructor(t,n,s){super(t,n),this.urlAfterRedirects=s}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class SC extends zc{constructor(t,n,s){super(t,n),this.reason=s}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class FA extends zc{constructor(t,n,s){super(t,n),this.error=s}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class zA extends zc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class BA extends zc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NA extends zc{constructor(t,n,s,l,d){super(t,n),this.urlAfterRedirects=s,this.state=l,this.shouldActivate=d}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class UA extends zc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jA extends zc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class AC{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class PC{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class VA{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $A{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GA{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HA{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kC{constructor(t,n,s){this.routerEvent=t,this.position=n,this.anchor=s}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const wn="primary";class qA{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function kp(e){return new qA(e)}const RC="ngNavigationCancelingError";function X0(e){const t=Error("NavigationCancelingError: "+e);return t[RC]=!0,t}function WA(e,t,n){const s=n.path.split("/");if(s.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||s.length<e.length))return null;const l={};for(let d=0;d<s.length;d++){const y=s[d],w=e[d];if(y.startsWith(":"))l[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:e.slice(0,s.length),posParams:l}}function Wl(e,t){const n=e?Object.keys(e):void 0,s=t?Object.keys(t):void 0;if(!n||!s||n.length!=s.length)return!1;let l;for(let d=0;d<n.length;d++)if(l=n[d],!LC(e[l],t[l]))return!1;return!0}function LC(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),s=[...t].sort();return n.every((l,d)=>s[d]===l)}return e===t}function OC(e){return Array.prototype.concat.apply([],e)}function FC(e){return e.length>0?e[e.length-1]:null}function Ki(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Xl(e){return h1(e)?e:l_(e)?Pr(Promise.resolve(e)):hn(e)}const YA={exact:function NC(e,t,n){if(!Yh(e.segments,t.segments)||!$_(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const s in t.children)if(!e.children[s]||!NC(e.children[s],t.children[s],n))return!1;return!0},subset:UC},zC={exact:function JA(e,t){return Wl(e,t)},subset:function QA(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>LC(e[n],t[n]))},ignored:()=>!0};function BC(e,t,n){return YA[n.paths](e.root,t.root,n.matrixParams)&&zC[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function UC(e,t,n){return jC(e,t,t.segments,n)}function jC(e,t,n,s){if(e.segments.length>n.length){const l=e.segments.slice(0,n.length);return!(!Yh(l,n)||t.hasChildren()||!$_(l,n,s))}if(e.segments.length===n.length){if(!Yh(e.segments,n)||!$_(e.segments,n,s))return!1;for(const l in t.children)if(!e.children[l]||!UC(e.children[l],t.children[l],s))return!1;return!0}{const l=n.slice(0,e.segments.length),d=n.slice(e.segments.length);return!!(Yh(e.segments,l)&&$_(e.segments,l,s)&&e.children[wn])&&jC(e.children[wn],t,d,s)}}function $_(e,t,n){return t.every((s,l)=>zC[n](e[l].parameters,s.parameters))}class Kh{constructor(t,n,s){this.root=t,this.queryParams=n,this.fragment=s}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kp(this.queryParams)),this._queryParamMap}toString(){return nP.serialize(this)}}class An{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Ki(n,(s,l)=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return G_(this)}}class Am{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=kp(this.parameters)),this._parameterMap}toString(){return qC(this)}}function Yh(e,t){return e.length===t.length&&e.every((n,s)=>n.path===t[s].path)}class VC{}class $C{parse(t){const n=new hP(t);return new Kh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${Pm(t.root,!0)}`,s=function oP(e){const t=Object.keys(e).map(n=>{const s=e[n];return Array.isArray(s)?s.map(l=>`${H_(n)}=${H_(l)}`).join("&"):`${H_(n)}=${H_(s)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${s}${"string"==typeof t.fragment?`#${function rP(e){return encodeURI(e)}(t.fragment)}`:""}`}}const nP=new $C;function G_(e){return e.segments.map(t=>qC(t)).join("/")}function Pm(e,t){if(!e.hasChildren())return G_(e);if(t){const n=e.children[wn]?Pm(e.children[wn],!1):"",s=[];return Ki(e.children,(l,d)=>{d!==wn&&s.push(`${d}:${Pm(l,!1)}`)}),s.length>0?`${n}(${s.join("//")})`:n}{const n=function tP(e,t){let n=[];return Ki(e.children,(s,l)=>{l===wn&&(n=n.concat(t(s,l)))}),Ki(e.children,(s,l)=>{l!==wn&&(n=n.concat(t(s,l)))}),n}(e,(s,l)=>l===wn?[Pm(e.children[wn],!1)]:[`${l}:${Pm(s,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[wn]?`${G_(e)}/${n[0]}`:`${G_(e)}/(${n.join("//")})`}}function GC(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function H_(e){return GC(e).replace(/%3B/gi,";")}function K0(e){return GC(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function q_(e){return decodeURIComponent(e)}function HC(e){return q_(e.replace(/\+/g,"%20"))}function qC(e){return`${K0(e.path)}${function iP(e){return Object.keys(e).map(t=>`;${K0(t)}=${K0(e[t])}`).join("")}(e.parameters)}`}const sP=/^[^\/()?;=#]+/;function Z_(e){const t=e.match(sP);return t?t[0]:""}const aP=/^[^=?&#]+/,cP=/^[^&#]+/;class hP{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new An([],{}):new An([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(s[wn]=new An(t,n)),s}parseSegment(){const t=Z_(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new Am(q_(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=Z_(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const l=Z_(this.remaining);l&&(s=l,this.capture(s))}t[q_(n)]=q_(s)}parseQueryParam(t){const n=function lP(e){const t=e.match(aP);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const y=function uP(e){const t=e.match(cP);return t?t[0]:""}(this.remaining);y&&(s=y,this.capture(s))}const l=HC(n),d=HC(s);if(t.hasOwnProperty(l)){let y=t[l];Array.isArray(y)||(y=[y],t[l]=y),y.push(d)}else t[l]=d}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=Z_(this.remaining),l=this.remaining[s.length];if("/"!==l&&")"!==l&&";"!==l)throw new Error(`Cannot parse url '${this.url}'`);let d;s.indexOf(":")>-1?(d=s.substr(0,s.indexOf(":")),this.capture(d),this.capture(":")):t&&(d=wn);const y=this.parseChildren();n[d]=1===Object.keys(y).length?y[wn]:new An([],y),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class ZC{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Y0(t,this._root);return n?n.children.map(s=>s.value):[]}firstChild(t){const n=Y0(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=J0(t,this._root);return n.length<2?[]:n[n.length-2].children.map(l=>l.value).filter(l=>l!==t)}pathFromRoot(t){return J0(t,this._root).map(n=>n.value)}}function Y0(e,t){if(e===t.value)return t;for(const n of t.children){const s=Y0(e,n);if(s)return s}return null}function J0(e,t){if(e===t.value)return[t];for(const n of t.children){const s=J0(e,n);if(s.length)return s.unshift(t),s}return[]}class Bc{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Rp(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class WC extends ZC{constructor(t,n){super(t),this.snapshot=n,Q0(this,t)}toString(){return this.snapshot.toString()}}function XC(e,t){const n=function dP(e,t){const y=new W_([],{},{},"",{},wn,t,null,e.root,-1,{});return new YC("",new Bc(y,[]))}(e,t),s=new Ka([new Am("",{})]),l=new Ka({}),d=new Ka({}),y=new Ka({}),w=new Ka(""),D=new Lp(s,l,y,w,d,wn,t,n.root);return D.snapshot=n.root,new WC(new Bc(D,[]),n)}class Lp{constructor(t,n,s,l,d,y,w,D){this.url=t,this.params=n,this.queryParams=s,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this._futureSnapshot=D}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Cn(t=>kp(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Cn(t=>kp(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function KC(e,t="emptyOnly"){const n=e.pathFromRoot;let s=0;if("always"!==t)for(s=n.length-1;s>=1;){const l=n[s],d=n[s-1];if(l.routeConfig&&""===l.routeConfig.path)s--;else{if(d.component)break;s--}}return function pP(e){return e.reduce((t,n)=>({params:Object.assign(Object.assign({},t.params),n.params),data:Object.assign(Object.assign({},t.data),n.data),resolve:Object.assign(Object.assign({},t.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(s))}class W_{constructor(t,n,s,l,d,y,w,D,A,F,V){this.url=t,this.params=n,this.queryParams=s,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this.routeConfig=D,this._urlSegment=A,this._lastPathIndex=F,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=kp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class YC extends ZC{constructor(t,n){super(n),this.url=t,Q0(this,n)}toString(){return JC(this._root)}}function Q0(e,t){t.value._routerState=e,t.children.forEach(n=>Q0(e,n))}function JC(e){const t=e.children.length>0?` { ${e.children.map(JC).join(", ")} } `:"";return`${e.value}${t}`}function ex(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Wl(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Wl(t.params,n.params)||e.params.next(n.params),function XA(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Wl(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Wl(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function tx(e,t){const n=Wl(e.params,t.params)&&function eP(e,t){return Yh(e,t)&&e.every((n,s)=>Wl(n.parameters,t[s].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||tx(e.parent,t.parent))}function km(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const s=n.value;s._futureSnapshot=t.value;const l=function mP(e,t,n){return t.children.map(s=>{for(const l of n.children)if(e.shouldReuseRoute(s.value,l.value.snapshot))return km(e,s,l);return km(e,s)})}(e,t,n);return new Bc(s,l)}{if(e.shouldAttach(t.value)){const d=e.retrieve(t.value);if(null!==d){const y=d.route;return y.value._futureSnapshot=t.value,y.children=t.children.map(w=>km(e,w)),y}}const s=function gP(e){return new Lp(new Ka(e.url),new Ka(e.params),new Ka(e.queryParams),new Ka(e.fragment),new Ka(e.data),e.outlet,e.component,e)}(t.value),l=t.children.map(d=>km(e,d));return new Bc(s,l)}}function X_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Rm(e){return"object"==typeof e&&null!=e&&e.outlets}function nx(e,t,n,s,l){let d={};if(s&&Ki(s,(w,D)=>{d[D]=Array.isArray(w)?w.map(A=>`${A}`):`${w}`}),e===t)return new Kh(n,d,l);const y=QC(e,t,n);return new Kh(y,d,l)}function QC(e,t,n){const s={};return Ki(e.children,(l,d)=>{s[d]=l===t?n:QC(l,t,n)}),new An(e.segments,s)}class eE{constructor(t,n,s){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=s,t&&s.length>0&&X_(s[0]))throw new Error("Root segment cannot have matrix parameters");const l=s.find(Rm);if(l&&l!==FC(s))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class rx{constructor(t,n,s){this.segmentGroup=t,this.processChildren=n,this.index=s}}function tE(e,t,n){if(e||(e=new An([],{})),0===e.segments.length&&e.hasChildren())return K_(e,t,n);const s=function wP(e,t,n){let s=0,l=t;const d={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(s>=n.length)return d;const y=e.segments[l],w=n[s];if(Rm(w))break;const D=`${w}`,A=s<n.length-1?n[s+1]:null;if(l>0&&void 0===D)break;if(D&&A&&"object"==typeof A&&void 0===A.outlets){if(!rE(D,A,y))return d;s+=2}else{if(!rE(D,{},y))return d;s++}l++}return{match:!0,pathIndex:l,commandIndex:s}}(e,t,n),l=n.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){const d=new An(e.segments.slice(0,s.pathIndex),{});return d.children[wn]=new An(e.segments.slice(s.pathIndex),e.children),K_(d,0,l)}return s.match&&0===l.length?new An(e.segments,{}):s.match&&!e.hasChildren()?ix(e,t,n):s.match?K_(e,0,l):ix(e,t,n)}function K_(e,t,n){if(0===n.length)return new An(e.segments,{});{const s=function bP(e){return Rm(e[0])?e[0].outlets:{[wn]:e}}(n),l={};return Ki(s,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(l[y]=tE(e.children[y],t,d))}),Ki(e.children,(d,y)=>{void 0===s[y]&&(l[y]=d)}),new An(e.segments,l)}}function ix(e,t,n){const s=e.segments.slice(0,t);let l=0;for(;l<n.length;){const d=n[l];if(Rm(d)){const D=CP(d.outlets);return new An(s,D)}if(0===l&&X_(n[0])){s.push(new Am(e.segments[t].path,nE(n[0]))),l++;continue}const y=Rm(d)?d.outlets[wn]:`${d}`,w=l<n.length-1?n[l+1]:null;y&&w&&X_(w)?(s.push(new Am(y,nE(w))),l+=2):(s.push(new Am(y,{})),l++)}return new An(s,{})}function CP(e){const t={};return Ki(e,(n,s)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[s]=ix(new An([],{}),0,n))}),t}function nE(e){const t={};return Ki(e,(n,s)=>t[s]=`${n}`),t}function rE(e,t,n){return e==n.path&&Wl(t,n.parameters)}class TP{constructor(t,n,s,l){this.routeReuseStrategy=t,this.futureState=n,this.currState=s,this.forwardEvent=l}activate(t){const n=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,s,t),ex(this.futureState.root),this.activateChildRoutes(n,s,t)}deactivateChildRoutes(t,n,s){const l=Rp(n);t.children.forEach(d=>{const y=d.value.outlet;this.deactivateRoutes(d,l[y],s),delete l[y]}),Ki(l,(d,y)=>{this.deactivateRouteAndItsChildren(d,s)})}deactivateRoutes(t,n,s){const l=t.value,d=n?n.value:null;if(l===d)if(l.component){const y=s.getContext(l.outlet);y&&this.deactivateChildRoutes(t,n,y.children)}else this.deactivateChildRoutes(t,n,s);else d&&this.deactivateRouteAndItsChildren(n,s)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const s=n.getContext(t.value.outlet),l=s&&t.value.component?s.children:n,d=Rp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);if(s&&s.outlet){const y=s.outlet.detach(),w=s.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:y,route:t,contexts:w})}}deactivateRouteAndOutlet(t,n){const s=n.getContext(t.value.outlet),l=s&&t.value.component?s.children:n,d=Rp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);s&&s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated(),s.attachRef=null,s.resolver=null,s.route=null)}activateChildRoutes(t,n,s){const l=Rp(n);t.children.forEach(d=>{this.activateRoutes(d,l[d.value.outlet],s),this.forwardEvent(new HA(d.value.snapshot))}),t.children.length&&this.forwardEvent(new $A(t.value.snapshot))}activateRoutes(t,n,s){const l=t.value,d=n?n.value:null;if(ex(l),l===d)if(l.component){const y=s.getOrCreateContext(l.outlet);this.activateChildRoutes(t,n,y.children)}else this.activateChildRoutes(t,n,s);else if(l.component){const y=s.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const w=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),ex(w.route.value),this.activateChildRoutes(t,null,y.children)}else{const w=function DP(e){for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(l.snapshot),D=w?w.module.componentFactoryResolver:null;y.attachRef=null,y.route=l,y.resolver=D,y.outlet&&y.outlet.activateWith(l,D),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,s)}}class ox{constructor(t,n){this.routes=t,this.module=n}}function Xu(e){return"function"==typeof e}function Jh(e){return e instanceof Kh}const Lm=Symbol("INITIAL_VALUE");function Om(){return Wh(e=>MA(e.map(t=>t.pipe(rl(1),function PA(...e){const t=jt(e);return yr((n,s)=>{(t?q0(e,n,t):q0(e,n)).subscribe(s)})}(Lm)))).pipe(DC((t,n)=>{let s=!1;return n.reduce((l,d,y)=>l!==Lm?l:(d===Lm&&(s=!0),s||!1!==d&&y!==n.length-1&&!Jh(d)?l:d),t)},Lm),Xh(t=>t!==Lm),Cn(t=>Jh(t)?t:!0===t),rl(1)))}class kP{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Fm,this.attachRef=null}}class Fm{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const s=this.getOrCreateContext(t);s.outlet=n,this.contexts.set(t,s)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new kP,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let iE=(()=>{class e{constructor(n,s,l,d,y){this.parentContexts=n,this.location=s,this.resolver=l,this.changeDetector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new Bo,this.deactivateEvents=new Bo,this.attachEvents=new Bo,this.detachEvents=new Bo,this.name=d||wn,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const y=(s=s||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,D=new RP(n,w,this.location.injector);this.activated=this.location.createComponent(y,this.location.length,D),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(Et(Fm),Et(qa),Et(ym),function yc(e){return function rr(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const s=n.length;let l=0;for(;l<s;){const d=n[l];if(cn(d))break;if(0===d)l+=2;else if("number"==typeof d)for(l++;l<s&&"string"==typeof n[l];)l++;else{if(d===t)return n[l+1];l+=2}}}return null}(Or(),e)}("name"),Et(_0))},e.\u0275dir=Mr({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class RP{constructor(t,n,s){this.route=t,this.childContexts=n,this.parent=s}get(t,n){return t===Lp?this.route:t===Fm?this.childContexts:this.parent.get(t,n)}}let oE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,s){1&n&&Zt(0,"router-outlet")},directives:[iE],encapsulation:2}),e})();function sE(e,t=""){for(let n=0;n<e.length;n++){const s=e[n];LP(s,OP(t,s))}}function LP(e,t){e.children&&sE(e.children,t)}function OP(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function sx(e){const t=e.children&&e.children.map(sx),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==wn&&(n.component=oE),n}function la(e){return e.outlet||wn}function aE(e,t){const n=e.filter(s=>la(s)===t);return n.push(...e.filter(s=>la(s)!==t)),n}const lE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Y_(e,t,n){var s;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},lE):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const d=(t.matcher||WA)(n,e,t);if(!d)return Object.assign({},lE);const y={};Ki(d.posParams,(D,A)=>{y[A]=D.path});const w=d.consumed.length>0?Object.assign(Object.assign({},y),d.consumed[d.consumed.length-1].parameters):y;return{matched:!0,consumedSegments:d.consumed,remainingSegments:n.slice(d.consumed.length),parameters:w,positionalParamSegments:null!==(s=d.posParams)&&void 0!==s?s:{}}}function J_(e,t,n,s,l="corrected"){if(n.length>0&&function BP(e,t,n){return n.some(s=>Q_(e,t,s)&&la(s)!==wn)}(e,n,s)){const y=new An(t,function zP(e,t,n,s){const l={};l[wn]=s,s._sourceSegment=e,s._segmentIndexShift=t.length;for(const d of n)if(""===d.path&&la(d)!==wn){const y=new An([],{});y._sourceSegment=e,y._segmentIndexShift=t.length,l[la(d)]=y}return l}(e,t,s,new An(n,e.children)));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function NP(e,t,n){return n.some(s=>Q_(e,t,s))}(e,n,s)){const y=new An(e.segments,function FP(e,t,n,s,l,d){const y={};for(const w of s)if(Q_(e,n,w)&&!l[la(w)]){const D=new An([],{});D._sourceSegment=e,D._segmentIndexShift="legacy"===d?e.segments.length:t.length,y[la(w)]=D}return Object.assign(Object.assign({},l),y)}(e,t,n,s,e.children,l));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:n}}const d=new An(e.segments,e.children);return d._sourceSegment=e,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:n}}function Q_(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function cE(e,t,n,s){return!!(la(e)===s||s!==wn&&Q_(t,n,e))&&("**"===e.path||Y_(t,e,n).matched)}function uE(e,t,n){return 0===t.length&&!e.children[n]}class ey{constructor(t){this.segmentGroup=t||null}}class hE{constructor(t){this.urlTree=t}}function zm(e){return j_(new ey(e))}function dE(e){return j_(new hE(e))}class $P{constructor(t,n,s,l,d){this.configLoader=n,this.urlSerializer=s,this.urlTree=l,this.config=d,this.allowRedirects=!0,this.ngModule=t.get(Rc)}apply(){const t=J_(this.urlTree.root,[],[],this.config).segmentGroup,n=new An(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,wn).pipe(Cn(d=>this.createUrlTree(ax(d),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Wu(d=>{if(d instanceof hE)return this.allowRedirects=!1,this.match(d.urlTree);throw d instanceof ey?this.noMatchError(d):d}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,wn).pipe(Cn(l=>this.createUrlTree(ax(l),t.queryParams,t.fragment))).pipe(Wu(l=>{throw l instanceof ey?this.noMatchError(l):l}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,s){const l=t.segments.length>0?new An([],{[wn]:t}):t;return new Kh(l,n,s)}expandSegmentGroup(t,n,s,l){return 0===s.segments.length&&s.hasChildren()?this.expandChildren(t,n,s).pipe(Cn(d=>new An([],d))):this.expandSegment(t,s,n,s.segments,l,!0)}expandChildren(t,n,s){const l=[];for(const d of Object.keys(s.children))"primary"===d?l.unshift(d):l.push(d);return Pr(l).pipe(Ap(d=>{const y=s.children[d],w=aE(n,d);return this.expandSegmentGroup(t,w,y,d).pipe(Cn(D=>({segment:D,outlet:d})))}),DC((d,y)=>(d[y.outlet]=y.segment,d),{}),function LA(e,t){const n=arguments.length>=2;return s=>s.pipe(e?Xh((l,d)=>e(l,d,s)):an,Z0(1),n?IC(t):MC(()=>new V_))}())}expandSegment(t,n,s,l,d,y){return Pr(s).pipe(Ap(w=>this.expandSegmentAgainstRoute(t,n,s,w,l,d,y).pipe(Wu(A=>{if(A instanceof ey)return hn(null);throw A}))),Pp(w=>!!w),Wu((w,D)=>{if(w instanceof V_||"EmptyError"===w.name)return uE(n,l,d)?hn(new An([],{})):zm(n);throw w}))}expandSegmentAgainstRoute(t,n,s,l,d,y,w){return cE(l,n,d,y)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(t,n,l,d,y):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y):zm(n):zm(n)}expandSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,s,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,s,l){const d=this.applyRedirectCommands([],s.redirectTo,{});return s.redirectTo.startsWith("/")?dE(d):this.lineralizeSegments(s,d).pipe(Ce(y=>{const w=new An(y,{});return this.expandSegment(t,w,n,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y){const{matched:w,consumedSegments:D,remainingSegments:A,positionalParamSegments:F}=Y_(n,l,d);if(!w)return zm(n);const V=this.applyRedirectCommands(D,l.redirectTo,F);return l.redirectTo.startsWith("/")?dE(V):this.lineralizeSegments(l,V).pipe(Ce(Q=>this.expandSegment(t,n,s,Q.concat(A),y,!1)))}matchSegmentAgainstRoute(t,n,s,l,d){if("**"===s.path)return s.loadChildren?(s._loadedConfig?hn(s._loadedConfig):this.configLoader.load(t.injector,s)).pipe(Cn(V=>(s._loadedConfig=V,new An(l,{})))):hn(new An(l,{}));const{matched:y,consumedSegments:w,remainingSegments:D}=Y_(n,s,l);return y?this.getChildConfig(t,s,l).pipe(Ce(F=>{const V=F.module,Q=F.routes,{segmentGroup:oe,slicedSegments:Te}=J_(n,w,D,Q),je=new An(oe.segments,oe.children);if(0===Te.length&&je.hasChildren())return this.expandChildren(V,Q,je).pipe(Cn(It=>new An(w,It)));if(0===Q.length&&0===Te.length)return hn(new An(w,{}));const et=la(s)===d;return this.expandSegment(V,je,Q,Te,et?wn:d,!0).pipe(Cn(ke=>new An(w.concat(ke.segments),ke.children)))})):zm(n)}getChildConfig(t,n,s){return n.children?hn(new ox(n.children,t)):n.loadChildren?void 0!==n._loadedConfig?hn(n._loadedConfig):this.runCanLoadGuards(t.injector,n,s).pipe(Ce(l=>l?this.configLoader.load(t.injector,n).pipe(Cn(d=>(n._loadedConfig=d,d))):function jP(e){return j_(X0(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`))}(n))):hn(new ox([],t))}runCanLoadGuards(t,n,s){const l=n.canLoad;return l&&0!==l.length?hn(l.map(y=>{const w=t.get(y);let D;if(function IP(e){return e&&Xu(e.canLoad)}(w))D=w.canLoad(n,s);else{if(!Xu(w))throw new Error("Invalid CanLoad guard");D=w(n,s)}return Xl(D)})).pipe(Om(),Os(y=>{if(!Jh(y))return;const w=X0(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw w.url=y,w}),Cn(y=>!0===y)):hn(!0)}lineralizeSegments(t,n){let s=[],l=n.root;for(;;){if(s=s.concat(l.segments),0===l.numberOfChildren)return hn(s);if(l.numberOfChildren>1||!l.children[wn])return j_(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t.redirectTo}'`));l=l.children[wn]}}applyRedirectCommands(t,n,s){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,s)}applyRedirectCreatreUrlTree(t,n,s,l){const d=this.createSegmentGroup(t,n.root,s,l);return new Kh(d,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const s={};return Ki(t,(l,d)=>{if("string"==typeof l&&l.startsWith(":")){const w=l.substring(1);s[d]=n[w]}else s[d]=l}),s}createSegmentGroup(t,n,s,l){const d=this.createSegments(t,n.segments,s,l);let y={};return Ki(n.children,(w,D)=>{y[D]=this.createSegmentGroup(t,w,s,l)}),new An(d,y)}createSegments(t,n,s,l){return n.map(d=>d.path.startsWith(":")?this.findPosParam(t,d,l):this.findOrReturn(d,s))}findPosParam(t,n,s){const l=s[n.path.substring(1)];if(!l)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return l}findOrReturn(t,n){let s=0;for(const l of n){if(l.path===t.path)return n.splice(s),l;s++}return t}}function ax(e){const t={};for(const s of Object.keys(e.children)){const d=ax(e.children[s]);(d.segments.length>0||d.hasChildren())&&(t[s]=d)}return function GP(e){if(1===e.numberOfChildren&&e.children[wn]){const t=e.children[wn];return new An(e.segments.concat(t.segments),t.children)}return e}(new An(e.segments,t))}class pE{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class ty{constructor(t,n){this.component=t,this.route=n}}function qP(e,t,n){const s=e._root;return Bm(s,t?t._root:null,n,[s.value])}function ny(e,t,n){const s=function WP(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(s?s.module.injector:n).get(e)}function Bm(e,t,n,s,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=Rp(t);return e.children.forEach(y=>{(function XP(e,t,n,s,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=e.value,y=t?t.value:null,w=n?n.getContext(e.value.outlet):null;if(y&&d.routeConfig===y.routeConfig){const D=function KP(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Yh(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Yh(e.url,t.url)||!Wl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!tx(e,t)||!Wl(e.queryParams,t.queryParams);default:return!tx(e,t)}}(y,d,d.routeConfig.runGuardsAndResolvers);D?l.canActivateChecks.push(new pE(s)):(d.data=y.data,d._resolvedData=y._resolvedData),Bm(e,t,d.component?w?w.children:null:n,s,l),D&&w&&w.outlet&&w.outlet.isActivated&&l.canDeactivateChecks.push(new ty(w.outlet.component,y))}else y&&Nm(t,w,l),l.canActivateChecks.push(new pE(s)),Bm(e,null,d.component?w?w.children:null:n,s,l)})(y,d[y.value.outlet],n,s.concat([y.value]),l),delete d[y.value.outlet]}),Ki(d,(y,w)=>Nm(y,n.getContext(w),l)),l}function Nm(e,t,n){const s=Rp(e),l=e.value;Ki(s,(d,y)=>{Nm(d,l.component?t?t.children.getContext(y):null:t,n)}),n.canDeactivateChecks.push(new ty(l.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,l))}class ok{}function fE(e){return new Rn(t=>t.error(e))}class ak{constructor(t,n,s,l,d,y){this.rootComponentType=t,this.config=n,this.urlTree=s,this.url=l,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=y}recognize(){const t=J_(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,wn);if(null===n)return null;const s=new W_([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},wn,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new Bc(s,n),d=new YC(this.url,l);return this.inheritParamsAndData(d._root),d}inheritParamsAndData(t){const n=t.value,s=KC(n,this.paramsInheritanceStrategy);n.params=Object.freeze(s.params),n.data=Object.freeze(s.data),t.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(t,n,s){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,s)}processChildren(t,n){const s=[];for(const d of Object.keys(n.children)){const y=n.children[d],w=aE(t,d),D=this.processSegmentGroup(w,y,d);if(null===D)return null;s.push(...D)}const l=mE(s);return function lk(e){e.sort((t,n)=>t.value.outlet===wn?-1:n.value.outlet===wn?1:t.value.outlet.localeCompare(n.value.outlet))}(l),l}processSegment(t,n,s,l){for(const d of t){const y=this.processSegmentAgainstRoute(d,n,s,l);if(null!==y)return y}return uE(n,s,l)?[]:null}processSegmentAgainstRoute(t,n,s,l){if(t.redirectTo||!cE(t,n,s,l))return null;let d,y=[],w=[];if("**"===t.path){const oe=s.length>0?FC(s).parameters:{};d=new W_(s,oe,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,yE(t),la(t),t.component,t,gE(n),_E(n)+s.length,vE(t))}else{const oe=Y_(n,t,s);if(!oe.matched)return null;y=oe.consumedSegments,w=oe.remainingSegments,d=new W_(y,oe.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,yE(t),la(t),t.component,t,gE(n),_E(n)+y.length,vE(t))}const D=function ck(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(t),{segmentGroup:A,slicedSegments:F}=J_(n,y,w,D.filter(oe=>void 0===oe.redirectTo),this.relativeLinkResolution);if(0===F.length&&A.hasChildren()){const oe=this.processChildren(D,A);return null===oe?null:[new Bc(d,oe)]}if(0===D.length&&0===F.length)return[new Bc(d,[])];const V=la(t)===l,Q=this.processSegment(D,A,F,V?wn:l);return null===Q?null:[new Bc(d,Q)]}}function uk(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function mE(e){const t=[],n=new Set;for(const s of e){if(!uk(s)){t.push(s);continue}const l=t.find(d=>s.value.routeConfig===d.value.routeConfig);void 0!==l?(l.children.push(...s.children),n.add(l)):t.push(s)}for(const s of n){const l=mE(s.children);t.push(new Bc(s.value,l))}return t.filter(s=>!n.has(s))}function gE(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function _E(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function yE(e){return e.data||{}}function vE(e){return e.resolve||{}}function xE(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function lx(e){return Wh(t=>{const n=e(t);return n?Pr(n).pipe(Cn(()=>t)):hn(t)})}class yk extends class _k{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const cx=new yn("ROUTES");class bE{constructor(t,n,s,l){this.injector=t,this.compiler=n,this.onLoadStartListener=s,this.onLoadEndListener=l}load(t,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const l=this.loadModuleFactory(n.loadChildren).pipe(Cn(d=>{this.onLoadEndListener&&this.onLoadEndListener(n);const y=d.create(t);return new ox(OC(y.injector.get(cx,void 0,Ut.Self|Ut.Optional)).map(sx),y)}),Wu(d=>{throw n._loader$=void 0,d}));return n._loader$=new AA(l,()=>new mo).pipe(TC()),n._loader$}loadModuleFactory(t){return Xl(t()).pipe(Ce(n=>n instanceof Fb?hn(n):Pr(this.compiler.compileModuleAsync(n))))}}class xk{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function bk(e){throw e}function wk(e,t,n){return t.parse("/")}function wE(e,t){return hn(null)}const Ck={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Ek={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Fs=(()=>{class e{constructor(n,s,l,d,y,w,D){this.rootComponentType=n,this.urlSerializer=s,this.rootContexts=l,this.location=d,this.config=D,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new mo,this.errorHandler=bk,this.malformedUriErrorHandler=wk,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:wE,afterPreactivation:wE},this.urlHandlingStrategy=new xk,this.routeReuseStrategy=new yk,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=y.get(Rc),this.console=y.get(yw);const V=y.get(Xi);this.isNgZoneEnabled=V instanceof Xi&&Xi.isInAngularZone(),this.resetConfig(D),this.currentUrlTree=function KA(){return new Kh(new An([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new bE(y,w,Q=>this.triggerEvent(new AC(Q)),Q=>this.triggerEvent(new PC(Q))),this.routerState=XC(this.currentUrlTree,this.rootComponentType),this.transitions=new Ka({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const s=this.events;return n.pipe(Xh(l=>0!==l.id),Cn(l=>Object.assign(Object.assign({},l),{extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Wh(l=>{let d=!1,y=!1;return hn(l).pipe(Os(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Wh(w=>{const D=this.browserUrlTree.toString(),A=!this.navigated||w.extractedUrl.toString()!==D||D!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||A)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return CE(w.source)&&(this.browserUrlTree=w.extractedUrl),hn(w).pipe(Wh(V=>{const Q=this.transitions.getValue();return s.next(new W0(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),Q!==this.transitions.getValue()?ze:Promise.resolve(V)}),function HP(e,t,n,s){return Wh(l=>function VP(e,t,n,s,l){return new $P(e,t,n,s,l).apply()}(e,t,n,l.extractedUrl,s).pipe(Cn(d=>Object.assign(Object.assign({},l),{urlAfterRedirects:d}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Os(V=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:V.urlAfterRedirects})}),function hk(e,t,n,s,l){return Ce(d=>function sk(e,t,n,s,l="emptyOnly",d="legacy"){try{const y=new ak(e,t,n,s,l,d).recognize();return null===y?fE(new ok):hn(y)}catch(y){return fE(y)}}(e,t,d.urlAfterRedirects,n(d.urlAfterRedirects),s,l).pipe(Cn(y=>Object.assign(Object.assign({},d),{targetSnapshot:y}))))}(this.rootComponentType,this.config,V=>this.serializeUrl(V),this.paramsInheritanceStrategy,this.relativeLinkResolution),Os(V=>{if("eager"===this.urlUpdateStrategy){if(!V.extras.skipLocationChange){const oe=this.urlHandlingStrategy.merge(V.urlAfterRedirects,V.rawUrl);this.setBrowserUrl(oe,V)}this.browserUrlTree=V.urlAfterRedirects}const Q=new zA(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);s.next(Q)}));if(A&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Q,extractedUrl:oe,source:Te,restoredState:je,extras:et}=w,Je=new W0(Q,this.serializeUrl(oe),Te,je);s.next(Je);const ke=XC(oe,this.rootComponentType).snapshot;return hn(Object.assign(Object.assign({},w),{targetSnapshot:ke,urlAfterRedirects:oe,extras:Object.assign(Object.assign({},et),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,w.resolve(null),ze}),lx(w=>{const{targetSnapshot:D,id:A,extractedUrl:F,rawUrl:V,extras:{skipLocationChange:Q,replaceUrl:oe}}=w;return this.hooks.beforePreactivation(D,{navigationId:A,appliedUrlTree:F,rawUrlTree:V,skipLocationChange:!!Q,replaceUrl:!!oe})}),Os(w=>{const D=new BA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(D)}),Cn(w=>Object.assign(Object.assign({},w),{guards:qP(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function YP(e,t){return Ce(n=>{const{targetSnapshot:s,currentSnapshot:l,guards:{canActivateChecks:d,canDeactivateChecks:y}}=n;return 0===y.length&&0===d.length?hn(Object.assign(Object.assign({},n),{guardsResult:!0})):function JP(e,t,n,s){return Pr(e).pipe(Ce(l=>function ik(e,t,n,s,l){const d=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return d&&0!==d.length?hn(d.map(w=>{const D=ny(w,t,l);let A;if(function PP(e){return e&&Xu(e.canDeactivate)}(D))A=Xl(D.canDeactivate(e,t,n,s));else{if(!Xu(D))throw new Error("Invalid CanDeactivate guard");A=Xl(D(e,t,n,s))}return A.pipe(Pp())})).pipe(Om()):hn(!0)}(l.component,l.route,n,t,s)),Pp(l=>!0!==l,!0))}(y,s,l,e).pipe(Ce(w=>w&&function MP(e){return"boolean"==typeof e}(w)?function QP(e,t,n,s){return Pr(t).pipe(Ap(l=>q0(function tk(e,t){return null!==e&&t&&t(new VA(e)),hn(!0)}(l.route.parent,s),function ek(e,t){return null!==e&&t&&t(new GA(e)),hn(!0)}(l.route,s),function rk(e,t,n){const s=t[t.length-1],d=t.slice(0,t.length-1).reverse().map(y=>function ZP(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(y)).filter(y=>null!==y).map(y=>EC(()=>hn(y.guards.map(D=>{const A=ny(D,y.node,n);let F;if(function AP(e){return e&&Xu(e.canActivateChild)}(A))F=Xl(A.canActivateChild(s,e));else{if(!Xu(A))throw new Error("Invalid CanActivateChild guard");F=Xl(A(s,e))}return F.pipe(Pp())})).pipe(Om())));return hn(d).pipe(Om())}(e,l.path,n),function nk(e,t,n){const s=t.routeConfig?t.routeConfig.canActivate:null;if(!s||0===s.length)return hn(!0);const l=s.map(d=>EC(()=>{const y=ny(d,t,n);let w;if(function SP(e){return e&&Xu(e.canActivate)}(y))w=Xl(y.canActivate(t,e));else{if(!Xu(y))throw new Error("Invalid CanActivate guard");w=Xl(y(t,e))}return w.pipe(Pp())}));return hn(l).pipe(Om())}(e,l.route,n))),Pp(l=>!0!==l,!0))}(s,d,e,t):hn(w)),Cn(w=>Object.assign(Object.assign({},n),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),Os(w=>{if(Jh(w.guardsResult)){const A=X0(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw A.url=w.guardsResult,A}const D=new NA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(D)}),Xh(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),lx(w=>{if(w.guards.canActivateChecks.length)return hn(w).pipe(Os(D=>{const A=new UA(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(A)}),Wh(D=>{let A=!1;return hn(D).pipe(function dk(e,t){return Ce(n=>{const{targetSnapshot:s,guards:{canActivateChecks:l}}=n;if(!l.length)return hn(n);let d=0;return Pr(l).pipe(Ap(y=>function pk(e,t,n,s){return function fk(e,t,n,s){const l=xE(e);if(0===l.length)return hn({});const d={};return Pr(l).pipe(Ce(y=>function mk(e,t,n,s){const l=ny(e,t,s);return Xl(l.resolve?l.resolve(t,n):l(t,n))}(e[y],t,n,s).pipe(Os(w=>{d[y]=w}))),Z0(1),Ce(()=>xE(d).length===l.length?hn(d):ze))}(e._resolve,e,t,s).pipe(Cn(d=>(e._resolvedData=d,e.data=Object.assign(Object.assign({},e.data),KC(e,n).resolve),null)))}(y.route,s,e,t)),Os(()=>d++),Z0(1),Ce(y=>d===l.length?hn(n):ze))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Os({next:()=>A=!0,complete:()=>{A||(this.restoreHistory(D),this.cancelNavigationTransition(D,"At least one route resolver didn't emit any value."))}}))}),Os(D=>{const A=new jA(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(A)}))}),lx(w=>{const{targetSnapshot:D,id:A,extractedUrl:F,rawUrl:V,extras:{skipLocationChange:Q,replaceUrl:oe}}=w;return this.hooks.afterPreactivation(D,{navigationId:A,appliedUrlTree:F,rawUrlTree:V,skipLocationChange:!!Q,replaceUrl:!!oe})}),Cn(w=>{const D=function fP(e,t,n){const s=km(e,t._root,n?n._root:void 0);return new WC(s,t)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:D})}),Os(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((e,t,n)=>Cn(s=>(new TP(t,s.targetRouterState,s.currentRouterState,n).activate(e),s)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),Os({next(){d=!0},complete(){d=!0}}),function OA(e){return yr((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var w;d||y||this.cancelNavigationTransition(l,`Navigation ID ${l.id} is not equal to the current navigation id ${this.navigationId}`),(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===l.id&&(this.currentNavigation=null)}),Wu(w=>{if(y=!0,function ZA(e){return e&&e[RC]}(w)){const D=Jh(w.url);D||(this.navigated=!0,this.restoreHistory(l,!0));const A=new SC(l.id,this.serializeUrl(l.extractedUrl),w.message);s.next(A),D?setTimeout(()=>{const F=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),V={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||CE(l.source)};this.scheduleNavigation(F,"imperative",null,V,{resolve:l.resolve,reject:l.reject,promise:l.promise})},0):l.resolve(!1)}else{this.restoreHistory(l,!0);const D=new FA(l.id,this.serializeUrl(l.extractedUrl),w);s.next(D);try{l.resolve(this.errorHandler(w))}catch(A){l.reject(A)}}return ze}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const s="popstate"===n.type?"popstate":"hashchange";"popstate"===s&&setTimeout(()=>{var l;const d={replaceUrl:!0},y=(null===(l=n.state)||void 0===l?void 0:l.navigationId)?n.state:null;if(y){const D=Object.assign({},y);delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(d.state=D)}const w=this.parseUrl(n.url);this.scheduleNavigation(w,s,y,d)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){sE(n),this.config=n.map(sx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,s={}){const{relativeTo:l,queryParams:d,fragment:y,queryParamsHandling:w,preserveFragment:D}=s,A=l||this.routerState.root,F=D?this.currentUrlTree.fragment:y;let V=null;switch(w){case"merge":V=Object.assign(Object.assign({},this.currentUrlTree.queryParams),d);break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=d||null}return null!==V&&(V=this.removeEmptyProps(V)),function _P(e,t,n,s,l){if(0===n.length)return nx(t.root,t.root,t.root,s,l);const d=function yP(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new eE(!0,0,e);let t=0,n=!1;const s=e.reduce((l,d,y)=>{if("object"==typeof d&&null!=d){if(d.outlets){const w={};return Ki(d.outlets,(D,A)=>{w[A]="string"==typeof D?D.split("/"):D}),[...l,{outlets:w}]}if(d.segmentPath)return[...l,d.segmentPath]}return"string"!=typeof d?[...l,d]:0===y?(d.split("/").forEach((w,D)=>{0==D&&"."===w||(0==D&&""===w?n=!0:".."===w?t++:""!=w&&l.push(w))}),l):[...l,d]},[]);return new eE(n,t,s)}(n);if(d.toRoot())return nx(t.root,t.root,new An([],{}),s,l);const y=function vP(e,t,n){if(e.isAbsolute)return new rx(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const d=n.snapshot._urlSegment;return new rx(d,d===t.root,0)}const s=X_(e.commands[0])?0:1;return function xP(e,t,n){let s=e,l=t,d=n;for(;d>l;){if(d-=l,s=s.parent,!s)throw new Error("Invalid number of '../'");l=s.segments.length}return new rx(s,!1,l-d)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+s,e.numberOfDoubleDots)}(d,t,e),w=y.processChildren?K_(y.segmentGroup,y.index,d.commands):tE(y.segmentGroup,y.index,d.commands);return nx(t.root,y.segmentGroup,w,s,l)}(A,this.currentUrlTree,n,V,null!=F?F:null)}navigateByUrl(n,s={skipLocationChange:!1}){const l=Jh(n)?n:this.parseUrl(n),d=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(d,"imperative",null,s)}navigate(n,s={skipLocationChange:!1}){return function Tk(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let s;try{s=this.urlSerializer.parse(n)}catch(l){s=this.malformedUriErrorHandler(l,this.urlSerializer,n)}return s}isActive(n,s){let l;if(l=!0===s?Object.assign({},Ck):!1===s?Object.assign({},Ek):s,Jh(n))return BC(this.currentUrlTree,n,l);const d=this.parseUrl(n);return BC(this.currentUrlTree,d,l)}removeEmptyProps(n){return Object.keys(n).reduce((s,l)=>{const d=n[l];return null!=d&&(s[l]=d),s},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Sm(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,s,l,d,y){var w,D;if(this.disposed)return Promise.resolve(!1);let A,F,V;y?(A=y.resolve,F=y.reject,V=y.promise):V=new Promise((Te,je)=>{A=Te,F=je});const Q=++this.navigationId;let oe;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),oe=l&&l.\u0275routerPageId?l.\u0275routerPageId:d.replaceUrl||d.skipLocationChange?null!==(w=this.browserPageId)&&void 0!==w?w:0:(null!==(D=this.browserPageId)&&void 0!==D?D:0)+1):oe=0,this.setTransition({id:Q,targetPageId:oe,source:s,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:d,resolve:A,reject:F,promise:V,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),V.catch(Te=>Promise.reject(Te))}setBrowserUrl(n,s){const l=this.urlSerializer.serialize(n),d=Object.assign(Object.assign({},s.extras.state),this.generateNgRouterState(s.id,s.targetPageId));this.location.isCurrentPathEqualTo(l)||s.extras.replaceUrl?this.location.replaceState(l,"",d):this.location.go(l,"",d)}restoreHistory(n,s=!1){var l,d;if("computed"===this.canceledNavigationResolution){const y=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(l=this.currentNavigation)||void 0===l?void 0:l.finalUrl)||0===y?this.currentUrlTree===(null===(d=this.currentNavigation)||void 0===d?void 0:d.finalUrl)&&0===y&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(y)}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,s){const l=new SC(n.id,this.serializeUrl(n.extractedUrl),s);this.triggerEvent(l),n.resolve(!1)}generateNgRouterState(n,s){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}}return e.\u0275fac=function(n){Mv()},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();function CE(e){return"imperative"!==e}class EE{}class TE{preload(t,n){return hn(null)}}let DE=(()=>{class e{constructor(n,s,l,d){this.router=n,this.injector=l,this.preloadingStrategy=d,this.loader=new bE(l,s,D=>n.triggerEvent(new AC(D)),D=>n.triggerEvent(new PC(D)))}setUpPreloading(){this.subscription=this.router.events.pipe(Xh(n=>n instanceof Sm),Ap(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Rc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,s){const l=[];for(const d of s)if(d.loadChildren&&!d.canLoad&&d._loadedConfig){const y=d._loadedConfig;l.push(this.processRoutes(y.module,y.routes))}else d.loadChildren&&!d.canLoad?l.push(this.preloadConfig(n,d)):d.children&&l.push(this.processRoutes(n,d.children));return Pr(l).pipe(Re(),Cn(d=>{}))}preloadConfig(n,s){return this.preloadingStrategy.preload(s,()=>(s._loadedConfig?hn(s._loadedConfig):this.loader.load(n.injector,s)).pipe(Ce(d=>(s._loadedConfig=d,this.processRoutes(d.module,d.routes)))))}}return e.\u0275fac=function(n){return new(n||e)(it(Fs),it(vw),it(Ft),it(EE))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),dx=(()=>{class e{constructor(n,s,l={}){this.router=n,this.viewportScroller=s,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof W0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Sm&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof kC&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,s){this.router.triggerEvent(new kC(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,s))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){Mv()},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const Qh=new yn("ROUTER_CONFIGURATION"),ME=new yn("ROUTER_FORROOT_GUARD"),Sk=[E0,{provide:VC,useClass:$C},{provide:Fs,useFactory:function Lk(e,t,n,s,l,d,y={},w,D){const A=new Fs(null,e,t,n,s,l,OC(d));return w&&(A.urlHandlingStrategy=w),D&&(A.routeReuseStrategy=D),function Ok(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(y,A),y.enableTracing&&A.events.subscribe(F=>{var V,Q;null===(V=console.group)||void 0===V||V.call(console,`Router Event: ${F.constructor.name}`),console.log(F.toString()),console.log(F),null===(Q=console.groupEnd)||void 0===Q||Q.call(console)}),A},deps:[VC,Fm,E0,Ft,vw,cx,Qh,[class vk{},new Ei],[class gk{},new Ei]]},Fm,{provide:Lp,useFactory:function Fk(e){return e.routerState.root},deps:[Fs]},DE,TE,class Ik{preload(t,n){return n().pipe(Wu(()=>hn(null)))}},{provide:Qh,useValue:{enableTracing:!1}}];function Ak(){return new Ew("Router",Fs)}let IE=(()=>{class e{constructor(n,s){}static forRoot(n,s){return{ngModule:e,providers:[Sk,SE(n),{provide:ME,useFactory:Rk,deps:[[Fs,new Ei,new vc]]},{provide:Qh,useValue:s||{}},{provide:Sp,useFactory:kk,deps:[Zh,[new bh(C0),new Ei],Qh]},{provide:dx,useFactory:Pk,deps:[Fs,RS,Qh]},{provide:EE,useExisting:s&&s.preloadingStrategy?s.preloadingStrategy:TE},{provide:Ew,multi:!0,useFactory:Ak},[px,{provide:a0,multi:!0,useFactory:zk,deps:[px]},{provide:AE,useFactory:Bk,deps:[px]},{provide:_w,multi:!0,useExisting:AE}]]}}static forChild(n){return{ngModule:e,providers:[SE(n)]}}}return e.\u0275fac=function(n){return new(n||e)(it(ME,8),it(Fs,8))},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({}),e})();function Pk(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new dx(e,t,n)}function kk(e,t,n={}){return n.useHash?new fI(e,t):new Gw(e,t)}function Rk(e){return"guarded"}function SE(e){return[{provide:Km,multi:!0,useValue:e},{provide:cx,multi:!0,useValue:e}]}let px=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new mo}appInitializer(){return this.injector.get(hI,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let s=null;const l=new Promise(w=>s=w),d=this.injector.get(Fs),y=this.injector.get(Qh);return"disabled"===y.initialNavigation?(d.setUpLocationChangeListener(),s(!0)):"enabled"===y.initialNavigation||"enabledBlocking"===y.initialNavigation?(d.hooks.afterPreactivation=()=>this.initNavigation?hn(null):(this.initNavigation=!0,s(!0),this.resultOfPreactivationDone),d.initialNavigation()):s(!0),l})}bootstrapListener(n){const s=this.injector.get(Qh),l=this.injector.get(DE),d=this.injector.get(dx),y=this.injector.get(Fs),w=this.injector.get(m0);n===w.components[0]&&(("enabledNonBlocking"===s.initialNavigation||void 0===s.initialNavigation)&&y.initialNavigation(),l.setUpPreloading(),d.init(),y.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(it(Ft))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();function zk(e){return e.appInitializer.bind(e)}function Bk(e){return e.bootstrapListener.bind(e)}const AE=new yn("Router Initializer"),Uk=[];let jk=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({imports:[[IE.forRoot(Uk)],IE]}),e})(),Vk=(()=>{class e{constructor(){}hideAPropos(){console.log("Test HideAPropos"),document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected")}hideAProposMobile(){console.log("Test HideAProposMobile"),document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-apropos"]],decls:76,vars:0,consts:[["id","apropos",1,"inactive-categorie"],[1,"recentre"],["id","close-btn-apropos",1,"close-btn",3,"click"],["id","close-btn-apropos",1,"close-btn-mobile",3,"click"],[1,"titre"],[1,"description"],[1,"span"],[1,"titre1"],[1,"centred","equipe"],[1,"container-box"],[1,"containter-content"],[1,"pp","clement"],[1,"container-nom"],[1,"container-desc"],[1,"container-reseaux"],["target","_blank","href","https://www.instagram.com/cleementcoomte/"],[1,"instagram","box-reseaux"],["target","_blank","href","https://twitter.com/clementcoomte/"],[1,"twitter","box-reseaux"],["target","_blank","href","https://www.linkedin.com/in/cl%C3%A9ment-comte-2445851a4/"],[1,"linkedin","box-reseaux"],[1,"pp","louis"],["target","_blank","href","https://www.instagram.com/ronteahri/"],["target","_blank","href","https://www.twitter.com/ronteahri/"],["target","_blank","href","https://fr.linkedin.com/in/louis-georget/"],[1,"pp","nathan"],["target","_blank","href","https://www.instagram.com/nathlabbe72/"],["target","_blank","href","https://www.linkedin.com/in/nathan-labb%C3%A9-058407200/"],[1,"pp","romain"],["target","_blank","href","https://www.instagram.com/romainlaval2/"],["target","_blank","href","https://www.twitter.com/lavalromain1/"],["target","_blank","href","https://fr.linkedin.com/in/romain-laval-7195b7201/"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"div",1)(2,"div",2),qn("click",function(){return s.hideAPropos()}),rt(),Xe(3,"div",3),qn("click",function(){return s.hideAProposMobile()}),rt(),Xe(4,"div",4),xt(5,"\xc0 PROPOS"),rt(),Xe(6,"p",5)(7,"span",6),xt(8,"RadarABeats"),rt(),xt(9," est un projet d'\xe9tude de 3\xe8me ann\xe9e de licence informatique de l'Universit\xe9 du Mans, d\xe9velopp\xe9 par Cl\xe9ment, Louis, Nathan et Romain... Le projet consiste \xe0 d\xe9velopper une application web avec comme contrainte l'utilisation de diff\xe9rentes APIs. "),rt(),Xe(10,"div",7),xt(11,"\xc9QUIPE"),rt(),Zt(12,"hr"),Xe(13,"div",8)(14,"div",9)(15,"div",10),Zt(16,"div",11),Xe(17,"p",12),xt(18,"Cl\xe9ment C."),rt(),Xe(19,"p",13),xt(20," D\xe9veloppeur couch\xe9. "),Zt(21,"br"),xt(22," > Syst\xe8me de connexion, mise en place de la carte. "),rt(),Xe(23,"div",14)(24,"a",15),Zt(25,"div",16),rt(),Xe(26,"a",17),Zt(27,"div",18),rt(),Xe(28,"a",19),Zt(29,"div",20),rt()()()(),Xe(30,"div",9)(31,"div",10),Zt(32,"div",21),Xe(33,"p",12),xt(34,"Louis G."),rt(),Xe(35,"p",13),xt(36," Front-Enderman. "),Zt(37,"br"),xt(38," > Toute la partie Front. Responsive, charte graphique, animations etc... "),rt(),Xe(39,"div",14)(40,"a",22),Zt(41,"div",16),rt(),Xe(42,"a",23),Zt(43,"div",18),rt(),Xe(44,"a",24),Zt(45,"div",20),rt()()()(),Xe(46,"div",9)(47,"div",10),Zt(48,"div",25),Xe(49,"p",12),xt(50,"Nathan L."),rt(),Xe(51,"p",13),xt(52," Docu-mentaliste "),Zt(53,"br"),xt(54," > Toute la paperasse, aide \xe0 la carte et au back-end. "),rt(),Xe(55,"div",14)(56,"a",26),Zt(57,"div",16),rt(),Xe(58,"a",27),Zt(59,"div",20),rt()()()(),Xe(60,"div",9)(61,"div",10),Zt(62,"div",28),Xe(63,"p",12),xt(64,"Romain L."),rt(),Xe(65,"p",13),xt(66," D\xe9velop-peur des araign\xe9es. "),Zt(67,"br"),xt(68," > Gestion de la musique (lecteur) et artistes (r\xe9cup\xe9ration de donn\xe9es). "),rt(),Xe(69,"div",14)(70,"a",29),Zt(71,"div",16),rt(),Xe(72,"a",30),Zt(73,"div",18),rt(),Xe(74,"a",31),Zt(75,"div",20),rt()()()()()()())},styles:["#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:4000;width:100%;height:100%;transition:.3s;overflow:hidden}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:95%;margin-bottom:-4%;margin-top:3%;padding:0;transition:.3s}.close-btn-mobile[_ngcontent-%COMP%]{display:none;margin-bottom:-7%;margin-top:9%}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:34px;font-weight:600;margin:3% 3% -.5% 23%;font-family:futuraheavy}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:28px;font-weight:600;margin:3% 3% -.5% 23%;font-family:futuraheavy}.pp[_ngcontent-%COMP%]{width:150px;height:150px;margin-left:50%;transform:translate(-51%)}.louis[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197446662651924/Louis.png);background-repeat:no-repeat;background-size:cover}.romain[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197447283400744/Romain.png);background-repeat:no-repeat;background-size:cover}.nathan[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197447006552064/Nathan.png);background-repeat:no-repeat;background-size:cover}.clement[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197446226440202/Clement.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]{width:17%;height:52vh;margin:1%;text-align:center;align-items:center;justify-content:center;display:flex}.container-desc[_ngcontent-%COMP%]{max-width:90%;margin-left:5%;font-family:motirawregular}.equipe[_ngcontent-%COMP%]{margin-left:10%;font-family:futuraheavy}span[_ngcontent-%COMP%]{color:#a91917}.description[_ngcontent-%COMP%]{max-width:70%;margin-left:23%;font-family:motirawregular}hr[_ngcontent-%COMP%]{background:#666;max-width:35%;height:1.5px;margin-left:23%;border:none}.container-nom[_ngcontent-%COMP%]{color:#e5e4e4;font-size:18px;font-weight:600}.box-reseaux[_ngcontent-%COMP%]{width:20px;height:20px;display:inline-block;margin:10% 2%}.container-box[_ngcontent-%COMP%]   .instagram[_ngcontent-%COMP%]{background:url(icon-instagram.a9c1761e45ddd1fd.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .instagram[_ngcontent-%COMP%]:hover{background:url(icon-instagram-hov1.3fbea02fe0a8d35d.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .twitter[_ngcontent-%COMP%]{background:url(icon-twitter.a751fa6dee33f089.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .twitter[_ngcontent-%COMP%]:hover{background:url(icon-twitter-hov.7dc9d96b617ae2f8.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .linkedin[_ngcontent-%COMP%]{background:url(icon-linkedin.e11b4441009b4a79.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .linkedin[_ngcontent-%COMP%]:hover{background:url(icon-linkedin-hov.321d516008b43430.png);background-repeat:no-repeat;background-size:cover}.container-reseaux[_ngcontent-%COMP%]{align-items:center;text-align:center}.recentre[_ngcontent-%COMP%]{margin-left:0;margin-top:0}@media screen and (max-width: 415px){#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:auto;overflow-x:hidden;display:block}.close-btn[_ngcontent-%COMP%]{display:none}.close-btn-mobile[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:50%;transform:translate(-50%);margin-bottom:15%;padding:0;transition:.3s;display:block}.close-btn-mobile[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:28px;font-weight:600;margin:3% 0 -.5%;text-align:center}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:24px;font-weight:600;margin:10% 0 -.5%;text-align:center}p[_ngcontent-%COMP%]{font-size:12px;line-height:18px;text-align:center;text-justify:auto;width:100%}.description[_ngcontent-%COMP%]{margin-left:50%;transform:translate(-50%)}hr[_ngcontent-%COMP%]{background:#666;max-width:35%;height:1.5px;margin-left:50%;transform:translate(-50%);border:none}.pp[_ngcontent-%COMP%]{width:100px;height:100px;margin-left:50%}.equipe[_ngcontent-%COMP%]{display:inline-table;margin-left:22%}.container-box[_ngcontent-%COMP%]{width:55%;height:42vh;text-align:center;align-items:center;justify-content:center;display:flex}}@media screen and (min-width: 415px) and (max-width: 1440px){#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:auto;overflow-x:hidden;display:block}.recentre[_ngcontent-%COMP%]{margin-left:-25%;margin-top:3%}}"]}),e})(),$k=(()=>{class e{constructor(){}hideContacter(){console.log("Test HideContacter"),document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected")}hideContacterMobile(){console.log("Test HideContacterMobile"),document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-contacter"]],decls:66,vars:0,consts:[["id","contacter",1,"inactive-categorie"],[1,"recentre"],["id","close-btn-contacter",1,"close-btn",3,"click"],["id","close-btn-contacter",1,"close-btn-mobile",3,"click"],[1,"titre"],[1,"pc"],[1,"titre1"],[1,"api"],[1,"inline"],["target","_blank","href","https://docs.mapbox.com/mapbox-gl-js/guides/",1,"inline"],["target","_blank","href","https://developers.google.com/youtube/v3",1,"inline"],["target","_blank","href","https://musicbrainz.org/doc/MusicBrainz_API",1,"inline"],[1,"mobile"],["target","_blank","href","https://developer.spotify.com/documentation/web-api/",1,"inline"],["target","_blank","href","https://github.com/ClemStun/RadarABeats"],["target","_blank","href","https://docs.google.com/document/d/10omYw_GEmSiN0buHzrdkx3ZbJLzE2Ju_tHPQURK_E3Q/edit?usp=sharing"],["target","_blank","href","https://docs.google.com/document/d/1B-s4ycvNhz6V5TduIwhidRO61hQBOMzjtxPbraIyRWY/edit?usp=sharing"],["target","_blank","href","https://www.paypal.me/pokecog/"],["type","image","src","https://cdn.discordapp.com/attachments/520318904170709023/948137880239374356/donate.png","border","0","name","submit","title","Business is business - Paypal","alt","Donate with PayPal button",1,"paypal"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"div",1)(2,"div",2),qn("click",function(){return s.hideContacter()}),rt(),Xe(3,"div",3),qn("click",function(){return s.hideContacterMobile()}),rt(),Xe(4,"div",4),xt(5,"RESSOURCES"),rt(),Xe(6,"div",5)(7,"div",6),xt(8,"APIs"),rt(),Xe(9,"div",7)(10,"p",8),xt(11,"Mapbox : "),Xe(12,"a",9),xt(13,"https://docs.mapbox.com/mapbox-gl-js/guides/"),rt()()(),Xe(14,"div",7)(15,"p",8),xt(16,"Youtube : "),Xe(17,"a",10),xt(18,"https://developers.google.com/youtube/v3"),rt()()(),Xe(19,"div",7)(20,"p",8),xt(21,"MusicBrainz : "),Xe(22,"a",11),xt(23,"https://musicbrainz.org/doc/MusicBrainz_API"),rt()()()(),Xe(24,"div",12)(25,"div",6),xt(26,"APIs"),rt(),Xe(27,"div",7)(28,"p",8)(29,"a",9),xt(30,"Mapbox"),rt()()(),Xe(31,"div",7)(32,"p",8)(33,"a",13),xt(34,"Spotify"),rt()()(),Xe(35,"div",7)(36,"p",8)(37,"a",11),xt(38,"MusicBrainz"),rt()()()(),Xe(39,"div",5)(40,"div",6),xt(41,"GitHub"),rt(),Xe(42,"p",7)(43,"a",14),xt(44,"https://github.com/ClemStun/RadarABeats"),rt()(),Xe(45,"div",6),xt(46,"Cahier des charges"),rt(),Xe(47,"p",7)(48,"a",15),xt(49,"https://docs.google.com/document/d/10omYw_GEmSiN0buHzrdkx3ZbJLzE2Ju_tHPQURK_E3Q/edit?usp=sharing"),rt()()(),Xe(50,"div",12)(51,"div",6),xt(52,"GitHub"),rt(),Xe(53,"p",7)(54,"a",14),xt(55,"GitHub"),rt()(),Xe(56,"div",6),xt(57,"Cahier des charges"),rt(),Xe(58,"p",7)(59,"a",16),xt(60,"Cahier des charges"),rt()()(),Zt(61,"br")(62,"br")(63,"br"),Xe(64,"a",17),Zt(65,"input",18),rt()()())},styles:["#contacter[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:4000;width:100%;height:100%;transition:.3s;overflow:hidden}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:95%;margin-bottom:-4%;margin-top:3%;padding:0;transition:.3s}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn-mobile[_ngcontent-%COMP%]{display:none;margin-bottom:-7%;margin-top:9%}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:34px;font-weight:600;margin:3% 3% -.5% 23%;font-family:futuraheavy}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:28px;font-weight:600;margin:3% 3% -.5% 23%;font-family:futuraheavy}.paypal[_ngcontent-%COMP%]{margin-left:23%}.contacter-btn[_ngcontent-%COMP%]{text-align:center}.p-contacter-btn[_ngcontent-%COMP%]{font-size:24px;color:#e5e4e4;background:#333333}.api[_ngcontent-%COMP%]{margin-left:23%;margin-bottom:-.8%;font-family:motirawregular}.inline[_ngcontent-%COMP%]{display:inline-block}.api[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#a91917}.api[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{color:#a91917}.mobile[_ngcontent-%COMP%]{display:none}.recentre[_ngcontent-%COMP%]{margin-left:0;margin-top:0}@media screen and (max-width: 415px){.close-btn-mobile[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:50%;transform:translate(-50%);margin-bottom:15%;padding:0;transition:.3s;display:block}.close-btn-mobile[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn[_ngcontent-%COMP%]{display:none}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:28px;font-weight:600;margin:3% 0 -.5%;text-align:center}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:24px;font-weight:600;margin:3% 0 -.5%;text-align:center}.paypal[_ngcontent-%COMP%]{margin-left:50%;transform:translate(-50%);width:45%}.contacter-btn[_ngcontent-%COMP%]{text-align:center}.p-contacter-btn[_ngcontent-%COMP%]{font-size:24px;color:#e5e4e4;background:#333333}.api[_ngcontent-%COMP%]{text-align:center;margin-left:0;margin-bottom:-.8%}p[_ngcontent-%COMP%]{font-size:12px}.mobile[_ngcontent-%COMP%]{display:block}.pc[_ngcontent-%COMP%]{display:none}}@media screen and (min-width: 415px) and (max-width: 1440px){#contacter[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:hidden}.recentre[_ngcontent-%COMP%]{margin-left:-25%;margin-top:3%}}"]}),e})();function PE(e,t,n,s,l,d,y){try{var w=e[d](y),D=w.value}catch(A){return void n(A)}w.done?t(D):Promise.resolve(D).then(s,l)}function Ku(e){return function(){var t=this,n=arguments;return new Promise(function(s,l){var d=e.apply(t,n);function y(D){PE(d,s,l,y,w,"next",D)}function w(D){PE(d,s,l,y,w,"throw",D)}y(void 0)})}}const Nc_mapbox_token="pk.eyJ1Ijoic3R1biIsImEiOiJja3lqejNqb3YycmQwMnhwYmUycmdtcWs2In0.akBRqOKrLPCiZE6_CGIOFA",Nc_youtube_token="AIzaSyCpj0jsX9HH0jJC2lWCLP1fkvG2tgmuQaI",Nc_database_url="https://radarabeats.herokuapp.com/";class kE{}class RE{}class Uc{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const s=n.indexOf(":");if(s>0){const l=n.slice(0,s),d=l.toLowerCase(),y=n.slice(s+1).trim();this.maybeSetNormalizedName(l,d),this.headers.has(d)?this.headers.get(d).push(y):this.headers.set(d,[y])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let s=t[n];const l=n.toLowerCase();"string"==typeof s&&(s=[s]),s.length>0&&(this.headers.set(l,s),this.maybeSetNormalizedName(n,l))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof Uc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new Uc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Uc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let s=t.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(t.name,n);const l=("a"===t.op?this.headers.get(n):void 0)||[];l.push(...s),this.headers.set(n,l);break;case"d":const d=t.value;if(d){let y=this.headers.get(n);if(!y)return;y=y.filter(w=>-1===d.indexOf(w)),0===y.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,y)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class Gk{encodeKey(t){return LE(t)}encodeValue(t){return LE(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const qk=/%(\d[a-f0-9])/gi,Zk={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function LE(e){return encodeURIComponent(e).replace(qk,(t,n)=>{var s;return null!==(s=Zk[n])&&void 0!==s?s:t})}function OE(e){return`${e}`}class Yu{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Gk,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Hk(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const d=l.indexOf("="),[y,w]=-1==d?[t.decodeKey(l),""]:[t.decodeKey(l.slice(0,d)),t.decodeValue(l.slice(d+1))],D=n.get(y)||[];D.push(w),n.set(y,D)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const s=t.fromObject[n];this.map.set(n,Array.isArray(s)?s:[s])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(s=>{const l=t[s];Array.isArray(l)?l.forEach(d=>{n.push({param:s,value:d,op:"a"})}):n.push({param:s,value:l,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(s=>n+"="+this.encoder.encodeValue(s)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Yu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(OE(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let s=this.map.get(t.param)||[];const l=s.indexOf(OE(t.value));-1!==l&&s.splice(l,1),s.length>0?this.map.set(t.param,s):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Wk{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function FE(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function zE(e){return"undefined"!=typeof Blob&&e instanceof Blob}function BE(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Um{constructor(t,n,s,l){let d;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function Xk(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==s?s:null,d=l):d=s,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params)),this.headers||(this.headers=new Uc),this.context||(this.context=new Wk),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=n;else{const w=n.indexOf("?");this.urlWithParams=n+(-1===w?"?":w<n.length-1?"&":"")+y}}else this.params=new Yu,this.urlWithParams=n}serializeBody(){return null===this.body?null:FE(this.body)||zE(this.body)||BE(this.body)||function Kk(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Yu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||BE(this.body)?null:zE(this.body)?this.body.type||null:FE(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Yu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var n;const s=t.method||this.method,l=t.url||this.url,d=t.responseType||this.responseType,y=void 0!==t.body?t.body:this.body,w=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,D=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let A=t.headers||this.headers,F=t.params||this.params;const V=null!==(n=t.context)&&void 0!==n?n:this.context;return void 0!==t.setHeaders&&(A=Object.keys(t.setHeaders).reduce((Q,oe)=>Q.set(oe,t.setHeaders[oe]),A)),t.setParams&&(F=Object.keys(t.setParams).reduce((Q,oe)=>Q.set(oe,t.setParams[oe]),F)),new Um(s,l,y,{params:F,headers:A,context:V,reportProgress:D,responseType:d,withCredentials:w})}}var bi=(()=>((bi=bi||{})[bi.Sent=0]="Sent",bi[bi.UploadProgress=1]="UploadProgress",bi[bi.ResponseHeader=2]="ResponseHeader",bi[bi.DownloadProgress=3]="DownloadProgress",bi[bi.Response=4]="Response",bi[bi.User=5]="User",bi))();class fx{constructor(t,n=200,s="OK"){this.headers=t.headers||new Uc,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||s,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class mx extends fx{constructor(t={}){super(t),this.type=bi.ResponseHeader}clone(t={}){return new mx({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class ry extends fx{constructor(t={}){super(t),this.type=bi.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new ry({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class NE extends fx{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function gx(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let iy=(()=>{class e{constructor(n){this.handler=n}request(n,s,l={}){let d;if(n instanceof Um)d=n;else{let D,A;D=l.headers instanceof Uc?l.headers:new Uc(l.headers),l.params&&(A=l.params instanceof Yu?l.params:new Yu({fromObject:l.params})),d=new Um(n,s,void 0!==l.body?l.body:null,{headers:D,context:l.context,params:A,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=hn(d).pipe(Ap(D=>this.handler.handle(D)));if(n instanceof Um||"events"===l.observe)return y;const w=y.pipe(Xh(D=>D instanceof ry));switch(l.observe||"body"){case"body":switch(d.responseType){case"arraybuffer":return w.pipe(Cn(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return w.pipe(Cn(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return w.pipe(Cn(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return w.pipe(Cn(D=>D.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:(new Yu).append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,l={}){return this.request("PATCH",n,gx(l,s))}post(n,s,l={}){return this.request("POST",n,gx(l,s))}put(n,s,l={}){return this.request("PUT",n,gx(l,s))}}return e.\u0275fac=function(n){return new(n||e)(it(kE))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();class UE{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const jE=new yn("HTTP_INTERCEPTORS");let Yk=(()=>{class e{intercept(n,s){return s.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const Jk=/^\)\]\}',?\n/;let VE=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Rn(s=>{const l=this.xhrFactory.build();if(l.open(n.method,n.urlWithParams),n.withCredentials&&(l.withCredentials=!0),n.headers.forEach((oe,Te)=>l.setRequestHeader(oe,Te.join(","))),n.headers.has("Accept")||l.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const oe=n.detectContentTypeHeader();null!==oe&&l.setRequestHeader("Content-Type",oe)}if(n.responseType){const oe=n.responseType.toLowerCase();l.responseType="json"!==oe?oe:"text"}const d=n.serializeBody();let y=null;const w=()=>{if(null!==y)return y;const oe=l.statusText||"OK",Te=new Uc(l.getAllResponseHeaders()),je=function Qk(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(l)||n.url;return y=new mx({headers:Te,status:l.status,statusText:oe,url:je}),y},D=()=>{let{headers:oe,status:Te,statusText:je,url:et}=w(),Je=null;204!==Te&&(Je=void 0===l.response?l.responseText:l.response),0===Te&&(Te=Je?200:0);let ke=Te>=200&&Te<300;if("json"===n.responseType&&"string"==typeof Je){const It=Je;Je=Je.replace(Jk,"");try{Je=""!==Je?JSON.parse(Je):null}catch(Tt){Je=It,ke&&(ke=!1,Je={error:Tt,text:Je})}}ke?(s.next(new ry({body:Je,headers:oe,status:Te,statusText:je,url:et||void 0})),s.complete()):s.error(new NE({error:Je,headers:oe,status:Te,statusText:je,url:et||void 0}))},A=oe=>{const{url:Te}=w(),je=new NE({error:oe,status:l.status||0,statusText:l.statusText||"Unknown Error",url:Te||void 0});s.error(je)};let F=!1;const V=oe=>{F||(s.next(w()),F=!0);let Te={type:bi.DownloadProgress,loaded:oe.loaded};oe.lengthComputable&&(Te.total=oe.total),"text"===n.responseType&&!!l.responseText&&(Te.partialText=l.responseText),s.next(Te)},Q=oe=>{let Te={type:bi.UploadProgress,loaded:oe.loaded};oe.lengthComputable&&(Te.total=oe.total),s.next(Te)};return l.addEventListener("load",D),l.addEventListener("error",A),l.addEventListener("timeout",A),l.addEventListener("abort",A),n.reportProgress&&(l.addEventListener("progress",V),null!==d&&l.upload&&l.upload.addEventListener("progress",Q)),l.send(d),s.next({type:bi.Sent}),()=>{l.removeEventListener("error",A),l.removeEventListener("abort",A),l.removeEventListener("load",D),l.removeEventListener("timeout",A),n.reportProgress&&(l.removeEventListener("progress",V),null!==d&&l.upload&&l.upload.removeEventListener("progress",Q)),l.readyState!==l.DONE&&l.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(it(lC))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})();const _x=new yn("XSRF_COOKIE_NAME"),yx=new yn("XSRF_HEADER_NAME");class $E{}let eR=(()=>{class e{constructor(n,s,l){this.doc=n,this.platform=s,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=eC(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(it(Uo),it(C_),it(_x))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),vx=(()=>{class e{constructor(n,s){this.tokenService=n,this.headerName=s}intercept(n,s){const l=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||l.startsWith("http://")||l.startsWith("https://"))return s.handle(n);const d=this.tokenService.getToken();return null!==d&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,d)})),s.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(it($E),it(yx))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),tR=(()=>{class e{constructor(n,s){this.backend=n,this.injector=s,this.chain=null}handle(n){if(null===this.chain){const s=this.injector.get(jE,[]);this.chain=s.reduceRight((l,d)=>new UE(l,d),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(it(RE),it(Ft))},e.\u0275prov=gt({token:e,factory:e.\u0275fac}),e})(),nR=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:vx,useClass:Yk}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:_x,useValue:n.cookieName}:[],n.headerName?{provide:yx,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({providers:[vx,{provide:jE,useExisting:vx,multi:!0},{provide:$E,useClass:eR},{provide:_x,useValue:"XSRF-TOKEN"},{provide:yx,useValue:"X-XSRF-TOKEN"}]}),e})(),rR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=wi({type:e}),e.\u0275inj=ar({providers:[iy,{provide:kE,useClass:tR},VE,{provide:RE,useExisting:VE}],imports:[[nR.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})(),oy=(()=>{class e{constructor(){this.login=""}getLogin(){return this.login}setLogin(n){this.login=n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),sy=(()=>{class e{constructor(n,s){this.http=n,this._connexion=s,this.favorisListe=[]}getFavoris(){var n=this;return Ku(function*(){let s=n._connexion.getLogin();""!=s&&(yield n.http.get(Nc_database_url+"favoris?login="+s,{responseType:"json"}).toPromise().then(l=>{l!=[]&&(n.favorisListe=l,n.favorisListe.forEach(d=>d.link="https://www.youtube.com/embed/"+d.link))}))})()}addFavoris(n,s,l){var d=this;return Ku(function*(){let y=d._connexion.getLogin();""!=y&&(d.isFavoris(n,s)||(yield d.http.get(Nc_database_url+"favorisadd?login="+y+"&title="+n+"&artiste="+s+"&link="+l,{responseType:"json"}).toPromise().then(w=>{console.log(w),d.getFavoris()}).catch(w=>{console.log(w)})))})()}removeFavoris(n,s){var l=this;return Ku(function*(){let d=l._connexion.getLogin();""!=d&&0!=l.isFavoris(n,s)&&(yield l.http.get(Nc_database_url+"favorisremove?login="+d+"&title="+n+"&artiste="+s,{responseType:"json"}).toPromise().then(y=>{console.log(y),l.getFavoris()}).catch(y=>{console.log(y)}))})()}isFavoris(n,s){return null!=this.favorisListe.find(l=>l.title==n&&l.artiste==s)}resetFavorisListe(){this.favorisListe=[]}}return e.\u0275fac=function(n){return new(n||e)(it(iy),it(oy))},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),GE=(()=>{class e{constructor(n){this.sanitizer=n}transform(n){return this.sanitizer.bypassSecurityTrustResourceUrl(n)}}return e.\u0275fac=function(n){return new(n||e)(Et(bC,16))},e.\u0275pipe=Hr({name:"safe",type:e,pure:!0}),e})();function iR(e,t){1&e&&(Xe(0,"div",7)(1,"p"),xt(2,"Vous n'\xeates pas connect\xe9"),rt()())}function oR(e,t){if(1&e){const n=a_();Xe(0,"div",8)(1,"div",9)(2,"span",10),xt(3),rt(),Xe(4,"span",11),xt(5),rt(),Xe(6,"span",12),qn("click",function(){const d=El(n).$implicit;return c_()._favoris.removeFavoris(d.title,d.artiste)}),xt(7,"Retirer des favoris"),rt()(),Xe(8,"div",13),Zt(9,"iframe",14),Vv(10,"safe"),rt()()}if(2&e){const n=t.$implicit;Mi(3),Gh(n.title),Mi(2),Gh(n.artiste),Mi(4),$u("src",$v(10,3,n.link),Eu)}}let sR=(()=>{class e{constructor(n,s){this._favoris=n,this._connexion=s}ngOnInit(){}hideFavoris(){document.getElementById("favoris").classList.remove("active-categorie"),document.getElementById("favoris").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected")}hideFavorisMobile(){document.getElementById("favoris").classList.remove("active-categorie"),document.getElementById("favoris").classList.add("inactive-categorie"),document.getElementById("btn-favoris").classList.remove("text-selected"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active")}}return e.\u0275fac=function(n){return new(n||e)(Et(sy),Et(oy))},e.\u0275cmp=Gr({type:e,selectors:[["app-favoris"]],decls:8,vars:2,consts:[["id","favoris",1,"inactive-categorie"],[1,"recentre"],["id","close-btn-favoris",1,"close-btn",3,"click"],["id","close-btn-favoris",1,"close-btn-mobile",3,"click"],[1,"titre"],["class","not-connected",4,"ngIf"],["class","card-container",4,"ngFor","ngForOf"],[1,"not-connected"],[1,"card-container"],[1,"info"],[1,"title"],[1,"artiste"],[1,"retirer",3,"click"],[1,"video"],["id","videoPlayer","width","420","height","315",3,"src"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"div",1)(2,"div",2),qn("click",function(){return s.hideFavoris()}),rt(),Xe(3,"div",3),qn("click",function(){return s.hideFavorisMobile()}),rt(),Xe(4,"div",4),xt(5,"FAVORIS"),rt(),um(6,iR,3,0,"div",5),um(7,oR,11,5,"div",6),rt()()),2&n&&(Mi(6),$u("ngIf",""==s._connexion.login),Mi(1),$u("ngForOf",s._favoris.favorisListe))},directives:[L0,tC],pipes:[GE],styles:["#favoris[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:4000;width:100%;height:100%;transition:.3s;overflow-x:hidden;overflow-y:scroll}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:95%;margin-bottom:-4%;margin-top:3%;padding:0;transition:.3s}.close-btn-mobile[_ngcontent-%COMP%]{display:none;margin-bottom:-7%;margin-top:9%}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:34px;font-weight:600;margin:3% 3% -.5% 23%;font-family:futuraheavy}@media screen and (min-width: 415px) and (max-width: 1440px){#favoris[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow-y:scroll;overflow-x:hidden;display:block}.recentre[_ngcontent-%COMP%]{margin-left:-25%;margin-top:3%}}@media screen and (max-width: 415px){#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow-x:hidden;overflow-y:scroll;display:block}.close-btn[_ngcontent-%COMP%]{display:none}.close-btn-mobile[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:50%;transform:translate(-50%);margin-bottom:15%;padding:0;transition:.3s;display:block}.close-btn-mobile[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:28px;font-weight:600;margin:3% 0 -.5%;text-align:center}}.card-container[_ngcontent-%COMP%]{position:relative;left:25%;display:flex;justify-content:center;align-items:center;z-index:5000;width:60%;height:20%;color:#fff;background-color:#333;border-radius:5px;margin:10px}.info[_ngcontent-%COMP%]{position:relative;display:flex;width:50%;height:100%;flex-direction:column;justify-content:center;align-items:center}.video[_ngcontent-%COMP%]{position:relative;display:flex;width:50%;height:100%;justify-content:center;align-items:center}.video[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{position:relative;color:#fff;z-index:10000}.title[_ngcontent-%COMP%]{font-size:30px;color:#a91917}.artiste[_ngcontent-%COMP%]{font-size:20px;color:#ccc610}.not-connected[_ngcontent-%COMP%]{position:absolute;left:25%;top:50%;display:flex;justify-content:center;align-items:center;z-index:5000;width:60%;height:60px;background-color:#333;border-radius:5px;transform:translateY(-50%)}.not-connected[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:red;font-size:30px;margin:0;padding:0}.info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:10px}.retirer[_ngcontent-%COMP%]{cursor:pointer;color:#555;transition:.2s}.retirer[_ngcontent-%COMP%]:hover{color:#999}"]}),e})();var ay=ca(898),HE=Object.prototype.toString;function ed(e){return"[object Object]"===HE.call(e)}function jm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Object.create(null);return e.forEach(function(s){s&&Object.keys(s).forEach(function(l){var d=s[l];n[l]=ed(d)?ed(n[l])?jm(n[l],d):jm(d):d})}),n}var xx=function(e,t){return(xx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var l in s)s.hasOwnProperty(l)&&(n[l]=s[l])})(e,t)},gR=function(e){function t(n,s,l,d,y){var w=e.call(this,n)||this;return w.config=s,w.code=l,w.request=d,w.response=y,w.isAxiosError=!0,Object.setPrototypeOf(w,t.prototype),w}return function mR(e,t){function n(){this.constructor=e}xx(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error);function bx(e,t,n,s,l){return new gR(e,t,n,s,l)}function qE(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%23/gi,"#").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var wx=document.createElement("a"),ZE=WE(window.location.href);function WE(e){return wx.setAttribute("href",e),{protocol:wx.protocol,host:wx.host}}function wR(e){return new Promise(function(t,n){var s=e.data,l=void 0===s?null:s,d=e.url,y=e.method,w=void 0===y?"get":y,D=e.headers,A=void 0===D?{}:D,F=e.responseType,V=e.timeout,Q=e.cancelToken,oe=e.withCredentials,Te=e.xsrfCookieName,je=e.xsrfHeaderName,et=e.onDownloadProgress,Je=e.onUploadProgress,ke=e.auth,It=e.validateStatus,Tt=new XMLHttpRequest;Tt.open(w.toLocaleUpperCase(),d,!0),function kn(){F&&(Tt.responseType=F),V&&(Tt.timeout=V),oe&&(Tt.withCredentials=oe)}(),function jo(){Tt.onreadystatechange=function(){if(4===Tt.readyState&&0!==Tt.status){var Kl=function pR(e){var t=Object.create(null);return e&&e.split("\r\n").forEach(function(n){var s=n.split(":"),l=s[0],d=s.slice(1);if(l=l.trim().toLowerCase()){var y=d.join(":").trim();t[l]=y}}),t}(Tt.getAllResponseHeaders());!function $m(fo){!It||It(fo.status)?t(fo):n(bx("Request failed with status code "+fo.status,e,null,Tt,fo))}({data:"text"!==F?Tt.response:Tt.responseText,status:Tt.status,statusText:Tt.statusText,headers:Kl,config:e,request:Tt})}},Tt.onerror=function(){n(bx("Network Error",e,null,Tt))},Tt.ontimeout=function(){n(bx("Timeout of "+V+" ms exceeded",e,"ECONNABORTED",Tt))},et&&(Tt.onprogress=et),Je&&(Tt.upload.onprogress=Je)}(),function jc(){if(function lR(e){return void 0!==e&&e instanceof FormData}(l)&&delete A["Content-Type"],(oe||function xR(e){var t=WE(e);return t.protocol===ZE.protocol&&t.host===ZE.host}(d))&&Te){var fo=function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null}(Te);fo&&je&&(A[je]=fo)}ke&&(A.Authorization="Basic "+btoa(ke.username+":"+ke.password)),Object.keys(A).forEach(function(Kl){null===l&&"content-type"===Kl.toLocaleLowerCase()?delete A[Kl]:Tt.setRequestHeader(Kl,A[Kl])})}(),function Vm(){Q&&Q.promise.then(function(fo){Tt.abort(),n(fo)}).catch(function(){})}(),Tt.send(l)})}function XE(e,t,n){return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(s){e=s(e,t)})),e}function CR(e){return function TR(e){e.cancelToken&&e.cancelToken.throwIfRequested()}(e),function ER(e){e.url=KE(e),e.data=XE(e.data,e.headers,e.transformRequest),e.headers=function fR(e,t){return e?(e=jm(e.common,e[t],e),["delete","get","head","options","post","put","patch","common"].forEach(function(s){delete e[s]}),e):e}(e.headers,e.method)}(e),wR(e).then(function(t){return YE(t)},function(t){return t&&t.response&&(t.response=YE(t.response)),Promise.reject(t)})}function KE(e){var t=e.url,n=e.params,s=e.paramsSerializer,l=e.baseURL;return l&&!function yR(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}(t)&&(t=function vR(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(l,t)),function _R(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(function cR(e){return void 0!==e&&e instanceof URLSearchParams}(t))s=t.toString();else{var l=[];Object.keys(t).forEach(function(y){var w=t[y];if(null!=w){var D=[];Array.isArray(w)?(D=w,y+="[]"):D=[w],D.forEach(function(A){!function aR(e){return"[object Date]"===HE.call(e)}(A)?ed(A)&&(A=JSON.stringify(A)):A=A.toISOString(),l.push(qE(y)+"="+qE(A))})}}),s=l.join("&")}if(s){var d=e.indexOf("#");-1!==d&&(e=e.slice(0,d)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}(t,n,s)}function YE(e){return e.data=XE(e.data,e.headers,e.config.transformResponse),e}var JE=function(){function e(){this.interceptors=[]}return e.prototype.use=function(t,n){return this.interceptors.push({resolved:t,rejected:n}),this.interceptors.length-1},e.prototype.forEach=function(t){this.interceptors.forEach(function(n){null!=n&&t(n)})},e.prototype.eject=function(t){this.interceptors[t]&&(this.interceptors[t]=null)},e}(),Cx=Object.create(null);function DR(e,t){return void 0!==t?t:e}function MR(e,t){if(void 0!==t)return t}function IR(e,t){return ed(t)?jm(e,t):void 0!==t?t:ed(e)?jm(e):void 0!==e?e:void 0}function Ex(e,t){t||(t={});var n=Object.create(null);for(var s in t)l(s);for(var s in e)t[s]||l(s);function l(d){n[d]=(Cx[d]||DR)(e[d],t[d])}return n}["url","params","data"].forEach(function(e){Cx[e]=MR}),["headers","auth"].forEach(function(e){Cx[e]=IR});var Tx=function(){function e(t){this.defaults=t,this.interceptors={request:new JE,response:new JE}}return e.prototype.request=function(t,n){"string"==typeof t?(n||(n={}),n.url=t):n=t,(n=Ex(this.defaults,n)).method=n.method.toLowerCase();var s=[{resolved:CR,rejected:void 0}];this.interceptors.request.forEach(function(D){s.unshift(D)}),this.interceptors.response.forEach(function(D){s.push(D)});for(var l=Promise.resolve(n);s.length;){var d=s.shift();l=l.then(d.resolved,d.rejected)}return l},e.prototype.get=function(t,n){return this._requestMethodWithoutData("get",t,n)},e.prototype.delete=function(t,n){return this._requestMethodWithoutData("delete",t,n)},e.prototype.head=function(t,n){return this._requestMethodWithoutData("head",t,n)},e.prototype.options=function(t,n){return this._requestMethodWithoutData("options",t,n)},e.prototype.post=function(t,n,s){return this._requestMethodWithData("post",t,n,s)},e.prototype.put=function(t,n,s){return this._requestMethodWithData("put",t,n,s)},e.prototype.patch=function(t,n,s){return this._requestMethodWithData("patch",t,n,s)},e.prototype.getUri=function(t){return KE(t=Ex(this.defaults,t))},e.prototype._requestMethodWithoutData=function(t,n,s){return this.request(Object.assign(s||{},{method:t,url:n}))},e.prototype._requestMethodWithData=function(t,n,s,l){return this.request(Object.assign(l||{},{method:t,url:n,data:s}))},e}(),ly={method:"get",timeout:0,headers:{common:{Accept:"application/json, text/plain, /*/"}},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",transformRequest:[function(e,t){return function dR(e,t){return function hR(e,t){!e||Object.keys(e).forEach(function(n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=e[n],delete e[n])})}(e,"Content-Type"),ed(t)&&e&&!e["Content-Type"]&&(e["Content-Type"]="application/json;charset=utf-8"),e}(t,e),function PR(e){return ed(e)?JSON.stringify(e):e}(e)}],transformResponse:[function(e){return function kR(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e}(e)}],validateStatus:function(e){return e>=200&&e<300}};["delete","get","head","options"].forEach(function(e){ly.headers[e]={}}),["post","put","patch"].forEach(function(e){ly.headers[e]={"Content-Type":"application/x-www-form-urlencoded"}});var Dx=function e(t){this.message=t},FR=function(){function e(t){var s,n=this;this.promise=new Promise(function(l){s=l}),t(function(l){n.reason||(n.reason=new Dx(l),s(n.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw console.log(1),this.reason},e.source=function(){var t,n=new e(function(s){t=s});return{cancel:t,token:n}},e}();function QE(e){var t=new Tx(e),n=Tx.prototype.request.bind(t);return function uR(e,t){for(var n in t)e[n]=t[n]}(n,t),n}var Ju=QE(ly);Ju.create=function(t){return QE(Ex(ly,t))},Ju.CancelToken=FR,Ju.Cancel=Dx,Ju.isCancel=function OR(e){return e instanceof Dx},Ju.all=function(t){return Promise.all(t)},Ju.spread=function(t){return function(s){return t.apply(null,s)}},Ju.Axios=Tx;const zR=Ju;let eT=(()=>{class e{constructor(){}getPlace(n,s){var l=this;return Ku(function*(){let d,y,w;return d="https://api.mapbox.com/geocoding/v5/mapbox.places/"+n+","+s+".json?types=place&access_token="+Nc_mapbox_token,w=[],yield zR.get(d).then(D=>{y=D.data.features[0].place_name,w=y.split(", ")}).catch(D=>{console.log(D)}),l.musicTileComp.showMenu(),w})()}setComp(n){this.musicTileComp=n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),tT=(()=>{class e{constructor(n){this.http=n,this.artiste="NO ARTIST",this.titre="NO SONG",this.count=0,this.ville="NO CITY",this.coordonnees="0, 0",this.videoLink="",this.videoId="",this.artisteID="",this.description="Cet arstiste n'a pas de description !"}getRandomOffset(n){return Math.floor(Math.random()*n)}setCoord(n,s){this.coordonnees=n+", "+s}getNumberOfArtists(n){return console.log("Inside"),this.http.get('https://musicbrainz.org/ws/2/artist/?query=area:"'+n+'"&limit=1&fmt=json',{responseType:"json"}).toPromise()}getRandomArtists(n,s){let l=this.getRandomOffset(s);return this.http.get('https://musicbrainz.org/ws/2/artist/?query=area:"'+n+'"&limit=1&offset='+l+"&fmt=json",{responseType:"json"}).toPromise()}getNumberOfSongs(n){return this.http.get('https://musicbrainz.org/ws/2/recording/?query=artist:"'+n+'"&limit=1&fmt=json',{responseType:"json"}).toPromise()}getRandomSong(n,s){let l=this.getRandomOffset(s);return this.http.get('https://musicbrainz.org/ws/2/recording/?query=artist:"'+n+'"&limit=1&offset='+l+"&fmt=json",{responseType:"json"}).toPromise()}setArtistAndSong(n,s,l){var d=this;return Ku(function*(){console.log("Before"),yield d.getNumberOfArtists(n).then(y=>d.count=y.count),0==d.count?(yield d.getNumberOfArtists(s).then(y=>d.count=y.count),0==d.count?(yield d.getNumberOfArtists(l).then(y=>d.count=y.count),0==d.count?(d.artiste="NO ARTIST",d.titre="NO SONG"):(yield d.getRandomArtists(l,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=null==y.artists[0].disambiguation?"Cet artiste n'a pas de description !":y.artists[0].disambiguation}),d.ville=l,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title))):(yield d.getRandomArtists(s,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=null==y.artists[0].disambiguation?"Cet arstiste n'a pas de description !":y.artists[0].disambiguation}),d.ville=s,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title))):(yield d.getRandomArtists(n,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=null==y.artists[0].disambiguation?"Cet arstiste n'a pas de description !":y.artists[0].disambiguation}),console.log("Artist : "+d.artiste),d.ville=n,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),console.log(d.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title),console.log("Song : "+d.titre),console.log("After"))})()}setVideoLink(){var n=this;return Ku(function*(){yield n.getLinkFromArtistAndSong(n.artiste,n.titre),n.videoLink="https://www.youtube.com/embed/"+n.videoId+"?&autoplay=1"})()}getLinkFromArtistAndSong(n,s){var l=this;return Ku(function*(){yield l.http.get('https://www.googleapis.com/youtube/v3/search/?q="'+n+" "+s+'"&type=video&part=snippet&key='+Nc_youtube_token,{responseType:"json"}).toPromise().then(d=>{l.videoId=d.items[0].id.videoId})})()}}return e.\u0275fac=function(n){return new(n||e)(it(iy))},e.\u0275prov=gt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),BR=(()=>{class e{constructor(n,s){this.service=n,this.songTileService=s}ngOnInit(){var n=this;this.map=new ay.Map({accessToken:Nc_mapbox_token,container:"carte",style:"mapbox://styles/mapbox/streets-v11",center:[.1988608,48.0076426],zoom:9});let s=(new ay.Marker).setLngLat(this.map.getCenter()).addTo(this.map);navigator.geolocation.getCurrentPosition(d=>{console.log(d),s.remove(),s=(new ay.Marker).setLngLat([d.coords.longitude,d.coords.latitude]).addTo(this.map)},()=>{console.log("Geopos non accept\xe9 placement au Mans !")}),this.map.on("load",d=>{this.map.setCenter(s.getLngLat())}),this.map.on("click",d=>{s.remove(),s=(new ay.Marker).setLngLat(d.lngLat).addTo(this.map),console.log(this.service.getPlace(d.lngLat.lng,d.lngLat.lat)),this.songTileService.setCoord(d.lngLat.lng,d.lngLat.lat),this.service.getPlace(d.lngLat.lng,d.lngLat.lat).then(function(){var y=Ku(function*(w){n.songTileService.ville=w[0],yield n.songTileService.setArtistAndSong(w[0],w[1],w[2]),n.songTileService.setVideoLink()});return function(w){return y.apply(this,arguments)}}())})}}return e.\u0275fac=function(n){return new(n||e)(Et(eT),Et(tT))},e.\u0275cmp=Gr({type:e,selectors:[["app-carte"]],decls:2,vars:0,consts:[["href","https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css","rel","stylesheet"],["id","carte"]],template:function(n,s){1&n&&Zt(0,"link",0)(1,"div",1)},styles:["#carte[_ngcontent-%COMP%]{background:#fffeb9;position:fixed;z-index:1;width:100%;height:100%}.marker[_ngcontent-%COMP%]{background-color:red;width:50px;height:50px;border-radius:50%;cursor:pointer}"]}),e})(),NR=(()=>{class e{constructor(){}hideSide(){console.log("Test HideSide"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("trigger-btn-pre").classList.remove("invisible"),document.getElementById("log-window").classList.remove("active-log"),document.getElementById("log-window").classList.add("unactive-log"),document.getElementById("pop-up").classList.remove("active-popup"),document.getElementById("pop-up").classList.add("inactive-popup"),document.getElementById("error-ins").classList.remove("active-err"),document.getElementById("error-ins").classList.add("inactive-err")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-darker"]],decls:1,vars:0,consts:[["id","darker",1,"activeDarker",3,"click"]],template:function(n,s){1&n&&(Xe(0,"div",0),qn("click",function(){return s.hideSide()}),rt())},styles:["#darker[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);transition:.3s}#darker[_ngcontent-%COMP%]:hover{cursor:pointer}.activeDarker[_ngcontent-%COMP%]{z-index:3000;opacity:1}.inactiveDarker[_ngcontent-%COMP%]{z-index:-1;opacity:0}"]}),e})(),UR=(()=>{class e{constructor(){}ngOnInit(){}closeWin(){document.getElementById("popup").classList.remove("active-pop"),document.getElementById("popup").classList.add("inactive-pop")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-popup"]],decls:3,vars:0,consts:[["id","popup",1,"inactive-pop",2,"font-family","futuraheavy",3,"click"]],template:function(n,s){1&n&&(Xe(0,"div",0),qn("click",function(){return s.closeWin()}),Xe(1,"span"),xt(2,"Vous \xeates maintenant connect\xe9 !"),rt()())},styles:["#popup[_ngcontent-%COMP%]{position:absolute;z-index:2999;width:50%;height:40px;display:flex;justify-content:center;align-items:center;border-radius:5px;background-color:#1e1e1e;color:#e5e4e4;left:50%;transform:translate(-50%);transition:.3s;cursor:pointer}#close[_ngcontent-%COMP%]{background-image:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png)}.inactive-pop[_ngcontent-%COMP%]{top:-2%;opacity:0}.active-pop[_ngcontent-%COMP%]{top:5%;opacity:1}"]}),e})(),jR=(()=>{class e{constructor(){}showSide(){console.log("Test ShowSide"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active"),document.getElementById("darker").classList.remove("inactiveDarker"),document.getElementById("darker").classList.add("activeDarker"),document.getElementById("trigger-btn-pre").classList.add("invisible"),document.getElementById("close-btn-side").classList.remove("invisible")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-btn-sidebar"]],decls:2,vars:0,consts:[["id","trigger-btn-pre",1,"trigger-btn-side",3,"click"]],template:function(n,s){1&n&&(Xe(0,"div")(1,"div",0),qn("click",function(){return s.showSide()}),rt()())},styles:[".trigger-btn-side[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/950688606127796254/Burger_copie.png);background-repeat:no-repeat;background-size:cover;opacity:.5;width:167px;height:51px;text-align:center;position:relative;align-items:center;left:2%;margin-top:2%;transition:.3s}.trigger-btn-side[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}#trigger-btn-pre[_ngcontent-%COMP%]{position:fixed;z-index:2999}"]}),e})();var cy=ca(400);let VR=(()=>{class e{constructor(n,s,l){this.http=n,this.connexionService=s,this._favoris=l}ngOnInit(){}setConnexion(n){n?(document.getElementById("background-selec").classList.remove("choix-right"),document.getElementById("background-selec").classList.add("choix-left"),document.getElementById("connexion-form").classList.add("active-choix"),document.getElementById("enregistrer-form").classList.remove("active-choix")):(document.getElementById("background-selec").classList.add("choix-right"),document.getElementById("background-selec").classList.remove("choix-left"),document.getElementById("connexion-form").classList.remove("active-choix"),document.getElementById("enregistrer-form").classList.add("active-choix"))}connexion(n="",s=""){""==n&&(n=document.getElementById("pseudo-con").value),""==s&&(s=document.getElementById("pw-con").value);const l=cy.hash.sha256.hash(s),d=cy.codec.hex.fromBits(l);this.http.get(Nc_database_url+"login?login="+n+"&pw="+d,{responseType:"json"}).toPromise().then(y=>{1==y.connexion?(this.connexionService.setLogin(n),this._favoris.getFavoris(),document.getElementById("condec").innerHTML="Deconnexion",this.popUp()):this.printError("error-con",y.message)}),this.resetDisplay()}inscription(){let n=document.getElementById("pseudo-ins").value,s=document.getElementById("pw-ins").value,l=document.getElementById("pwc-ins").value;if(null==n.match(/\s/)&&""!=n&&"accounts"!=n)if(s===l){{const d=cy.hash.sha256.hash(s),y=cy.codec.hex.fromBits(d);this.http.get(Nc_database_url+"register?login="+n+"&pw="+y,{responseType:"json"}).toPromise().then(w=>{1==w.register?this.connexion(n,s):this.printError("error-ins",w.message)})}this.resetDisplay()}else this.printError("error-ins","Les mots de passe ne correspondent pas !");else this.printError("error-ins","Login incorrect")}printError(n,s){document.getElementById(n).innerHTML=s,document.getElementById(n).classList.remove("inactive-err"),document.getElementById(n).classList.add("active-err")}popUp(){document.getElementById("popup").classList.remove("inactive-pop"),document.getElementById("popup").classList.add("active-pop")}resetDisplay(){document.getElementById("log-window").classList.remove("active-log"),document.getElementById("log-window").classList.add("unactive-log"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("error-ins").classList.remove("active-err"),document.getElementById("error-ins").classList.add("inactive-err"),document.getElementById("error-con").classList.remove("active-err"),document.getElementById("error-con").classList.add("inactive-err"),document.getElementById("pseudo-ins").value="",document.getElementById("pw-ins").value="",document.getElementById("pwc-ins").value="",document.getElementById("pseudo-con").value="",document.getElementById("pw-con").value=""}}return e.\u0275fac=function(n){return new(n||e)(Et(iy),Et(oy),Et(sy))},e.\u0275cmp=Gr({type:e,selectors:[["app-connexion"]],decls:18,vars:0,consts:[["id","log-window",1,"unactive-log"],["id","selection"],["id","background-selec",1,"choix-left"],["id","btn-con",1,"choix",3,"click"],["id","btn-ins",1,"choix",3,"click"],["id","connexion-form",1,"form-c","choix-connexion","active-choix"],["id","error-con",1,"inactive-err"],["id","pseudo-con","type","text","placeholder","Pseudo"],["id","pw-con","type","password","placeholder","Mot de passe"],["type","button","value","Connexion",2,"font-family","futuraheavy",3,"click"],["id","enregistrer-form",1,"form-c","choix-inscription"],["id","error-ins",1,"inactive-err"],["id","pseudo-ins","type","text","placeholder","Pseudo"],["id","pw-ins","type","password","placeholder","Mot de passe"],["id","pwc-ins","type","password","placeholder","Confirmation mot de passe"],["type","button","value","Inscription",2,"font-family","futuraheavy",3,"click"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"div",1),Zt(2,"span",2),Xe(3,"span",3),qn("click",function(){return s.setConnexion(!0)}),xt(4,"Connexion"),rt(),Xe(5,"span",4),qn("click",function(){return s.setConnexion(!1)}),xt(6,"S'inscrire"),rt()(),Xe(7,"form",5),Zt(8,"span",6)(9,"input",7)(10,"input",8),Xe(11,"input",9),qn("click",function(){return s.connexion()}),rt()(),Xe(12,"form",10),Zt(13,"span",11)(14,"input",12)(15,"input",13)(16,"input",14),Xe(17,"input",15),qn("click",function(){return s.inscription()}),rt()()())},styles:["#log-window[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-50%);width:40%;height:50%;background-color:#1c1c1c;border-radius:10px;color:#e5e4e4;overflow:hidden;transition:.3s}.unactive-log[_ngcontent-%COMP%]{z-index:-1;opacity:0;top:80%}.active-log[_ngcontent-%COMP%]{z-index:5000;top:50%}#selection[_ngcontent-%COMP%]{position:relative;width:100%;height:10%;display:flex;justify-content:space-evenly;align-items:center;background-color:#333;cursor:pointer}.choix[_ngcontent-%COMP%]{position:absolute;width:50%;height:100%;display:flex;justify-content:center;font-family:futuraheavy;align-items:center}#btn-con[_ngcontent-%COMP%]{top:0;left:0}#btn-ins[_ngcontent-%COMP%]{top:0;left:50%}.form-c[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:column;width:100%;height:80%;justify-content:space-evenly;align-items:center;transition:.3s}input[type=text][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%]{border-radius:0;color:#e5e4e4;border:none;border-bottom:1px solid #CCC610;background-color:#fff0;width:75%;height:50px;font-size:18px;font-family:motirawregular}input[_ngcontent-%COMP%]:focus{outline:none}input[type=button][_ngcontent-%COMP%]{all:unset;width:75%;height:50px;background-color:#fff0;border-radius:5px;border:1px solid #CCC610;color:#e5e4e4;font-size:18px;text-align:center;cursor:pointer}.choix-connexion[_ngcontent-%COMP%]{left:-100%}.choix-inscription[_ngcontent-%COMP%]{left:100%}.active-choix[_ngcontent-%COMP%]{left:0%}#background-selec[_ngcontent-%COMP%]{position:absolute;width:50%;height:100%;top:0;background-color:#1c1c1c;transition:.3s}.choix-right[_ngcontent-%COMP%]{left:50%}.choix-left[_ngcontent-%COMP%]{left:0}form[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:80%;height:50px;color:red;background-color:#333;justify-content:center;align-items:center;border-radius:5px}.inactive-err[_ngcontent-%COMP%]{display:none}.active-err[_ngcontent-%COMP%]{display:flex}@media screen and (max-width: 415px){#log-window[_ngcontent-%COMP%]{width:70%}}@media screen and (max-width: 1440px){#log-window[_ngcontent-%COMP%]{width:70%}}"]}),e})(),$R=(()=>{class e{constructor(n,s){this._connexion=n,this._favoris=s}ngOnInit(){}connexionMenu(){"Deconnexion"!=document.getElementById("condec").textContent?(document.getElementById("log-window").classList.remove("unactive-log"),document.getElementById("log-window").classList.add("active-log"),document.getElementById("darker").classList.remove("inactiveDarker"),document.getElementById("darker").classList.add("activeDarker")):(document.getElementById("condec").innerHTML="Connexion",this._connexion.setLogin(""),this._favoris.resetFavorisListe())}}return e.\u0275fac=function(n){return new(n||e)(Et(oy),Et(sy))},e.\u0275cmp=Gr({type:e,selectors:[["app-btn-connexion"]],decls:7,vars:0,consts:[["id","btn-connexion",3,"click"],[1,"btn-hover"],["id","condec",2,"font-family","futuraheavy"]],template:function(n,s){1&n&&(Xe(0,"div")(1,"div",0),qn("click",function(){return s.connexionMenu()}),Zt(2,"span",1)(3,"span",1)(4,"span",1),Xe(5,"span",2),xt(6,"Connexion"),rt()()())},styles:["#btn-connexion[_ngcontent-%COMP%]{position:absolute;margin-top:2%;right:3%;width:180px;height:40px;background-color:#1c1c1c;z-index:2999;border-radius:5px;color:#e5e4e4;cursor:pointer;display:flex;justify-content:center;align-items:center;overflow:hidden;transition:.3s;transition-delay:.3s}#btn-connexion[_ngcontent-%COMP%]:hover{color:#1c1c1c}#btn-connexion[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute}#btn-connexion[_ngcontent-%COMP%]   .btn-hover[_ngcontent-%COMP%]{width:0px;height:0px;border-radius:50%;opacity:0;transition:.4s}#btn-connexion[_ngcontent-%COMP%]   .btn-hover[_ngcontent-%COMP%]:nth-child(3){background-color:#ccc610;transition-delay:.4s}#btn-connexion[_ngcontent-%COMP%]   .btn-hover[_ngcontent-%COMP%]:nth-child(2){border:2px solid #CCC610;transition-delay:.2s}#btn-connexion[_ngcontent-%COMP%]   .btn-hover[_ngcontent-%COMP%]:nth-child(1){border:2px solid #CCC610;transition-delay:.1s}#btn-connexion[_ngcontent-%COMP%]:hover   .btn-hover[_ngcontent-%COMP%]{opacity:1;width:190px;height:190px}"]}),e})(),GR=(()=>{class e{constructor(){}showPopup(){console.log("Test Popup"),document.getElementById("pop-up").classList.remove("inactive"),document.getElementById("pop-up").classList.add("active"),document.getElementById("darker").classList.remove("inactiveDarker"),document.getElementById("darker").classList.add("activeDarker"),document.getElementById("trigger-btn-pre").classList.add("invisible"),document.getElementById("close-btn-side").classList.remove("invisible")}hidePopup(){console.log("Test HidePopup"),document.getElementById("pop-up").classList.remove("active"),document.getElementById("pop-up").classList.add("inactive"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("close-btn-side").classList.add("invisible"),document.getElementById("trigger-btn-pre").classList.remove("invisible")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-pop-up"]],decls:21,vars:0,consts:[["id","pop-up",1,"active-popup"],[1,"titre"],[2,"color","#A91917"],[2,"color","#CCC610"],[1,"description"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"h1",1)(2,"span",2),xt(3,"BIENVENUE"),rt(),Zt(4,"br"),xt(5," SUR "),Xe(6,"span",3),xt(7,"RADAR \xc0 BEATS"),rt()(),Xe(8,"p",4),xt(9," Le but de ce site est de d\xe9couvrir de nouvelles musiques et de nouveaux artistes des 4 coins du monde. Pour ce fait, il suffit simplement de cliquer \xe0 l'endroit souhait\xe9 n'importe o\xf9 sur la carte (sauf les oc\xe9ans, logique). "),Zt(10,"br")(11,"br"),xt(12," En esp\xe9rant que le site vous plaise, HF. "),Zt(13,"br")(14,"br"),xt(15," L'\xe9quipe de "),Xe(16,"span",2),xt(17,"RadarABeats"),rt(),xt(18,". "),Zt(19,"br"),xt(20,"(le nom est totalement assum\xe9) "),rt()())},styles:["#pop-up[_ngcontent-%COMP%]{width:40%;background:#1C1C1C;position:fixed;top:50%;transform:translate(-50%,-50%);border-radius:10px;transition:.3s}.active-popup[_ngcontent-%COMP%]{opacity:1;margin-left:50%;transform:translate(-50%);z-index:11000}.inactive-popup[_ngcontent-%COMP%]{margin-left:50%;opacity:0;z-index:-10}.titre[_ngcontent-%COMP%]{text-transform:uppercase;color:#e5e4e4;margin-left:50%;transform:translate(-50%);font-family:futuraheavy;font-size:28px;line-height:28px;padding:2% 0}.description[_ngcontent-%COMP%]{color:#e5e4e4;font-family:motirawregular;padding:0 8% 5%}@media screen and (max-width: 415px){#pop-up[_ngcontent-%COMP%]{width:70%}}@media screen and (max-width: 1440px){#pop-up[_ngcontent-%COMP%]{width:70%}}"]}),e})(),HR=(()=>{class e{constructor(){}hideSide(){console.log("Test HideSide"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("close-btn-side").classList.add("invisible"),document.getElementById("trigger-btn-pre").classList.remove("invisible")}showContacter(){document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected"),document.getElementById("favoris").classList.remove("active-categorie"),document.getElementById("favoris").classList.add("inactive-categorie"),document.getElementById("btn-favoris").classList.remove("text-selected"),document.getElementById("contacter").classList.remove("inactive-categorie"),document.getElementById("contacter").classList.add("active-categorie"),document.getElementById("btn-contacter").classList.add("text-selected")}showContacterMobile(){this.showContacter(),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive")}showAPropos(){document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected"),document.getElementById("favoris").classList.remove("active-categorie"),document.getElementById("favoris").classList.add("inactive-categorie"),document.getElementById("btn-favoris").classList.remove("text-selected"),document.getElementById("apropos").classList.remove("inactive-categorie"),document.getElementById("apropos").classList.add("active-categorie"),document.getElementById("btn-apropos").classList.add("text-selected")}showAProposMobile(){this.showAPropos(),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive")}showFavoris(){document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected"),document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected"),document.getElementById("favoris").classList.remove("inactive-categorie"),document.getElementById("favoris").classList.add("active-categorie"),document.getElementById("btn-favoris").classList.add("text-selected")}showFavorisMobile(){this.showFavoris(),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-sidebar"]],decls:28,vars:0,consts:[["id","sidebar",1,"inactive"],[2,"padding","1px"],["id","close-btn-side",1,"close-btn",3,"click"],[1,"remplaceClose"],["src","https://cdn.discordapp.com/attachments/520318904170709023/959363151357440040/LogoCentre.png","alt","logo",1,"logo"],["id","btn-favoris",1,"categorie",3,"click"],["id","btn-favoris",1,"categorie-mobile"],["id","btn-apropos",1,"categorie",3,"click"],["id","btn-apropos",1,"categorie-mobile",3,"click"],["id","btn-contacter",1,"categorie",3,"click"],["id","btn-contacter",1,"categorie-mobile",3,"click"],[1,"categorie"],["href","mailto:radarabeats@gmail.com",1,"mailto"],[1,"categorie-mobile"],[1,"copyright"],[1,"rempli"]],template:function(n,s){1&n&&(Xe(0,"div",0),Zt(1,"div",1),Xe(2,"div")(3,"div",2),qn("click",function(){return s.hideSide()}),rt()(),Zt(4,"div",3),Xe(5,"div"),Zt(6,"img",4),Xe(7,"div",5),qn("click",function(){return s.showFavoris()}),xt(8," FAVORIS "),rt(),Xe(9,"div",6),xt(10," FAVORIS "),rt(),Xe(11,"div",7),qn("click",function(){return s.showAPropos()}),xt(12," \xc0 PROPOS "),rt(),Xe(13,"div",8),qn("click",function(){return s.showAProposMobile()}),xt(14," \xc0 PROPOS "),rt(),Xe(15,"div",9),qn("click",function(){return s.showContacter()}),xt(16," RESSOURCES "),rt(),Xe(17,"div",10),qn("click",function(){return s.showContacterMobile()}),xt(18," RESSOURCES "),rt(),Xe(19,"div",11)(20,"a",12),xt(21,"CONTACTER"),rt()(),Xe(22,"div",13)(23,"a",12),xt(24,"CONTACTER"),rt()()(),Xe(25,"div",14),xt(26," \xa9 Utema & Stun "),rt(),Zt(27,"div",15),rt())},styles:["#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:20%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.active[_ngcontent-%COMP%]{left:0;margin-left:0%}.inactive[_ngcontent-%COMP%]{margin-left:-100%}.rempli[_ngcontent-%COMP%]{padding:100% 0}.close-btn[_ngcontent-%COMP%]{display:none}.remplaceClose[_ngcontent-%COMP%]{background:#44444400;width:30px;height:30px}.logo[_ngcontent-%COMP%]{width:40%;margin:5% 5% 20%}.categorie[_ngcontent-%COMP%]{width:100%;font-size:24px;padding:5% 0;color:#e5e4e4;font-family:futuraheavy}.categorie[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#333;color:#ccc610}.categorie-mobile[_ngcontent-%COMP%]{display:none;visibility:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:72%;left:50%;transform:translate(-50%)}.mailto[_ngcontent-%COMP%]{text-decoration:none;color:#a91917;width:100%;font-size:24px;padding:5% 0}@media screen and (max-width: 415px){.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:30px;height:30px;text-align:center;position:relative;margin:8% 0 -1%;left:50%;transform:translate(-50%);padding:0;transition:.3s;display:block}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.remplaceClose[_ngcontent-%COMP%]{display:none}#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:100%;transition:.3s;position:fixed;z-index:9000;align-items:center;text-align:center;overflow:hidden}.logo[_ngcontent-%COMP%]{width:40%;margin:20%}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:50%;left:50%;transform:translate(-50%)}.categorie[_ngcontent-%COMP%]{display:none;visibility:hidden}.categorie-mobile[_ngcontent-%COMP%]{width:100%;font-size:24px;padding:5% 0;color:#e5e4e4;display:block;visibility:visible}.categorie-mobile[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#333;color:#ccc610}}@media screen and (min-width: 930px) and (max-width: 1440px){#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:25%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;bottom:60%;left:50%;transform:translate(-50%)}}@media screen and (min-width: 415px) and (max-width: 930px){#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:35%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:65%;left:50%;transform:translate(-50%)}}"]}),e})();function qR(e,t){if(1&e){const n=a_();Ie(),Xe(0,"svg",18),qn("click",function(){El(n);const l=c_();return l._favoris.addFavoris(l.songTileService.titre,l.songTileService.artiste,l.songTileService.videoId)}),Xe(1,"g",19),Zt(2,"path",20),rt()()}}function ZR(e,t){if(1&e){const n=a_();Ie(),Xe(0,"svg",18),qn("click",function(){El(n);const l=c_();return l._favoris.removeFavoris(l.songTileService.titre,l.songTileService.artiste)}),Xe(1,"g",21),Zt(2,"path",20),rt()()}}let WR=(()=>{class e{constructor(n,s,l){this.songTileService=n,this.carteService=s,this._favoris=l}showMenu(){console.log("Test ShowMenu"),document.getElementById("menuUp").classList.contains("greater")&&this.lowerMenu(),document.getElementById("menuUp").classList.remove("inactive"),document.getElementById("menuUp").classList.add("active"),document.getElementById("trigger-btn").classList.add("invisible"),document.getElementById("close-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.remove("invisible"),setTimeout(()=>{document.getElementById("close-btn").classList.remove("close-btn-inactive"),document.getElementById("close-btn").classList.add("close-btn-active"),document.getElementById("greater-btn").classList.remove("greater-btn-inactive"),document.getElementById("greater-btn").classList.add("greater-btn-active")},30)}hideMenu(){console.log("Test HideMenu"),document.getElementById("menuUp").scroll(0,-1e3),document.getElementById("menuUp").classList.remove("active"),document.getElementById("menuUp").classList.add("inactive"),document.getElementById("close-btn").classList.add("invisible"),document.getElementById("trigger-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.add("invisible"),document.getElementById("menuUp").classList.contains("greater")&&(document.getElementById("menuUp").classList.remove("greater"),this.lowerMenu()),setTimeout(()=>{document.getElementById("close-btn").classList.remove("close-btn-active"),document.getElementById("close-btn").classList.add("close-btn-inactive"),document.getElementById("greater-btn").classList.remove("greater-btn-active"),document.getElementById("greater-btn").classList.add("greater-btn-inactive")},30)}greaterMenu(){document.getElementById("menuUp").classList.add("greater"),document.getElementById("close-btn").classList.remove("close-btn-active"),document.getElementById("close-btn").classList.add("close-btn-greater"),document.getElementById("greater-btn").classList.remove("greater-btn-img-inactive"),document.getElementById("greater-btn").classList.add("greater-btn-img-active"),document.getElementById("lower-btn").classList.remove("greater-btn-img-inactive"),document.getElementById("lower-btn").classList.add("greater-btn-img-active"),document.getElementById("greater-btn").classList.remove("greater-btn-active"),document.getElementById("greater-btn").classList.add("greater-btn-greater"),document.getElementById("lower-btn").classList.remove("greater-btn-active"),document.getElementById("lower-btn").classList.add("greater-btn-greater"),setTimeout(()=>{document.getElementById("lower-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.add("invisible")},300)}lowerMenu(){document.getElementById("menuUp").classList.remove("greater"),document.getElementById("close-btn").classList.remove("close-btn-greater"),document.getElementById("close-btn").classList.add("close-btn-active"),document.getElementById("greater-btn").classList.remove("greater-btn-img-active"),document.getElementById("greater-btn").classList.add("greater-btn-img-inactive"),document.getElementById("lower-btn").classList.remove("greater-btn-img-active"),document.getElementById("lower-btn").classList.add("greater-btn-img-inactive"),document.getElementById("greater-btn").classList.remove("greater-btn-greater"),document.getElementById("greater-btn").classList.add("greater-btn-active"),document.getElementById("lower-btn").classList.remove("greater-btn-greater"),document.getElementById("lower-btn").classList.add("greater-btn-active"),setTimeout(()=>{document.getElementById("lower-btn").classList.add("invisible"),document.getElementById("greater-btn").classList.remove("invisible")},300)}ngOnInit(){this.carteService.setComp(this)}}return e.\u0275fac=function(n){return new(n||e)(Et(tT),Et(eT),Et(sy))},e.\u0275cmp=Gr({type:e,selectors:[["app-test-musique"]],decls:28,vars:12,consts:[["id","menuUp",1,"scroll","inactive"],["src","https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png","alt","icon lower",2,"display","none"],["id","trigger-btn",1,"trigger-btn",3,"click"],["id","greater-btn",1,"greater-btn","greater-btn-inactive","greater-btn-img-inactive",3,"click"],["id","lower-btn",1,"lower-btn","invisible","greater-btn-img-active",3,"click"],["id","close-btn",1,"close-btn","invisible","close-btn-inactive",3,"click"],["id","greater-btn",1,"greater-btn","invisible",3,"click"],[1,"titre1"],[1,"artiste"],["target","_blank",3,"href"],["src","https://cdn.discordapp.com/attachments/520318904170709023/959349871452778526/icon-artist.png",1,"icon"],["version","1.0","id","coeur","class","icon","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 1280.000000 1189.000000","preserveAspectRatio","xMidYMid meet",3,"click",4,"ngIf"],[1,"lecteur"],["id","videoPlayer",3,"src"],[2,"font-family","futuraheavy"],[2,"font-family","motirawregular"],[1,"aPropos"],[1,"description"],["version","1.0","id","coeur","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 1280.000000 1189.000000","preserveAspectRatio","xMidYMid meet",1,"icon",3,"click"],["transform","translate(0.000000,1189.000000) scale(0.100000,-0.100000)","fill","transparent"],["d","M3250 11884 c-25 -2 -106 -11 -180 -20 -1485 -172 -2704 -1295 -3001\n                    -2764 -133 -660 -67 -1507 171 -2223 252 -753 675 -1411 1397 -2172 342 -360\n                    634 -630 1588 -1470 231 -203 488 -430 570 -505 1024 -920 1735 -1692 2346\n                    -2547 l130 -183 132 0 132 1 130 192 c557 822 1212 1560 2185 2461 191 178\n                    408 373 1027 923 956 852 1445 1343 1841 1850 643 825 968 1603 1064 2553 19\n                    196 17 665 -5 835 -105 805 -441 1497 -998 2054 -557 557 -1250 894 -2054 998\n                    -193 24 -613 24 -810 0 -733 -93 -1379 -387 -1920 -874 -191 -172 -406 -417\n                    -535 -610 -30 -45 -57 -82 -60 -82 -3 0 -30 37 -60 82 -129 193 -344 438 -535\n                    610 -531 478 -1170 773 -1878 867 -146 20 -562 34 -677 24z","stroke","#ff0000","stroke-width","800pt"],["transform","translate(0.000000,1189.000000) scale(0.100000,-0.100000)","fill","#ff0000"]],template:function(n,s){1&n&&(Xe(0,"div",0),Zt(1,"img",1),Xe(2,"div",2),qn("click",function(){return s.showMenu()}),rt(),Xe(3,"div",3),qn("click",function(){return s.greaterMenu()}),rt(),Xe(4,"div",4),qn("click",function(){return s.lowerMenu()}),rt(),Xe(5,"div",5),qn("click",function(){return s.hideMenu()}),rt(),Xe(6,"div",6),qn("click",function(){return s.hideMenu()}),rt(),Xe(7,"h1",7),xt(8),rt(),Xe(9,"h3",8)(10,"a",9),xt(11),rt()(),Xe(12,"div")(13,"a",9),Zt(14,"img",10),rt(),um(15,qR,3,0,"svg",11),um(16,ZR,3,0,"svg",11),rt(),Xe(17,"div",12),Zt(18,"iframe",13),Vv(19,"safe"),rt(),Xe(20,"h2",14),xt(21),rt(),Xe(22,"h3",15),xt(23),rt(),Xe(24,"h3",16),xt(25,"\xc0 Propos"),rt(),Xe(26,"p",17),xt(27),rt()()),2&n&&(Mi(8),Gh(s.songTileService.titre),Mi(2),hm("href","https://musicbrainz.org/artist/",s.songTileService.artisteID,"",Mh),Mi(1),pm(" ",s.songTileService.artiste," "),Mi(2),hm("href","https://musicbrainz.org/artist/",s.songTileService.artisteID,"",Mh),Mi(2),$u("ngIf",0==s._favoris.isFavoris(s.songTileService.titre,s.songTileService.artiste)),Mi(1),$u("ngIf",1==s._favoris.isFavoris(s.songTileService.titre,s.songTileService.artiste)),Mi(2),$u("src",$v(19,10,s.songTileService.videoLink),Eu),Mi(3),Gh(s.songTileService.ville),Mi(2),pm("(",s.songTileService.coordonnees,")"),Mi(4),Gh(s.songTileService.description))},directives:[L0],pipes:[GE],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:0px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.titre1[_ngcontent-%COMP%]{margin-top:3.2%;margin-bottom:-1.3%;text-transform:uppercase;color:#e5e4e4;max-width:70%;line-height:38px;margin-left:50%;transform:translate(-50%);font-family:futuraheavy}.icon[_ngcontent-%COMP%]{width:25px;height:25px;margin:-35px 5px 5px;opacity:.5;transition:.2s;overflow:visible}.icon[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%;font-family:motirawregular}h2[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#ccc610;margin-bottom:-1%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%]{color:#ccc610;font-family:motirawregular;text-decoration:none}.artiste[_ngcontent-%COMP%]:hover{text-decoration:underline}h3[_ngcontent-%COMP%]{color:#ccc610}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:2%;font-size:22px;font-family:futuraheavy}.lecteur[_ngcontent-%COMP%]{width:480px;height:315px;margin:3% 0 3% 50%;transform:translate(-50%)}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:49%;top:3%;transition:.3s}.trigger-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;left:95%;margin-bottom:-1%;padding:0;position:absolute;position:fixed;transition:.3s}.close-btn-active[_ngcontent-%COMP%]{top:61%}.close-btn-inactive[_ngcontent-%COMP%]{top:100%}.close-btn-greater[_ngcontent-%COMP%]{top:23%}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.lower-btn[_ngcontent-%COMP%]{width:35px;height:35px;text-align:center;position:relative;left:92%;margin-bottom:-1%;top:23%;padding:0;position:fixed;transition:.3s}.lower-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.greater-btn[_ngcontent-%COMP%]{width:35px;height:35px;text-align:center;position:relative;left:92%;margin-bottom:-1%;padding:0;transition:.3s;position:fixed}.greater-btn-img-active[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover}.greater-btn-img-inactive[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover}.greater-btn-greater[_ngcontent-%COMP%]{top:23%}.greater-btn-active[_ngcontent-%COMP%]{top:61%}.greater-btn-inactive[_ngcontent-%COMP%]{top:100%}.greater-btn[_ngcontent-%COMP%]:hover{cursor:pointer}#menuUp[_ngcontent-%COMP%]{position:absolute;width:100%;background:#1C1C1C;text-align:center;left:0;transition:.3s;position:fixed;overflow-x:hidden;z-index:2000}.active[_ngcontent-%COMP%]{bottom:0;overflow-y:auto;height:43%}.inactive[_ngcontent-%COMP%]{bottom:-36%;overflow:hidden;height:43%}.greater[_ngcontent-%COMP%]{height:80%}@media screen and (max-width: 415px){.titre1[_ngcontent-%COMP%]{margin-bottom:-35px;text-transform:uppercase;color:#e5e4e4;font-size:32px}.greater-btn[_ngcontent-%COMP%]{left:85%}.greater-btn-greater[_ngcontent-%COMP%]{top:22.2%;left:85%}.greater-btn-active[_ngcontent-%COMP%]{top:58.2%}.icon[_ngcontent-%COMP%]{width:15px;height:15px;margin:-35px 5px 5px}h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#ccc610;margin-bottom:-10%;margin-top:10%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%]{font-size:18px;color:#ccc610}h3[_ngcontent-%COMP%]{color:#ccc610;font-size:12px}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%;font-size:12px;line-height:18px}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:3%;margin-bottom:-1%;font-size:22px}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:50%;transform:translate(-50%);top:2%;transition:.3s}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:3%;left:50%;transform:translate(-50%);margin-bottom:-1%;padding:0;transition:.3s}.lecteur[_ngcontent-%COMP%]{width:220px;height:150px;margin:3% 0 3% 50%;transform:translate(-50%)}}@media screen and (max-width: 1440px){.titre1[_ngcontent-%COMP%]{margin-bottom:-35px;margin-top:2%;text-transform:uppercase;color:#e5e4e4;font-size:38px}.icon[_ngcontent-%COMP%]{width:20px;height:20px;margin:-35px 5px 5px}.greater-btn[_ngcontent-%COMP%]{left:85%}.greater-btn-greater[_ngcontent-%COMP%]{top:22.2%;left:85%}.greater-btn-active[_ngcontent-%COMP%]{top:58.2%}h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#ccc610;margin-bottom:-2%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%]{font-size:24px;color:#ccc610}h3[_ngcontent-%COMP%]{color:#ccc610;font-size:18px}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%;font-size:16px;line-height:18px}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:3%;margin-bottom:-.5%;font-size:22px}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:50%;transform:translate(-50%);top:2%;transition:.3s}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:3%;left:50%;transform:translate(-50%);margin-bottom:-1%;padding:0;transition:.3s}}"]}),e})(),XR=(()=>{class e{constructor(){this.title="my-app"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Gr({type:e,selectors:[["app-root"]],decls:15,vars:0,consts:[[1,"centre"]],template:function(n,s){1&n&&(Xe(0,"div",0)(1,"div"),Zt(2,"app-apropos")(3,"app-contacter")(4,"app-favoris")(5,"app-carte")(6,"app-darker")(7,"app-popup")(8,"app-btn-sidebar")(9,"app-connexion")(10,"app-btn-connexion"),Xe(11,"div"),Zt(12,"app-pop-up")(13,"app-sidebar"),rt(),Zt(14,"app-test-musique"),rt()())},directives:[Vk,$k,sR,BR,NR,UR,jR,VR,$R,GR,HR,WR],styles:[""]}),e})(),KR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=wi({type:e,bootstrap:[XR]}),e.\u0275inj=ar({providers:[],imports:[[rR,sA,jk]]}),e})();(function G2(){Aw=!1})(),iA().bootstrapModule(KR).catch(e=>console.error(e))},898:function(Ya){Ya.exports=function(){"use strict";var Ja,ca,jn;function ua(p,Kn){if(Ja)if(ca){var Yi="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ja+")(sharedChunk); ("+ca+")(sharedChunk); self.onerror = null;",Tr={};Ja(Tr),jn=Kn(Tr),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(jn.workerUrl=window.URL.createObjectURL(new Blob([Yi],{type:"text/javascript"})))}else ca=Kn;else Ja=Kn}return ua(0,function(p){var Yi=Tr;function Tr(i,r,a,c){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=c,this.p2x=a,this.p2y=c}Tr.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Tr.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Tr.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Tr.prototype.solveCurveX=function(i,r){var a,c,h,f,_;for(void 0===r&&(r=1e-6),h=i,_=0;_<8;_++){if(f=this.sampleCurveX(h)-i,Math.abs(f)<r)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=f/x}if((h=i)<(a=0))return a;if(h>(c=1))return c;for(;a<c;){if(f=this.sampleCurveX(h),Math.abs(f-i)<r)return h;i>f?a=h:c=h,h=.5*(c-a)+a}return h},Tr.prototype.solve=function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))};var at=Lt;function Lt(i,r){this.x=i,this.y=r}Lt.prototype={clone:function(){return new Lt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,r){return this.clone()._rotateAround(i,r)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var r=i.x-this.x,a=i.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,r){return Math.atan2(this.x*r-this.y*i,this.x*i+this.y*r)},_matMult:function(i){var r=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=r,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var r=Math.cos(i),a=Math.sin(i),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(i,r){var a=Math.cos(i),c=Math.sin(i),h=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lt.convert=function(i){return i instanceof Lt?i:Array.isArray(i)?new Lt(i[0],i[1]):i};var Be="undefined"!=typeof self?self:{},jr=1e-6,Vn="undefined"!=typeof Float32Array?Float32Array:Array;function Vo(){var i=new Vn(9);return Vn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Vr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function as(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3],x=r[4],C=r[5],T=r[6],I=r[7],S=r[8],P=r[9],z=r[10],N=r[11],H=r[12],X=r[13],ne=r[14],ce=r[15],pe=a[0],_e=a[1],be=a[2],we=a[3];return i[0]=pe*c+_e*x+be*S+we*H,i[1]=pe*h+_e*C+be*P+we*X,i[2]=pe*f+_e*T+be*z+we*ne,i[3]=pe*_+_e*I+be*N+we*ce,i[4]=(pe=a[4])*c+(_e=a[5])*x+(be=a[6])*S+(we=a[7])*H,i[5]=pe*h+_e*C+be*P+we*X,i[6]=pe*f+_e*T+be*z+we*ne,i[7]=pe*_+_e*I+be*N+we*ce,i[8]=(pe=a[8])*c+(_e=a[9])*x+(be=a[10])*S+(we=a[11])*H,i[9]=pe*h+_e*C+be*P+we*X,i[10]=pe*f+_e*T+be*z+we*ne,i[11]=pe*_+_e*I+be*N+we*ce,i[12]=(pe=a[12])*c+(_e=a[13])*x+(be=a[14])*S+(we=a[15])*H,i[13]=pe*h+_e*C+be*P+we*X,i[14]=pe*f+_e*T+be*z+we*ne,i[15]=pe*_+_e*I+be*N+we*ce,i}function U(i,r,a){var c,h,f,_,x,C,T,I,S,P,z,N,H=a[0],X=a[1],ne=a[2];return r===i?(i[12]=r[0]*H+r[4]*X+r[8]*ne+r[12],i[13]=r[1]*H+r[5]*X+r[9]*ne+r[13],i[14]=r[2]*H+r[6]*X+r[10]*ne+r[14],i[15]=r[3]*H+r[7]*X+r[11]*ne+r[15]):(h=r[1],f=r[2],_=r[3],x=r[4],C=r[5],T=r[6],I=r[7],S=r[8],P=r[9],z=r[10],N=r[11],i[0]=c=r[0],i[1]=h,i[2]=f,i[3]=_,i[4]=x,i[5]=C,i[6]=T,i[7]=I,i[8]=S,i[9]=P,i[10]=z,i[11]=N,i[12]=c*H+x*X+S*ne+r[12],i[13]=h*H+C*X+P*ne+r[13],i[14]=f*H+T*X+z*ne+r[14],i[15]=_*H+I*X+N*ne+r[15]),i}function $(i,r,a){var c=a[0],h=a[1],f=a[2];return i[0]=r[0]*c,i[1]=r[1]*c,i[2]=r[2]*c,i[3]=r[3]*c,i[4]=r[4]*h,i[5]=r[5]*h,i[6]=r[6]*h,i[7]=r[7]*h,i[8]=r[8]*f,i[9]=r[9]*f,i[10]=r[10]*f,i[11]=r[11]*f,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function q(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[4],_=r[5],x=r[6],C=r[7],T=r[8],I=r[9],S=r[10],P=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=f*h+T*c,i[5]=_*h+I*c,i[6]=x*h+S*c,i[7]=C*h+P*c,i[8]=T*h-f*c,i[9]=I*h-_*c,i[10]=S*h-x*c,i[11]=P*h-C*c,i}function ee(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[0],_=r[1],x=r[2],C=r[3],T=r[8],I=r[9],S=r[10],P=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=f*h-T*c,i[1]=_*h-I*c,i[2]=x*h-S*c,i[3]=C*h-P*c,i[8]=f*c+T*h,i[9]=_*c+I*h,i[10]=x*c+S*h,i[11]=C*c+P*h,i}Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});var fe=as;function ge(){var i=new Vn(3);return Vn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function De(i){var r=new Vn(3);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r}function Ne(i){return Math.hypot(i[0],i[1],i[2])}function st(i,r,a){var c=new Vn(3);return c[0]=i,c[1]=r,c[2]=a,c}function ht(i,r,a){return i[0]=r[0]+a[0],i[1]=r[1]+a[1],i[2]=r[2]+a[2],i}function Pt(i,r,a){return i[0]=r[0]-a[0],i[1]=r[1]-a[1],i[2]=r[2]-a[2],i}function bt(i,r,a){return i[0]=r[0]*a[0],i[1]=r[1]*a[1],i[2]=r[2]*a[2],i}function gn(i,r,a){return i[0]=Math.max(r[0],a[0]),i[1]=Math.max(r[1],a[1]),i[2]=Math.max(r[2],a[2]),i}function zn(i,r,a){return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i}function an(i,r,a,c){return i[0]=r[0]+a[0]*c,i[1]=r[1]+a[1]*c,i[2]=r[2]+a[2]*c,i}function $o(i,r){var a=r[0],c=r[1],h=r[2],f=a*a+c*c+h*h;return f>0&&(f=1/Math.sqrt(f)),i[0]=r[0]*f,i[1]=r[1]*f,i[2]=r[2]*f,i}function si(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]}function Rn(i,r,a){var c=r[0],h=r[1],f=r[2],_=a[0],x=a[1],C=a[2];return i[0]=h*C-f*x,i[1]=f*_-c*C,i[2]=c*x-h*_,i}function ln(i,r,a){var c=r[0],h=r[1],f=r[2],_=a[3]*c+a[7]*h+a[11]*f+a[15];return i[0]=(a[0]*c+a[4]*h+a[8]*f+a[12])/(_=_||1),i[1]=(a[1]*c+a[5]*h+a[9]*f+a[13])/_,i[2]=(a[2]*c+a[6]*h+a[10]*f+a[14])/_,i}function Vc(i,r,a){var c=a[0],h=a[1],f=a[2],_=r[0],x=r[1],C=r[2],T=h*C-f*x,I=f*_-c*C,S=c*x-h*_,P=h*S-f*I,z=f*T-c*S,N=c*I-h*T,H=2*a[3];return I*=H,S*=H,z*=2,N*=2,i[0]=_+(T*=H)+(P*=2),i[1]=x+I+z,i[2]=C+S+N,i}var ha,i,da=Pt,mo=bt,pa=Ne;function go(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3];return i[0]=a[0]*c+a[4]*h+a[8]*f+a[12]*_,i[1]=a[1]*c+a[5]*h+a[9]*f+a[13]*_,i[2]=a[2]*c+a[6]*h+a[10]*f+a[14]*_,i[3]=a[3]*c+a[7]*h+a[11]*f+a[15]*_,i}function yr(){var i=new Vn(4);return Vn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Dr(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function $c(i,r,a){a*=.5;var c=r[0],h=r[1],f=r[2],_=r[3],x=Math.sin(a),C=Math.cos(a);return i[0]=c*C+_*x,i[1]=h*C+f*x,i[2]=f*C-h*x,i[3]=_*C-c*x,i}function Cn(i,r){return i[0]===r[0]&&i[1]===r[1]}ge(),ha=new Vn(4),Vn!=Float32Array&&(ha[0]=0,ha[1]=0,ha[2]=0,ha[3]=0),ge(),st(1,0,0),st(0,1,0),yr(),yr(),Vo(),i=new Vn(2),Vn!=Float32Array&&(i[0]=0,i[1]=0);const Qa=Math.PI/180,Yl=180/Math.PI;function Jt(i){return i*Qa}function Ji(i){return i*Yl}const el=[[0,0],[1,0],[1,1],[0,1]];function Gc(i){if(i<=0)return 0;if(i>=1)return 1;const r=i*i,a=r*i;return 4*(i<.5?a:3*(i-r)+a-.75)}function Hc(i,r,a,c){const h=new Yi(i,r,a,c);return function(f){return h.solve(f)}}const Jl=Hc(.25,.1,.25,1);function Ln(i,r,a){return Math.min(a,Math.max(r,i))}function ls(i,r,a){return(a=Ln((a-i)/(r-i),0,1))*a*(3-2*a)}function zs(i,r,a){const c=a-r,h=((i-r)%c+c)%c+r;return h===r?a:h}function Bs(i,r,a){if(!i.length)return a(null,[]);let c=i.length;const h=new Array(i.length);let f=null;i.forEach((_,x)=>{r(_,(C,T)=>{C&&(f=C),h[x]=T,0==--c&&a(f,h)})})}function tl(i){const r=[];for(const a in i)r.push(i[a]);return r}function ur(i,...r){for(const a of r)for(const c in a)i[c]=a[c];return i}let qc=1;function Zc(){return qc++}function _o(){return function i(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Qi(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Qu(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function nl(i,r){i.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Ql(i,r){return-1!==i.indexOf(r,i.length-r.length)}function Ns(i,r,a){const c={};for(const h in i)c[h]=r.call(a||this,i[h],h,i);return c}function ec(i,r,a){const c={};for(const h in i)r.call(a||this,i[h],h,i)&&(c[h]=i[h]);return c}function yo(i){return Array.isArray(i)?i.map(yo):"object"==typeof i&&i?Ns(i,yo):i}const eh={};function sr(i){eh[i]||("undefined"!=typeof console&&console.warn(i),eh[i]=!0)}function Ui(i,r,a){return(a.y-i.y)*(r.x-i.x)>(r.y-i.y)*(a.x-i.x)}function fa(i){let r=0;for(let a,c,h=0,f=i.length,_=f-1;h<f;_=h++)a=i[h],c=i[_],r+=(c.x-a.x)*(a.y+c.y);return r}function vo(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ma(i){const r={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,h,f)=>{const _=h||f;return r[c]=!_||_.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Us,cs,eo,us=null;function xo(i){if(null==us){const r=i.navigator?i.navigator.userAgent:null;us=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return us}function ga(i){try{const r=Be[i];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const vr={now:()=>void 0!==eo?eo:Be.performance.now(),setNow(i){eo=i},restoreNow(){eo=void 0},frame(i){const r=Be.requestAnimationFrame(i);return{cancel:()=>Be.cancelAnimationFrame(r)}},getImageData(i,r=0){const a=Be.document.createElement("canvas"),c=a.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return a.width=i.width,a.height=i.height,c.drawImage(i,0,0,i.width,i.height),c.getImageData(-r,-r,i.width+2*r,i.height+2*r)},resolveURL:i=>(Us||(Us=Be.document.createElement("a")),Us.href=i,Us.href),get devicePixelRatio(){return Be.devicePixelRatio},get prefersReducedMotion(){return!!Be.matchMedia&&(null==cs&&(cs=Be.matchMedia("(prefers-reduced-motion: reduce)")),cs.matches)}};let te;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==te){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{te=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(r){te=i}}return te},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(i){!de&&re&&(Ee?xe(i):J=i)}};let J,re,de=!1,Ee=!1;function xe(i){const r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,re),i.isContextLost())return;j.supported=!0}catch(a){}i.deleteTexture(r),de=!0}Be.document&&(re=Be.document.createElement("img"),re.onload=function(){J&&xe(J),J=null,Ee=!0},re.onerror=function(){de=!0,J=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const me="01",Ce="NO_ACCESS_TOKEN";function Re(i){return 0===i.indexOf("mapbox:")}function ze(i){return O.API_URL_REGEX.test(i)}const He=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(i){const r=i.match(He);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Mt(i){const r=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${r}`}function wt(i){if(!i)return null;const r=i.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Be.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class St{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=wt(O.ACCESS_TOKEN);let c="";return c=a&&a.u?Be.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):O.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=ga("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const h=Be.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const f=Be.localStorage.getItem(c);f&&(this.anonId=f)}catch(h){sr("Unable to read from LocalStorage")}}saveEventData(){const r=ga("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{Be.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Be.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){sr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,c,h){if(!O.EVENTS_URL)return;const f=yt(O.EVENTS_URL);f.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:me,userId:this.anonId},x=a?ur(_,a):_,C={url:Mt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=Go(C,T=>{this.pendingRequest=null,c(T),this.saveEventData(),this.processRequests(h)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const jt=new class extends St{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,r){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(a=>Re(a)||ze(a))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=wt(O.ACCESS_TOKEN),a=r?r.u:O.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;Qu(this.anonId)||(this.anonId=_o(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||f.getDate()!==_.getDate()}else c=!0;if(!c)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},i)}},$n=jt.postTurnstileEvent.bind(jt),Zn=new class extends St{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,a,c){this.skuToken=r,this.errorCb=c,O.EVENTS_URL&&(a||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},a):this.errorCb(new Error(Ce)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Qu(this.anonId)||(this.anonId=_o()),this.postEvent(a,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i))}},On=Zn.postMapLoadEvent.bind(Zn),Yn=new class extends St{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,a,c){if(!O.API_URL||!O.SESSION_PATH)return;const h=yt(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${c||O.ACCESS_TOKEN||""}`);const f={url:Mt(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=th(f,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,r,a,c){this.skuToken=r,this.errorCb=c,O.SESSION_PATH&&O.API_URL&&(a||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},a):this.errorCb(new Error(Ce)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i)}},js=Yn.getSessionAPI.bind(Yn),hs=new Set,Qr="mapbox-tiles";let bo,Wc,td=500,Pr=50;function tc(){Be.caches&&!bo&&(bo=Be.caches.open(Qr))}function rl(i){const r=i.indexOf("?");return r<0?i:i.slice(0,r)}let Xc=1/0;const il={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(il);class Pn extends Error{constructor(r,a,c){401===a&&ze(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const nc=vo()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Be.location.protocol?Be.parent:Be).location.href,rn=function(i,r){if(!(/^file:/.test(a=i.url)||/^file:/.test(nc())&&!/^\w+:/.test(a))){if(Be.fetch&&Be.Request&&Be.AbortController&&Be.Request.prototype.hasOwnProperty("signal"))return function(c,h){const f=new Be.AbortController,_=new Be.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:nc(),signal:f.signal});let x=!1,C=!1;const T=(I=_.url).indexOf("sku=")>0&&ze(I);var I;"json"===c.type&&_.headers.set("Accept","application/json");const S=(z,N,H)=>{if(C)return;if(z&&"SecurityError"!==z.message&&sr(z),N&&H)return P(N);const X=Date.now();Be.fetch(_).then(ne=>{if(ne.ok){const ce=T?ne.clone():null;return P(ne,ce,X)}return h(new Pn(ne.statusText,ne.status,c.url))}).catch(ne=>{20!==ne.code&&h(new Error(ne.message))})},P=(z,N,H)=>{("arrayBuffer"===c.type?z.arrayBuffer():"json"===c.type?z.json():z.text()).then(X=>{C||(N&&H&&function(ne,ce,pe){if(tc(),!bo)return;const _e={status:ce.status,statusText:ce.statusText,headers:new Be.Headers};ce.headers.forEach((we,Fe)=>_e.headers.set(Fe,we));const be=ma(ce.headers.get("Cache-Control")||"");be["no-store"]||(be["max-age"]&&_e.headers.set("Expires",new Date(pe+1e3*be["max-age"]).toUTCString()),new Date(_e.headers.get("Expires")).getTime()-pe<42e4||function(we,Fe){if(void 0===Wc)try{new Response(new ReadableStream),Wc=!0}catch(Pe){Wc=!1}Wc?Fe(we.body):we.blob().then(Fe)}(ce,we=>{const Fe=new Be.Response(we,_e);tc(),bo&&bo.then(Pe=>Pe.put(rl(ne.url),Fe)).catch(Pe=>sr(Pe.message))}))}(_,N,H),x=!0,h(null,X,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(X=>{C||h(new Error(X.message))})};return T?function(z,N){if(tc(),!bo)return N(null);const H=rl(z.url);bo.then(X=>{X.match(H).then(ne=>{const ce=function(pe){if(!pe)return!1;const _e=new Date(pe.headers.get("Expires")||0),be=ma(pe.headers.get("Cache-Control")||"");return _e>Date.now()&&!be["no-cache"]}(ne);X.delete(H),ce&&X.put(H,ne.clone()),N(null,ne,ce)}).catch(N)}).catch(N)}(_,S):S(null,null),{cancel:()=>{C=!0,x||f.abort()}}}(i,r);if(vo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,r,void 0,!0)}var a;return function(c,h){const f=new Be.XMLHttpRequest;f.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(f.responseType="arraybuffer");for(const _ in c.headers)f.setRequestHeader(_,c.headers[_]);return"json"===c.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===c.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let _=f.response;if("json"===c.type)try{_=JSON.parse(f.response)}catch(x){return h(x)}h(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Pn(f.statusText,f.status,c.url))},f.send(c.body),{cancel:()=>f.abort()}}(i,r)},_a=function(i,r){return rn(ur(i,{type:"arrayBuffer"}),r)},Go=function(i,r){return rn(ur(i,{method:"POST"}),r)},th=function(i,r){return rn(ur(i,{method:"GET"}),r)};function Wt(i){const r=Be.document.createElement("a");return r.href=i,r.protocol===Be.document.location.protocol&&r.host===Be.document.location.host}const ya="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let rc,_n;rc=[],_n=0;const Kc=function(i,r){if(j.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),_n>=O.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:i,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return rc.push(f),f}_n++;let a=!1;const c=()=>{if(!a)for(a=!0,_n--;rc.length&&_n<O.MAX_PARALLEL_IMAGE_REQUESTS;){const f=rc.shift(),{requestParameters:_,callback:x,cancelled:C}=f;C||(f.cancel=Kc(_,x).cancel)}},h=_a(i,(f,_,x,C)=>{c(),f?r(f):_&&(Be.createImageBitmap?function(T,I){const S=new Be.Blob([new Uint8Array(T)],{type:"image/png"});Be.createImageBitmap(S).then(P=>{I(null,P)}).catch(P=>{I(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,I)=>r(T,I,x,C)):function(T,I){const S=new Be.Image,P=Be.URL;S.onload=()=>{I(null,S),P.revokeObjectURL(S.src),S.onload=null,Be.requestAnimationFrame(()=>{S.src=ya})},S.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Be.Blob([new Uint8Array(T)],{type:"image/png"});S.src=T.byteLength?P.createObjectURL(z):ya}(_,(T,I)=>r(T,I,x,C)))});return{cancel:()=>{h.cancel(),c()}}};function Vt(i,r,a){a[i]&&-1!==a[i].indexOf(r)||(a[i]=a[i]||[],a[i].push(r))}function $r(i,r,a){if(a&&a[i]){const c=a[i].indexOf(r);-1!==c&&a[i].splice(c,1)}}class Vs{constructor(r,a={}){ur(this,a),this.type=r}}class nh extends Vs{constructor(r,a={}){super("error",ur({error:r},a))}}class va{on(r,a){return this._listeners=this._listeners||{},Vt(r,a,this._listeners),this}off(r,a){return $r(r,a,this._listeners),$r(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Vt(r,a,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,a){"string"==typeof r&&(r=new Vs(r,a||{}));const c=r.type;if(this.listens(c)){r.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of h)x.call(this,r);const f=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of f)$r(c,x,this._oneTimeListeners),x.call(this,r);const _=this._eventedParent;_&&(ur(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof nh&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var Se=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class nt{constructor(r,a,c,h){this.message=(r?`${r}: `:"")+c,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function Fp(i){const r=i.value;return r?[new nt(i.key,r,"constants have been deprecated as of v8")]:[]}function $s(i,...r){for(const a of r)for(const c in a)i[c]=a[c];return i}function xr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ei(i){if(Array.isArray(i))return i.map(ei);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const a in i)r[a]=ei(i[a]);return r}return xr(i)}class ds extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class rh{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[c,h]of a)this.bindings[c]=h}concat(r){return new rh(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const xa={kind:"null"},lt={kind:"number"},on={kind:"string"},Qt={kind:"boolean"},Ho={kind:"color"},ic={kind:"object"},kt={kind:"value"},Bn={kind:"collator"},ba={kind:"formatted"},Yc={kind:"resolvedImage"};function wo(i,r){return{kind:"array",itemType:i,N:r}}function gt(i){if("array"===i.kind){const r=gt(i.itemType);return"number"==typeof i.N?`array<${r}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${r}>`}return i.kind}const qm=[xa,lt,on,Qt,Ho,ba,ic,wo(kt),Yc];function ar(i,r){if("error"===r.kind)return null;if("array"===i.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!ar(i.itemType,r.itemType))&&("number"!=typeof i.N||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if("value"===i.kind)for(const a of qm)if(!ar(a,r))return null}return`Expected ${gt(i)} but found ${gt(r)} instead.`}function ol(i,r){return r.some(a=>a.kind===i.kind)}function wa(i,r){return r.some(a=>"null"===a?null===i:"array"===a?Array.isArray(i):"object"===a?i&&!Array.isArray(i)&&"object"==typeof i:a===typeof i)}function sl(i){var r={exports:{}};return i(r,r.exports),r.exports}var al=sl(function(i,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return c("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(C="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:C>1?1:C;var C}function _(x,C,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?x+(C-x)*T*6:2*T<1?C:3*T<2?x+(C-x)*(2/3-T)*6:x}try{r.parseCSSColor=function(x){var C,T=x.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if("#"===T[0])return 4===T.length?(C=parseInt(T.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===T.length&&(C=parseInt(T.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var I=T.indexOf("("),S=T.indexOf(")");if(-1!==I&&S+1===T.length){var P=T.substr(0,I),z=T.substr(I+1,S-(I+1)).split(","),N=1;switch(P){case"rgba":if(4!==z.length)return null;N=f(z.pop());case"rgb":return 3!==z.length?null:[h(z[0]),h(z[1]),h(z[2]),N];case"hsla":if(4!==z.length)return null;N=f(z.pop());case"hsl":if(3!==z.length)return null;var H=(parseFloat(z[0])%360+360)%360/360,X=f(z[1]),ne=f(z[2]),ce=ne<=.5?ne*(X+1):ne+X-ne*X,pe=2*ne-ce;return[c(255*_(pe,ce,H+1/3)),c(255*_(pe,ce,H)),c(255*_(pe,ce,H-1/3)),N];default:return null}}return null}}catch(x){}});class dn{constructor(r,a,c,h=1){this.r=r,this.g=a,this.b=c,this.a=h}static parse(r){if(!r)return;if(r instanceof dn)return r;if("string"!=typeof r)return;const a=al.parseCSSColor(r);return a?new dn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,c,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(c)},${h})`}toArray(){const{r,g:a,b:c,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*a/h,255*c/h,h]}}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1),dn.blue=new dn(0,0,1,1);class Ca{constructor(r,a,c){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oc{constructor(r,a,c,h,f){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=c,this.fontStack=h,this.textColor=f}}class Bt{constructor(r){this.sections=r}static fromString(r){return new Bt([new oc(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Bt?r:Bt.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(c)}return r}}class to{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new to({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Ut(i,r,a,c){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[i,r,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[i,r,a,c]:[i,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ll(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof dn||i instanceof Ca||i instanceof Bt||i instanceof to)return!0;if(Array.isArray(i)){for(const r of i)if(!ll(r))return!1;return!0}if("object"==typeof i){for(const r in i)if(!ll(i[r]))return!1;return!0}return!1}function br(i){if(null===i)return xa;if("string"==typeof i)return on;if("boolean"==typeof i)return Qt;if("number"==typeof i)return lt;if(i instanceof dn)return Ho;if(i instanceof Ca)return Bn;if(i instanceof Bt)return ba;if(i instanceof to)return Yc;if(Array.isArray(i)){const r=i.length;let a;for(const c of i){const h=br(c);if(a){if(a===h)continue;a=kt;break}a=h}return wo(a||kt,r)}return ic}function no(i){const r=typeof i;return null===i?"":"string"===r||"number"===r||"boolean"===r?String(i):i instanceof dn||i instanceof Bt||i instanceof to?i.toString():JSON.stringify(i)}class ps{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ll(r[1]))return a.error("invalid value");const c=r[1];let h=br(c);const f=a.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new ps(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof dn?["rgba"].concat(this.value.toArray()):this.value instanceof Bt?this.value.serialize():this.value}}class ti{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Co={string:on,number:lt,boolean:Qt,object:ic};class hr{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let c,h=1;const f=r[0];if("array"===f){let x,C;if(r.length>2){const T=r[1];if("string"!=typeof T||!(T in Co)||"object"===T)return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Co[T],h++}else x=kt;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=r[2],h++}c=wo(x,C)}else c=Co[f];const _=[];for(;h<r.length;h++){const x=a.parse(r[h],h,kt);if(!x)return null;_.push(x)}return new hr(c,_)}evaluate(r){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(r);if(!ar(this.type,br(c)))return c;if(a===this.args.length-1)throw new ti(`Expected value to be of type ${gt(this.type)}, but found ${gt(br(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){a.push(c.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(c=>c.serialize()))}}class fs{constructor(r){this.type=ba,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return a.error("First argument must be an image or text section.");const h=[];let f=!1;for(let _=1;_<=r.length-1;++_){const x=r[_];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let C=null;if(x["font-scale"]&&(C=a.parse(x["font-scale"],1,lt),!C))return null;let T=null;if(x["text-font"]&&(T=a.parse(x["text-font"],1,wo(on)),!T))return null;let I=null;if(x["text-color"]&&(I=a.parse(x["text-color"],1,Ho),!I))return null;const S=h[h.length-1];S.scale=C,S.font=T,S.textColor=I}else{const C=a.parse(r[_],1,kt);if(!C)return null;const T=C.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:C,scale:null,font:null,textColor:null})}}return new fs(h)}evaluate(r){return new Bt(this.sections.map(a=>{const c=a.content.evaluate(r);return br(c)===Yc?new oc("",c,null,null,null):new oc(no(c),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),r.push(c)}return r}}class cl{constructor(r){this.type=Yc,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,on);return c?new cl(c):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),c=to.fromString(a);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(a)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const qo={"to-boolean":Qt,"to-color":Ho,"to-number":lt,"to-string":on};class Zo{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return a.error("Expected one argument.");const h=qo[c],f=[];for(let _=1;_<r.length;_++){const x=a.parse(r[_],_,kt);if(!x)return null;f.push(x)}return new Zo(h,f)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,c;for(const h of this.args){if(a=h.evaluate(r),c=null,a instanceof dn)return a;if("string"==typeof a){const f=r.parseColor(a);if(f)return f}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ut(a[0],a[1],a[2],a[3]),!c))return new dn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ti(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const c of this.args){if(a=c.evaluate(r),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new ti(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Bt.fromString(no(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?to.fromString(no(this.args[0].evaluate(r))):no(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new fs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new cl(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const nd=["Unknown","Point","LineString","Polygon"];class rd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?nd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*a-r[0])+this.featureDistanceData.bearing[1]*(h*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=dn.parse(r)),a}}class ro{constructor(r,a,c,h){this.name=r,this.type=a,this._evaluate=c,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const c=r[0],h=ro.definitions[c];if(!h)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([T])=>!Array.isArray(T)||T.length===r.length-1);let C=null;for(const[T,I]of x){C=new kr(a.registry,a.path,null,a.scope);const S=[];let P=!1;for(let z=1;z<r.length;z++){const N=r[z],H=Array.isArray(T)?T[z-1]:T.type,X=C.parse(N,1+S.length,H);if(!X){P=!0;break}S.push(X)}if(!P)if(Array.isArray(T)&&T.length!==S.length)C.error(`Expected ${T.length} arguments, but found ${S.length} instead.`);else{for(let z=0;z<S.length;z++){const N=Array.isArray(T)?T[z]:T.type,H=S[z];C.concat(z+1).checkSubtype(N,H.type)}if(0===C.errors.length)return new ro(c,f,I,S)}}if(1===x.length)a.errors.push(...C.errors);else{const T=(x.length?x:_).map(([S])=>{return P=S,Array.isArray(P)?`(${P.map(gt).join(", ")})`:`(${gt(P.type)}...)`;var P}).join(" | "),I=[];for(let S=1;S<r.length;S++){const P=a.parse(r[S],1+I.length);if(!P)return null;I.push(gt(P.type))}a.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(r,a){ro.definitions=a;for(const c in a)r[c]=ro}}class Mn{constructor(r,a,c){this.type=Bn,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,Qt);if(!h)return null;const f=a.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,Qt);if(!f)return null;let _=null;return c.locale&&(_=a.parse(c.locale,1,on),!_)?null:new Mn(h,f,_)}evaluate(r){return new Ca(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Ea=8192;function ih(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function Wo(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function Gn(i,r){const a=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*Ea),Math.round(c*h*Ea)]}function sc(i,r,a){const c=i[0]-r[0],h=i[1]-r[1],f=i[0]-a[0],_=i[1]-a[1];return c*_-f*h==0&&c*f<=0&&h*_<=0}function ac(i,r){let a=!1;for(let _=0,x=r.length;_<x;_++){const C=r[_];for(let T=0,I=C.length;T<I-1;T++){if(sc(i,C[T],C[T+1]))return!1;(h=C[T])[1]>(c=i)[1]!=(f=C[T+1])[1]>c[1]&&c[0]<(f[0]-h[0])*(c[1]-h[1])/(f[1]-h[1])+h[0]&&(a=!a)}}var c,h,f;return a}function Jc(i,r){for(let a=0;a<r.length;a++)if(ac(i,r[a]))return!0;return!1}function Qc(i,r,a,c){const h=c[0]-a[0],f=c[1]-a[1],_=(i[0]-a[0])*f-h*(i[1]-a[1]),x=(r[0]-a[0])*f-h*(r[1]-a[1]);return _>0&&x<0||_<0&&x>0}function ms(i,r,a){for(const T of a)for(let I=0;I<T.length-1;++I)if((x=[(_=T[I+1])[0]-(f=T[I])[0],_[1]-f[1]])[0]*(C=[(h=r)[0]-(c=i)[0],h[1]-c[1]])[1]-x[1]*C[0]!=0&&Qc(c,h,f,_)&&Qc(f,_,c,h))return!0;var c,h,f,_,x,C;return!1}function ul(i,r){for(let a=0;a<i.length;++a)if(!ac(i[a],r))return!1;for(let a=0;a<i.length-1;++a)if(ms(i[a],i[a+1],r))return!1;return!0}function zp(i,r){for(let a=0;a<r.length;a++)if(ul(i,r[a]))return!0;return!1}function Gr(i,r,a){const c=[];for(let h=0;h<i.length;h++){const f=[];for(let _=0;_<i[h].length;_++){const x=Gn(i[h][_],a);ih(r,x),f.push(x)}c.push(f)}return c}function id(i,r,a){const c=[];for(let h=0;h<i.length;h++){const f=Gr(i[h],r,a);c.push(f)}return c}function eu(i,r,a,c){if(i[0]<a[0]||i[0]>a[2]){const h=.5*c;let f=i[0]-a[0]>h?-c:a[0]-i[0]>h?c:0;0===f&&(f=i[0]-a[2]>h?-c:a[2]-i[0]>h?c:0),i[0]+=f}ih(r,i)}function oh(i,r,a,c){const h=Math.pow(2,c.z)*Ea,f=[c.x*Ea,c.y*Ea],_=[];for(const x of i)for(const C of x){const T=[C.x+f[0],C.y+f[1]];eu(T,r,a,h),_.push(T)}return _}function sh(i,r,a,c){const h=Math.pow(2,c.z)*Ea,f=[c.x*Ea,c.y*Ea],_=[];for(const C of i){const T=[];for(const I of C){const S=[I.x+f[0],I.y+f[1]];ih(r,S),T.push(S)}_.push(T)}if(r[2]-r[0]<=h/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const C of _)for(const T of C)eu(T,r,a,h)}var x;return _}class wi{constructor(r,a){this.type=Qt,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ll(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let h=0;h<c.features.length;++h){const f=c.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new wi(c,c.features[h].geometry)}else if("Feature"===c.type){const h=c.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new wi(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new wi(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if("Polygon"===c.type){const x=Gr(c.coordinates,f,_),C=oh(a.geometry(),h,f,_);if(!Wo(h,f))return!1;for(const T of C)if(!ac(T,x))return!1}if("MultiPolygon"===c.type){const x=id(c.coordinates,f,_),C=oh(a.geometry(),h,f,_);if(!Wo(h,f))return!1;for(const T of C)if(!Jc(T,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if("Polygon"===c.type){const x=Gr(c.coordinates,f,_),C=sh(a.geometry(),h,f,_);if(!Wo(h,f))return!1;for(const T of C)if(!ul(T,x))return!1}if("MultiPolygon"===c.type){const x=id(c.coordinates,f,_),C=sh(a.geometry(),h,f,_);if(!Wo(h,f))return!1;for(const T of C)if(!zp(T,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function hl(i){if(i instanceof ro&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof wi)return!1;let r=!0;return i.eachChild(a=>{r&&!hl(a)&&(r=!1)}),r}function dl(i){if(i instanceof ro&&"feature-state"===i.name)return!1;let r=!0;return i.eachChild(a=>{r&&!dl(a)&&(r=!1)}),r}function Mr(i,r){if(i instanceof ro&&r.indexOf(i.name)>=0)return!1;let a=!0;return i.eachChild(c=>{a&&!Mr(c,r)&&(a=!1)}),a}class Hr{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const c=r[1];return a.scope.has(c)?new Hr(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class kr{constructor(r,a=[],c,h=new rh,f=[]){this.registry=r,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=f,this.expectedType=c}parse(r,a,c,h,f={}){return a?this.concat(a,c,h)._parse(r,f):this._parse(r,f)}_parse(r,a){function c(h,f,_){return"assert"===_?new hr(f,[h]):"coerce"===_?new Zo(f,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let _=f.parse(r,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,C=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==C.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(x,C))return null}else _=c(_,x,a.typeAnnotation||"coerce");else _=c(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof ps)&&"resolvedImage"!==_.type.kind&&Eo(_)){const x=new rd;try{_=new ps(_.type,_.evaluate(x))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,c){const h="number"==typeof r?this.path.concat(r):this.path,f=c?this.scope.concat(c):this.scope;return new kr(this.registry,h,a||null,f,this.errors)}error(r,...a){const c=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new ds(c,r))}checkSubtype(r,a){const c=ar(r,a);return c&&this.error(c),c}}function Eo(i){if(i instanceof Hr)return Eo(i.boundExpression);if(i instanceof ro&&"error"===i.name||i instanceof Mn||i instanceof wi)return!1;const r=i instanceof Zo||i instanceof hr;let a=!0;return i.eachChild(c=>{a=r?a&&Eo(c):a&&c instanceof ps}),!!a&&hl(i)&&Mr(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function To(i,r){const a=i.length-1;let c,h,f=0,_=a,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),c=i[x],h=i[x+1],c<=r){if(x===a||r<h)return x;f=x+1}else{if(!(c>r))throw new ti("Input is not a number.");_=x-1}return 0}class ai{constructor(r,a,c){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,f]of c)this.labels.push(h),this.outputs.push(f)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(r[1],1,lt);if(!c)return null;const h=[];let f=null;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);for(let _=1;_<r.length;_+=2){const x=1===_?-1/0:r[_],C=r[_+1],T=_,I=_+1;if("number"!=typeof x)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const S=a.parse(C,I,f);if(!S)return null;f=f||S.type,h.push([x,S])}return new ai(f,c,h)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const f=a.length;return h>=a[f-1]?c[f-1].evaluate(r):c[To(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}function mn(i,r,a){return i*(1-a)+r*a}var pl=Object.freeze({__proto__:null,number:mn,color:function(i,r,a){return new dn(mn(i.r,r.r,a),mn(i.g,r.g,a),mn(i.b,r.b,a),mn(i.a,r.a,a))},array:function(i,r,a){return i.map((c,h)=>mn(c,r[h],a))}});const gs=4/29,Rr=6/29,od=3*Rr*Rr,io=Math.PI/180,pt=180/Math.PI;function en(i){return i>.008856451679035631?Math.pow(i,1/3):i/od+gs}function Wn(i){return i>Rr?i*i*i:od*(i-gs)}function li(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Do(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Lr(i){const r=Do(i.r),a=Do(i.g),c=Do(i.b),h=en((.4124564*r+.3575761*a+.1804375*c)/.95047),f=en((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-en((.0193339*r+.119192*a+.9503041*c)/1.08883)),alpha:i.a}}function Hs(i){let r=(i.l+16)/116,a=isNaN(i.a)?r:r+i.a/500,c=isNaN(i.b)?r:r-i.b/200;return r=1*Wn(r),a=.95047*Wn(a),c=1.08883*Wn(c),new dn(li(3.2404542*a-1.5371385*r-.4985314*c),li(-.969266*a+1.8760108*r+.041556*c),li(.0556434*a-.2040259*r+1.0572252*c),i.alpha)}function wr(i,r,a){const c=r-i;return i+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const _s={forward:Lr,reverse:Hs,interpolate:function(i,r,a){return{l:mn(i.l,r.l,a),a:mn(i.a,r.a,a),b:mn(i.b,r.b,a),alpha:mn(i.alpha,r.alpha,a)}}},Xo={forward:function(i){const{l:r,a,b:c}=Lr(i),h=Math.atan2(c,a)*pt;return{h:h<0?h+360:h,c:Math.sqrt(a*a+c*c),l:r,alpha:i.a}},reverse:function(i){const r=i.h*io,a=i.c;return Hs({l:i.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:i.alpha})},interpolate:function(i,r,a){return{h:wr(i.h,r.h,a),c:mn(i.c,r.c,a),l:mn(i.l,r.l,a),alpha:mn(i.alpha,r.alpha,a)}}};var Xt=Object.freeze({__proto__:null,lab:_s,hcl:Xo});class ni{constructor(r,a,c,h,f){this.type=r,this.operator=a,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(r,a,c,h){let f=0;if("exponential"===r.name)f=ys(a,r.base,c,h);else if("linear"===r.name)f=ys(a,1,c,h);else if("cubic-bezier"===r.name){const _=r.controlPoints;f=new Yi(_[0],_[1],_[2],_[3]).solve(ys(a,1,c,h))}return f}static parse(r,a){let[c,h,f,..._]=r;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(I=>"number"!=typeof I||I<0||I>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(f=a.parse(f,2,lt),!f)return null;const x=[];let C=null;"interpolate-hcl"===c||"interpolate-lab"===c?C=Ho:a.expectedType&&"value"!==a.expectedType.kind&&(C=a.expectedType);for(let T=0;T<_.length;T+=2){const I=_[T],S=_[T+1],P=T+3,z=T+4;if("number"!=typeof I)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=I)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const N=a.parse(S,z,C);if(!N)return null;C=C||N.type,x.push([I,N])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new ni(C,c,h,f,x):a.error(`Type ${gt(C)} is not interpolatable.`)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const f=a.length;if(h>=a[f-1])return c[f-1].evaluate(r);const _=To(a,h),x=ni.interpolationFactor(this.interpolation,h,a[_],a[_+1]),C=c[_].evaluate(r),T=c[_+1].evaluate(r);return"interpolate"===this.operator?pl[this.type.kind.toLowerCase()](C,T,x):"interpolate-hcl"===this.operator?Xo.reverse(Xo.interpolate(Xo.forward(C),Xo.forward(T),x)):_s.reverse(_s.interpolate(_s.forward(C),_s.forward(T),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function ys(i,r,a,c){const h=c-a,f=i-a;return 0===h?0:1===r?f/h:(Math.pow(r,f)-1)/(Math.pow(r,h)-1)}class vs{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let c=null;const h=a.expectedType;h&&"value"!==h.kind&&(c=h);const f=[];for(const x of r.slice(1)){const C=a.parse(x,1+f.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,f.push(C)}const _=h&&f.some(x=>ar(h,x.type));return new vs(_?kt:c,f)}evaluate(r){let a,c=null,h=0;for(const f of this.args){if(h++,c=f.evaluate(r),c&&c instanceof to&&!c.available&&(a||(a=c),c=null,h===this.args.length))return a;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class xs{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let f=1;f<r.length-1;f+=2){const _=r[f];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=a.parse(r[f+1],f+1);if(!x)return null;c.push([_,x])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,c);return h?new xs(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,c]of this.bindings)r.push(a,c.serialize());return r.push(this.result.serialize()),r}}class ci{constructor(r,a,c){this.type=r,this.index=a,this.input=c}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,lt),h=a.parse(r[2],2,wo(a.expectedType||kt));return c&&h?new ci(h.type.itemType,c,h):null}evaluate(r){const a=this.index.evaluate(r),c=this.input.evaluate(r);if(a<0)throw new ti(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new ti(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new ti(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ta{constructor(r,a){this.type=Qt,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,kt),h=a.parse(r[2],2,kt);return c&&h?ol(c.type,[Qt,on,lt,xa,kt])?new Ta(c,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${gt(c.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!c)return!1;if(!wa(a,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${gt(br(a))} instead.`);if(!wa(c,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${gt(br(c))} instead.`);return c.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ui{constructor(r,a,c){this.type=lt,this.needle=r,this.haystack=a,this.fromIndex=c}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,kt),h=a.parse(r[2],2,kt);if(!c||!h)return null;if(!ol(c.type,[Qt,on,lt,xa,kt]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${gt(c.type)} instead`);if(4===r.length){const f=a.parse(r[3],3,lt);return f?new ui(c,h,f):null}return new ui(c,h)}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!wa(a,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${gt(br(a))} instead.`);if(!wa(c,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${gt(br(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return c.indexOf(a,h)}return c.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ri{constructor(r,a,c,h,f,_){this.inputType=r,this.type=a,this.input=c,this.cases=h,this.outputs=f,this.otherwise=_}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let c,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const f={},_=[];for(let T=2;T<r.length-1;T+=2){let I=r[T];const S=r[T+1];Array.isArray(I)||(I=[I]);const P=a.concat(T);if(0===I.length)return P.error("Expected at least one branch label.");for(const N of I){if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(c){if(P.checkSubtype(c,br(N)))return null}else c=br(N);if(void 0!==f[String(N)])return P.error("Branch labels must be unique.");f[String(N)]=_.length}const z=a.parse(S,T,h);if(!z)return null;h=h||z.type,_.push(z)}const x=a.parse(r[1],1,kt);if(!x)return null;const C=a.parse(r[r.length-1],r.length-1,h);return C?"value"!==x.type.kind&&a.concat(1).checkSubtype(c,x.type)?null:new Ri(c,h,x,f,_,C):null}evaluate(r){const a=this.input.evaluate(r);return(br(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],h={};for(const _ of a){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[x][1].push(_)}const f=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of c)r.push(1===x.length?f(x[0]):x.map(f)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class En{constructor(r,a,c){this.type=r,this.branches=a,this.otherwise=c}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);const h=[];for(let _=1;_<r.length-1;_+=2){const x=a.parse(r[_],_,Qt);if(!x)return null;const C=a.parse(r[_+1],_+1,c);if(!C)return null;h.push([x,C]),c=c||C.type}const f=a.parse(r[r.length-1],r.length-1,c);return f?new En(c,h,f):null}evaluate(r){for(const[a,c]of this.branches)if(a.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,c]of this.branches)r(a),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class lc{constructor(r,a,c,h){this.type=r,this.input=a,this.beginIndex=c,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,kt),h=a.parse(r[2],2,lt);if(!c||!h)return null;if(!ol(c.type,[wo(kt),on,kt]))return a.error(`Expected first argument to be of type array or string, but found ${gt(c.type)} instead`);if(4===r.length){const f=a.parse(r[3],3,lt);return f?new lc(c.type,c,h,f):null}return new lc(c.type,c,h)}evaluate(r){const a=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!wa(a,["string","array"]))throw new ti(`Expected first argument to be of type array or string, but found ${gt(br(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(c,h)}return a.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function sd(i,r){return"=="===i||"!="===i?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function ji(i,r,a,c){return 0===c.compare(r,a)}function qr(i,r,a){const c="=="!==i&&"!="!==i;return class nT{constructor(f,_,x){this.type=Qt,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===_.type.kind}static parse(f,_){if(3!==f.length&&4!==f.length)return _.error("Expected two or three arguments.");const x=f[0];let C=_.parse(f[1],1,kt);if(!C)return null;if(!sd(x,C.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${gt(C.type)}'.`);let T=_.parse(f[2],2,kt);if(!T)return null;if(!sd(x,T.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${gt(T.type)}'.`);if(C.type.kind!==T.type.kind&&"value"!==C.type.kind&&"value"!==T.type.kind)return _.error(`Cannot compare types '${gt(C.type)}' and '${gt(T.type)}'.`);c&&("value"===C.type.kind&&"value"!==T.type.kind?C=new hr(T.type,[C]):"value"!==C.type.kind&&"value"===T.type.kind&&(T=new hr(C.type,[T])));let I=null;if(4===f.length){if("string"!==C.type.kind&&"string"!==T.type.kind&&"value"!==C.type.kind&&"value"!==T.type.kind)return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(f[3],3,Bn),!I)return null}return new nT(C,T,I)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(c&&this.hasUntypedArgument){const C=br(_),T=br(x);if(C.kind!==T.kind||"string"!==C.kind&&"number"!==C.kind)throw new ti(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=br(_),T=br(x);if("string"!==C.kind||"string"!==T.kind)return r(f,_,x)}return this.collator?a(f,_,x,this.collator.evaluate(f)):r(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[i];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const tu=qr("==",function(i,r,a){return r===a},ji),ml=qr("!=",function(i,r,a){return r!==a},function(i,r,a,c){return!ji(0,r,a,c)}),gl=qr("<",function(i,r,a){return r<a},function(i,r,a,c){return c.compare(r,a)<0}),oo=qr(">",function(i,r,a){return r>a},function(i,r,a,c){return c.compare(r,a)>0}),ah=qr("<=",function(i,r,a){return r<=a},function(i,r,a,c){return c.compare(r,a)<=0}),Bp=qr(">=",function(i,r,a){return r>=a},function(i,r,a,c){return c.compare(r,a)>=0});class nu{constructor(r,a,c,h,f){this.type=on,this.number=r,this.locale=a,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,lt);if(!c)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=a.parse(h.locale,1,on),!f))return null;let _=null;if(h.currency&&(_=a.parse(h.currency,1,on),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=a.parse(h["min-fraction-digits"],1,lt),!x))return null;let C=null;return h["max-fraction-digits"]&&(C=a.parse(h["max-fraction-digits"],1,lt),!C)?null:new nu(c,f,_,x,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class ru{constructor(r){this.type=lt,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=a.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?a.error(`Expected argument of type string or array, but found ${gt(c.type)} instead.`):new ru(c):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new ti(`Expected value to be of type string or array, but found ${gt(br(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Ko={"==":tu,"!=":ml,">":oo,"<":gl,">=":Bp,"<=":ah,array:hr,at:ci,boolean:hr,case:En,coalesce:vs,collator:Mn,format:fs,image:cl,in:Ta,"index-of":ui,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:ru,let:xs,literal:ps,match:Ri,number:hr,"number-format":nu,object:hr,slice:lc,step:ai,string:hr,"to-boolean":Zo,"to-color":Zo,"to-number":Zo,"to-string":Zo,var:Hr,within:wi};function ad(i,[r,a,c,h]){r=r.evaluate(i),a=a.evaluate(i),c=c.evaluate(i);const f=h?h.evaluate(i):1,_=Ut(r,a,c,f);if(_)throw new ti(_);return new dn(r/255*f,a/255*f,c/255*f,f)}function ld(i,r){return i in r}function iu(i,r){const a=r[i];return void 0===a?null:a}function Da(i){return{type:i}}function Np(i){return{result:"success",value:i}}function qs(i){return{result:"error",value:i}}function cc(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function Up(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function cd(i){return!!i.expression&&i.expression.interpolated}function Tn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function lh(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function ch(i){return i}function ou(i,r){const a="color"===r.type,c=i.stops&&"object"==typeof i.stops[0][0],h=c||!(c||void 0!==i.property),f=i.type||(cd(r)?"exponential":"interval");if(a&&((i=$s({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],dn.parse(T[1])])),i.default=dn.parse(i.default?i.default:r.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!Xt[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,x,C;if("exponential"===f)_=jp;else if("interval"===f)_=Zm;else if("categorical"===f){_=_l,x=Object.create(null);for(const T of i.stops)x[T[0]]=T[1];C=typeof i.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);_=Wm}if(c){const T={},I=[];for(let z=0;z<i.stops.length;z++){const N=i.stops[z],H=N[0].zoom;void 0===T[H]&&(T[H]={zoom:H,type:i.type,property:i.property,default:i.default,stops:[]},I.push(H)),T[H].stops.push([N[0].value,N[1]])}const S=[];for(const z of I)S.push([T[z].zoom,ou(T[z],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:ni.interpolationFactor.bind(void 0,P),zoomStops:S.map(z=>z[0]),evaluate:({zoom:z},N)=>jp({stops:S,base:i.base},r,z).evaluate(z,N)}}if(h){const T="exponential"===f?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:ni.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(i,r,I,x,C)}}return{kind:"source",evaluate(T,I){const S=I&&I.properties?I.properties[i.property]:void 0;return void 0===S?Zr(i.default,r.default):_(i,r,S,x,C)}}}function Zr(i,r,a){return void 0!==i?i:void 0!==r?r:void 0!==a?a:void 0}function _l(i,r,a,c,h){return Zr(typeof a===h?c[a]:void 0,i.default,r.default)}function Zm(i,r,a){if("number"!==Tn(a))return Zr(i.default,r.default);const c=i.stops.length;if(1===c||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[c-1][0])return i.stops[c-1][1];const h=To(i.stops.map(f=>f[0]),a);return i.stops[h][1]}function jp(i,r,a){const c=void 0!==i.base?i.base:1;if("number"!==Tn(a))return Zr(i.default,r.default);const h=i.stops.length;if(1===h||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[h-1][0])return i.stops[h-1][1];const f=To(i.stops.map(I=>I[0]),a),_=function(I,S,P,z){const N=z-P,H=I-P;return 0===N?0:1===S?H/N:(Math.pow(S,H)-1)/(Math.pow(S,N)-1)}(a,c,i.stops[f][0],i.stops[f+1][0]),x=i.stops[f][1],C=i.stops[f+1][1];let T=pl[r.type]||ch;if(i.colorSpace&&"rgb"!==i.colorSpace){const I=Xt[i.colorSpace];T=(S,P)=>I.reverse(I.interpolate(I.forward(S),I.forward(P),_))}return"function"==typeof x.evaluate?{evaluate(...I){const S=x.evaluate.apply(void 0,I),P=C.evaluate.apply(void 0,I);if(void 0!==S&&void 0!==P)return T(S,P,_)}}:T(x,C,_)}function Wm(i,r,a){return"color"===r.type?a=dn.parse(a):"formatted"===r.type?a=Bt.fromString(a.toString()):"resolvedImage"===r.type?a=to.fromString(a.toString()):Tn(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),Zr(a,i.default,r.default)}ro.register(Ko,{error:[{kind:"error"},[on],(i,[r])=>{throw new ti(r.evaluate(i))}],typeof:[on,[kt],(i,[r])=>gt(br(r.evaluate(i)))],"to-rgba":[wo(lt,4),[Ho],(i,[r])=>r.evaluate(i).toArray()],rgb:[Ho,[lt,lt,lt],ad],rgba:[Ho,[lt,lt,lt,lt],ad],has:{type:Qt,overloads:[[[on],(i,[r])=>ld(r.evaluate(i),i.properties())],[[on,ic],(i,[r,a])=>ld(r.evaluate(i),a.evaluate(i))]]},get:{type:kt,overloads:[[[on],(i,[r])=>iu(r.evaluate(i),i.properties())],[[on,ic],(i,[r,a])=>iu(r.evaluate(i),a.evaluate(i))]]},"feature-state":[kt,[on],(i,[r])=>iu(r.evaluate(i),i.featureState||{})],properties:[ic,[],i=>i.properties()],"geometry-type":[on,[],i=>i.geometryType()],id:[kt,[],i=>i.id()],zoom:[lt,[],i=>i.globals.zoom],pitch:[lt,[],i=>i.globals.pitch||0],"distance-from-center":[lt,[],i=>i.distanceFromCenter()],"heatmap-density":[lt,[],i=>i.globals.heatmapDensity||0],"line-progress":[lt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[lt,[],i=>i.globals.skyRadialProgress||0],accumulated:[kt,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[lt,Da(lt),(i,r)=>{let a=0;for(const c of r)a+=c.evaluate(i);return a}],"*":[lt,Da(lt),(i,r)=>{let a=1;for(const c of r)a*=c.evaluate(i);return a}],"-":{type:lt,overloads:[[[lt,lt],(i,[r,a])=>r.evaluate(i)-a.evaluate(i)],[[lt],(i,[r])=>-r.evaluate(i)]]},"/":[lt,[lt,lt],(i,[r,a])=>r.evaluate(i)/a.evaluate(i)],"%":[lt,[lt,lt],(i,[r,a])=>r.evaluate(i)%a.evaluate(i)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(i,[r,a])=>Math.pow(r.evaluate(i),a.evaluate(i))],sqrt:[lt,[lt],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[lt,[lt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[lt,[lt],(i,[r])=>Math.log(r.evaluate(i))],log2:[lt,[lt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[lt,[lt],(i,[r])=>Math.sin(r.evaluate(i))],cos:[lt,[lt],(i,[r])=>Math.cos(r.evaluate(i))],tan:[lt,[lt],(i,[r])=>Math.tan(r.evaluate(i))],asin:[lt,[lt],(i,[r])=>Math.asin(r.evaluate(i))],acos:[lt,[lt],(i,[r])=>Math.acos(r.evaluate(i))],atan:[lt,[lt],(i,[r])=>Math.atan(r.evaluate(i))],min:[lt,Da(lt),(i,r)=>Math.min(...r.map(a=>a.evaluate(i)))],max:[lt,Da(lt),(i,r)=>Math.max(...r.map(a=>a.evaluate(i)))],abs:[lt,[lt],(i,[r])=>Math.abs(r.evaluate(i))],round:[lt,[lt],(i,[r])=>{const a=r.evaluate(i);return a<0?-Math.round(-a):Math.round(a)}],floor:[lt,[lt],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[lt,[lt],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[Qt,[on,kt],(i,[r,a])=>i.properties()[r.value]===a.value],"filter-id-==":[Qt,[kt],(i,[r])=>i.id()===r.value],"filter-type-==":[Qt,[on],(i,[r])=>i.geometryType()===r.value],"filter-<":[Qt,[on,kt],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Qt,[kt],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a<c}],"filter->":[Qt,[on,kt],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c>h}],"filter-id->":[Qt,[kt],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a>c}],"filter-<=":[Qt,[on,kt],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Qt,[kt],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a<=c}],"filter->=":[Qt,[on,kt],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Qt,[kt],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a>=c}],"filter-has":[Qt,[kt],(i,[r])=>r.value in i.properties()],"filter-has-id":[Qt,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[Qt,[wo(on)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[Qt,[wo(kt)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[Qt,[on,wo(kt)],(i,[r,a])=>a.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[Qt,[on,wo(kt)],(i,[r,a])=>function(c,h,f,_){for(;f<=_;){const x=f+_>>1;if(h[x]===c)return!0;h[x]>c?_=x-1:f=x+1}return!1}(i.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(i,[r,a])=>r.evaluate(i)&&a.evaluate(i)],[Da(Qt),(i,r)=>{for(const a of r)if(!a.evaluate(i))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(i,[r,a])=>r.evaluate(i)||a.evaluate(i)],[Da(Qt),(i,r)=>{for(const a of r)if(a.evaluate(i))return!0;return!1}]]},"!":[Qt,[Qt],(i,[r])=>!r.evaluate(i)],"is-supported-script":[Qt,[on],(i,[r])=>{const a=i.globals&&i.globals.isSupportedScript;return!a||a(r.evaluate(i))}],upcase:[on,[on],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[on,[on],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[on,Da(kt),(i,r)=>r.map(a=>no(a.evaluate(i))).join("")],"resolved-locale":[on,[Bn],(i,[r])=>r.evaluate(i).resolvedLocale()]});class bs{constructor(r,a){var c;this.expression=r,this._warningHistory={},this._evaluator=new rd,this._defaultValue=a?"color"===(c=a).type&&lh(c.default)?new dn(0,0,0,0):"color"===c.type?dn.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,c,h,f,_,x,C){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,c,h,f,_,x,C){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ti(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,"undefined"!=typeof console&&console.warn(T.message)),this._defaultValue}}}function yl(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in Ko}function Mo(i,r){const a=new kr(Ko,[],r?function(h){const f={color:Ho,string:on,number:lt,enum:on,boolean:Qt,formatted:ba,resolvedImage:Yc};return"array"===h.type?wo(f[h.value]||kt,h.length):f[h.type]}(r):void 0),c=a.parse(i,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?Np(new bs(c,r)):qs(a.errors)}class vl{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!dl(a.expression)}evaluateWithoutErrorHandling(r,a,c,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,f,_)}evaluate(r,a,c,h,f,_){return this._styleExpression.evaluate(r,a,c,h,f,_)}}class uh{constructor(r,a,c,h){this.kind=r,this.zoomStops=c,this._styleExpression=a,this.isStateDependent="camera"!==r&&!dl(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,c,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,f,_)}evaluate(r,a,c,h,f,_){return this._styleExpression.evaluate(r,a,c,h,f,_)}interpolationFactor(r,a,c){return this.interpolationType?ni.interpolationFactor(this.interpolationType,r,a,c):0}}function ud(i,r){if("error"===(i=Mo(i,r)).result)return i;const a=i.value.expression,c=hl(a);if(!c&&!cc(r))return qs([new ds("","data expressions not supported")]);const h=Mr(a,["zoom","pitch","distance-from-center"]);if(!h&&!Up(r))return qs([new ds("","zoom expressions not supported")]);const f=uc(a);return f||h?f instanceof ds?qs([f]):f instanceof ni&&!cd(r)?qs([new ds("",'"interpolate" expressions cannot be used with this property')]):Np(f?new uh(c?"camera":"composite",i.value,f.labels,f instanceof ni?f.interpolation:void 0):new vl(c?"constant":"source",i.value)):qs([new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ma{constructor(r,a){this._parameters=r,this._specification=a,$s(this,ou(this._parameters,this._specification))}static deserialize(r){return new Ma(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function uc(i){let r=null;if(i instanceof xs)r=uc(i.result);else if(i instanceof vs){for(const a of i.args)if(r=uc(a),r)break}else(i instanceof ai||i instanceof ni)&&i.input instanceof ro&&"zoom"===i.input.name&&(r=i);return r instanceof ds||i.eachChild(a=>{const c=uc(a);c instanceof ds?r=c:!r&&c?r=new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function so(i){const r=i.key,a=i.value,c=i.valueSpec||{},h=i.objectElementValidators||{},f=i.style,_=i.styleSpec;let x=[];const C=Tn(a);if("object"!==C)return[new nt(r,a,`object expected, ${C} found`)];for(const T in a){const I=T.split(".")[0],S=c[I]||c["*"];let P;if(h[I])P=h[I];else if(c[I])P=Wr;else if(h["*"])P=h["*"];else{if(!c["*"]){x.push(new nt(r,a[T],`unknown property "${T}"`));continue}P=Wr}x=x.concat(P({key:(r&&`${r}.`)+T,value:a[T],valueSpec:S,style:f,styleSpec:_,object:a,objectKey:T},a))}for(const T in c)h[T]||c[T].required&&void 0===c[T].default&&void 0===a[T]&&x.push(new nt(r,a,`missing required property "${T}"`));return x}function hc(i){const r=i.value,a=i.valueSpec,c=i.style,h=i.styleSpec,f=i.key,_=i.arrayElementValidator||Wr;if("array"!==Tn(r))return[new nt(f,r,`array expected, ${Tn(r)} found`)];if(a.length&&r.length!==a.length)return[new nt(f,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new nt(f,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum};h.$version<7&&(x.function=a.function),"object"===Tn(a.value)&&(x=a.value);let C=[];for(let T=0;T<r.length;T++)C=C.concat(_({array:r,arrayIndex:T,value:r[T],valueSpec:x,style:c,styleSpec:h,key:`${f}[${T}]`}));return C}function hd(i){const r=i.key,a=i.value,c=i.valueSpec;let h=Tn(a);if("number"===h&&a!=a&&(h="NaN"),"number"!==h)return[new nt(r,a,`number expected, ${h} found`)];if("minimum"in c){let f=c.minimum;if("array"===Tn(c.minimum)&&(f=c.minimum[i.arrayIndex]),a<f)return[new nt(r,a,`${a} is less than the minimum value ${f}`)]}if("maximum"in c){let f=c.maximum;if("array"===Tn(c.maximum)&&(f=c.maximum[i.arrayIndex]),a>f)return[new nt(r,a,`${a} is greater than the maximum value ${f}`)]}return[]}function Ci(i){const r=i.valueSpec,a=xr(i.value.type);let c,h,f,_={};const x="categorical"!==a&&void 0===i.value.property,C=!x,T="array"===Tn(i.value.stops)&&"array"===Tn(i.value.stops[0])&&"object"===Tn(i.value.stops[0][0]),I=so({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if("identity"===a)return[new nt(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const H=z.value;return N=N.concat(hc({key:z.key,value:H,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:S})),"array"===Tn(H)&&0===H.length&&N.push(new nt(z.key,H,"array must have at least one stop")),N},default:function(z){return Wr({key:z.key,value:z.value,valueSpec:r,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===a&&x&&I.push(new nt(i.key,i.value,'missing required property "property"')),"identity"===a||i.value.stops||I.push(new nt(i.key,i.value,'missing required property "stops"')),"exponential"===a&&i.valueSpec.expression&&!cd(i.valueSpec)&&I.push(new nt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!cc(i.valueSpec)?I.push(new nt(i.key,i.value,"property functions not supported")):x&&!Up(i.valueSpec)&&I.push(new nt(i.key,i.value,"zoom functions not supported"))),"categorical"!==a&&!T||void 0!==i.value.property||I.push(new nt(i.key,i.value,'"property" property is required')),I;function S(z){let N=[];const H=z.value,X=z.key;if("array"!==Tn(H))return[new nt(X,H,`array expected, ${Tn(H)} found`)];if(2!==H.length)return[new nt(X,H,`array length 2 expected, length ${H.length} found`)];if(T){if("object"!==Tn(H[0]))return[new nt(X,H,`object expected, ${Tn(H[0])} found`)];if(void 0===H[0].zoom)return[new nt(X,H,"object stop key must have zoom")];if(void 0===H[0].value)return[new nt(X,H,"object stop key must have value")];if(f&&f>xr(H[0].zoom))return[new nt(X,H[0].zoom,"stop zoom values must appear in ascending order")];xr(H[0].zoom)!==f&&(f=xr(H[0].zoom),h=void 0,_={}),N=N.concat(so({key:`${X}[0]`,value:H[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:hd,value:P}}))}else N=N.concat(P({key:`${X}[0]`,value:H[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},H));return yl(ei(H[1]))?N.concat([new nt(`${X}[1]`,H[1],"expressions are not allowed in function stops.")]):N.concat(Wr({key:`${X}[1]`,value:H[1],valueSpec:r,style:z.style,styleSpec:z.styleSpec}))}function P(z,N){const H=Tn(z.value),X=xr(z.value),ne=null!==z.value?z.value:N;if(c){if(H!==c)return[new nt(z.key,ne,`${H} stop domain type must match previous stop domain type ${c}`)]}else c=H;if("number"!==H&&"string"!==H&&"boolean"!==H)return[new nt(z.key,ne,"stop domain value must be a number, string, or boolean")];if("number"!==H&&"categorical"!==a){let ce=`number expected, ${H} found`;return cc(r)&&void 0===a&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(z.key,ne,ce)]}return"categorical"!==a||"number"!==H||isFinite(X)&&Math.floor(X)===X?"categorical"!==a&&"number"===H&&void 0!==h&&X<h?[new nt(z.key,ne,"stop domain values must appear in ascending order")]:(h=X,"categorical"===a&&X in _?[new nt(z.key,ne,"stop domain values must be unique")]:(_[X]=!0,[])):[new nt(z.key,ne,`integer expected, found ${X}`)]}}function Io(i){const r=("property"===i.expressionContext?ud:Mo)(ei(i.value),i.valueSpec);if("error"===r.result)return r.value.map(c=>new nt(`${i.key}${c.key}`,i.value,c.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!a.outputDefined())return[new nt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!dl(a))return[new nt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return hh(a,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Mr(a,["zoom","feature-state"]))return[new nt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!hl(a))return[new nt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hh(i,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of r.valueSpec.expression.parameters)a.delete(h);if(0===a.size)return[];const c=[];return i instanceof ro&&a.has(i.name)?[new nt(r.key,r.value,`["${i.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(i.eachChild(h=>{c.push(...hh(h,r))}),c)}function xl(i){const r=i.key,a=i.value,c=i.valueSpec,h=[];return Array.isArray(c.values)?-1===c.values.indexOf(xr(a))&&h.push(new nt(r,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(c.values).indexOf(xr(a))&&h.push(new nt(r,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function su(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!su(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function au(i,r="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};su(i)||(i=cu(i));const a=i;let c=!0;try{c=function(T){if(!Zs(T))return T;let I=ei(T);return dd(I),I=bl(I),I}(a)}catch(T){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=Se[`filter_${r}`],f=Mo(c,h);let _=null;if("error"===f.result)throw new Error(f.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,I,S)=>f.value.evaluate(T,I,{},S);let x=null,C=null;if(c!==a){const T=Mo(a,h);if("error"===T.result)throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,S,P,z,N)=>T.value.evaluate(I,S,{},P,void 0,void 0,z,N),C=!hl(T.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:lu(c),needFeature:!!C}}function bl(i){if(!Array.isArray(i))return i;const r=function(a){if(Xm.has(a[0]))for(let c=1;c<a.length;c++)if(Zs(a[c]))return!0;return a}(i);return!0===r?r:r.map(a=>bl(a))}function dd(i){let r=!1;const a=[];if("case"===i[0]){for(let c=1;c<i.length-1;c+=2)r=r||Zs(i[c]),a.push(i[c+1]);a.push(i[i.length-1])}else if("match"===i[0]){r=r||Zs(i[1]);for(let c=2;c<i.length-1;c+=2)a.push(i[c+1]);a.push(i[i.length-1])}else if("step"===i[0]){r=r||Zs(i[1]);for(let c=1;c<i.length-1;c+=2)a.push(i[c+1])}r&&(i.length=0,i.push("any",...a));for(let c=1;c<i.length;c++)dd(i[c])}function Zs(i){if(!Array.isArray(i))return!1;if("pitch"===(r=i[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<i.length;a++)if(Zs(i[a]))return!0;return!1}const Xm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dr(i,r){return i<r?-1:i>r?1:0}function lu(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let r=1;r<i.length;r++)if(lu(i[r]))return!0;return!1}function cu(i){if(!i)return!0;const r=i[0];return i.length<=1?"any"!==r:"=="===r?pr(i[1],i[2],"=="):"!="===r?Ia(pr(i[1],i[2],"==")):"<"===r||">"===r||"<="===r||">="===r?pr(i[1],i[2],r):"any"===r?(a=i.slice(1),["any"].concat(a.map(cu))):"all"===r?["all"].concat(i.slice(1).map(cu)):"none"===r?["all"].concat(i.slice(1).map(cu).map(Ia)):"in"===r?pd(i[1],i.slice(2)):"!in"===r?Ia(pd(i[1],i.slice(2))):"has"===r?Vp(i[1]):"!has"===r?Ia(Vp(i[1])):"within"!==r||i;var a}function pr(i,r,a){switch(i){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,i,r]}}function pd(i,r){if(0===r.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",i,["literal",r.sort(dr)]]:["filter-in-small",i,["literal",r]]}}function Vp(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ia(i){return["!",i]}function Li(i){if(su(ei(i.value))){const r=ei(i.layerType);return Io($s({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${r||"fill"}`]}))}return fd(i)}function fd(i){const r=i.value,a=i.key;if("array"!==Tn(r))return[new nt(a,r,`array expected, ${Tn(r)} found`)];const c=i.styleSpec;let h,f=[];if(r.length<1)return[new nt(a,r,"filter array must have at least 1 element")];switch(f=f.concat(xl({key:`${a}[0]`,value:r[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),xr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===xr(r[1])&&f.push(new nt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&f.push(new nt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=Tn(r[1]),"string"!==h&&f.push(new nt(`${a}[1]`,r[1],`string expected, ${h} found`)));for(let _=2;_<r.length;_++)h=Tn(r[_]),"$type"===xr(r[1])?f=f.concat(xl({key:`${a}[${_}]`,value:r[_],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new nt(`${a}[${_}]`,r[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)f=f.concat(fd({key:`${a}[${_}]`,value:r[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Tn(r[1]),2!==r.length?f.push(new nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new nt(`${a}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=Tn(r[1]),2!==r.length?f.push(new nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new nt(`${a}[1]`,r[1],`object expected, ${h} found`))}return f}function Sa(i,r){const a=i.key,c=i.style,h=i.styleSpec,f=i.value,_=i.objectKey,x=h[`${r}_${i.layerType}`];if(!x)return[];const C=_.match(/^(.*)-transition$/);if("paint"===r&&C&&x[C[1]]&&x[C[1]].transition)return Wr({key:a,value:f,valueSpec:h.transition,style:c,styleSpec:h});const T=i.valueSpec||x[_];if(!T)return[new nt(a,f,`unknown property "${_}"`)];let I;if("string"===Tn(f)&&cc(T)&&!T.tokens&&(I=/^{([^}]+)}$/.exec(f)))return[new nt(a,f,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const S=[];return"symbol"===i.layerType&&("text-field"===_&&c&&!c.glyphs&&S.push(new nt(a,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&lh(ei(f))&&"identity"===xr(f.type)&&S.push(new nt(a,f,'"text-font" does not support identity functions'))),S.concat(Wr({key:i.key,value:f,valueSpec:T,style:c,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:_}))}function Aa(i){return Sa(i,"paint")}function Oi(i){return Sa(i,"layout")}function wl(i){let r=[];const a=i.value,c=i.key,h=i.style,f=i.styleSpec;a.type||a.ref||r.push(new nt(c,a,'either "type" or "ref" is required'));let _=xr(a.type);const x=xr(a.ref);if(a.id){const C=xr(a.id);for(let T=0;T<i.arrayIndex;T++){const I=h.layers[T];xr(I.id)===C&&r.push(new nt(c,a.id,`duplicate layer id "${a.id}", previously used at line ${I.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(T=>{T in a&&r.push(new nt(c,a[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{xr(T.id)===x&&(C=T)}),C?C.ref?r.push(new nt(c,a.ref,"ref cannot reference another ref layer")):_=xr(C.type):r.push(new nt(c,a.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(a.source){const C=h.sources&&h.sources[a.source],T=C&&xr(C.type);C?"vector"===T&&"raster"===_?r.push(new nt(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===T&&"raster"!==_?r.push(new nt(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==T||a["source-layer"]?"raster-dem"===T&&"hillshade"!==_?r.push(new nt(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!a.paint||!a.paint["line-gradient"]||"geojson"===T&&C.lineMetrics||r.push(new nt(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new nt(c,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new nt(c,a.source,`source "${a.source}" not found`))}else r.push(new nt(c,a,'missing required property "source"'));return r=r.concat(so({key:c,value:a,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wr({key:`${c}.type`,value:a.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,object:a,objectKey:"type"}),filter:C=>Li($s({layerType:_},C)),layout:C=>so({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":T=>Oi($s({layerType:_},T))}}),paint:C=>so({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":T=>Aa($s({layerType:_},T))}})}})),r}function Ws(i){const r=i.value,a=i.key,c=Tn(r);return"string"!==c?[new nt(a,r,`string expected, ${c} found`)]:[]}const dh={promoteId:function({key:i,value:r}){if("string"===Tn(r))return Ws({key:i,value:r});{const a=[];for(const c in r)a.push(...Ws({key:`${i}.${c}`,value:r[c]}));return a}}};function ws(i){const r=i.value,a=i.key,c=i.styleSpec,h=i.style;if(!r.type)return[new nt(a,r,'"type" is required')];const f=xr(r.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=so({key:a,value:r,valueSpec:c[`source_${f.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:dh}),_;case"geojson":if(_=so({key:a,value:r,valueSpec:c.source_geojson,style:h,styleSpec:c,objectElementValidators:dh}),r.cluster)for(const x in r.clusterProperties){const[C,T]=r.clusterProperties[x],I="string"==typeof C?[C,["accumulated"],["get",x]]:C;_.push(...Io({key:`${a}.${x}.map`,value:T,expressionContext:"cluster-map"})),_.push(...Io({key:`${a}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return so({key:a,value:r,valueSpec:c.source_video,style:h,styleSpec:c});case"image":return so({key:a,value:r,valueSpec:c.source_image,style:h,styleSpec:c});case"canvas":return[new nt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xl({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:c})}}function uu(i){const r=i.value,a=i.styleSpec,c=a.light,h=i.style;let f=[];const _=Tn(r);if(void 0===r)return f;if("object"!==_)return f=f.concat([new nt("light",r,`object expected, ${_} found`)]),f;for(const x in r){const C=x.match(/^(.*)-transition$/);f=f.concat(C&&c[C[1]]&&c[C[1]].transition?Wr({key:x,value:r[x],valueSpec:a.transition,style:h,styleSpec:a}):c[x]?Wr({key:x,value:r[x],valueSpec:c[x],style:h,styleSpec:a}):[new nt(x,r[x],`unknown property "${x}"`)])}return f}function dc(i){const r=i.value,a=i.key,c=i.style,h=i.styleSpec,f=h.terrain;let _=[];const x=Tn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new nt("terrain",r,`object expected, ${x} found`)]),_;for(const C in r){const T=C.match(/^(.*)-transition$/);_=_.concat(T&&f[T[1]]&&f[T[1]].transition?Wr({key:C,value:r[C],valueSpec:h.transition,style:c,styleSpec:h}):f[C]?Wr({key:C,value:r[C],valueSpec:f[C],style:c,styleSpec:h}):[new nt(C,r[C],`unknown property "${C}"`)])}if(r.source){const C=c.sources&&c.sources[r.source],T=C&&xr(C.type);C?"raster-dem"!==T&&_.push(new nt(a,r.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):_.push(new nt(a,r.source,`source "${r.source}" not found`))}else _.push(new nt(a,r,'terrain is missing required property "source"'));return _}function zt(i){const r=i.value,a=i.style,c=i.styleSpec,h=c.fog;let f=[];const _=Tn(r);if(void 0===r)return f;if("object"!==_)return f=f.concat([new nt("fog",r,`object expected, ${_} found`)]),f;for(const x in r){const C=x.match(/^(.*)-transition$/);f=f.concat(C&&h[C[1]]&&h[C[1]].transition?Wr({key:x,value:r[x],valueSpec:c.transition,style:a,styleSpec:c}):h[x]?Wr({key:x,value:r[x],valueSpec:h[x],style:a,styleSpec:c}):[new nt(x,r[x],`unknown property "${x}"`)])}return f}const md={"*":()=>[],array:hc,boolean:function(i){const r=i.value,a=i.key,c=Tn(r);return"boolean"!==c?[new nt(a,r,`boolean expected, ${c} found`)]:[]},number:hd,color:function(i){const r=i.key,a=i.value,c=Tn(a);return"string"!==c?[new nt(r,a,`color expected, ${c} found`)]:null===al.parseCSSColor(a)?[new nt(r,a,`color expected, "${a}" found`)]:[]},constants:Fp,enum:xl,filter:Li,function:Ci,layer:wl,object:so,source:ws,light:uu,terrain:dc,fog:zt,string:Ws,formatted:function(i){return 0===Ws(i).length?[]:Io(i)},resolvedImage:function(i){return 0===Ws(i).length?[]:Io(i)},projection:function(i){const r=i.value,a=i.styleSpec,c=a.projection,h=i.style;let f=[];const _=Tn(r);if("object"===_)for(const x in r)f=f.concat(Wr({key:x,value:r[x],valueSpec:c[x],style:h,styleSpec:a}));else"string"!==_&&(f=f.concat([new nt("projection",r,`object or string expected, ${_} found`)]));return f}};function Wr(i){const r=i.value,a=i.valueSpec,c=i.styleSpec;return a.expression&&lh(xr(r))?Ci(i):a.expression&&yl(ei(r))?Io(i):a.type&&md[a.type]?md[a.type](i):so($s({},i,{valueSpec:a.type?c[a.type]:a}))}function ph(i){const r=i.value,a=i.key,c=Ws(i);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new nt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new nt(a,r,'"glyphs" url must include a "{range}" token'))),c}function Cs(i,r=Se){let a=[];return a=a.concat(Wr({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:ph,"*":()=>[]}})),i.constants&&(a=a.concat(Fp({key:"constants",value:i.constants,style:i,styleSpec:r}))),fh(a)}function fh(i){return[].concat(i).sort((r,a)=>r.line-a.line)}function So(i){return function(...r){return fh(i.apply(this,r))}}Cs.source=So(ws),Cs.light=So(uu),Cs.terrain=So(dc),Cs.fog=So(zt),Cs.layer=So(wl),Cs.filter=So(Li),Cs.paintProperty=So(Aa),Cs.layoutProperty=So(Oi);const Cl=Cs,We=Cl.light,xn=Cl.fog,El=Cl.paintProperty,Or=Cl.layoutProperty;function mh(i,r){let a=!1;if(r&&r.length)for(const c of r)i.fire(new nh(new Error(c.message))),a=!0;return a}var Es=er;function er(i,r,a){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(r=h[1])+2*(a=h[2]);for(var f=0;f<this.d*this.d;f++){var _=h[3+f],x=h[3+f+1];c.push(_===x?null:h.subarray(_,x))}var C=h[3+c.length+1];this.keys=h.subarray(h[3+c.length],C),this.bboxes=h.subarray(C),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var T=0;T<this.d*this.d;T++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=a,this.scale=r/i,this.uid=0;var I=a/r*i;this.min=-I,this.max=i+I}er.prototype.insert=function(i,r,a,c,h){this._forEachCell(r,a,c,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(h)},er.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},er.prototype._insertCell=function(i,r,a,c,h,f){this.cells[h].push(f)},er.prototype.query=function(i,r,a,c,h){var f=this.min,_=this.max;if(i<=f&&r<=f&&_<=a&&_<=c&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,r,a,c,this._queryCell,x,{},h),x},er.prototype._queryCell=function(i,r,a,c,h,f,_,x){var C=this.cells[h];if(null!==C)for(var T=this.keys,I=this.bboxes,S=0;S<C.length;S++){var P=C[S];if(void 0===_[P]){var z=4*P;(x?x(I[z+0],I[z+1],I[z+2],I[z+3]):i<=I[z+2]&&r<=I[z+3]&&a>=I[z+0]&&c>=I[z+1])?(_[P]=!0,f.push(T[P])):_[P]=!1}}},er.prototype._forEachCell=function(i,r,a,c,h,f,_,x){for(var C=this._convertToCellCoord(i),T=this._convertToCellCoord(r),I=this._convertToCellCoord(a),S=this._convertToCellCoord(c),P=C;P<=I;P++)for(var z=T;z<=S;z++){var N=this.d*z+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(z),this._convertFromCellCoord(P+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,r,a,c,N,f,_,x))return}},er.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},er.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},er.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=r,_=0;_<i.length;_++){var x=i[_];h[3+_]=f,h.set(x,f),f+=x.length}return h[3+i.length]=f,h.set(this.keys,f),h[3+i.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const{ImageData:Pa,ImageBitmap:Xs}=Be,hu={};function ut(i,r,a={}){Object.defineProperty(r,"_classRegistryKey",{value:i,writeable:!1}),hu[i]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}ut("Object",Object),Es.serialize=function(i,r){const a=i.toArrayBuffer();return r&&r.push(a),{buffer:a}},Es.deserialize=function(i){return new Es(i.buffer)},ut("Grid",Es),ut("Color",dn),ut("Error",Error),ut("ResolvedImage",to),ut("StylePropertyFunction",Ma),ut("StyleExpression",bs,{omit:["_evaluator"]}),ut("ZoomDependentExpression",uh),ut("ZoomConstantExpression",vl),ut("CompoundExpression",ro,{omit:["_evaluate"]});for(const i in Ko)Ko[i]._classRegistryKey||ut(`Expression_${i}`,Ko[i]);function Ts(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function pc(i){return Xs&&i instanceof Xs}function Fr(i,r){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ts(i)||pc(i))return r&&r.push(i),i;if(ArrayBuffer.isView(i)){const a=i;return r&&r.push(a.buffer),a}if(i instanceof Pa)return r&&r.push(i.data.buffer),i;if(Array.isArray(i)){const a=[];for(const c of i)a.push(Fr(c,r));return a}if("object"==typeof i){const a=i.constructor,c=a._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");const h=a.serialize?a.serialize(i,r):{};if(!a.serialize){for(const f in i){if(!i.hasOwnProperty(f)||hu[c].omit.indexOf(f)>=0)continue;const _=i[f];h[f]=hu[c].shallow.indexOf(f)>=0?_:Fr(_,r)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof i)}function hi(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ts(i)||pc(i)||ArrayBuffer.isView(i)||i instanceof Pa)return i;if(Array.isArray(i))return i.map(hi);if("object"==typeof i){const r=i.$name||"Object",{klass:a}=hu[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(i);const c=Object.create(a.prototype);for(const h of Object.keys(i)){if("$name"===h)continue;const f=i[h];c[h]=hu[r].shallow.indexOf(h)>=0?f:hi(f)}return c}throw new Error("can't deserialize object of type "+typeof i)}class m{constructor(){this.first=!0}update(r,a){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const o=i=>i>=1536&&i<=1791,u=i=>i>=1872&&i<=1919,g=i=>i>=2208&&i<=2303,v=i=>i>=11904&&i<=12031,b=i=>i>=12032&&i<=12255,E=i=>i>=12272&&i<=12287,M=i=>i>=12288&&i<=12351,k=i=>i>=12352&&i<=12447,R=i=>i>=12448&&i<=12543,L=i=>i>=12544&&i<=12591,B=i=>i>=12704&&i<=12735,G=i=>i>=12736&&i<=12783,K=i=>i>=12784&&i<=12799,Z=i=>i>=12800&&i<=13055,Y=i=>i>=13056&&i<=13311,he=i=>i>=13312&&i<=19903,W=i=>i>=19968&&i<=40959,ae=i=>i>=40960&&i<=42127,le=i=>i>=42128&&i<=42191,se=i=>i>=44032&&i<=55215,ie=i=>i>=63744&&i<=64255,ue=i=>i>=64336&&i<=65023,ye=i=>i>=65040&&i<=65055,Ie=i=>i>=65072&&i<=65103,Qe=i=>i>=65104&&i<=65135,Ge=i=>i>=65136&&i<=65279,$e=i=>i>=65280&&i<=65519;function Ae(i){for(const r of i)if(Oe(r.charCodeAt(0)))return!0;return!1}function Me(i){for(const r of i)if(!Ve(r.charCodeAt(0)))return!1;return!0}function Ve(i){return!(o(i)||u(i)||g(i)||ue(i)||Ge(i))}function Oe(i){return!(746!==i&&747!==i&&(i<4352||!(B(i)||L(i)||Ie(i)&&!(i>=65097&&i<=65103)||ie(i)||Y(i)||v(i)||G(i)||!(!M(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||he(i)||W(i)||Z(i)||(r=i,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(i)||(r=>r>=55216&&r<=55295)(i)||(r=>r>=4352&&r<=4607)(i)||se(i)||k(i)||E(i)||(r=>r>=12688&&r<=12703)(i)||b(i)||K(i)||R(i)&&12540!==i||!(!$e(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!Qe(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(r=>r>=5120&&r<=5759)(i)||(r=>r>=6320&&r<=6399)(i)||ye(i)||(r=>r>=19904&&r<=19967)(i)||ae(i)||le(i))));var r}function mt(i){return!(Oe(i)||(r=i,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||M(r)||R(r)||(a=>a>=57344&&a<=63743)(r)||Ie(r)||Qe(r)||$e(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function Dt(i){return i>=1424&&i<=2303||ue(i)||Ge(i)}function Gt(i,r){return!(!r&&Dt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(a=i,a>=6016&&a<=6143));var a}function Ye(i){for(const r of i)if(Dt(r.charCodeAt(0)))return!0;return!1}const _t="deferred",Rt="loading",In="loaded";let Nn=null,At="unavailable",qt=null;const Jn=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(At="error"),Nn&&Nn(i)};function Ir(){Vi.fire(new Vs("pluginStateChange",{pluginStatus:At,pluginURL:qt}))}const Vi=new va,Ao=function(){return At},Fi=function(){if(At!==_t||!qt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");At=Rt,Ir(),qt&&_a({url:qt},i=>{i?Jn(i):(At=In,Ir())})},cn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>At===In||null!=cn.applyArabicShaping,isLoading:()=>At===Rt,setState(i){At=i.pluginStatus,qt=i.pluginURL},isParsed:()=>null!=cn.applyArabicShaping&&null!=cn.processBidirectionalText&&null!=cn.processStyledBidirectionalText,getPluginURL:()=>qt};class Ot{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new m,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,c){for(const h of a)if(!Gt(h.charCodeAt(0),c))return!1;return!0}(r,cn.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*a}}}class Kt{constructor(r,a){this.property=r,this.value=a,this.expression=function(c,h){if(lh(c))return new Ma(c,h);if(yl(c)){const f=ud(c,h);if("error"===f.result)throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=c;return"string"==typeof c&&"color"===h.type&&(f=dn.parse(c)),{kind:"constant",evaluate:()=>f}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,c){return this.property.possiblyEvaluate(this,r,a,c)}}class tr{constructor(r){this.property=r,this.value=new Kt(r,void 0)}transitioned(r,a){return new Sn(this.property,this.value,a,ur({},r.transition,this.transition),r.now)}untransitioned(){return new Sn(this.property,this.value,null,{},0)}}class zi{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return yo(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new tr(this._values[r].property)),this._values[r].value=new Kt(this._values[r].property,null===a?void 0:yo(a))}getTransition(r){return yo(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new tr(this._values[r].property)),this._values[r].transition=yo(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c);const h=this.getTransition(a);void 0!==h&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const c=new $i(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(r,a._values[h]);return c}untransitioned(){const r=new $i(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class Sn{constructor(r,a,c,h,f){const _=h.delay||0,x=h.duration||0;f=f||0,this.property=r,this.value=a,this.begin=f+_,this.end=this.begin+x,r.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(r,a,c){const h=r.now||0,f=this.value.possiblyEvaluate(r,a,c),_=this.prior;if(_){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return _.possiblyEvaluate(r,a,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,a,c),f,Gc(x))}}return f}}class $i{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,c){const h=new Jo(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(r,a,c);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Yo{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return yo(this._values[r].value)}setValue(r,a){this._values[r]=new Kt(this._values[r].property,null===a?void 0:yo(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c)}return r}possiblyEvaluate(r,a,c){const h=new Jo(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(r,a,c);return h}}class di{constructor(r,a,c){this.property=r,this.value=a,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,c,h){return this.property.evaluate(this.value,this.parameters,r,a,c,h)}}class Jo{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ft{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,c){const h=pl[this.specification.type];return h?h(r,a,c):r}}class Ct{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,c,h){return new di(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},c,h)}:r.expression,a)}interpolate(r,a,c){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new di(this,{kind:"constant",value:void 0},r.parameters);const h=pl[this.specification.type];return h?new di(this,{kind:"constant",value:h(r.value.value,a.value.value,c)},r.parameters):r}evaluate(r,a,c,h,f,_){return"constant"===r.kind?r.value:r.evaluate(a,c,h,f,_)}}class zr extends Ct{possiblyEvaluate(r,a,c,h){if(void 0===r.value)return new di(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const f=r.expression.evaluate(a,null,{},c,h),_="resolvedImage"===r.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(_,_,_,a);return new di(this,{kind:"constant",value:x},a)}if("camera"===r.expression.kind){const f=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new di(this,{kind:"constant",value:f},a)}return new di(this,r.expression,a)}evaluate(r,a,c,h,f,_){if("source"===r.kind){const x=r.evaluate(a,c,h,f,_);return this._calculate(x,x,x,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},c,h),r.evaluate({zoom:Math.floor(a.zoom)},c,h),r.evaluate({zoom:Math.floor(a.zoom)+1},c,h),a):r.value}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a,other:c}:{from:c,to:a,other:r}}interpolate(r){return r}}class ka{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){if(void 0!==r.value){if("constant"===r.expression.kind){const f=r.expression.evaluate(a,null,{},c,h);return this._calculate(f,f,f,a)}return this._calculate(r.expression.evaluate(new Ot(Math.floor(a.zoom-1),a)),r.expression.evaluate(new Ot(Math.floor(a.zoom),a)),r.expression.evaluate(new Ot(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:c,to:a}}interpolate(r){return r}}class Ks{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){return!!r.expression.evaluate(a,null,{},c,h)}interpolate(){return!1}}class Cr{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const c=r[a];c.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new Kt(c,void 0),f=this.defaultTransitionablePropertyValues[a]=new tr(c);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}}}function gd(i,r){return 256*(i=Ln(Math.floor(i),0,255))+Ln(Math.floor(r),0,255)}ut("DataDrivenProperty",Ct),ut("DataConstantProperty",ft),ut("CrossFadedDataDrivenProperty",zr),ut("CrossFadedProperty",ka),ut("ColorRampProperty",Ks);const $p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Tl{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rr(i,r=1){let a=0,c=0;return{members:i.map(h=>{const f=$p[h.type].BYTES_PER_ELEMENT,_=a=Gp(a,Math.max(r,f)),x=h.components||1;return c=Math.max(c,f),a+=f*x,{name:h.name,type:h.type,components:x,offset:_}}),size:Gp(a,Math.max(c,r)),alignment:r}}function Gp(i,r){return Math.ceil(i/r)*r}class fc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=c,r}}fc.prototype.bytesPerElement=4,ut("StructArrayLayout2i4",fc);class mc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=c,this.int16[_+2]=h,this.int16[_+3]=f,r}}mc.prototype.bytesPerElement=8,ut("StructArrayLayout4i8",mc);class _d extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,C){const T=6*r,I=12*r,S=3*r;return this.int16[T+0]=a,this.int16[T+1]=c,this.uint8[I+4]=h,this.uint8[I+5]=f,this.uint8[I+6]=_,this.uint8[I+7]=x,this.float32[S+2]=C,r}}_d.prototype.bytesPerElement=12,ut("StructArrayLayout2i4ub1f12",_d);class du extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.float32[f+0]=a,this.float32[f+1]=c,this.float32[f+2]=h,r}}du.prototype.bytesPerElement=12,ut("StructArrayLayout3f12",du);class Dl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C,T,I){const S=this.length;return this.resize(S+1),this.emplace(S,r,a,c,h,f,_,x,C,T,I)}emplace(r,a,c,h,f,_,x,C,T,I,S){const P=10*r;return this.uint16[P+0]=a,this.uint16[P+1]=c,this.uint16[P+2]=h,this.uint16[P+3]=f,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=C,this.uint16[P+7]=T,this.uint16[P+8]=I,this.uint16[P+9]=S,r}}Dl.prototype.bytesPerElement=20,ut("StructArrayLayout10ui20",Dl);class gc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,c,h,f,_,x,C)}emplace(r,a,c,h,f,_,x,C,T){const I=8*r;return this.uint16[I+0]=a,this.uint16[I+1]=c,this.uint16[I+2]=h,this.uint16[I+3]=f,this.uint16[I+4]=_,this.uint16[I+5]=x,this.uint16[I+6]=C,this.uint16[I+7]=T,r}}gc.prototype.bytesPerElement=16,ut("StructArrayLayout8ui16",gc);class _c extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X){const ne=this.length;return this.resize(ne+1),this.emplace(ne,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X)}emplace(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne){const ce=16*r;return this.int16[ce+0]=a,this.int16[ce+1]=c,this.int16[ce+2]=h,this.int16[ce+3]=f,this.uint16[ce+4]=_,this.uint16[ce+5]=x,this.uint16[ce+6]=C,this.uint16[ce+7]=T,this.int16[ce+8]=I,this.int16[ce+9]=S,this.int16[ce+10]=P,this.int16[ce+11]=z,this.int16[ce+12]=N,this.int16[ce+13]=H,this.int16[ce+14]=X,this.int16[ce+15]=ne,r}}_c.prototype.bytesPerElement=32,ut("StructArrayLayout4i4ui4i4i32",_c);class Hp extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Hp.prototype.bytesPerElement=4,ut("StructArrayLayout1ul4",Hp);class yd extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C,T,I,S,P,z){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,c,h,f,_,x,C,T,I,S,P,z)}emplace(r,a,c,h,f,_,x,C,T,I,S,P,z,N){const H=20*r,X=10*r;return this.int16[H+0]=a,this.int16[H+1]=c,this.int16[H+2]=h,this.int16[H+3]=f,this.int16[H+4]=_,this.float32[X+3]=x,this.float32[X+4]=C,this.float32[X+5]=T,this.float32[X+6]=I,this.int16[H+14]=S,this.uint32[X+8]=P,this.uint16[H+18]=z,this.uint16[H+19]=N,r}}yd.prototype.bytesPerElement=40,ut("StructArrayLayout5i4f1i1ul2ui40",yd);class gh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,C){const T=8*r;return this.int16[T+0]=a,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+4]=f,this.int16[T+5]=_,this.int16[T+6]=x,this.int16[T+7]=C,r}}gh.prototype.bytesPerElement=16,ut("StructArrayLayout3i2i2i16",gh);class Ml extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,h,f)}emplace(r,a,c,h,f,_){const x=4*r,C=8*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[C+6]=f,this.int16[C+7]=_,r}}Ml.prototype.bytesPerElement=16,ut("StructArrayLayout2f1f2i16",Ml);class qp extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=12*r,x=3*r;return this.uint8[_+0]=a,this.uint8[_+1]=c,this.float32[x+1]=h,this.float32[x+2]=f,r}}qp.prototype.bytesPerElement=12,ut("StructArrayLayout2ub2f12",qp);class Gi extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.uint16[f+0]=a,this.uint16[f+1]=c,this.uint16[f+2]=h,r}}Gi.prototype.bytesPerElement=6,ut("StructArrayLayout3ui6",Gi);class yc extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be){const we=this.length;return this.resize(we+1),this.emplace(we,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be)}emplace(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be,we){const Fe=30*r,Pe=15*r,tt=60*r;return this.int16[Fe+0]=a,this.int16[Fe+1]=c,this.int16[Fe+2]=h,this.float32[Pe+2]=f,this.float32[Pe+3]=_,this.uint16[Fe+8]=x,this.uint16[Fe+9]=C,this.uint32[Pe+5]=T,this.uint32[Pe+6]=I,this.uint32[Pe+7]=S,this.uint16[Fe+16]=P,this.uint16[Fe+17]=z,this.uint16[Fe+18]=N,this.float32[Pe+10]=H,this.float32[Pe+11]=X,this.uint8[tt+48]=ne,this.uint8[tt+49]=ce,this.uint8[tt+50]=pe,this.uint32[Pe+13]=_e,this.int16[Fe+28]=be,this.uint8[tt+58]=we,r}}yc.prototype.bytesPerElement=60,ut("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",yc);class Il extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be,we,Fe,Pe,tt,qe,Le,Ke,ot,Ue){const ct=this.length;return this.resize(ct+1),this.emplace(ct,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be,we,Fe,Pe,tt,qe,Le,Ke,ot,Ue)}emplace(r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X,ne,ce,pe,_e,be,we,Fe,Pe,tt,qe,Le,Ke,ot,Ue,ct){const dt=38*r,un=19*r;return this.int16[dt+0]=a,this.int16[dt+1]=c,this.int16[dt+2]=h,this.float32[un+2]=f,this.float32[un+3]=_,this.int16[dt+8]=x,this.int16[dt+9]=C,this.int16[dt+10]=T,this.int16[dt+11]=I,this.int16[dt+12]=S,this.int16[dt+13]=P,this.uint16[dt+14]=z,this.uint16[dt+15]=N,this.uint16[dt+16]=H,this.uint16[dt+17]=X,this.uint16[dt+18]=ne,this.uint16[dt+19]=ce,this.uint16[dt+20]=pe,this.uint16[dt+21]=_e,this.uint16[dt+22]=be,this.uint16[dt+23]=we,this.uint16[dt+24]=Fe,this.uint16[dt+25]=Pe,this.uint16[dt+26]=tt,this.uint16[dt+27]=qe,this.uint16[dt+28]=Le,this.uint32[un+15]=Ke,this.float32[un+16]=ot,this.float32[un+17]=Ue,this.float32[un+18]=ct,r}}Il.prototype.bytesPerElement=76,ut("StructArrayLayout3i2f6i15ui1ul3f76",Il);class Ra extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ra.prototype.bytesPerElement=4,ut("StructArrayLayout1f4",Ra);class Sl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.int16[f+0]=a,this.int16[f+1]=c,this.int16[f+2]=h,r}}Sl.prototype.bytesPerElement=6,ut("StructArrayLayout3i6",Sl);class pu extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,C){const T=7*r;return this.float32[T+0]=a,this.float32[T+1]=c,this.float32[T+2]=h,this.float32[T+3]=f,this.float32[T+4]=_,this.float32[T+5]=x,this.float32[T+6]=C,r}}pu.prototype.bytesPerElement=28,ut("StructArrayLayout7f28",pu);class _h extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=6*r;return this.uint32[3*r+0]=a,this.uint16[_+2]=c,this.uint16[_+3]=h,this.uint16[_+4]=f,r}}_h.prototype.bytesPerElement=12,ut("StructArrayLayout1ul3ui12",_h);class Po extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=c,r}}Po.prototype.bytesPerElement=4,ut("StructArrayLayout2ui4",Po);class Zp extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Zp.prototype.bytesPerElement=2,ut("StructArrayLayout1ui2",Zp);class vd extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=c,r}}vd.prototype.bytesPerElement=8,ut("StructArrayLayout2f8",vd);class yn extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=4*r;return this.float32[_+0]=a,this.float32[_+1]=c,this.float32[_+2]=h,this.float32[_+3]=f,r}}yn.prototype.bytesPerElement=16,ut("StructArrayLayout4f16",yn);class Km extends Tl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Km.prototype.size=40;class Ym extends yd{get(r){return new Km(this,r)}}ut("CollisionBoxArray",Ym);class uy extends Tl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}uy.prototype.size=60;class hy extends yc{get(r){return new uy(this,r)}}ut("PlacedSymbolArray",hy);class dy extends Tl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}dy.prototype.size=76;class py extends Il{get(r){return new dy(this,r)}}ut("SymbolInstanceArray",py);class fy extends Ra{getoffsetX(r){return this.float32[1*r+0]}}ut("GlyphOffsetArray",fy);class fu extends Sl{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}ut("SymbolLineVertexArray",fu);class my extends Tl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}my.prototype.size=12;class Xr extends _h{get(r){return new my(this,r)}}ut("FeatureIndexArray",Xr);class xd extends Tl{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}xd.prototype.size=4;class mu extends Po{get(r){return new xd(this,r)}}ut("FillExtrusionCentroidArray",mu);const Ax=rr([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),gy=rr([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ko=sl(function(i){i.exports=function(r,a){var c,h,f,_,x,C,T,I;for(h=r.length-(c=3&r.length),f=a,x=3432918353,C=461845907,I=0;I<h;)T=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,f=27492+(65535&(_=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,c){case 3:T^=(255&r.charCodeAt(I+2))<<16;case 2:T^=(255&r.charCodeAt(I+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&r.charCodeAt(I)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*C+(((T>>>16)*C&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Ys=sl(function(i){i.exports=function(r,a){for(var c,h=r.length,f=a^h,_=0;h>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&r.charCodeAt(_+2))<<16;case 2:f^=(255&r.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),gu=ko,bd=Ys;gu.murmur3=ko,gu.murmur2=bd;class Al{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,c,h){this.ids.push(Wp(r)),this.positions.push(a,c,h)}getPositions(r){const a=Wp(r);let c=0,h=this.ids.length-1;for(;c<h;){const _=c+h>>1;this.ids[_]>=a?h=_:c=_+1}const f=[];for(;this.ids[c]===a;)f.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return f}static serialize(r,a){const c=new Float64Array(r.ids),h=new Uint32Array(r.positions);return Xp(c,h,0,c.length-1),a&&a.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(r){const a=new Al;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function Wp(i){const r=+i;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:gu(String(i))}function Xp(i,r,a,c){for(;a<c;){const h=i[a+c>>1];let f=a-1,_=c+1;for(;;){do{f++}while(i[f]<h);do{_--}while(i[_]>h);if(f>=_)break;wd(i,f,_),wd(r,3*f,3*_),wd(r,3*f+1,3*_+1),wd(r,3*f+2,3*_+2)}_-a<c-_?(Xp(i,r,a,_),a=_+1):(Xp(i,r,_+1,c),c=_)}}function wd(i,r,a){const c=i[r];i[r]=i[a],i[a]=c}ut("FeaturePositionMap",Al);class Pl{constructor(r,a){this.gl=r.gl,this.location=a}}class Kp extends Pl{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Yp extends Pl{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class ao extends Pl{constructor(r,a){super(r,a),this.current=dn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Jp=new Float32Array(16),_u=new Float32Array(9),Px=new Float32Array(4);function Cd(i){return[gd(255*i.r,255*i.g),gd(255*i.b,255*i.a)]}class yh{constructor(r,a,c){this.value=r,this.uniformNames=a.map(h=>`u_${h}`),this.type=c}setUniform(r,a,c){r.set(c.constantOr(this.value))}getBinding(r,a,c){return"color"===this.type?new ao(r,a):new Kp(r,a)}}class yu{constructor(r,a){this.uniformNames=a.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,c,h){const f="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;f&&r.set(f)}getBinding(r,a,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Yp(r,a):new Kp(r,a)}}class La{constructor(r,a,c,h){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,c,h,f,_){const x=this.paintVertexArray.length,C=this.expression.evaluate(new Ot(0),a,{},f,h,_);this.paintVertexArray.resize(r),this._setPaintValue(x,r,C)}updatePaintArray(r,a,c,h,f){const _=this.expression.evaluate({zoom:0},c,h,void 0,f);this._setPaintValue(r,a,_)}_setPaintValue(r,a,c){if("color"===this.type){const h=Cd(c);for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=r;h<a;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ds{constructor(r,a,c,h,f,_){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,a,c,h,f,_){const x=this.expression.evaluate(new Ot(this.zoom),a,{},f,h,_),C=this.expression.evaluate(new Ot(this.zoom+1),a,{},f,h,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,x,C)}updatePaintArray(r,a,c,h,f){const _=this.expression.evaluate({zoom:this.zoom},c,h,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},c,h,void 0,f);this._setPaintValue(r,a,_,x)}_setPaintValue(r,a,c,h){if("color"===this.type){const f=Cd(c),_=Cd(h);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Ln(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,a,c){return new Kp(r,a)}}class kl{constructor(r,a,c,h,f,_,x){this.expression=r,this.type=c,this.useIntegerZoom=h,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===c?gy:Ax).members;for(let C=0;C<a.length;++C);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,a,c){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(r,a,c,h,f,_){this._setPaintValues(r,a,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(r,a,c,h){if(!h||!c)return;const{min:f,mid:_,max:x}=c,C=h[f],T=h[_],I=h[x];if(C&&T&&I)for(let S=r;S<a;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,T,C),this._setPaintValue(this.zoomOutPaintVertexArray,S,T,I)}_setPaintValue(r,a,c,h){r.emplace(a,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],c.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Js{constructor(r,a,c=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in r.paint._values){if(!c(f))continue;const _=r.paint.get(f);if(!(_ instanceof di&&cc(_.property.specification)))continue;const x=kx(f,r.type),C=_.value,T=_.property.specification.type,I=_.property.useIntegerZoom,S=_.property.specification["property-type"],P="cross-faded"===S||"cross-faded-data-driven"===S,z="line-dasharray"===String(f)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==C.kind||z)if("source"===C.kind||z||P){const N=xh(f,T,"source");this.binders[f]=P?new kl(C,x,T,I,a,N,r.id):new La(C,x,T,N),h.push(`/a_${f}`)}else{const N=xh(f,T,"composite");this.binders[f]=new Ds(C,x,T,I,a,N),h.push(`/z_${f}`)}else this.binders[f]=P?new yu(C.value,x):new yh(C.value,x,T),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof La||a instanceof Ds?a.maxValue:0}populatePaintArrays(r,a,c,h,f,_){for(const x in this.binders){const C=this.binders[x];(C instanceof La||C instanceof Ds||C instanceof kl)&&C.populatePaintArray(r,a,c,h,f,_)}}setConstantPatternPositions(r,a){for(const c in this.binders){const h=this.binders[c];h instanceof yu&&h.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,c,h,f,_){let x=!1;for(const C in r){const T=a.getPositions(C);for(const I of T){const S=c.feature(I.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof La||z instanceof Ds||z instanceof kl)&&!0===z.expression.isStateDependent){const N=h.paint.get(P);z.expression=N.value,z.updatePaintArray(I.start,I.end,S,r[C],f,_),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const c=this.binders[a];(c instanceof yh||c instanceof yu)&&r.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof La||c instanceof Ds||c instanceof kl)for(let h=0;h<c.paintVertexAttributes.length;h++)r.push(c.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof yh||c instanceof yu||c instanceof Ds)for(const h of c.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const c=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof yh||f instanceof yu||f instanceof Ds)for(const _ of f.uniformNames)if(a[_]){const x=f.getBinding(r,a[_],_);c.push({name:_,property:h,binding:x})}}return c}setUniforms(r,a,c,h){for(const{name:f,property:_,binding:x}of a)this.binders[_].setUniform(x,h,c.get(_),f)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const c=this.binders[a];if(r&&c instanceof kl){const h=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof La||c instanceof Ds)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const a in this.binders){const c=this.binders[a];(c instanceof La||c instanceof Ds||c instanceof kl)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof La||a instanceof Ds||a instanceof kl)&&a.destroy()}}}class Oa{constructor(r,a,c=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new Js(h,a,c);this.needsUpload=!1,this._featureMap=new Al,this._bufferOffset=0}populatePaintArrays(r,a,c,h,f,_,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(r,a,h,f,_,x);void 0!==a.id&&this._featureMap.add(a.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,c,h,f){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,a,_,h,f)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Ed={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function kx(i,r){return Ed[i]||[i.replace(`${r}-`,"").replace(/-/g,"_")]}const vh={"line-pattern":{source:Dl,composite:Dl},"fill-pattern":{source:Dl,composite:Dl},"fill-extrusion-pattern":{source:Dl,composite:Dl},"line-dasharray":{source:gc,composite:gc}},Qp={color:{source:vd,composite:yn},number:{source:Ra,composite:vd}};function xh(i,r,a){const c=vh[i];return c&&c[a]||Qp[r][a]}ut("ConstantBinder",yh),ut("CrossFadedConstantBinder",yu),ut("SourceExpressionBinder",La),ut("CrossFadedCompositeBinder",kl),ut("CompositeExpressionBinder",Ds),ut("ProgramConfiguration",Js,{omit:["_buffers"]}),ut("ProgramConfigurationSet",Oa);const Td="-transition";class Ms extends va{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Yo(a.layout)),a.paint)){this._transitionablePaint=new zi(a.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jo(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,c={}){null!=a&&this._validate(Or,`layers.${this.id}.layout.${r}`,r,a,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return Ql(r,Td)?this._transitionablePaint.getTransition(r.slice(0,-Td.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,c={}){if(null!=a&&this._validate(El,`layers.${this.id}.paint.${r}`,r,a,c))return!1;if(Ql(r,Td))return this._transitionablePaint.setTransition(r.slice(0,-Td.length),a||void 0),!1;{const h=this._transitionablePaint._values[r],f="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const C=this._transitionablePaint._values[r].value;return C.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(r,x,C)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),ec(r,(a,c)=>!(void 0===a||"layout"===c&&!Object.keys(a).length||"paint"===c&&!Object.keys(a).length))}_validate(r,a,c,h,f={}){return(!f||!1!==f.validate)&&mh(this,r.call(Cl,{key:a,layerType:this.type,objectKey:c,value:h,styleSpec:Se,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof di&&cc(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=au(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _y=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jm}=_y;class Er{constructor(r=[]){this.segments=r}prepareSegment(r,a,c,h){let f=this.segments[this.segments.length-1];return r>Er.MAX_VERTEX_ARRAY_LENGTH&&sr(`Max vertices per segment is ${Er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!f||f.vertexLength+r>Er.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,c,h){return new Er([{vertexOffset:r,primitiveOffset:a,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}Er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut("SegmentVector",Er);var Ht=8192;class Rl{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof it?new it(r.lng,r.lat):it.convert(r),this}setSouthWest(r){return this._sw=r instanceof it?new it(r.lng,r.lat):it.convert(r),this}extend(r){const a=this._sw,c=this._ne;let h,f;if(r instanceof it)h=r,f=r;else{if(!(r instanceof Rl))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Rl.convert(r)):this.extend(it.convert(r)):this;if(h=r._sw,f=r._ne,!h||!f)return this}return a||c?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),c.lng=Math.max(f.lng,c.lng),c.lat=Math.max(f.lat,c.lat)):(this._sw=new it(h.lng,h.lat),this._ne=new it(f.lng,f.lat)),this}getCenter(){return new it((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new it(this.getWest(),this.getNorth())}getSouthEast(){return new it(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:c}=it.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(r){return!r||r instanceof Rl?r:new Rl(r)}}const Qm=6371008.8;class it{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new it(zs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,c=this.lat*a,h=r.lat*a,f=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return Qm*Math.acos(Math.min(f,1))}toBounds(r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new Rl(new it(this.lng-c,this.lat-a),new it(this.lng+c,this.lat+a))}static convert(r){if(r instanceof it)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new it(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new it(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ef=2*Math.PI*Qm;function eg(i){return ef*Math.cos(i*Math.PI/180)}function Ll(i){return(180+i)/360}function Qs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Is(i,r){return i/eg(r)}function Fa(i){return 360*i-180}function Qo(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function bh(i,r){return i*eg(Qo(r))}const Ei=85.051129;class wh{constructor(r,a,c=0){this.x=+r,this.y=+a,this.z=+c}static fromLngLat(r,a=0){const c=it.convert(r);return new wh(Ll(c.lng),Qs(c.lat),Is(a,c.lat))}toLngLat(){return new it(Fa(this.x),Qo(this.y))}toAltitude(){return bh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ef*(r=Qo(this.y),1/Math.cos(r*Math.PI/180));var r}}function vc(i,r,a,c,h,f,_,x,C){const T=(r+c)/2,I=(a+h)/2,S=new at(T,I);x(S),function(P,z,N,H,X,ne){const ce=N-X,pe=H-ne;return Math.abs((H-z)*ce-(N-P)*pe)/Math.hypot(ce,pe)}(S.x,S.y,f.x,f.y,_.x,_.y)>=C?(vc(i,r,a,T,I,f,S,x,C),vc(i,T,I,c,h,S,_,x,C)):i.push(_)}function yy(i,r,a){const c=[];let h,f,_;for(const x of i){const{x:C,y:T}=x;r(x),_?vc(c,h,f,C,T,_,x,r,a):c.push(x),h=C,f=T,_=x}return c}const Dd=Math.pow(2,14)-1,Md=-Dd-1;function Id(i,r){const a=Math.round(i.x*r),c=Math.round(i.y*r);return i.x=Ln(a,Md,Dd),i.y=Ln(c,Md,Dd),(a<i.x||a>i.x+1||c<i.y||c>i.y+1)&&sr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ea(i,r,a){const c=i.loadGeometry(),h=i.extent,f=Ht/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:x,x:C,y:T,projection:I}=a,S=P=>{const z=Fa((r.x+P.x/h)/_),N=Qo((r.y+P.y/h)/_),H=I.project(z,N);P.x=(H.x*x-C)*h,P.y=(H.y*x-T)*h};for(let P=0;P<c.length;P++)if(1!==i.type)c[P]=yy(c[P],S,1);else{const z=[];for(const N of c[P])N.x<0||N.x>=h||N.y<0||N.y>=h||(S(N),z.push(N));c[P]=z}}for(const _ of c)for(const x of _)Id(x,f);return c}function xc(i,r){return{type:i.type,id:i.id,properties:i.properties,geometry:r?ea(i):[]}}function Sd(i,r,a,c,h){i.emplaceBack(2*r+(c+1)/2,2*a+(h+1)/2)}class Ol{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new fc,this.indexArray=new Gi,this.segments=new Er,this.programConfigurations=new Oa(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){const f=this.layers[0],_=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:C,id:T,index:I,sourceLayerIndex:S}of r){const P=this.layers[0]._featureFilter.needGeometry,z=xc(C,P);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),z,c))continue;const N=x?x.evaluate(z,{},c):void 0,H={id:T,properties:C.properties,type:C.type,sourceLayerIndex:S,index:I,geometry:P?z.geometry:ea(C,c,h),patterns:{},sortKey:N};_.push(H)}x&&_.sort((C,T)=>C.sortKey-T.sortKey);for(const C of _){const{geometry:T,index:I,sourceLayerIndex:S}=C,P=r[I].feature;this.addFeature(C,T,I,a.availableImages,c),a.featureIndex.insert(P,T,I,S,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Jm),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,h,f){for(const _ of a)for(const x of _){const C=x.x,T=x.y;if(C<0||C>=Ht||T<0||T>=Ht)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),S=I.vertexLength;Sd(this.layoutVertexArray,C,T,-1,-1),Sd(this.layoutVertexArray,C,T,1,-1),Sd(this.layoutVertexArray,C,T,1,1),Sd(this.layoutVertexArray,C,T,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},h,f)}}function vu(i,r){for(let a=0;a<i.length;a++)if(za(r,i[a]))return!0;for(let a=0;a<r.length;a++)if(za(i,r[a]))return!0;return!!tf(i,r)}function vy(i,r,a){return!!za(i,r)||!!nf(r,i,a)}function xy(i,r){if(1===i.length)return rg(r,i[0]);for(let a=0;a<r.length;a++){const c=r[a];for(let h=0;h<c.length;h++)if(za(i,c[h]))return!0}for(let a=0;a<i.length;a++)if(rg(r,i[a]))return!0;for(let a=0;a<r.length;a++)if(tf(i,r[a]))return!0;return!1}function tg(i,r,a){if(i.length>1){if(tf(i,r))return!0;for(let c=0;c<r.length;c++)if(nf(r[c],i,a))return!0}for(let c=0;c<i.length;c++)if(nf(i[c],r,a))return!0;return!1}function tf(i,r){if(0===i.length||0===r.length)return!1;for(let a=0;a<i.length-1;a++){const c=i[a],h=i[a+1];for(let f=0;f<r.length-1;f++)if(Rx(c,h,r[f],r[f+1]))return!0}return!1}function Rx(i,r,a,c){return Ui(i,a,c)!==Ui(r,a,c)&&Ui(i,r,a)!==Ui(i,r,c)}function nf(i,r,a){const c=a*a;if(1===r.length)return i.distSqr(r[0])<c;for(let h=1;h<r.length;h++)if(ng(i,r[h-1],r[h])<c)return!0;return!1}function ng(i,r,a){const c=r.distSqr(a);if(0===c)return i.distSqr(r);const h=((i.x-r.x)*(a.x-r.x)+(i.y-r.y)*(a.y-r.y))/c;return i.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function rg(i,r){let a,c,h,f=!1;for(let _=0;_<i.length;_++){a=i[_];for(let x=0,C=a.length-1;x<a.length;C=x++)c=a[x],h=a[C],c.y>r.y!=h.y>r.y&&r.x<(h.x-c.x)*(r.y-c.y)/(h.y-c.y)+c.x&&(f=!f)}return f}function za(i,r){let a=!1;for(let c=0,h=i.length-1;c<i.length;h=c++){const f=i[c],_=i[h];f.y>r.y!=_.y>r.y&&r.x<(_.x-f.x)*(r.y-f.y)/(_.y-f.y)+f.x&&(a=!a)}return a}function Ad(i,r,a,c,h){for(const _ of i)if(r<=_.x&&a<=_.y&&c>=_.x&&h>=_.y)return!0;const f=[new at(r,a),new at(r,h),new at(c,h),new at(c,a)];if(i.length>2)for(const _ of f)if(za(i,_))return!0;for(let _=0;_<i.length-1;_++)if(xu(i[_],i[_+1],f))return!0;return!1}function xu(i,r,a){const c=a[0],h=a[2];if(i.x<c.x&&r.x<c.x||i.x>h.x&&r.x>h.x||i.y<c.y&&r.y<c.y||i.y>h.y&&r.y>h.y)return!1;const f=Ui(i,r,a[0]);return f!==Ui(i,r,a[1])||f!==Ui(i,r,a[2])||f!==Ui(i,r,a[3])}function bu(i,r,a){const c=r.paint.get(i).value;return"constant"===c.kind?c.value:a.programConfigurations.get(r.id).getMaxValue(i)}function Pd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function by(i,r,a,c,h){if(!r[0]&&!r[1])return i;const f=at.convert(r)._mult(h);"viewport"===a&&f._rotate(-c);const _=[];for(let x=0;x<i.length;x++)_.push(i[x].sub(f));return _}function Ch(i,r,a,c){const h=at.convert(i)._mult(c);return"viewport"===r&&h._rotate(-a),h}ut("CircleBucket",Ol,{omit:["layers"]});const rf=new Cr({"circle-sort-key":new Ct(Se.layout_circle["circle-sort-key"])});var ig={paint:new Cr({"circle-radius":new Ct(Se.paint_circle["circle-radius"]),"circle-color":new Ct(Se.paint_circle["circle-color"]),"circle-blur":new Ct(Se.paint_circle["circle-blur"]),"circle-opacity":new Ct(Se.paint_circle["circle-opacity"]),"circle-translate":new ft(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ct(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ct(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ct(Se.paint_circle["circle-stroke-opacity"])}),layout:rf};class kd{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,c,h){const f=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const T=go([],C,r),I=1/T[3]/a*f;return(S=T)[0]=(P=T)[0]*(z=[I,I,h?1/T[3]:I,I])[0],S[1]=P[1]*z[1],S[2]=P[2]*z[2],S[3]=P[3]*z[3],S;var S,P,z}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const T=$o([],Rn([],da([],_[C[0]],_[C[1]]),da([],_[C[2]],_[C[1]]))),I=-si(T,_[C[1]]);return T.concat(I)});return new kd(_,x)}}class es{constructor(r,a){this.min=r,this.max=a,this.center=zn([],ht([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],c=De(this.min),h=De(this.max);for(let f=0;f<a.length;f++)c[f]=a[f]?this.min[f]:this.center[f],h[f]=a[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new es(c,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let c=!0;for(let h=0;h<r.planes.length;h++){const f=r.planes[h];let _=0;for(let x=0;x<a.length;x++)_+=si(f,a[x])+f[3]>=0;if(0===_)return 0;_!==a.length&&(c=!1)}if(c)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const C=r.points[x][h]-this.min[h];f=Math.min(f,C),_=Math.max(_,C)}if(_<0||f>this.max[h]-this.min[h])return 0}return 1}}function Fl(i,r,a,c,h,f,_,x,C){if(f&&i.queryGeometry.isAboveHorizon)return!1;f&&(C*=i.pixelToTileUnitsFactor);for(const T of r)for(const I of T){const S=I.add(x),P=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(S.x,S.y,!0):0,z=f?S:wy(S,P,c),N=f?i.tilespaceRays.map(X=>Ey(X,P)):i.queryGeometry.screenGeometry,H=go([],[I.x,I.y,P,1],c);if(!_&&f?C*=H[3]/a.cameraToCenterDistance:_&&!f&&(C*=a.cameraToCenterDistance/H[3]),vy(N,z,C))return!0}return!1}function wy(i,r,a){const c=go([],[i.x,i.y,r,1],a);return new at(c[0]/c[3],c[1]/c[3])}const og=st(0,0,0),Cy=st(0,0,1);function Ey(i,r){const a=ge();return og[2]=r,i.intersectsPlane(og,Cy,a),new at(a[0],a[1])}class sg extends Ol{}function Hi(i,{width:r,height:a},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*c);return i.width=r,i.height=a,i.data=h,i}function Ss(i,{width:r,height:a},c){if(r===i.width&&a===i.height)return;const h=Hi({},{width:r,height:a},c);Rd(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,r),height:Math.min(i.height,a)},c),i.width=r,i.height=a,i.data=h.data}function Rd(i,r,a,c,h,f){if(0===h.width||0===h.height)return r;if(h.width>i.width||h.height>i.height||a.x>i.width-h.width||a.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||c.x>r.width-h.width||c.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,x=r.data;for(let C=0;C<h.height;C++){const T=((a.y+C)*i.width+a.x)*f,I=((c.y+C)*r.width+c.x)*f;for(let S=0;S<h.width*f;S++)x[I+S]=_[T+S]}return r}ut("HeatmapBucket",sg,{omit:["layers"]});class zl{constructor(r,a){Hi(this,r,1,a)}resize(r){Ss(this,r,1)}clone(){return new zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,f){Rd(r,a,c,h,f,1)}}class Ro{constructor(r,a){Hi(this,r,4,a)}resize(r){Ss(this,r,4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,f){Rd(r,a,c,h,f,4)}}ut("AlphaImage",zl),ut("RGBAImage",Ro);var Ty={paint:new Cr({"heatmap-radius":new Ct(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ct(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ks(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(Se.paint_heatmap["heatmap-opacity"])})};function of(i){const r={},a=i.resolution||256,c=i.clips?i.clips.length:1,h=i.image||new Ro({width:a,height:c}),f=(_,x,C)=>{r[i.evaluationKey]=C;const T=i.expression.evaluate(r);h.data[_+x+0]=Math.floor(255*T.r/T.a),h.data[_+x+1]=Math.floor(255*T.g/T.a),h.data[_+x+2]=Math.floor(255*T.b/T.a),h.data[_+x+3]=Math.floor(255*T.a)};if(i.clips)for(let _=0,x=0;_<c;++_,x+=4*a)for(let C=0,T=0;C<a;C++,T+=4){const I=C/(a-1),{start:S,end:P}=i.clips[_];f(x,T,S*(1-I)+P*I)}else for(let _=0,x=0;_<a;_++,x+=4)f(0,x,_/(a-1));return h}var Dy={paint:new Cr({"hillshade-illumination-direction":new ft(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(Se.paint_hillshade["hillshade-accent-color"])})};const ag=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:My}=ag;var Ld=Od,Iy=Od;function Od(i,r,a){a=a||2;var c,h,f,_,x,C,T,I=r&&r.length,S=I?r[0]*a:i.length,P=Sy(i,0,S,a,!0),z=[];if(!P||P.next===P.prev)return z;if(I&&(P=function(H,X,ne,ce){var pe,_e,be,we=[];for(pe=0,_e=X.length;pe<_e;pe++)(be=Sy(H,X[pe]*ce,pe<_e-1?X[pe+1]*ce:H.length,ce,!1))===be.next&&(be.steiner=!0),we.push(Ox(be));for(we.sort(ug),pe=0;pe<we.length;pe++)ne=Bl(ne=hg(we[pe],ne),ne.next);return ne}(i,r,P,a)),i.length>80*a){c=f=i[0],h=_=i[1];for(var N=a;N<S;N+=a)(x=i[N])<c&&(c=x),(C=i[N+1])<h&&(h=C),x>f&&(f=x),C>_&&(_=C);T=0!==(T=Math.max(f-c,_-h))?1/T:0}return Ba(P,z,a,c,h,T),z}function Sy(i,r,a,c,h){var f,_;if(h===zd(i,r,a,c)>0)for(f=r;f<a;f+=c)_=fg(f,i[f],i[f+1],_);else for(f=a-c;f>=r;f-=c)_=fg(f,i[f],i[f+1],_);return _&&af(_,_.next)&&(wu(_),_=_.next),_}function Bl(i,r){if(!i)return i;r||(r=i);var a,c=i;do{if(a=!1,c.steiner||!af(c,c.next)&&0!==lr(c.prev,c,c.next))c=c.next;else{if(wu(c),(c=r=c.prev)===c.next)break;a=!0}}while(a||c!==r);return r}function Ba(i,r,a,c,h,f,_){if(i){!_&&f&&function(I,S,P,z){var N=I;do{null===N.z&&(N.z=dg(N.x,N.y,S,P,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==I);N.prevZ.nextZ=null,N.prevZ=null,function(H){var X,ne,ce,pe,_e,be,we,Fe,Pe=1;do{for(ne=H,H=null,_e=null,be=0;ne;){for(be++,ce=ne,we=0,X=0;X<Pe&&(we++,ce=ce.nextZ);X++);for(Fe=Pe;we>0||Fe>0&&ce;)0!==we&&(0===Fe||!ce||ne.z<=ce.z)?(pe=ne,ne=ne.nextZ,we--):(pe=ce,ce=ce.nextZ,Fe--),_e?_e.nextZ=pe:H=pe,pe.prevZ=_e,_e=pe;ne=ce}_e.nextZ=null,Pe*=2}while(be>1)}(N)}(i,c,h,f);for(var x,C,T=i;i.prev!==i.next;)if(x=i.prev,C=i.next,f?ta(i,c,h,f):lg(i))r.push(x.i/a),r.push(i.i/a),r.push(C.i/a),wu(i),i=C.next,T=C.next;else if((i=C)===T){_?1===_?Ba(i=Eh(Bl(i),r,a),r,a,c,h,f,2):2===_&&cg(i,r,a,c,h,f):Ba(Bl(i),r,a,c,h,f,1);break}}}function lg(i){var r=i.prev,a=i,c=i.next;if(lr(r,a,c)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(Nl(r.x,r.y,a.x,a.y,c.x,c.y,h.x,h.y)&&lr(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function ta(i,r,a,c){var h=i.prev,f=i,_=i.next;if(lr(h,f,_)>=0)return!1;for(var x=h.x>f.x?h.x>_.x?h.x:_.x:f.x>_.x?f.x:_.x,C=h.y>f.y?h.y>_.y?h.y:_.y:f.y>_.y?f.y:_.y,T=dg(h.x<f.x?h.x<_.x?h.x:_.x:f.x<_.x?f.x:_.x,h.y<f.y?h.y<_.y?h.y:_.y:f.y<_.y?f.y:_.y,r,a,c),I=dg(x,C,r,a,c),S=i.prevZ,P=i.nextZ;S&&S.z>=T&&P&&P.z<=I;){if(S!==i.prev&&S!==i.next&&Nl(h.x,h.y,f.x,f.y,_.x,_.y,S.x,S.y)&&lr(S.prev,S,S.next)>=0||(S=S.prevZ,P!==i.prev&&P!==i.next&&Nl(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&lr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;S&&S.z>=T;){if(S!==i.prev&&S!==i.next&&Nl(h.x,h.y,f.x,f.y,_.x,_.y,S.x,S.y)&&lr(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;P&&P.z<=I;){if(P!==i.prev&&P!==i.next&&Nl(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&lr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Eh(i,r,a){var c=i;do{var h=c.prev,f=c.next.next;!af(h,f)&&Ay(h,c,c.next,f)&&Dh(h,f)&&Dh(f,h)&&(r.push(h.i/a),r.push(c.i/a),r.push(f.i/a),wu(c),wu(c.next),c=i=f),c=c.next}while(c!==i);return Bl(c)}function cg(i,r,a,c,h,f){var _=i;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&sf(_,x)){var C=pg(_,x);return _=Bl(_,_.next),C=Bl(C,C.next),Ba(_,r,a,c,h,f),void Ba(C,r,a,c,h,f)}x=x.next}_=_.next}while(_!==i)}function ug(i,r){return i.x-r.x}function hg(i,r){var a=function(f,_){var x,C=_,T=f.x,I=f.y,S=-1/0;do{if(I<=C.y&&I>=C.next.y&&C.next.y!==C.y){var P=C.x+(I-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(P<=T&&P>S){if(S=P,P===T){if(I===C.y)return C;if(I===C.next.y)return C.next}x=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!x)return null;if(T===S)return x;var z,N=x,H=x.x,X=x.y,ne=1/0;C=x;do{T>=C.x&&C.x>=H&&T!==C.x&&Nl(I<X?T:S,I,H,X,I<X?S:T,I,C.x,C.y)&&(z=Math.abs(I-C.y)/(T-C.x),Dh(C,f)&&(z<ne||z===ne&&(C.x>x.x||C.x===x.x&&Lx(x,C)))&&(x=C,ne=z)),C=C.next}while(C!==N);return x}(i,r);if(!a)return r;var c=pg(a,i),h=Bl(a,a.next);return Bl(c,c.next),r===a?h:r}function Lx(i,r){return lr(i.prev,i,r.prev)<0&&lr(r.next,i,i.next)<0}function dg(i,r,a,c,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-a)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Ox(i){var r=i,a=i;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==i);return a}function Nl(i,r,a,c,h,f,_,x){return(h-_)*(r-x)-(i-_)*(f-x)>=0&&(i-_)*(c-x)-(a-_)*(r-x)>=0&&(a-_)*(f-x)-(h-_)*(c-x)>=0}function sf(i,r){return i.next.i!==r.i&&i.prev.i!==r.i&&!function(a,c){var h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==c.i&&h.next.i!==c.i&&Ay(h,h.next,a,c))return!0;h=h.next}while(h!==a);return!1}(i,r)&&(Dh(i,r)&&Dh(r,i)&&function(a,c){var h=a,f=!1,_=(a.x+c.x)/2,x=(a.y+c.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==a);return f}(i,r)&&(lr(i.prev,i,r.prev)||lr(i,r.prev,r))||af(i,r)&&lr(i.prev,i,i.next)>0&&lr(r.prev,r,r.next)>0)}function lr(i,r,a){return(r.y-i.y)*(a.x-r.x)-(r.x-i.x)*(a.y-r.y)}function af(i,r){return i.x===r.x&&i.y===r.y}function Ay(i,r,a,c){var h=Fd(lr(i,r,a)),f=Fd(lr(i,r,c)),_=Fd(lr(a,c,i)),x=Fd(lr(a,c,r));return h!==f&&_!==x||!(0!==h||!Th(i,a,r))||!(0!==f||!Th(i,c,r))||!(0!==_||!Th(a,i,c))||!(0!==x||!Th(a,r,c))}function Th(i,r,a){return r.x<=Math.max(i.x,a.x)&&r.x>=Math.min(i.x,a.x)&&r.y<=Math.max(i.y,a.y)&&r.y>=Math.min(i.y,a.y)}function Fd(i){return i>0?1:i<0?-1:0}function Dh(i,r){return lr(i.prev,i,i.next)<0?lr(i,r,i.next)>=0&&lr(i,i.prev,r)>=0:lr(i,r,i.prev)<0||lr(i,i.next,r)<0}function pg(i,r){var a=new Cu(i.i,i.x,i.y),c=new Cu(r.i,r.x,r.y),h=i.next,f=r.prev;return i.next=r,r.prev=i,a.next=h,h.prev=a,c.next=a,a.prev=c,f.next=c,c.prev=f,c}function fg(i,r,a,c){var h=new Cu(i,r,a);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function wu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Cu(i,r,a){this.i=i,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zd(i,r,a,c){for(var h=0,f=r,_=a-c;f<a;f+=c)h+=(i[_]-i[f])*(i[f+1]+i[_+1]),_=f;return h}function lf(i,r,a,c,h){mg(i,r,a||0,c||i.length-1,h||Py)}function mg(i,r,a,c,h){for(;c>a;){if(c-a>600){var f=c-a+1,_=r-a+1,x=Math.log(f),C=.5*Math.exp(2*x/3),T=.5*Math.sqrt(x*C*(f-C)/f)*(_-f/2<0?-1:1);mg(i,r,Math.max(a,Math.floor(r-_*C/f+T)),Math.min(c,Math.floor(r+(f-_)*C/f+T)),h)}var I=i[r],S=a,P=c;for(Hn(i,a,r),h(i[c],I)>0&&Hn(i,a,c);S<P;){for(Hn(i,S,P),S++,P--;h(i[S],I)<0;)S++;for(;h(i[P],I)>0;)P--}0===h(i[a],I)?Hn(i,a,P):Hn(i,++P,c),P<=r&&(a=P+1),r<=P&&(c=P-1)}}function Hn(i,r,a){var c=i[r];i[r]=i[a],i[a]=c}function Py(i,r){return i<r?-1:i>r?1:0}function cf(i,r){const a=i.length;if(a<=1)return[i];const c=[];let h,f;for(let _=0;_<a;_++){const x=fa(i[_]);0!==x&&(i[_].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(h&&c.push(h),h=[i[_]]):h.push(i[_]))}if(h&&c.push(h),r>1)for(let _=0;_<c.length;_++)c[_].length<=r||(lf(c[_],r,1,c[_].length-1,Mh),c[_]=c[_].slice(0,r));return c}function Mh(i,r){return r.area-i.area}function Eu(i,r,a){const c=a.patternDependencies;let h=!1;for(const f of r){const _=f.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,c[x.to]=!0,c[x.from]=!0)}return h}function uf(i,r,a,c,h){const f=h.patternDependencies;for(const _ of r){const x=_.paint.get(`${i}-pattern`).value;if("constant"!==x.kind){let C=x.evaluate({zoom:c-1},a,{},h.availableImages),T=x.evaluate({zoom:c},a,{},h.availableImages),I=x.evaluate({zoom:c+1},a,{},h.availableImages);C=C&&C.name?C.name:C,T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,f[C]=!0,f[T]=!0,f[I]=!0,a.patterns[_.id]={min:C,mid:T,max:I}}}return a}Od.deviation=function(i,r,a,c){var h=r&&r.length,f=Math.abs(zd(i,0,h?r[0]*a:i.length,a));if(h)for(var _=0,x=r.length;_<x;_++)f-=Math.abs(zd(i,r[_]*a,_<x-1?r[_+1]*a:i.length,a));var C=0;for(_=0;_<c.length;_+=3){var T=c[_]*a,I=c[_+1]*a,S=c[_+2]*a;C+=Math.abs((i[T]-i[S])*(i[I+1]-i[T+1])-(i[T]-i[I])*(i[S+1]-i[T+1]))}return 0===f&&0===C?0:Math.abs((C-f)/f)},Od.flatten=function(i){for(var r=i[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,h=0;h<i.length;h++){for(var f=0;f<i[h].length;f++)for(var _=0;_<r;_++)a.vertices.push(i[h][f][_]);h>0&&a.holes.push(c+=i[h-1].length)}return a},Ld.default=Iy;class Bd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fc,this.indexArray=new Gi,this.indexArray2=new Po,this.programConfigurations=new Oa(r.layers,r.zoom),this.segments=new Er,this.segments2=new Er,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){this.hasPattern=Eu("fill",this.layers,a);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:C,index:T,sourceLayerIndex:I}of r){const S=this.layers[0]._featureFilter.needGeometry,P=xc(x,S);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),P,c))continue;const z=f?f.evaluate(P,{},c,a.availableImages):void 0,N={id:C,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:S?P.geometry:ea(x,c,h),patterns:{},sortKey:z};_.push(N)}f&&_.sort((x,C)=>x.sortKey-C.sortKey);for(const x of _){const{geometry:C,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const S=uf("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(S)}else this.addFeature(x,C,T,c,{},a.availableImages);a.featureIndex.insert(r[T].feature,C,T,I,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,My),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,c,h,f,_=[]){for(const x of cf(a,500)){let C=0;for(const N of x)C+=N.length;const T=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),I=T.vertexLength,S=[],P=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&P.push(S.length/2);const H=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),X=H.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(X+N.length-1,X),S.push(N[0].x),S.push(N[0].y);for(let ne=1;ne<N.length;ne++)this.layoutVertexArray.emplaceBack(N[ne].x,N[ne].y),this.indexArray2.emplaceBack(X+ne-1,X+ne),S.push(N[ne].x),S.push(N[ne].y);H.vertexLength+=N.length,H.primitiveLength+=N.length}const z=Ld(S,P);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(I+z[N],I+z[N+1],I+z[N+2]);T.vertexLength+=C,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}}ut("FillBucket",Bd,{omit:["layers","patternFeatures"]});const ky=new Cr({"fill-sort-key":new Ct(Se.layout_fill["fill-sort-key"])});var Ry={paint:new Cr({"fill-antialias":new ft(Se.paint_fill["fill-antialias"]),"fill-opacity":new Ct(Se.paint_fill["fill-opacity"]),"fill-color":new Ct(Se.paint_fill["fill-color"]),"fill-outline-color":new Ct(Se.paint_fill["fill-outline-color"]),"fill-translate":new ft(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new zr(Se.paint_fill["fill-pattern"])}),layout:ky};const Ly=rr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fx=rr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:zx}=Ly;var Tu=Kr;function Kr(i,r,a,c,h){this.properties={},this.extent=a,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=h,i.readFields(hf,this,r)}function hf(i,r,a){1==i?r.id=a.readVarint():2==i?function(c,h){for(var f=c.readVarint()+c.pos;c.pos<f;){var _=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[_]=x}}(a,r):3==i?r.type=a.readVarint():4==i&&(r._geometry=a.pos)}function gg(i){for(var r,a,c=0,h=0,f=i.length,_=f-1;h<f;_=h++)c+=((a=i[_]).x-(r=i[h]).x)*(r.y+a.y);return c}Kr.types=["Unknown","Point","LineString","Polygon"],Kr.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,a=i.readVarint()+i.pos,c=1,h=0,f=0,_=0,x=[];i.pos<a;){if(h<=0){var C=i.readVarint();c=7&C,h=C>>3}if(h--,1===c||2===c)f+=i.readSVarint(),_+=i.readSVarint(),1===c&&(r&&x.push(r),r=[]),r.push(new at(f,_));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},Kr.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var r=i.readVarint()+i.pos,a=1,c=0,h=0,f=0,_=1/0,x=-1/0,C=1/0,T=-1/0;i.pos<r;){if(c<=0){var I=i.readVarint();a=7&I,c=I>>3}if(c--,1===a||2===a)(h+=i.readSVarint())<_&&(_=h),h>x&&(x=h),(f+=i.readSVarint())<C&&(C=f),f>T&&(T=f);else if(7!==a)throw new Error("unknown command "+a)}return[_,C,x,T]},Kr.prototype.toGeoJSON=function(i,r,a){var c,h,f=this.extent*Math.pow(2,a),_=this.extent*i,x=this.extent*r,C=this.loadGeometry(),T=Kr.types[this.type];function I(z){for(var N=0;N<z.length;N++){var H=z[N];z[N]=[360*(H.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(c=0;c<C.length;c++)S[c]=C[c][0];I(C=S);break;case 2:for(c=0;c<C.length;c++)I(C[c]);break;case 3:for(C=function(z){var N=z.length;if(N<=1)return[z];for(var H,X,ne=[],ce=0;ce<N;ce++){var pe=gg(z[ce]);0!==pe&&(void 0===X&&(X=pe<0),X===pe<0?(H&&ne.push(H),H=[z[ce]]):H.push(z[ce]))}return H&&ne.push(H),ne}(C),c=0;c<C.length;c++)for(h=0;h<C[c].length;h++)I(C[c][h])}1===C.length?C=C[0]:T="Multi"+T;var P={type:"Feature",geometry:{type:T,coordinates:C},properties:this.properties};return"id"in this&&(P.id=this.id),P};var df=Ti;function Ti(i,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ih,this,r),this.length=this._features.length}function Ih(i,r,a){15===i?r.version=a.readVarint():1===i?r.name=a.readString():5===i?r.extent=a.readVarint():2===i?r._features.push(a.pos):3===i?r._keys.push(a.readString()):4===i&&r._values.push(function(c){for(var h=null,f=c.readVarint()+c.pos;c.pos<f;){var _=c.readVarint()>>3;h=1===_?c.readString():2===_?c.readFloat():3===_?c.readDouble():4===_?c.readVarint64():5===_?c.readVarint():6===_?c.readSVarint():7===_?c.readBoolean():null}return h}(a))}function pf(i,r,a){if(3===i){var c=new df(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}Ti.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new Tu(this._pbf,r,this.extent,this._keys,this._values)};var bc={VectorTile:function(i,r){this.layers=i.readFields(pf,{},r)},VectorTileFeature:Tu,VectorTileLayer:df};const Oy=bc.VectorTileFeature.types,_g=Math.pow(2,13);function Sh(i,r,a,c,h,f,_,x){i.emplaceBack((r<<1)+_,(a<<1)+f,(Math.floor(c*_g)<<1)+h,Math.round(x))}class ff{constructor(){this.acc=new at(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new at(r.x,r.y),this.max=new at(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);let c=!!this.borders;const h=this.min,f=this.max;r.x<h.x?(h.x=r.x,c=!0):r.x>f.x&&(f.x=r.x,c=!0),r.y<h.y?(h.y=r.y,c=!0):r.y>f.y&&(f.y=r.y,c=!0),((0===r.x||r.x===Ht)&&r.x===a.x)!=((0===r.y||r.y===Ht)&&r.y===a.y)&&this.processBorderOverlap(r,a),c&&this.checkBorderIntersection(r,a)}checkBorderIntersection(r,a){a.x<0!=r.x<0&&this.addBorderIntersection(0,mn(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Ht!=r.x>Ht&&this.addBorderIntersection(1,mn(a.y,r.y,(Ht-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,mn(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Ht!=r.y>Ht&&this.addBorderIntersection(3,mn(a.x,r.x,(Ht-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((a,c)=>a+c.edges,0);return 0!==r?this.acc.div(r)._round():new at(0,0)}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class mf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new mc,this.centroidVertexArray=new mu,this.indexArray=new Gi,this.programConfigurations=new Oa(r.layers,r.zoom),this.segments=new Er,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,c,h){this.features=[],this.hasPattern=Eu("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/Ht/(1<<f.z)}(c);for(const{feature:f,id:_,index:x,sourceLayerIndex:C}of r){const T=this.layers[0]._featureFilter.needGeometry,I=xc(f,T);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),I,c))continue;const S={id:_,sourceLayerIndex:C,index:x,geometry:T?I.geometry:ea(f,c,h),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(uf("fill-extrusion",this.layers,S,this.zoom,a)):this.addFeature(S,S.geometry,x,c,{},a.availableImages),a.featureIndex.insert(f,S.geometry,x,C,this.index,P)}this.sortBorders()}addFeatures(r,a,c,h){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,a,c,h)}this.sortBorders()}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zx),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Fx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,h,f,_){const x=this.enableTerrain?new ff:null;for(const T of cf(a,500)){let I=0,S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(C=T[0]).every(X=>X.x<=0)||C.every(X=>X.x>=Ht)||C.every(X=>X.y<=0)||C.every(X=>X.y>=Ht))continue;for(let X=0;X<T.length;X++){const ne=T[X];if(0===ne.length)continue;I+=ne.length;let ce=0;x&&x.startRing(ne[0]);for(let pe=0;pe<ne.length;pe++){const _e=ne[pe];if(pe>=1){const be=ne[pe-1];if(!yg(_e,be)){x&&x.append(_e,be),S.vertexLength+4>Er.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const we=_e.sub(be)._perp(),Fe=we.x/(Math.abs(we.x)+Math.abs(we.y)),Pe=we.y>0?1:0,tt=be.dist(_e);ce+tt>32768&&(ce=0),Sh(this.layoutVertexArray,_e.x,_e.y,Fe,Pe,0,0,ce),Sh(this.layoutVertexArray,_e.x,_e.y,Fe,Pe,0,1,ce),ce+=tt,Sh(this.layoutVertexArray,be.x,be.y,Fe,Pe,0,0,ce),Sh(this.layoutVertexArray,be.x,be.y,Fe,Pe,0,1,ce);const qe=S.vertexLength;this.indexArray.emplaceBack(qe,qe+2,qe+1),this.indexArray.emplaceBack(qe+1,qe+2,qe+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+I>Er.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==Oy[r.type])continue;const P=[],z=[],N=S.vertexLength;for(let X=0;X<T.length;X++){const ne=T[X];if(0!==ne.length){ne!==T[0]&&z.push(P.length/2);for(let ce=0;ce<ne.length;ce++){const pe=ne[ce];Sh(this.layoutVertexArray,pe.x,pe.y,0,0,1,1,0),P.push(pe.x),P.push(pe.y),x&&x.currentPolyCount.top++}}}const H=Ld(P,z);for(let X=0;X<H.length;X+=3)this.indexArray.emplaceBack(N+H[X],N+H[X+2],N+H[X+1]);S.primitiveLength+=H.length/3,S.vertexLength+=I}var C;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const T=x.borders,I=this.featuresOnBorder.push(x)-1;for(let S=0;S<4;S++)T[S][0]!==Number.MAX_VALUE&&this.borders[S].push(I)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,c)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,a,c=!0){let h,f;if(r)if(0!==r.y){const x=a.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(r.x+450)),f=0;else h=0,f=+c;let _=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let C=0;C<2*x.edges;C++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,h,f);for(let C=0;C<x.top;C++)this.centroidVertexArray.emplace(_++,h,f)}}}function yg(i,r){return i.x===r.x&&(i.x<0||i.x>Ht)||i.y===r.y&&(i.y<0||i.y>Ht)}ut("FillExtrusionBucket",mf,{omit:["layers","features"]}),ut("PartMetadata",ff);var Fy={paint:new Cr({"fill-extrusion-opacity":new ft(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ct(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zr(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ct(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ct(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ft(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ah(i,r){return i.x*r.x+i.y*r.y}function Nd(i,r){if(1===i.length){let a=0;const c=r[a++];let h;for(;!h||c.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const f=r[a],_=i[0],x=h.sub(c),C=f.sub(c),T=_.sub(c),I=Ah(x,x),S=Ah(x,C),P=Ah(C,C),z=Ah(T,x),N=Ah(T,C),H=I*P-S*S,X=(P*z-S*N)/H,ne=(I*N-S*z)/H,ce=c.z*(1-X-ne)+h.z*X+f.z*ne;if(isFinite(ce))return ce}return 1/0}{let a=1/0;for(const c of r)a=Math.min(a,c.z);return a}}function vg(i){const r=new at(i[0],i[1]);return r.z=i[2],r}function zy(i,r,a,c,h,f,_,x){const C=_*h.getElevationAt(i,r,!0,!0),T=0!==f[0],I=T?0===f[1]?_*(f[0]/7-450):_*function(S,P,z){const N=Math.floor(P[0]/8),H=Math.floor(P[1]/8),X=10*(P[0]-8*N),ne=10*(P[1]-8*H),ce=S.getElevationAt(N,H,!0,!0),pe=S.getMeterToDEM(z),_e=Math.floor(.5*(X*pe-1)),be=Math.floor(.5*(ne*pe-1)),we=S.tileCoordToPixel(N,H),Fe=2*_e+1,Pe=2*be+1,tt=(Un=Fe,Ft=Pe,[(ct=S).getElevationAtPixel(dt=we.x-_e,un=we.y-be,!0),ct.getElevationAtPixel(dt+Ft,un,!0),ct.getElevationAtPixel(dt,un+Ft,!0),ct.getElevationAtPixel(dt+Un,un+Ft,!0)]),qe=Math.abs(tt[0]-tt[1]),Le=Math.abs(tt[2]-tt[3]),Ke=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),ot=Math.min(.25,.5*pe*(qe+Le)/Fe),Ue=Math.min(.25,.5*pe*Ke/Pe);var ct,dt,un,Un,Ft;return ce+Math.max(ot*X,Ue*ne)}(h,f,x):C;return{base:C+(0===a)?-1:a,top:T?Math.max(I+c,C+a+2):C+c}}const gf=rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:By}=gf,Ny=rr([{name:"a_packed",components:3,type:"Float32"}]),{members:Ph}=Ny,Uy=bc.VectorTileFeature.types,jy=Math.cos(Math.PI/180*37.5);class Ud{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new _d,this.layoutVertexArray2=new du,this.indexArray=new Gi,this.programConfigurations=new Oa(r.layers,r.zoom),this.segments=new Er,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){this.hasPattern=Eu("line",this.layers,a);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:S,index:P,sourceLayerIndex:z}of r){const N=this.layers[0]._featureFilter.needGeometry,H=xc(I,N);if(!this.layers[0]._featureFilter.filter(new Ot(this.zoom),H,c))continue;const X=f?f.evaluate(H,{},c):void 0,ne={id:S,properties:I.properties,type:I.type,sourceLayerIndex:z,index:P,geometry:N?H.geometry:ea(I,c,h),patterns:{},sortKey:X};_.push(ne)}f&&_.sort((I,S)=>I.sortKey-S.sortKey);const{lineAtlas:x,featureIndex:C}=a,T=this.addConstantDashes(x);for(const I of _){const{geometry:S,index:P,sourceLayerIndex:z}=I;if(T&&this.addFeatureDashes(I,x),this.hasPattern){const N=uf("line",this.layers,I,this.zoom,a);this.patternFeatures.push(N)}else this.addFeature(I,S,P,c,x.positions,a.availableImages);C.insert(r[P].feature,S,P,z,this.index)}}addConstantDashes(r){let a=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)a=!0;else{const _=f.value,x=h.value;if(!x)continue;r.addDash(x.from,_),r.addDash(x.to,_),x.other&&r.addDash(x.other,_)}}return a}addFeatureDashes(r,a){const c=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===_.kind)continue;let x,C,T,I,S,P;if("constant"===f.kind){const X=f.value;if(!X)continue;x=X.other||X.to,C=X.to,T=X.from}else x=f.evaluate({zoom:c-1},r),C=f.evaluate({zoom:c},r),T=f.evaluate({zoom:c+1},r);"constant"===_.kind?I=S=P=_.value:(I=_.evaluate({zoom:c-1},r),S=_.evaluate({zoom:c},r),P=_.evaluate({zoom:c+1},r)),a.addDash(x,I),a.addDash(C,S),a.addDash(T,P);const z=a.getKey(x,I),N=a.getKey(C,S),H=a.getKey(T,P);r.patterns[h.id]={min:z,mid:N,max:H}}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Ph)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,By),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,c,h,f,_){const x=this.layers[0].layout,C=x.get("line-join").evaluate(r,{}),T=x.get("line-cap").evaluate(r,{}),I=x.get("line-miter-limit"),S=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const P of a)this.addLine(P,r,C,T,I,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}addLine(r,a,c,h,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<r.length-1;ne++)this.totalDistance+=r[ne].dist(r[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Uy[a.type];let C=r.length;for(;C>=2&&r[C-1].equals(r[C-2]);)C--;let T=0;for(;T<C-1&&r[T].equals(r[T+1]);)T++;if(C<(x?3:2))return;"bevel"===c&&(f=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let P,z,N,H,X;this.e1=this.e2=-1,x&&(P=r[C-2],X=r[T].sub(P)._unit()._perp());for(let ne=T;ne<C;ne++){if(N=ne===C-1?x?r[T+1]:void 0:r[ne+1],N&&r[ne].equals(N))continue;X&&(H=X),P&&(z=P),P=r[ne],X=N?N.sub(P)._unit()._perp():H,H=H||X;let ce=H.add(X);0===ce.x&&0===ce.y||ce._unit();const pe=H.x*X.x+H.y*X.y,_e=ce.x*X.x+ce.y*X.y,be=0!==_e?1/_e:1/0,we=2*Math.sqrt(2-2*_e),Fe=_e<jy&&z&&N,Pe=H.x*X.y-H.y*X.x>0;if(Fe&&ne>T){const Le=P.dist(z);if(Le>2*I){const Ke=P.sub(P.sub(z)._mult(I/Le)._round());this.updateDistance(z,Ke),this.addCurrentVertex(Ke,H,0,0,S),z=Ke}}const tt=z&&N;let qe=tt?c:x?"butt":h;if(tt&&"round"===qe&&(be<_?qe="miter":be<=2&&(qe="fakeround")),"miter"===qe&&be>f&&(qe="bevel"),"bevel"===qe&&(be>2&&(qe="flipbevel"),be<f&&(qe="miter")),z&&this.updateDistance(z,P),"miter"===qe)ce._mult(be),this.addCurrentVertex(P,ce,0,0,S);else if("flipbevel"===qe){if(be>100)ce=X.mult(-1);else{const Le=be*H.add(X).mag()/H.sub(X).mag();ce._perp()._mult(Le*(Pe?-1:1))}this.addCurrentVertex(P,ce,0,0,S),this.addCurrentVertex(P,ce.mult(-1),0,0,S)}else if("bevel"===qe||"fakeround"===qe){const Le=-Math.sqrt(be*be-1),Ke=Pe?Le:0,ot=Pe?0:Le;if(z&&this.addCurrentVertex(P,H,Ke,ot,S),"fakeround"===qe){const Ue=Math.round(180*we/Math.PI/20);for(let ct=1;ct<Ue;ct++){let dt=ct/Ue;if(.5!==dt){const Un=dt-.5;dt+=dt*Un*(dt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Un*Un+(.848013+pe*(.215638*pe-1.06021)))}const un=X.sub(H)._mult(dt)._add(H)._unit()._mult(Pe?-1:1);this.addHalfVertex(P,un.x,un.y,!1,Pe,0,S)}}N&&this.addCurrentVertex(P,X,-Ke,-ot,S)}else if("butt"===qe)this.addCurrentVertex(P,ce,0,0,S);else if("square"===qe){const Le=z?1:-1;z||this.addCurrentVertex(P,ce,Le,Le,S),this.addCurrentVertex(P,ce,0,0,S),z&&this.addCurrentVertex(P,ce,Le,Le,S)}else"round"===qe&&(z&&(this.addCurrentVertex(P,H,0,0,S),this.addCurrentVertex(P,H,1,1,S,!0)),N&&(this.addCurrentVertex(P,X,-1,-1,S,!0),this.addCurrentVertex(P,X,0,0,S)));if(Fe&&ne<C-1){const Le=P.dist(N);if(Le>2*I){const Ke=P.add(N.sub(P)._mult(I/Le)._round());this.updateDistance(P,Ke),this.addCurrentVertex(Ke,X,0,0,S),P=Ke}}}}addCurrentVertex(r,a,c,h,f,_=!1){const x=a.y*h-a.x,C=-a.y-a.x*h;this.addHalfVertex(r,a.x+a.y*c,a.y-a.x*c,_,!1,c,f),this.addHalfVertex(r,x,C,_,!0,-h,f)}addHalfVertex({x:r,y:a},c,h,f,_,x,C){this.layoutVertexArray.emplaceBack((r<<1)+(f?1:0),(a<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),C.primitiveLength++),_?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}ut("LineBucket",Ud,{omit:["layers","patternFeatures"]});const Vy=new Cr({"line-cap":new Ct(Se.layout_line["line-cap"]),"line-join":new Ct(Se.layout_line["line-join"]),"line-miter-limit":new ft(Se.layout_line["line-miter-limit"]),"line-round-limit":new ft(Se.layout_line["line-round-limit"]),"line-sort-key":new Ct(Se.layout_line["line-sort-key"])});var xg={paint:new Cr({"line-opacity":new Ct(Se.paint_line["line-opacity"]),"line-color":new Ct(Se.paint_line["line-color"]),"line-translate":new ft(Se.paint_line["line-translate"]),"line-translate-anchor":new ft(Se.paint_line["line-translate-anchor"]),"line-width":new Ct(Se.paint_line["line-width"]),"line-gap-width":new Ct(Se.paint_line["line-gap-width"]),"line-offset":new Ct(Se.paint_line["line-offset"]),"line-blur":new Ct(Se.paint_line["line-blur"]),"line-dasharray":new zr(Se.paint_line["line-dasharray"]),"line-pattern":new zr(Se.paint_line["line-pattern"]),"line-gradient":new Ks(Se.paint_line["line-gradient"])}),layout:Vy};const _f=new class extends Ct{possiblyEvaluate(i,r){return r=new Ot(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,a,c){return r=ur({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,a,c)}}(xg.paint.properties["line-width"].specification);function bg(i,r){return r>0?r+2*i:i}_f.useIntegerZoom=!0;const $y=rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Gy=rr([{name:"a_projected_pos",components:3,type:"Float32"}],4);rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hy=rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),qy=rr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);rr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wg=rr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zy=rr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);rr([{name:"triangle",components:3,type:"Uint16"}]),rr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),rr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),rr([{type:"Float32",name:"offsetX"}]),rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const qi=128;function ts(i,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Ot(i+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:h}=a;let f=0;for(;f<c.length&&c[f]<=i;)f++;f=Math.max(0,f-1);let _=f;for(;_<c.length&&c[_]<i+1;)_++;_=Math.min(c.length-1,_);const x=c[f],C=c[_];return"composite"===a.kind?{kind:"composite",minZoom:x,maxZoom:C,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:C,minSize:a.evaluate(new Ot(x)),maxSize:a.evaluate(new Ot(C)),interpolationType:h}}}function yf(i,{uSize:r,uSizeT:a},{lowerSize:c,upperSize:h}){return"source"===i.kind?c/qi:"composite"===i.kind?mn(c/qi,h/qi,a):r}function kh(i,r){let a=0,c=0;if("constant"===i.kind)c=i.layoutSize;else if("source"!==i.kind){const{interpolationType:h,minZoom:f,maxZoom:_}=i,x=h?Ln(ni.interpolationFactor(h,r,f,_),0,1):0;"camera"===i.kind?c=mn(i.minSize,i.maxSize,x):a=x}return{uSizeT:a,uSize:c}}var Cg=Object.freeze({__proto__:null,getSizeData:ts,evaluateSizeForFeature:yf,evaluateSizeForZoom:kh,SIZE_PACK_FACTOR:qi});function Bx(i,r,a){return i.sections.forEach(c=>{c.text=function(h,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),cn.applyArabicShaping&&(h=cn.applyArabicShaping(h)),h}(c.text,r,a)}),i}const Di={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function vf(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function xf(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var Eg=function(i,r,a,c,h){var f,_,x=8*h-c-1,C=(1<<x)-1,T=C>>1,I=-7,S=a?h-1:0,P=a?-1:1,z=i[r+S];for(S+=P,f=z&(1<<-I)-1,z>>=-I,I+=x;I>0;f=256*f+i[r+S],S+=P,I-=8);for(_=f&(1<<-I)-1,f>>=-I,I+=c;I>0;_=256*_+i[r+S],S+=P,I-=8);if(0===f)f=1-T;else{if(f===C)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,c),f-=T}return(z?-1:1)*_*Math.pow(2,f-c)},bf=function(i,r,a,c,h,f){var _,x,C,T=8*f-h-1,I=(1<<T)-1,S=I>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=c?0:f-1,N=c?1:-1,H=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,_=I):(_=Math.floor(Math.log(r)/Math.LN2),r*(C=Math.pow(2,-_))<1&&(_--,C*=2),(r+=_+S>=1?P/C:P*Math.pow(2,1-S))*C>=2&&(_++,C/=2),_+S>=I?(x=0,_=I):_+S>=1?(x=(r*C-1)*Math.pow(2,h),_+=S):(x=r*Math.pow(2,S-1)*Math.pow(2,h),_=0));h>=8;i[a+z]=255&x,z+=N,x/=256,h-=8);for(_=_<<h|x,T+=h;T>0;i[a+z]=255&_,z+=N,_/=256,T-=8);i[a+z-N]|=128*H},Na=Fn;function Fn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Fn.Varint=0,Fn.Fixed64=1,Fn.Bytes=2,Fn.Fixed32=5;var jd=4294967296,Vd=1/jd,$d="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function na(i){return i.type===Fn.Bytes?i.readVarint()+i.pos:i.pos+1}function wc(i,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var h=a.pos-1;h>=i;h--)a.buf[h+c]=a.buf[h]}function wf(i,r){for(var a=0;a<i.length;a++)r.writeVarint(i[a])}function Tg(i,r){for(var a=0;a<i.length;a++)r.writeSVarint(i[a])}function Wy(i,r){for(var a=0;a<i.length;a++)r.writeFloat(i[a])}function Cf(i,r){for(var a=0;a<i.length;a++)r.writeDouble(i[a])}function Xy(i,r){for(var a=0;a<i.length;a++)r.writeBoolean(i[a])}function Ky(i,r){for(var a=0;a<i.length;a++)r.writeFixed32(i[a])}function Yy(i,r){for(var a=0;a<i.length;a++)r.writeSFixed32(i[a])}function Jy(i,r){for(var a=0;a<i.length;a++)r.writeFixed64(i[a])}function Qy(i,r){for(var a=0;a<i.length;a++)r.writeSFixed64(i[a])}function Gd(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+16777216*i[r+3]}function Cc(i,r,a){i[a]=r,i[a+1]=r>>>8,i[a+2]=r>>>16,i[a+3]=r>>>24}function Hd(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+(i[r+3]<<24)}function Dg(i,r,a){r.glyphs=[],1===i&&a.readMessage(Ef,r)}function Ef(i,r,a){if(3===i){const{id:c,bitmap:h,width:f,height:_,left:x,top:C,advance:T}=a.readMessage(ev,{});r.glyphs.push({id:c,bitmap:new zl({width:f+6,height:_+6},h),metrics:{width:f,height:_,left:x,top:C,advance:T}})}else 4===i?r.ascender=a.readSVarint():5===i&&(r.descender=a.readSVarint())}function ev(i,r,a){1===i?r.id=a.readVarint():2===i?r.bitmap=a.readBytes():3===i?r.width=a.readVarint():4===i?r.height=a.readVarint():5===i?r.left=a.readSVarint():6===i?r.top=a.readSVarint():7===i&&(r.advance=a.readVarint())}function Tf(i){let r=0,a=0;for(const _ of i)r+=_.w*_.h,a=Math.max(a,_.w);i.sort((_,x)=>x.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,f=0;for(const _ of i)for(let x=c.length-1;x>=0;x--){const C=c[x];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,f=Math.max(f,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===C.w&&_.h===C.h){const T=c.pop();x<c.length&&(c[x]=T)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(c.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:h,h:f,fill:r/(h*f)||0}}Fn.prototype={destroy:function(){this.buf=null},readFields:function(i,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),h=c>>3,f=this.pos;this.type=7&c,i(h,r,this),this.pos===f&&this.skip(c)}return r},readMessage:function(i,r){return this.readFields(i,r,this.readVarint()+this.pos)},readFixed32:function(){var i=Gd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Hd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Gd(this.buf,this.pos)+Gd(this.buf,this.pos+4)*jd;return this.pos+=8,i},readSFixed64:function(){var i=Gd(this.buf,this.pos)+Hd(this.buf,this.pos+4)*jd;return this.pos+=8,i},readFloat:function(){var i=Eg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Eg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(h,f,_){var x,C,T=_.buf;if(x=(112&(C=T[_.pos++]))>>4,C<128||(x|=(127&(C=T[_.pos++]))<<3,C<128)||(x|=(127&(C=T[_.pos++]))<<10,C<128)||(x|=(127&(C=T[_.pos++]))<<17,C<128)||(x|=(127&(C=T[_.pos++]))<<24,C<128)||(x|=(1&(C=T[_.pos++]))<<31,C<128))return function Rh(i,r,a){return a?4294967296*r+(i>>>0):4294967296*(r>>>0)+(i>>>0)}(h,x,f);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,r=this.pos;return this.pos=i,i-r>=12&&$d?$d.decode(this.buf.subarray(r,i)):function(a,c,h){for(var f="",_=c;_<h;){var x,C,T,I=a[_],S=null,P=I>239?4:I>223?3:I>191?2:1;if(_+P>h)break;1===P?I<128&&(S=I):2===P?128==(192&(x=a[_+1]))&&(S=(31&I)<<6|63&x)<=127&&(S=null):3===P?(C=a[_+2],128==(192&(x=a[_+1]))&&128==(192&C)&&((S=(15&I)<<12|(63&x)<<6|63&C)<=2047||S>=55296&&S<=57343)&&(S=null)):4===P&&(C=a[_+2],T=a[_+3],128==(192&(x=a[_+1]))&&128==(192&C)&&128==(192&T)&&((S=(15&I)<<18|(63&x)<<12|(63&C)<<6|63&T)<=65535||S>=1114112)&&(S=null)),null===S?(S=65533,P=1):S>65535&&(S-=65536,f+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),f+=String.fromCharCode(S),_+=P}return f}(this.buf,r,i)},readBytes:function(){var i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r},readPackedVarint:function(i,r){if(this.type!==Fn.Bytes)return i.push(this.readVarint(r));var a=na(this);for(i=i||[];this.pos<a;)i.push(this.readVarint(r));return i},readPackedSVarint:function(i){if(this.type!==Fn.Bytes)return i.push(this.readSVarint());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Fn.Bytes)return i.push(this.readBoolean());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Fn.Bytes)return i.push(this.readFloat());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Fn.Bytes)return i.push(this.readDouble());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Fn.Bytes)return i.push(this.readFixed32());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Fn.Bytes)return i.push(this.readSFixed32());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Fn.Bytes)return i.push(this.readFixed64());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Fn.Bytes)return i.push(this.readSFixed64());var r=na(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed64());return i},skip:function(i){var r=7&i;if(r===Fn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Fn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Fn.Fixed32)this.pos+=4;else{if(r!==Fn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(i,r){this.writeVarint(i<<3|r)},realloc:function(i){for(var r=this.length||16;r<this.pos+i;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Cc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Cc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Cc(this.buf,-1&i,this.pos),Cc(this.buf,Math.floor(i*Vd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Cc(this.buf,-1&i,this.pos),Cc(this.buf,Math.floor(i*Vd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(r,a){var c,h,f,x;if(r>=0?(c=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),f=c,(x=a).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(h,a)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var r=this.pos;this.pos=function(c,h,f){for(var _,x,C=0;C<h.length;C++){if((_=h.charCodeAt(C))>55295&&_<57344){if(!x){_>56319||C+1===h.length?(c[f++]=239,c[f++]=191,c[f++]=189):x=_;continue}if(_<56320){c[f++]=239,c[f++]=191,c[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(c[f++]=239,c[f++]=191,c[f++]=189,x=null);_<128?c[f++]=_:(_<2048?c[f++]=_>>6|192:(_<65536?c[f++]=_>>12|224:(c[f++]=_>>18|240,c[f++]=_>>12&63|128),c[f++]=_>>6&63|128),c[f++]=63&_|128)}return f}(this.buf,i,this.pos);var a=this.pos-r;a>=128&&wc(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(i){this.realloc(4),bf(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),bf(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var r=i.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=i[a]},writeRawMessage:function(i,r){this.pos++;var a=this.pos;i(r,this);var c=this.pos-a;c>=128&&wc(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,r,a){this.writeTag(i,Fn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(i,r){r.length&&this.writeMessage(i,wf,r)},writePackedSVarint:function(i,r){r.length&&this.writeMessage(i,Tg,r)},writePackedBoolean:function(i,r){r.length&&this.writeMessage(i,Xy,r)},writePackedFloat:function(i,r){r.length&&this.writeMessage(i,Wy,r)},writePackedDouble:function(i,r){r.length&&this.writeMessage(i,Cf,r)},writePackedFixed32:function(i,r){r.length&&this.writeMessage(i,Ky,r)},writePackedSFixed32:function(i,r){r.length&&this.writeMessage(i,Yy,r)},writePackedFixed64:function(i,r){r.length&&this.writeMessage(i,Jy,r)},writePackedSFixed64:function(i,r){r.length&&this.writeMessage(i,Qy,r)},writeBytesField:function(i,r){this.writeTag(i,Fn.Bytes),this.writeBytes(r)},writeFixed32Field:function(i,r){this.writeTag(i,Fn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(i,r){this.writeTag(i,Fn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(i,r){this.writeTag(i,Fn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(i,r){this.writeTag(i,Fn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(i,r){this.writeTag(i,Fn.Varint),this.writeVarint(r)},writeSVarintField:function(i,r){this.writeTag(i,Fn.Varint),this.writeSVarint(r)},writeStringField:function(i,r){this.writeTag(i,Fn.Bytes),this.writeString(r)},writeFloatField:function(i,r){this.writeTag(i,Fn.Fixed32),this.writeFloat(r)},writeDoubleField:function(i,r){this.writeTag(i,Fn.Fixed64),this.writeDouble(r)},writeBooleanField:function(i,r){this.writeVarintField(i,Boolean(r))}};class qd{constructor(r,{pixelRatio:a,version:c,stretchX:h,stretchY:f,content:_}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=h,this.stretchY=f,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Df{constructor(r,a){const c={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(r,c,f),this.addImages(a,h,f);const{w:_,h:x}=Tf(f),C=new Ro({width:_||1,height:x||1});for(const T in r){const I=r[T],S=c[T].paddedRect;Ro.copy(I.data,C,{x:0,y:0},{x:S.x+1,y:S.y+1},I.data)}for(const T in a){const I=a[T],S=h[T].paddedRect,P=S.x+1,z=S.y+1,N=I.data.width,H=I.data.height;Ro.copy(I.data,C,{x:0,y:0},{x:P,y:z},I.data),Ro.copy(I.data,C,{x:0,y:H-1},{x:P,y:z-1},{width:N,height:1}),Ro.copy(I.data,C,{x:0,y:0},{x:P,y:z+H},{width:N,height:1}),Ro.copy(I.data,C,{x:N-1,y:0},{x:P-1,y:z},{width:1,height:H}),Ro.copy(I.data,C,{x:0,y:0},{x:P+N,y:z},{width:1,height:H})}this.image=C,this.iconPositions=c,this.patternPositions=h}addImages(r,a,c){for(const h in r){const f=r[h],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};c.push(_),a[h]=new qd(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,a){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),a)}patchUpdatedImage(r,a,c){if(!r||!a||r.version===a.version)return;r.version=a.version;const[h,f]=r.tl;c.update(a.data,void 0,{x:h,y:f})}}ut("ImagePosition",qd),ut("ImageAtlas",Df);const ri={horizontal:1,vertical:2,horizontalOnly:3};class Du{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const c=new Du;return c.scale=r||1,c.fontStack=a,c}static forImage(r){const a=new Du;return a.imageName=r,a}}class Ec{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const c=new Ec;for(let h=0;h<r.sections.length;h++){const f=r.sections[h];f.image?c.addImageSection(f):c.addTextSection(f,a)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,c){let h="";for(let f=0;f<a.length;f++){const _=a.charCodeAt(f+1)||null,x=a.charCodeAt(f-1)||null;h+=!c&&(_&&mt(_)&&!Di[a[f+1]]||x&&mt(x)&&!Di[a[f-1]])||!Di[a[f]]?a[f]:Di[a[f]]}return h}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&Tc[this.text.charCodeAt(c)];c++)r++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&Tc[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const c=new Ec;return c.text=this.text.substring(r,a),c.sectionIndex=this.sectionIndex.slice(r,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(Du.forText(r.scale,r.fontStack||a));const c=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(c)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void sr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Du.forImage(a)),this.sectionIndex.push(this.sections.length-1)):sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mf(i,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H){const X=Ec.fromFeature(i,h);let ne;S===ri.vertical&&X.verticalizePunctuation(P);const{processBidirectionalText:ce,processStyledBidirectionalText:pe}=cn;if(ce&&1===X.sections.length){ne=[];const we=ce(X.toString(),Mu(X,T,f,r,c,z,N));for(const Fe of we){const Pe=new Ec;Pe.text=Fe,Pe.sections=X.sections;for(let tt=0;tt<Fe.length;tt++)Pe.sectionIndex.push(0);ne.push(Pe)}}else if(pe){ne=[];const we=pe(X.text,X.sectionIndex,Mu(X,T,f,r,c,z,N));for(const Fe of we){const Pe=new Ec;Pe.text=Fe[0],Pe.sectionIndex=Fe[1],Pe.sections=X.sections,ne.push(Pe)}}else ne=function(we,Fe){const Pe=[],tt=we.text;let qe=0;for(const Le of Fe)Pe.push(we.substring(qe,Le)),qe=Le;return qe<tt.length&&Pe.push(we.substring(qe,tt.length)),Pe}(X,Mu(X,T,f,r,c,z,N));const _e=[],be={positionedLines:_e,text:X.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(we,Fe,Pe,tt,qe,Le,Ke,ot,Ue,ct,dt,un){let Un=0,Ft=0,sn=0;const Ze="right"===ot?1:"left"===ot?0:.5;let vn=!1;for(const bn of qe){const tn=bn.getSections();for(const ir of tn){if(ir.imageName)continue;const mr=Fe[ir.fontStack];if(mr&&(vn=void 0!==mr.ascender&&void 0!==mr.descender,!vn))break}if(!vn)break}let pn=0;for(const bn of qe){bn.trim();const tn=bn.getMaxScale(),ir=24*(tn-1),mr={positionedGlyphs:[],lineOffset:0};we.positionedLines[pn]=mr;const gr=mr.positionedGlyphs;let Sr=0;if(!bn.length()){Ft+=Le,++pn;continue}let Si=0,po=0;for(let Qn=0;Qn<bn.length();Qn++){const Br=bn.getSection(Qn),Oo=bn.getSectionIndex(Qn),mi=bn.getCharCode(Qn);let nn=Br.scale,ii=null,or=null,gi=null,Ar=24,_i=0;const Ni=!(Ue===ri.horizontal||!dt&&!Oe(mi)||dt&&(Tc[mi]||(fr=mi,o(fr)||u(fr)||g(fr)||ue(fr)||Ge(fr))));if(Br.imageName){const Zi=tt[Br.imageName];if(!Zi)continue;gi=Br.imageName,we.iconsInText=we.iconsInText||!0,or=Zi.paddedRect;const Nr=Zi.displaySize;nn=24*nn/un,ii={width:Nr[0],height:Nr[1],left:1,top:-3,advance:Ni?Nr[1]:Nr[0],localGlyph:!1},_i=vn?-ii.height*nn:24*tn-17-Nr[1]*nn,Ar=ii.advance;const os=(Ni?Nr[0]:Nr[1])*nn-24*tn;os>0&&os>Sr&&(Sr=os)}else{const Zi=Pe[Br.fontStack];if(!Zi)continue;Zi[mi]&&(or=Zi[mi]);const Nr=Fe[Br.fontStack];if(!Nr)continue;const os=Nr.glyphs[mi];if(!os)continue;if(ii=os.metrics,Ar=8203!==mi?24:0,vn){const Uu=void 0!==Nr.ascender?Math.abs(Nr.ascender):0,Pc=void 0!==Nr.descender?Math.abs(Nr.descender):0,Vh=(Uu+Pc)*nn;Si<Vh&&(Si=Vh,po=(Uu-Pc)/2*nn),_i=-Uu*nn}else _i=24*(tn-nn)-17}Ni?(we.verticalizable=!0,gr.push({glyph:mi,imageName:gi,x:Un,y:Ft+_i,vertical:Ni,scale:nn,localGlyph:ii.localGlyph,fontStack:Br.fontStack,sectionIndex:Oo,metrics:ii,rect:or}),Un+=Ar*nn+ct):(gr.push({glyph:mi,imageName:gi,x:Un,y:Ft+_i,vertical:Ni,scale:nn,localGlyph:ii.localGlyph,fontStack:Br.fontStack,sectionIndex:Oo,metrics:ii,rect:or}),Un+=ii.advance*nn+ct)}0!==gr.length&&(sn=Math.max(Un-ct,sn),vn?Pf(gr,Ze,Sr,po,Le*tn/2):Pf(gr,Ze,Sr,0,Le/2)),Un=0;const Ai=Le*tn+Sr;mr.lineOffset=Math.max(Sr,ir),Ft+=Ai,++pn}var fr;const cr=Ft,{horizontalAlign:Yr,verticalAlign:Ii}=Iu(Ke);(function(bn,tn,ir,mr,gr,Sr){const Si=(tn-ir)*gr,po=-Sr*mr;for(const Ai of bn)for(const Qn of Ai.positionedGlyphs)Qn.x+=Si,Qn.y+=po})(we.positionedLines,Ze,Yr,Ii,sn,cr),we.top+=-Ii*cr,we.bottom=we.top+cr,we.left+=-Yr*sn,we.right=we.left+sn,we.hasBaseline=vn}(be,r,a,c,ne,_,x,C,S,T,P,H),!function(we){for(const Fe of we)if(0!==Fe.positionedGlyphs.length)return!1;return!0}(_e)&&be}const Tc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function If(i,r,a,c,h,f){if(r.imageName){const _=c[r.imageName];return _?_.displaySize[0]*r.scale*24/f+h:0}{const _=a[r.fontStack],x=_&&_.glyphs[i];return x?x.metrics.advance*r.scale+h:0}}function Sf(i,r,a,c){const h=Math.pow(i-r,2);return c?i<r?h/2:2*h:h+Math.abs(a)*a}function Mg(i,r,a){let c=0;return 10===i&&(c-=1e4),a&&(c+=150),40!==i&&65288!==i||(c+=50),41!==r&&65289!==r||(c+=50),c}function Zd(i,r,a,c,h,f){let _=null,x=Sf(r,a,h,f);for(const C of c){const T=Sf(r-C.x,a,h,f)+C.badness;T<=x&&(_=C,x=T)}return{index:i,x:r,priorBreak:_,badness:x}}function Af(i){return i?Af(i.priorBreak).concat(i.index):[]}function Mu(i,r,a,c,h,f,_){if("point"!==f)return[];if(!i)return[];const x=[],C=function(P,z,N,H,X,ne){let ce=0;for(let pe=0;pe<P.length();pe++){const _e=P.getSection(pe);ce+=If(P.getCharCode(pe),_e,H,X,z,ne)}return ce/Math.max(1,Math.ceil(ce/N))}(i,r,a,c,h,_),T=i.text.indexOf("\u200b")>=0;let I=0;for(let P=0;P<i.length();P++){const z=i.getSection(P),N=i.getCharCode(P);if(Tc[N]||(I+=If(N,z,c,h,r,_)),P<i.length()-1){const H=!((S=N)<11904||!(B(S)||L(S)||Ie(S)||ie(S)||Y(S)||v(S)||G(S)||M(S)||he(S)||W(S)||Z(S)||$e(S)||k(S)||E(S)||b(S)||K(S)||R(S)||ye(S)||le(S)||ae(S)));(tv[N]||H||z.imageName)&&x.push(Zd(P+1,I,C,x,Mg(N,i.getCharCode(P+1),H&&T),!1))}}var S;return Af(Zd(i.length(),I,C,x,0,!0))}function Iu(i){let r=.5,a=.5;switch(i){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Pf(i,r,a,c,h){if(!(r||a||c||h))return;const f=i.length-1,_=i[f],x=(_.x+_.metrics.advance*_.scale)*r;for(let C=0;C<=f;C++)i[C].x-=x,i[C].y+=a+c+h}function kf(i,r,a){const{horizontalAlign:c,verticalAlign:h}=Iu(a),f=r[0]-i.displaySize[0]*c,_=r[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Rf(i,r,a,c,h,f){const _=i.image;let x;if(_.content){const X=_.content,ne=_.pixelRatio||1;x=[X[0]/ne,X[1]/ne,_.displaySize[0]-X[2]/ne,_.displaySize[1]-X[3]/ne]}const C=r.left*f,T=r.right*f;let I,S,P,z;"width"===a||"both"===a?(z=h[0]+C-c[3],S=h[0]+T+c[1]):(z=h[0]+(C+T-_.displaySize[0])/2,S=z+_.displaySize[0]);const N=r.top*f,H=r.bottom*f;return"height"===a||"both"===a?(I=h[1]+N-c[0],P=h[1]+H+c[2]):(I=h[1]+(N+H-_.displaySize[1])/2,P=I+_.displaySize[1]),{image:_,top:I,right:S,bottom:P,left:z,collisionPadding:x}}class As extends at{constructor(r,a,c,h,f){super(r,a),this.angle=h,this.z=c,void 0!==f&&(this.segment=f)}clone(){return new As(this.x,this.y,this.z,this.angle,this.segment)}}function Su(i,r,a,c,h){if(void 0===r.segment)return!0;let f=r,_=r.segment+1,x=0;for(;x>-a/2;){if(_--,_<0)return!1;x-=i[_].dist(f),f=i[_]}x+=i[_].dist(i[_+1]),_++;const C=[];let T=0;for(;x<a/2;){const I=i[_],S=i[_+1];if(!S)return!1;let P=i[_-1].angleTo(I)-I.angleTo(S);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:x,angleDelta:P}),T+=P;x-C[0].distance>c;)T-=C.shift().angleDelta;if(T>h)return!1;_++,x+=I.dist(S)}return!0}function Ig(i){let r=0;for(let a=0;a<i.length-1;a++)r+=i[a].dist(i[a+1]);return r}function Lf(i,r,a){return i?.6*r*a:0}function Sg(i,r){return Math.max(i?i.right-i.left:0,r?r.right-r.left:0)}function nv(i,r,a,c,h,f){const _=Lf(a,h,f),x=Sg(a,c)*f;let C=0;const T=Ig(i)/2;for(let I=0;I<i.length-1;I++){const S=i[I],P=i[I+1],z=S.dist(P);if(C+z>T){const N=(T-C)/z,H=mn(S.x,P.x,N),X=mn(S.y,P.y,N),ne=new As(H,X,0,P.angleTo(S),I);return!_||Su(i,ne,x,_,r)?ne:void 0}C+=z}}function Ag(i,r,a,c,h,f,_,x,C){const T=Lf(c,f,_),I=Sg(c,h),S=I*_,P=0===i[0].x||i[0].x===C||0===i[0].y||i[0].y===C;return r-S<r/4&&(r=S+r/4),Wd(i,P?r/2*x%r:(I/2+2*f)*_*x%r,r,T,a,S,P,!1,C)}function Wd(i,r,a,c,h,f,_,x,C){const T=f/2,I=Ig(i);let S=0,P=r-a,z=[];for(let N=0;N<i.length-1;N++){const H=i[N],X=i[N+1],ne=H.dist(X),ce=X.angleTo(H);for(;P+a<S+ne;){P+=a;const pe=(P-S)/ne,_e=mn(H.x,X.x,pe),be=mn(H.y,X.y,pe);if(_e>=0&&_e<C&&be>=0&&be<C&&P-T>=0&&P+T<=I){const we=new As(_e,be,0,ce,N);we._round(),c&&!Su(i,we,f,c,h)||z.push(we)}}S+=ne}return x||z.length||_||(z=Wd(i,S/2,a,c,h,f,_,!0,C)),z}function Of(i,r,a,c,h){const f=[];for(let _=0;_<i.length;_++){const x=i[_];let C;for(let T=0;T<x.length-1;T++){let I=x[T],S=x[T+1];I.x<r&&S.x<r||(I.x<r?I=new at(r,I.y+(r-I.x)/(S.x-I.x)*(S.y-I.y))._round():S.x<r&&(S=new at(r,I.y+(r-I.x)/(S.x-I.x)*(S.y-I.y))._round()),I.y<a&&S.y<a||(I.y<a?I=new at(I.x+(a-I.y)/(S.y-I.y)*(S.x-I.x),a)._round():S.y<a&&(S=new at(I.x+(a-I.y)/(S.y-I.y)*(S.x-I.x),a)._round()),I.x>=c&&S.x>=c||(I.x>=c?I=new at(c,I.y+(c-I.x)/(S.x-I.x)*(S.y-I.y))._round():S.x>=c&&(S=new at(c,I.y+(c-I.x)/(S.x-I.x)*(S.y-I.y))._round()),I.y>=h&&S.y>=h||(I.y>=h?I=new at(I.x+(h-I.y)/(S.y-I.y)*(S.x-I.x),h)._round():S.y>=h&&(S=new at(I.x+(h-I.y)/(S.y-I.y)*(S.x-I.x),h)._round()),C&&I.equals(C[C.length-1])||(C=[I],f.push(C)),C.push(S)))))}}return f}ut("Anchor",As);const Xd=1e20;function Ff(i,r,a,c,h,f,_,x,C){for(let T=r;T<r+c;T++)Pg(i,a*f+T,f,h,_,x,C);for(let T=a;T<a+h;T++)Pg(i,T*f+r,1,c,_,x,C)}function Pg(i,r,a,c,h,f,_){f[0]=0,_[0]=-Xd,_[1]=Xd,h[0]=i[r];for(let x=1,C=0,T=0;x<c;x++){h[x]=i[r+x*a];const I=x*x;do{const S=f[C];T=(h[x]-h[S]+I-S*S)/(x-S)/2}while(T<=_[C]&&--C>-1);C++,f[C]=x,_[C]=T,_[C+1]=Xd}for(let x=0,C=0;x<c;x++){for(;_[C+1]<x;)C++;const T=f[C],I=x-T;i[r+x*a]=h[T]+I*I}}const Kd={none:0,ideographs:1,all:2};class Au{constructor(r,a,c){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const c=[];for(const h in r)for(const f of r[h])c.push({stack:h,id:f});Bs(c,({stack:h,id:f},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=x.glyphs[f];if(void 0!==C)return void _(null,{stack:h,id:f,glyph:C});if(C=this._tinySDF(x,h,f),C)return x.glyphs[f]=C,void _(null,{stack:h,id:f,glyph:C});const T=Math.floor(f/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void _(null,{stack:h,id:f,glyph:C});let I=x.requests[T];I||(I=x.requests[T]=[],Au.loadGlyphRange(h,T,this.url,this.requestManager,(S,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const z in P.glyphs)this._doesCharSupportLocalGlyph(+z)||(x.glyphs[+z]=P.glyphs[+z]);x.ranges[T]=!0}for(const z of I)z(S,P);delete x.requests[T]})),I.push((S,P)=>{S?_(S):P&&_(null,{stack:h,id:f,glyph:P.glyphs[f]||null})})},(h,f)=>{if(h)a(h);else if(f){const _={};for(const{stack:x,id:C,glyph:T}of f)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[C]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;a(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Kd.none&&(this.localGlyphMode===Kd.all?!!this.localFontFamily:!!this.localFontFamily&&(W(r)||se(r)||k(r)||R(r))||M(r))}_tinySDF(r,a,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let f=r.tinySDF;if(!f){let H="400";/bold/i.test(a)?H="900":/medium/i.test(a)?H="500":/light/i.test(a)&&(H="200"),f=r.tinySDF=new Au.TinySDF({fontFamily:h,fontWeight:H,fontSize:48,buffer:6,radius:16}),f.fontWeight=H}if(this.localGlyphs[f.fontWeight][c])return this.localGlyphs[f.fontWeight][c];const _=String.fromCharCode(c),{data:x,width:C,height:T,glyphWidth:I,glyphHeight:S,glyphLeft:P,glyphTop:z,glyphAdvance:N}=f.draw(_);return this.localGlyphs[f.fontWeight][c]={id:c,bitmap:new zl({width:C,height:T},x),metrics:{width:I/2,height:S/2,left:P/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function kg(i,r,a,c){const h=[],f=i.image,_=f.pixelRatio,x=f.paddedRect.w-2,C=f.paddedRect.h-2,T=i.right-i.left,I=i.bottom-i.top,S=f.stretchX||[[0,x]],P=f.stretchY||[[0,C]],z=(Le,Ke)=>Le+Ke[1]-Ke[0],N=S.reduce(z,0),H=P.reduce(z,0),X=x-N,ne=C-H;let ce=0,pe=N,_e=0,be=H,we=0,Fe=X,Pe=0,tt=ne;if(f.content&&c){const Le=f.content;ce=lo(S,0,Le[0]),_e=lo(P,0,Le[1]),pe=lo(S,Le[0],Le[2]),be=lo(P,Le[1],Le[3]),we=Le[0]-ce,Pe=Le[1]-_e,Fe=Le[2]-Le[0]-pe,tt=Le[3]-Le[1]-be}const qe=(Le,Ke,ot,Ue)=>{const ct=Lh(Le.stretch-ce,pe,T,i.left),dt=Yd(Le.fixed-we,Fe,Le.stretch,N),un=Lh(Ke.stretch-_e,be,I,i.top),Un=Yd(Ke.fixed-Pe,tt,Ke.stretch,H),Ft=Lh(ot.stretch-ce,pe,T,i.left),sn=Yd(ot.fixed-we,Fe,ot.stretch,N),Ze=Lh(Ue.stretch-_e,be,I,i.top),vn=Yd(Ue.fixed-Pe,tt,Ue.stretch,H),pn=new at(ct,un),fr=new at(Ft,un),cr=new at(Ft,Ze),Yr=new at(ct,Ze),Ii=new at(dt/_,Un/_),bn=new at(sn/_,vn/_),tn=r*Math.PI/180;if(tn){const gr=Math.sin(tn),Sr=Math.cos(tn),Si=[Sr,-gr,gr,Sr];pn._matMult(Si),fr._matMult(Si),Yr._matMult(Si),cr._matMult(Si)}const ir=Le.stretch+Le.fixed,mr=Ke.stretch+Ke.fixed;return{tl:pn,tr:fr,bl:Yr,br:cr,tex:{x:f.paddedRect.x+1+ir,y:f.paddedRect.y+1+mr,w:ot.stretch+ot.fixed-ir,h:Ue.stretch+Ue.fixed-mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ii,pixelOffsetBR:bn,minFontScaleX:Fe/_/T,minFontScaleY:tt/_/I,isSDF:a}};if(c&&(f.stretchX||f.stretchY)){const Le=Rg(S,X,N),Ke=Rg(P,ne,H);for(let ot=0;ot<Le.length-1;ot++){const Ue=Le[ot],ct=Le[ot+1];for(let dt=0;dt<Ke.length-1;dt++)h.push(qe(Ue,Ke[dt],ct,Ke[dt+1]))}}else h.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:C+1}));return h}function lo(i,r,a){let c=0;for(const h of i)c+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return c}function Rg(i,r,a){const c=[{fixed:-1,stretch:0}];for(const[h,f]of i){const _=c[c.length-1];c.push({fixed:h-_.stretch,stretch:_.stretch}),c.push({fixed:h-_.stretch,stretch:_.stretch+(f-h)})}return c.push({fixed:r+1,stretch:a}),c}function Lh(i,r,a,c){return i/r*a+c}function Yd(i,r,a,c){return i-r*a/c}function rv(i,r,a,c){const h=r+i.positionedLines[c].lineOffset;return 0===c?a+h/2:a+(h+(r+i.positionedLines[c-1].lineOffset))/2}Au.loadGlyphRange=function(i,r,a,c,h){const f=256*r,_=f+255,x=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",i).replace("{range}",`${f}-${_}`),il.Glyphs);_a(x,(C,T)=>{if(C)h(C);else if(T){const I={},S=new Na(T).readFields(Dg,{});for(const P of S.glyphs)I[P.id]=P;h(null,{glyphs:I,ascender:S.ascender,descender:S.descender})}})},Au.TinySDF=class{constructor({fontSize:i=24,buffer:r=3,radius:a=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}){this.buffer=r,this.cutoff=c,this.radius=a;const x=this.size=i+4*r,C=this._createCanvas(x),T=this.ctx=C.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${f} ${i}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const r=document.createElement("canvas");return r.width=r.height=i,r}draw(i){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(i),_=Math.floor(a),x=Math.min(this.size-this.buffer,Math.ceil(f-h)),C=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(c)),T=x+2*this.buffer,I=C+2*this.buffer,S=T*I,P=new Uint8ClampedArray(S),z={data:P,width:T,height:I,glyphWidth:x,glyphHeight:C,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===x||0===C)return z;const{ctx:N,buffer:H,gridInner:X,gridOuter:ne}=this;N.clearRect(H,H,x,C),N.fillText(i,H,H+_+1);const ce=N.getImageData(H,H,x,C);ne.fill(Xd,0,S),X.fill(0,0,S);for(let pe=0;pe<C;pe++)for(let _e=0;_e<x;_e++){const be=ce.data[4*(pe*x+_e)+3]/255;if(0===be)continue;const we=(pe+H)*T+_e+H;if(1===be)ne[we]=0,X[we]=Xd;else{const Fe=.5-be;ne[we]=Fe>0?Fe*Fe:0,X[we]=Fe<0?Fe*Fe:0}}Ff(ne,0,0,T,I,T,this.f,this.v,this.z),Ff(X,H,H,x,C,T,this.f,this.v,this.z);for(let pe=0;pe<S;pe++){const _e=Math.sqrt(ne[pe])-Math.sqrt(X[pe]);P[pe]=Math.round(255-255*(_e/this.radius+this.cutoff))}return z}};class iv{constructor(r=[],a=ov){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:c}=this,h=a[r];for(;r>0;){const f=r-1>>1,_=a[f];if(c(h,_)>=0)break;a[r]=_,r=f}a[r]=h}_down(r){const{data:a,compare:c}=this,h=this.length>>1,f=a[r];for(;r<h;){let _=1+(r<<1),x=a[_];const C=_+1;if(C<this.length&&c(a[C],x)<0&&(_=C,x=a[C]),c(x,f)>=0)break;a[r]=x,r=_}a[r]=f}}function ov(i,r){return i<r?-1:i>r?1:0}function Lg(i,r=1,a=!1){let c=1/0,h=1/0,f=-1/0,_=-1/0;const x=i[0];for(let z=0;z<x.length;z++){const N=x[z];(!z||N.x<c)&&(c=N.x),(!z||N.y<h)&&(h=N.y),(!z||N.x>f)&&(f=N.x),(!z||N.y>_)&&(_=N.y)}const C=Math.min(f-c,_-h);let T=C/2;const I=new iv([],sv);if(0===C)return new at(c,h);for(let z=c;z<f;z+=C)for(let N=h;N<_;N+=C)I.push(new Pu(z+T,N+T,T,i));let S=function(z){let N=0,H=0,X=0;const ne=z[0];for(let ce=0,pe=ne.length,_e=pe-1;ce<pe;_e=ce++){const be=ne[ce],we=ne[_e],Fe=be.x*we.y-we.x*be.y;H+=(be.x+we.x)*Fe,X+=(be.y+we.y)*Fe,N+=3*Fe}return new Pu(H/N,X/N,0,z)}(i),P=I.length;for(;I.length;){const z=I.pop();(z.d>S.d||!S.d)&&(S=z,a&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,P)),z.max-S.d<=r||(T=z.h/2,I.push(new Pu(z.p.x-T,z.p.y-T,T,i)),I.push(new Pu(z.p.x+T,z.p.y-T,T,i)),I.push(new Pu(z.p.x-T,z.p.y+T,T,i)),I.push(new Pu(z.p.x+T,z.p.y+T,T,i)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${S.d}`)),S.p}function sv(i,r){return r.max-i.max}function Pu(i,r,a,c){this.p=new at(i,r),this.h=a,this.d=function(h,f){let _=!1,x=1/0;for(let C=0;C<f.length;C++){const T=f[C];for(let I=0,S=T.length,P=S-1;I<S;P=I++){const z=T[I],N=T[P];z.y>h.y!=N.y>h.y&&h.x<(N.x-z.x)*(h.y-z.y)/(N.y-z.y)+z.x&&(_=!_),x=Math.min(x,ng(h,z,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const zf=Number.POSITIVE_INFINITY,Yt=Math.sqrt(2);function Mi(i,r){return r[1]!==zf?function(a,c,h){let f=0,_=0;switch(c=Math.abs(c),h=Math.abs(h),a){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(a){case"top-right":case"bottom-right":case"right":f=-c;break;case"top-left":case"bottom-left":case"left":f=c}return[f,_]}(i,r[0],r[1]):function(a,c){let h=0,f=0;c<0&&(c=0);const _=c/Yt;switch(a){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-c;break;case"top":f=c-7}switch(a){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=c;break;case"right":h=-c}return[h,f]}(i,r[0])}function Og(i,r,a,c,h,f,_,x,C,T){i.createArrays(),i.tilePixelRatio=Ht/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const I=i.layers[0].layout,S=i.layers[0]._unevaluatedLayout._values,P={};if("composite"===i.textSizeData.kind){const{minZoom:H,maxZoom:X}=i.textSizeData;P.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Ot(H),x),S["text-size"].possiblyEvaluate(new Ot(X),x)]}if("composite"===i.iconSizeData.kind){const{minZoom:H,maxZoom:X}=i.iconSizeData;P.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Ot(H),x),S["icon-size"].possiblyEvaluate(new Ot(X),x)]}P.layoutTextSize=S["text-size"].possiblyEvaluate(new Ot(C+1),x),P.layoutIconSize=S["icon-size"].possiblyEvaluate(new Ot(C+1),x),P.textMaxSize=S["text-size"].possiblyEvaluate(new Ot(18),x);const z="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),N=I.get("text-size");for(const H of i.features){const X=I.get("text-font").evaluate(H,{},x).join(","),ne=N.evaluate(H,{},x),ce=P.layoutTextSize.evaluate(H,{},x),pe=(P.layoutIconSize.evaluate(H,{},x),{horizontal:{},vertical:void 0}),_e=H.text;let be,we=[0,0];if(_e){const tt=_e.toString(),qe=24*I.get("text-letter-spacing").evaluate(H,{},x),Le=24*I.get("text-line-height").evaluate(H,{},x),Ke=Me(tt)?qe:0,ot=I.get("text-anchor").evaluate(H,{},x),Ue=I.get("text-variable-anchor");if(!Ue){const sn=I.get("text-radial-offset").evaluate(H,{},x);we=sn?Mi(ot,[24*sn,zf]):I.get("text-offset").evaluate(H,{},x).map(Ze=>24*Ze)}let ct=z?"center":I.get("text-justify").evaluate(H,{},x);const dt=I.get("symbol-placement"),un="point"===dt,Un="point"===dt?24*I.get("text-max-width").evaluate(H,{},x):0,Ft=sn=>{i.allowVerticalPlacement&&Ae(tt)&&(pe.vertical=Mf(_e,r,a,h,X,Un,Le,ot,sn,Ke,we,ri.vertical,!0,dt,ce,ne))};if(!z&&Ue){const sn="auto"===ct?Ue.map(vn=>Jd(vn)):[ct];let Ze=!1;for(let vn=0;vn<sn.length;vn++){const pn=sn[vn];if(!pe.horizontal[pn])if(Ze)pe.horizontal[pn]=pe.horizontal[0];else{const fr=Mf(_e,r,a,h,X,Un,Le,"center",pn,Ke,we,ri.horizontal,!1,dt,ce,ne);fr&&(pe.horizontal[pn]=fr,Ze=1===fr.positionedLines.length)}}Ft("left")}else{if("auto"===ct&&(ct=Jd(ot)),un||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ae(tt)){const sn=Mf(_e,r,a,h,X,Un,Le,ot,ct,Ke,we,ri.horizontal,!1,dt,ce,ne);sn&&(pe.horizontal[ct]=sn)}Ft("point"===dt?"left":ct)}}let Fe=!1;if(H.icon&&H.icon.name){const tt=c[H.icon.name];tt&&(be=kf(h[H.icon.name],I.get("icon-offset").evaluate(H,{},x),I.get("icon-anchor").evaluate(H,{},x)),Fe=tt.sdf,void 0===i.sdfIcons?i.sdfIcons=tt.sdf:i.sdfIcons!==tt.sdf&&sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==i.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const Pe=Fg(pe.horizontal)||pe.vertical;i.iconsInText||(i.iconsInText=!!Pe&&Pe.iconsInText),(Pe||be)&&Qd(i,H,pe,be,c,P,ce,0,we,Fe,_,x,T)}f&&i.generateCollisionDebugBuffers(C,i.collisionBoxArray)}function Jd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qd(i,r,a,c,h,f,_,x,C,T,I,S,P){let z=f.textMaxSize.evaluate(r,{},S);void 0===z&&(z=_);const N=i.layers[0].layout,H=N.get("icon-offset").evaluate(r,{},S),X=Fg(a.horizontal)||a.vertical,ne=_/24,ce=i.tilePixelRatio*z/24,pe=i.tilePixelRatio*N.get("symbol-spacing"),_e=N.get("text-padding")*i.tilePixelRatio,be=N.get("icon-padding")*i.tilePixelRatio,we=Jt(N.get("text-max-angle")),Fe="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Pe="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),tt=N.get("symbol-placement"),qe=pe/2,Le=N.get("icon-text-fit");let Ke;c&&"none"!==Le&&(i.allowVerticalPlacement&&a.vertical&&(Ke=Rf(c,a.vertical,Le,N.get("icon-text-fit-padding"),H,ne)),X&&(c=Rf(c,X,Le,N.get("icon-text-fit-padding"),H,ne)));const ot=(Ue,ct,dt)=>{if(ct.x<0||ct.x>=Ht||ct.y<0||ct.y>=Ht)return;const{x:un,y:Un,z:Ft}=P.projectTilePoint(ct.x,ct.y,dt),sn=new As(un,Un,Ft,0,void 0);!function(Ze,vn,pn,fr,cr,Yr,Ii,bn,tn,ir,mr,gr,Sr,Si,po,Ai,Qn,Br,Oo,mi,nn,ii,or,gi,Ar){const _i=Ze.addToLineVertexArray(vn,fr);let Ni,Zi,Nr,os,Uu,Pc,Vh,t_=0,n_=0,r_=0,i_=0,lm=-1,ju=-1;const Wi={};let o_=gu(""),kc=0,cm=0;if(void 0===tn._unevaluatedLayout.getValue("text-radial-offset")?[kc,cm]=tn.layout.get("text-offset").evaluate(nn,{},Ar).map(yi=>24*yi):(kc=24*tn.layout.get("text-radial-offset").evaluate(nn,{},Ar),cm=zf),Ze.allowVerticalPlacement&&cr.vertical){const yi=cr.vertical;if(po)Pc=Ps(yi),bn&&(Vh=Ps(bn));else{const Xn=tn.layout.get("text-rotate").evaluate(nn,{},Ar)+90;Nr=ku(ir,pn,vn,mr,gr,Sr,yi,Si,Xn,Ai),bn&&(os=ku(ir,pn,vn,mr,gr,Sr,bn,Br,Xn))}}if(Yr){const yi=tn.layout.get("icon-rotate").evaluate(nn,{},Ar),Xn="none"!==tn.layout.get("icon-text-fit"),Ls=kg(Yr,yi,or,Xn),Vu=bn?kg(bn,yi,or,Xn):void 0;Zi=ku(ir,pn,vn,mr,gr,Sr,Yr,Br,yi),t_=4*Ls.length;const Fo=Ze.iconSizeData;let $a=null;"source"===Fo.kind?($a=[qi*tn.layout.get("icon-size").evaluate(nn,{},Ar)],$a[0]>fi&&sr(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Fo.kind&&($a=[qi*ii.compositeIconSizes[0].evaluate(nn,{},Ar),qi*ii.compositeIconSizes[1].evaluate(nn,{},Ar)],($a[0]>fi||$a[1]>fi)&&sr(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,Ls,$a,mi,Oo,nn,!1,pn,vn,_i.lineStartIndex,_i.lineLength,-1,gi,Ar),lm=Ze.icon.placedSymbolArray.length-1,Vu&&(n_=4*Vu.length,Ze.addSymbols(Ze.icon,Vu,$a,mi,Oo,nn,ri.vertical,pn,vn,_i.lineStartIndex,_i.lineLength,-1,gi,Ar),ju=Ze.icon.placedSymbolArray.length-1)}for(const yi in cr.horizontal){const Xn=cr.horizontal[yi];Ni||(o_=gu(Xn.text),po?Uu=Ps(Xn):Ni=ku(ir,pn,vn,mr,gr,Sr,Xn,Si,tn.layout.get("text-rotate").evaluate(nn,{},Ar),Ai));const Ls=1===Xn.positionedLines.length;if(r_+=Bf(Ze,pn,vn,Xn,Ii,tn,po,nn,Ai,_i,cr.vertical?ri.horizontal:ri.horizontalOnly,Ls?Object.keys(cr.horizontal):[yi],Wi,lm,ii,gi,Ar),Ls)break}cr.vertical&&(i_+=Bf(Ze,pn,vn,cr.vertical,Ii,tn,po,nn,Ai,_i,ri.vertical,["vertical"],Wi,ju,ii,gi,Ar));let Hl=-1;const $h=(yi,Xn)=>yi?Math.max(yi,Xn):Xn;Hl=$h(Uu,Hl),Hl=$h(Pc,Hl),Hl=$h(Vh,Hl);const oa=Hl>-1?1:0;Ze.glyphOffsetArray.length>=ra.MAX_GLYPHS&&sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==nn.sortKey&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,nn.sortKey),Ze.symbolInstances.emplaceBack(pn.x,pn.y,pn.z,vn.x,vn.y,Wi.right>=0?Wi.right:-1,Wi.center>=0?Wi.center:-1,Wi.left>=0?Wi.left:-1,Wi.vertical>=0?Wi.vertical:-1,lm,ju,o_,void 0!==Ni?Ni:Ze.collisionBoxArray.length,void 0!==Ni?Ni+1:Ze.collisionBoxArray.length,void 0!==Nr?Nr:Ze.collisionBoxArray.length,void 0!==Nr?Nr+1:Ze.collisionBoxArray.length,void 0!==Zi?Zi:Ze.collisionBoxArray.length,void 0!==Zi?Zi+1:Ze.collisionBoxArray.length,os||Ze.collisionBoxArray.length,os?os+1:Ze.collisionBoxArray.length,mr,r_,i_,t_,n_,oa,0,kc,cm,Hl)}(i,ct,sn,Ue,a,c,h,Ke,i.layers[0],i.collisionBoxArray,r.index,r.sourceLayerIndex,i.index,_e,Fe,C,0,be,Pe,H,r,f,T,I,S)};if("line"===tt)for(const Ue of Of(r.geometry,0,0,Ht,Ht)){const ct=Ag(Ue,pe,we,a.vertical||X,c,24,ce,i.overscaling,Ht);for(const dt of ct){const un=X;un&&Nf(i,un.text,qe,dt)||ot(Ue,dt,S)}}else if("line-center"===tt){for(const Ue of r.geometry)if(Ue.length>1){const ct=nv(Ue,we,a.vertical||X,c,24,ce);ct&&ot(Ue,ct,S)}}else if("Polygon"===r.type)for(const Ue of cf(r.geometry,0)){const ct=Lg(Ue,16);ot(Ue[0],new As(ct.x,ct.y,0,0,void 0),S)}else if("LineString"===r.type)for(const Ue of r.geometry)ot(Ue,new As(Ue[0].x,Ue[0].y,0,0,void 0),S);else if("Point"===r.type)for(const Ue of r.geometry)for(const ct of Ue)ot([ct],new As(ct.x,ct.y,0,0,void 0),S)}const fi=32640;function Bf(i,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H,X){const ne=function(_e,be,we,Fe,Pe,tt,qe,Le){const Ke=[];if(0===be.positionedLines.length)return Ke;const ot=Fe.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,Ue=function(Ft){const sn=Ft[0],Ze=Ft[1],vn=sn*Ze;return vn>0?[sn,-Ze]:vn<0?[-sn,Ze]:0===sn?[Ze,sn]:[Ze,-sn]}(we);let ct=Math.abs(be.top-be.bottom);for(const Ft of be.positionedLines)ct-=Ft.lineOffset;const dt=be.positionedLines.length,un=ct/dt;let Un=be.top-we[1];for(let Ft=0;Ft<dt;++Ft){const sn=be.positionedLines[Ft];Un=rv(be,un,Un,Ft);for(const Ze of sn.positionedGlyphs){if(!Ze.rect)continue;const vn=Ze.rect||{};let pn=4,fr=!0,cr=1,Yr=0;if(Ze.imageName){const or=qe[Ze.imageName];if(!or)continue;if(or.sdf){sr("SDF images are not supported in formatted text and will be ignored.");continue}fr=!1,cr=or.pixelRatio,pn=1/cr}const Ii=(Pe||Le)&&Ze.vertical,bn=Ze.metrics.advance*Ze.scale/2,tn=Ze.metrics,ir=Ze.rect;if(null===ir)continue;Le&&be.verticalizable&&(Yr=Ze.imageName?bn-Ze.metrics.width*Ze.scale/2:0);const mr=Pe?[Ze.x+bn,Ze.y]:[0,0];let gr=[0,0],Sr=[0,0],Si=!1;Pe||(Ii?(Sr=[Ze.x+bn+Ue[0],Ze.y+Ue[1]-Yr],Si=!0):gr=[Ze.x+bn+we[0],Ze.y+we[1]-Yr]);const po=ir.w*Ze.scale/(cr*(Ze.localGlyph?2:1)),Ai=ir.h*Ze.scale/(cr*(Ze.localGlyph?2:1));let Qn,Br,Oo,mi;if(Ii){const or=Ze.y-Un,gi=new at(-bn,bn-or),Ar=-Math.PI/2,_i=new at(...Sr);Qn=new at(-bn+gr[0],gr[1]),Qn._rotateAround(Ar,gi)._add(_i),Qn.x+=-or+bn,Qn.y-=(tn.left-pn)*Ze.scale;const Ni=Ze.imageName?tn.advance*Ze.scale:24*Ze.scale,Zi=String.fromCharCode(Ze.glyph);vf(Zi)?Qn.x+=(1-pn)*Ze.scale:xf(Zi)?Qn.x+=Ni-tn.height*Ze.scale+(-pn-1)*Ze.scale:Qn.x+=Ze.imageName||tn.width+2*pn===ir.w&&tn.height+2*pn===ir.h?(Ni-Ai)/2:(Ni-(tn.height+2*pn)*Ze.scale)/2,Br=new at(Qn.x,Qn.y-po),Oo=new at(Qn.x+Ai,Qn.y),mi=new at(Qn.x+Ai,Qn.y-po)}else{const or=(tn.left-pn)*Ze.scale-bn+gr[0],gi=(-tn.top-pn)*Ze.scale+gr[1],Ar=or+po,_i=gi+Ai;Qn=new at(or,gi),Br=new at(Ar,gi),Oo=new at(or,_i),mi=new at(Ar,_i)}if(ot){let or;or=Pe?new at(0,0):Si?new at(Ue[0],Ue[1]):new at(we[0],we[1]),Qn._rotateAround(ot,or),Br._rotateAround(ot,or),Oo._rotateAround(ot,or),mi._rotateAround(ot,or)}const nn=new at(0,0),ii=new at(0,0);Ke.push({tl:Qn,tr:Br,bl:Oo,br:mi,tex:vn,writingMode:be.writingMode,glyphOffset:mr,sectionIndex:Ze.sectionIndex,isSDF:fr,pixelOffsetTL:nn,pixelOffsetBR:ii,minFontScaleX:0,minFontScaleY:0})}}return Ke}(0,c,C,f,_,x,h,i.allowVerticalPlacement),ce=i.textSizeData;let pe=null;"source"===ce.kind?(pe=[qi*f.layout.get("text-size").evaluate(x,{},X)],pe[0]>fi&&sr(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ce.kind&&(pe=[qi*N.compositeTextSizes[0].evaluate(x,{},X),qi*N.compositeTextSizes[1].evaluate(x,{},X)],(pe[0]>fi||pe[1]>fi)&&sr(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ne,pe,C,_,x,I,r,a,T.lineStartIndex,T.lineLength,z,H,X);for(const _e of S)P[_e]=i.text.placedSymbolArray.length-1;return 4*ne.length}function Fg(i){for(const r in i)return i[r];return null}function ku(i,r,a,c,h,f,_,x,C,T){let I=_.top,S=_.bottom,P=_.left,z=_.right;const N=_.collisionPadding;if(N&&(P-=N[0],I-=N[1],z+=N[2],S+=N[3]),C){const H=new at(P,I),X=new at(z,I),ne=new at(P,S),ce=new at(z,S),pe=Jt(C);let _e=new at(0,0);T&&(_e=new at(T[0],T[1])),H._rotateAround(pe,_e),X._rotateAround(pe,_e),ne._rotateAround(pe,_e),ce._rotateAround(pe,_e),P=Math.min(H.x,X.x,ne.x,ce.x),z=Math.max(H.x,X.x,ne.x,ce.x),I=Math.min(H.y,X.y,ne.y,ce.y),S=Math.max(H.y,X.y,ne.y,ce.y)}return i.emplaceBack(r.x,r.y,r.z,a.x,a.y,P,I,z,S,x,c,h,f),i.length-1}function Ps(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const r=i.bottom-i.top;return r>0?Math.max(10,r):null}function Nf(i,r,a,c){const h=i.compareText;if(r in h){const f=h[r];for(let _=f.length-1;_>=0;_--)if(c.dist(f[_])<a)return!0}else h[r]=[];return h[r].push(c),!1}const zg=bc.VectorTileFeature.types,Uf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jf(i,r,a,c,h,f,_,x,C,T,I,S,P,z,N,H){const X=I?Math.min(fi,Math.round(I[0])):0,ne=I?Math.min(fi,Math.round(I[1])):0;i.emplaceBack(r,a,Math.round(32*_),Math.round(32*x),C,T,(X<<1)+(S?1:0),ne,16*P,16*z,256*N,256*H,c,h,f,0)}function ep(i,r,a){i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a)}function Nx(i){for(const r of i.sections)if(Ye(r.text))return!0;return!1}class Ru{constructor(r){this.layoutVertexArray=new _c,this.indexArray=new Gi,this.programConfigurations=r,this.segments=new Er,this.dynamicLayoutVertexArray=new du,this.opacityVertexArray=new Hp,this.placedSymbolArray=new hy}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,$y.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Gy.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Uf,!0),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ut("SymbolBuffers",Ru);class Lu{constructor(r,a,c){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new c,this.segments=new Er,this.collisionVertexArray=new qp,this.collisionVertexArrayExt=new du}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Hy.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,qy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ut("CollisionBuffers",Lu);class ra{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vr([]),this.placementViewportMatrix=Vr([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ts(this.zoom,a["text-size"]),this.iconSizeData=ts(this.zoom,a["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),f=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>ri[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID}createArrays(){this.text=new Ru(new Oa(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Ru(new Oa(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new fy,this.lineVertexArray=new fu,this.symbolInstances=new py}calculateGlyphDependencies(r,a,c,h,f){for(let _=0;_<r.length;_++)if(a[r.charCodeAt(_)]=!0,h&&f){const x=Di[r.charAt(_)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,c,h){const f=this.layers[0],_=f.layout,x=_.get("text-font"),C=_.get("text-field"),T=_.get("icon-image"),I=("constant"!==C.value.kind||C.value.value instanceof Bt&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),S="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!I&&!S)return;const z=a.iconDependencies,N=a.glyphDependencies,H=a.availableImages,X=new Ot(this.zoom);for(const{feature:ne,id:ce,index:pe,sourceLayerIndex:_e}of r){const be=f._featureFilter.needGeometry,we=xc(ne,be);if(!f._featureFilter.filter(X,we,c))continue;let Fe,Pe;if(be||(we.geometry=ea(ne,c,h)),I){const qe=f.getValueAndResolveTokens("text-field",we,c,H),Le=Bt.factory(qe);Nx(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ao()||this.hasRTLText&&cn.isParsed())&&(Fe=Bx(Le,f,we))}if(S){const qe=f.getValueAndResolveTokens("icon-image",we,c,H);Pe=qe instanceof to?qe:to.fromString(qe)}if(!Fe&&!Pe)continue;const tt=this.sortFeaturesByKey?P.evaluate(we,{},c):void 0;if(this.features.push({id:ce,text:Fe,icon:Pe,index:pe,sourceLayerIndex:_e,geometry:we.geometry,properties:ne.properties,type:zg[ne.type],sortKey:tt}),Pe&&(z[Pe.name]=!0),Fe){const qe=x.evaluate(we,{},c).join(","),Le="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ri.vertical)>=0;for(const Ke of Fe.sections)if(Ke.image)z[Ke.image.name]=!0;else{const ot=Ae(Fe.toString()),Ue=Ke.fontStack||qe,ct=N[Ue]=N[Ue]||{};this.calculateGlyphDependencies(Ke.text,ct,Le,this.allowVerticalPlacement,ot)}}}"line"===_.get("symbol-placement")&&(this.features=function(ne){const ce={},pe={},_e=[];let be=0;function we(qe){_e.push(ne[qe]),be++}function Fe(qe,Le,Ke){const ot=pe[qe];return delete pe[qe],pe[Le]=ot,_e[ot].geometry[0].pop(),_e[ot].geometry[0]=_e[ot].geometry[0].concat(Ke[0]),ot}function Pe(qe,Le,Ke){const ot=ce[Le];return delete ce[Le],ce[qe]=ot,_e[ot].geometry[0].shift(),_e[ot].geometry[0]=Ke[0].concat(_e[ot].geometry[0]),ot}function tt(qe,Le,Ke){const ot=Ke?Le[0][Le[0].length-1]:Le[0][0];return`${qe}:${ot.x}:${ot.y}`}for(let qe=0;qe<ne.length;qe++){const Le=ne[qe],Ke=Le.geometry,ot=Le.text?Le.text.toString():null;if(!ot){we(qe);continue}const Ue=tt(ot,Ke),ct=tt(ot,Ke,!0);if(Ue in pe&&ct in ce&&pe[Ue]!==ce[ct]){const dt=Pe(Ue,ct,Ke),un=Fe(Ue,ct,_e[dt].geometry);delete ce[Ue],delete pe[ct],pe[tt(ot,_e[un].geometry,!0)]=un,_e[dt].geometry=null}else Ue in pe?Fe(Ue,ct,Ke):ct in ce?Pe(Ue,ct,Ke):(we(qe),ce[Ue]=be-1,pe[ct]=be-1)}return _e.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,ce)=>ne.sortKey-ce.sortKey)}update(r,a,c,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,c,h),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,c,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const c=this.lineVertexArray.length;if(void 0!==r.segment){let h=r.dist(a[r.segment+1]),f=r.dist(a[r.segment]);const _={};for(let x=r.segment+1;x<a.length;x++)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:h},x<a.length-1&&(h+=a[x+1].dist(a[x]));for(let x=r.segment||0;x>=0;x--)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=a[x-1].dist(a[x]));for(let x=0;x<a.length;x++){const C=_[x];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,a,c,h,f,_,x,C,T,I,S,P,z,N){const H=r.indexArray,X=r.layoutVertexArray,ne=r.segments.prepareSegment(4*a.length,X,H,this.canOverlap?_.sortKey:void 0),ce=this.glyphOffsetArray.length,pe=ne.vertexLength,_e=this.allowVerticalPlacement&&x===ri.vertical?Math.PI/2:0,be=_.text&&_.text.sections;for(let we=0;we<a.length;we++){const{tl:Fe,tr:Pe,bl:tt,br:qe,tex:Le,pixelOffsetTL:Ke,pixelOffsetBR:ot,minFontScaleX:Ue,minFontScaleY:ct,glyphOffset:dt,isSDF:un,sectionIndex:Un}=a[we],Ft=ne.vertexLength,sn=dt[1];jf(X,C.x,C.y,C.z,T.x,T.y,Fe.x,sn+Fe.y,Le.x,Le.y,c,un,Ke.x,Ke.y,Ue,ct),jf(X,C.x,C.y,C.z,T.x,T.y,Pe.x,sn+Pe.y,Le.x+Le.w,Le.y,c,un,ot.x,Ke.y,Ue,ct),jf(X,C.x,C.y,C.z,T.x,T.y,tt.x,sn+tt.y,Le.x,Le.y+Le.h,c,un,Ke.x,ot.y,Ue,ct),jf(X,C.x,C.y,C.z,T.x,T.y,qe.x,sn+qe.y,Le.x+Le.w,Le.y+Le.h,c,un,ot.x,ot.y,Ue,ct),ep(r.dynamicLayoutVertexArray,C,_e),H.emplaceBack(Ft,Ft+1,Ft+2),H.emplaceBack(Ft+1,Ft+2,Ft+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),we!==a.length-1&&Un===a[we+1].sectionIndex||r.programConfigurations.populatePaintArrays(X.length,_,_.index,{},z,N,be&&be[Un])}r.placedSymbolArray.emplaceBack(C.x,C.y,C.z,T.x,T.y,ce,this.glyphOffsetArray.length-ce,pe,I,S,T.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(r,a,c,h,f,_,x){r.emplaceBack(a,c,h,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,c,h,f,_,x){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=C.vertexLength,I=x.tileAnchorX,S=x.tileAnchorY;for(let z=0;z<4;z++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,I,S,new at(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,I,S,new at(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,I,S,new at(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,I,S,new at(r.x1,r.y2)),C.vertexLength+=4;const P=c.indexArray;P.emplaceBack(T,T+1),P.emplaceBack(T+1,T+2),P.emplaceBack(T+2,T+3),P.emplaceBack(T+3,T),C.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const C=c.get(x),T=this.getSymbolInstanceTextSize(r,_,a,x);this._addCollisionDebugVertices(C,T,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const C=c.get(x),T=this.getSymbolInstanceIconSize(r,a,x);this._addCollisionDebugVertices(C,T,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lu(gh,wg.members,Po),this.iconCollisionBox=new Lu(gh,wg.members,Po);const c=kh(this.iconSizeData,r),h=kh(this.textSizeData,r);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,a,c,h){const f=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),_=yf(this.textSizeData,r,f)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,a,c){const h=this.icon.placedSymbolArray.get(c),f=yf(this.iconSizeData,r,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(r,a,c){r.emplaceBack(a,-c,-c),r.emplaceBack(a,c,-c),r.emplaceBack(a,c,c),r.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const C=c.get(x),T=this.getSymbolInstanceTextSize(r,_,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,C.padding)}}_updateIconDebugCollisionBoxes(r,a,c,h,f){for(let _=h;_<f;_++){const x=c.get(_),C=this.getSymbolInstanceIconSize(r,a,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,x.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=kh(this.iconSizeData,r),h=kh(this.textSizeData,r);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,c,h,f,_,x,C,T){const I={};for(let S=a;S<c;S++){const P=r.get(S);I.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.textFeatureIndex=P.featureIndex;break}for(let S=h;S<f;S++){const P=r.get(S);I.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalTextFeatureIndex=P.featureIndex;break}for(let S=_;S<x;S++){const P=r.get(S);I.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.iconFeatureIndex=P.featureIndex;break}for(let S=C;S<T;S++){const P=r.get(S);I.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalIconFeatureIndex=P.featureIndex;break}return I}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const c=r.placedSymbolArray.get(a),h=c.vertexStartIndex+4*c.numGlyphs;for(let f=c.vertexStartIndex;f<h;f+=4)r.indexArray.emplaceBack(f,f+1,f+2),r.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),c=Math.cos(r),h=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const C=this.symbolInstances.get(x);h.push(0|Math.round(a*C.tileAnchorX+c*C.tileAnchorY)),f.push(C.featureIndex)}return _.sort((x,C)=>h[x]-h[C]||f[C]-f[x]),_}addToSortKeyRanges(r,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((h,f,_)=>{h>=0&&_.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ut("SymbolBucket",ra,{omit:["layers","collisionBoxArray","features","compareText"]}),ra.MAX_GLYPHS=65535,ra.addDynamicAttributes=ep;const Vf=new Cr({"symbol-placement":new ft(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ct(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(Se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ft(Se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ft(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ct(Se.layout_symbol["icon-size"]),"icon-text-fit":new ft(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ft(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ct(Se.layout_symbol["icon-image"]),"icon-rotate":new Ct(Se.layout_symbol["icon-rotate"]),"icon-padding":new ft(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new Ct(Se.layout_symbol["icon-offset"]),"icon-anchor":new Ct(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(Se.layout_symbol["text-rotation-alignment"]),"text-field":new Ct(Se.layout_symbol["text-field"]),"text-font":new Ct(Se.layout_symbol["text-font"]),"text-size":new Ct(Se.layout_symbol["text-size"]),"text-max-width":new Ct(Se.layout_symbol["text-max-width"]),"text-line-height":new Ct(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new Ct(Se.layout_symbol["text-letter-spacing"]),"text-justify":new Ct(Se.layout_symbol["text-justify"]),"text-radial-offset":new Ct(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(Se.layout_symbol["text-variable-anchor"]),"text-anchor":new Ct(Se.layout_symbol["text-anchor"]),"text-max-angle":new ft(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(Se.layout_symbol["text-writing-mode"]),"text-rotate":new Ct(Se.layout_symbol["text-rotate"]),"text-padding":new ft(Se.layout_symbol["text-padding"]),"text-keep-upright":new ft(Se.layout_symbol["text-keep-upright"]),"text-transform":new Ct(Se.layout_symbol["text-transform"]),"text-offset":new Ct(Se.layout_symbol["text-offset"]),"text-allow-overlap":new ft(Se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ft(Se.layout_symbol["text-ignore-placement"]),"text-optional":new ft(Se.layout_symbol["text-optional"])});var Oh={paint:new Cr({"icon-opacity":new Ct(Se.paint_symbol["icon-opacity"]),"icon-color":new Ct(Se.paint_symbol["icon-color"]),"icon-halo-color":new Ct(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ct(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ct(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(Se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ct(Se.paint_symbol["text-opacity"]),"text-color":new Ct(Se.paint_symbol["text-color"],{runtimeType:Ho,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ct(Se.paint_symbol["text-halo-color"]),"text-halo-width":new Ct(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new Ct(Se.paint_symbol["text-halo-blur"]),"text-translate":new ft(Se.paint_symbol["text-translate"]),"text-translate-anchor":new ft(Se.paint_symbol["text-translate-anchor"])}),layout:Vf};class av{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:xa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut("FormatSectionOverride",av,{omit:["defaultValue"]});class tp extends Ms{constructor(r){super(r,Oh)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const f of c)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,c,h){const f=this.layout.get(r).evaluate(a,{},c,h),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||yl(_.value)||!f?f:(x=a.properties,f.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):""));var x}createBucket(r){return new ra(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Oh.paint.overridableProperties){if(!tp.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),c=new av(a),h=new bs(c,a.property.specification);let f=null;f="constant"===a.value.kind||"source"===a.value.kind?new vl("source",h):new uh("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new di(a.property,f,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&tp.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const c=r.get("text-field"),h=Oh.paint.properties[a];let f=!1;const _=x=>{for(const C of x)if(h.overrides&&h.overrides.hasOverride(C))return void(f=!0)};if("constant"===c.value.kind&&c.value.value instanceof Bt)_(c.value.value.sections);else if("source"===c.value.kind){const x=T=>{f||(T instanceof ps&&br(T.value)===ba?_(T.value.sections):T instanceof fs?_(T.sections):T.eachChild(x))},C=c.value;C._styleExpression&&x(C._styleExpression.expression)}return f}getProgramConfiguration(r){return new Js(this,r)}}var lv={paint:new Cr({"background-color":new ft(Se.paint_background["background-color"]),"background-pattern":new ka(Se.paint_background["background-pattern"]),"background-opacity":new ft(Se.paint_background["background-opacity"])})},cv={paint:new Cr({"raster-opacity":new ft(Se.paint_raster["raster-opacity"]),"raster-hue-rotate":new ft(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(Se.paint_raster["raster-saturation"]),"raster-contrast":new ft(Se.paint_raster["raster-contrast"]),"raster-resampling":new ft(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(Se.paint_raster["raster-fade-duration"])})};class uv extends Ms{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Bg={paint:new Cr({"sky-type":new ft(Se.paint_sky["sky-type"]),"sky-atmosphere-sun":new ft(Se.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ft(Se.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ft(Se.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ft(Se.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ks(Se.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ft(Se.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ft(Se.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ft(Se.paint_sky["sky-opacity"])})};function Ng(i,r,a){const c=st(0,0,1),h=Dr(yr());return function(f,_,x){x*=.5;var C=_[0],T=_[1],I=_[2],S=_[3],P=Math.sin(x),z=Math.cos(x);f[0]=C*z-I*P,f[1]=T*z+S*P,f[2]=I*z+C*P,f[3]=S*z-T*P}(h,h,a?-Jt(i)+Math.PI:Jt(i)),$c(h,h,-Jt(r)),Vc(c,c,h),$o(c,c)}const hv={circle:class extends Ms{constructor(i){super(i,ig)}createBucket(i){return new Ol(i)}queryRadius(i){const r=i;return bu("circle-radius",this,r)+bu("circle-stroke-width",this,r)+Pd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,r,a,c,h,f,_,x){const C=Ch(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return Fl(i,c,f,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,T)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Js(this,i)}},heatmap:class extends Ms{createBucket(i){return new sg(i)}constructor(i){super(i,Ty),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=of({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return bu("heatmap-radius",this,i)}queryIntersectsFeature(i,r,a,c,h,f,_,x){const C=this.paint.get("heatmap-radius").evaluate(r,a);return Fl(i,c,f,_,x,!0,!0,new at(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Js(this,i)}},hillshade:class extends Ms{constructor(i){super(i,Dy)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new Js(this,i)}},fill:class extends Ms{constructor(i){super(i,Ry)}getProgramIds(){const i=this.paint.get("fill-pattern"),r=i&&i.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(i){return new Js(this,i)}recalculate(i,r){super.recalculate(i,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Bd(i)}queryRadius(){return Pd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,r,a,c,h,f){return!i.queryGeometry.isAboveHorizon&&xy(by(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ms{constructor(i){super(i,Fy)}createBucket(i){return new mf(i)}queryRadius(){return Pd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Js(this,i)}queryIntersectsFeature(i,r,a,c,h,f,_,x,C){const T=Ch(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(r,a),S=this.paint.get("fill-extrusion-base").evaluate(r,a),P=[0,0],z=x&&f.elevation,N=f.elevation?f.elevation.exaggeration():1;if(z){const ne=i.tile.getBucket(this).centroidVertexArray,ce=C+1;if(ce<ne.length){const pe=ne.get(ce);P[0]=pe.a_centroid_pos0,P[1]=pe.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;const H=(ne=c,ce=S,pe=I,_e=T,be=_,(we=z?x:null)?function(qe,Le,Ke,ot,Ue,ct,dt,un,Un){const Ft=[],sn=[],Ze=[0,0,0,1];for(const vn of qe){const pn=[],fr=[];for(const cr of vn){const Yr=cr.x+ot.x,Ii=cr.y+ot.y,bn=zy(Yr,Ii,Le,Ke,ct,dt,un,Un);Ze[0]=Yr,Ze[1]=Ii,Ze[2]=bn.base,Ze[3]=1,go(Ze,Ze,Ue),Ze[3]=Math.max(Ze[3],1e-5);const tn=vg([Ze[0]/Ze[3],Ze[1]/Ze[3],Ze[2]/Ze[3]]);Ze[0]=Yr,Ze[1]=Ii,Ze[2]=bn.top,Ze[3]=1,go(Ze,Ze,Ue),Ze[3]=Math.max(Ze[3],1e-5);const ir=vg([Ze[0]/Ze[3],Ze[1]/Ze[3],Ze[2]/Ze[3]]);pn.push(tn),fr.push(ir)}Ft.push(pn),sn.push(fr)}return[Ft,sn]}(ne,ce,pe,_e,be,we,P,N,f.center.lat):function(qe,Le,Ke,ot,Ue){const ct=[],dt=[],un=Ue[8]*Le,Un=Ue[9]*Le,Ft=Ue[10]*Le,sn=Ue[11]*Le,Ze=Ue[8]*Ke,vn=Ue[9]*Ke,pn=Ue[10]*Ke,fr=Ue[11]*Ke;for(const cr of qe){const Yr=[],Ii=[];for(const bn of cr){const tn=bn.x+ot.x,ir=bn.y+ot.y,mr=Ue[0]*tn+Ue[4]*ir+Ue[12],gr=Ue[1]*tn+Ue[5]*ir+Ue[13],Sr=Ue[2]*tn+Ue[6]*ir+Ue[14],Si=Ue[3]*tn+Ue[7]*ir+Ue[15],po=mr+un,Ai=gr+Un,Qn=Sr+Ft,Br=Math.max(Si+sn,1e-5),Oo=mr+Ze,mi=gr+vn,nn=Sr+pn,ii=Math.max(Si+fr,1e-5),or=new at(po/Br,Ai/Br);or.z=Qn/Br,Yr.push(or);const gi=new at(Oo/ii,mi/ii);gi.z=nn/ii,Ii.push(gi)}ct.push(Yr),dt.push(Ii)}return[ct,dt]}(ne,ce,pe,_e,be)),X=i.queryGeometry;var ne,ce,pe,_e,be,we;return function(ne,ce,pe){let _e=1/0;xy(pe,ce)&&(_e=Nd(pe,ce[0]));for(let be=0;be<ce.length;be++){const we=ce[be],Fe=ne[be];for(let Pe=0;Pe<we.length-1;Pe++){const tt=we[Pe],qe=[tt,we[Pe+1],Fe[Pe+1],Fe[Pe],tt];vu(pe,qe)&&(_e=Math.min(_e,Nd(pe,qe)))}}return _e!==1/0&&_e}(H[0],H[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Ms{constructor(i){super(i,xg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ai,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=_f.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Ud(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Js(this,i)}queryRadius(i){const r=i,a=bg(bu("line-width",this,r),bu("line-gap-width",this,r)),c=bu("line-offset",this,r);return a/2+Math.abs(c)+Pd(this.paint.get("line-translate"))}queryIntersectsFeature(i,r,a,c,h,f){if(i.queryGeometry.isAboveHorizon)return!1;const _=by(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*bg(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(c=function(T,I){const S=[],P=new at(0,0);for(let z=0;z<T.length;z++){const N=T[z],H=[];for(let X=0;X<N.length;X++){const ne=N[X-1],ce=N[X],pe=N[X+1],_e=0===X?P:ce.sub(ne)._unit()._perp(),be=X===N.length-1?P:pe.sub(ce)._unit()._perp(),we=_e._add(be)._unit();we._mult(1/(we.x*be.x+we.y*be.y)),H.push(we._mult(I)._add(ce))}S.push(H)}return S}(c,C*i.pixelToTileUnitsFactor)),function(T,I,S){for(let P=0;P<I.length;P++){const z=I[P];if(T.length>=3)for(let N=0;N<z.length;N++)if(za(T,z[N]))return!0;if(tg(T,z,S))return!0}return!1}(_,c,x)}isTileClipped(){return!0}},symbol:tp,background:class extends Ms{constructor(i){super(i,lv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ms{constructor(i){super(i,cv)}getProgramIds(){return["raster"]}},sky:class extends Ms{constructor(i){super(i,Bg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=of({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(i,r){const a=this.paint.get("sky-type");if("atmosphere"===a){const c=this.paint.get("sky-atmosphere-sun"),h=!c,f=i.style.light,_=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&sr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Ng(_.azimuthal,90-_.polar,r):Ng(c[0],90-c[1],r)}if("gradient"===a){const c=this.paint.get("sky-gradient-center");return Ng(c[0],90-c[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:dv,HTMLCanvasElement:$f,HTMLVideoElement:Gf,ImageData:Ug,ImageBitmap:Ou}=Be;class Hf{constructor(r,a,c,h){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(a,h)}update(r,a,c){const{width:h,height:f}=r,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||!1!==a.premultiply)),c||this.size&&this.size[0]===h&&this.size[1]===f){const{x:C,y:T}=c||{x:0,y:0};r instanceof dv||r instanceof $f||r instanceof Gf||r instanceof Ug||Ou&&r instanceof Ou?x.texSubImage2D(x.TEXTURE_2D,0,C,T,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,C,T,h,f,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[h,f],r instanceof dv||r instanceof $f||r instanceof Gf||r instanceof Ug||Ou&&r instanceof Ou?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class jg{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new zl({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const c=this.getKey(r,a);return this.positions[c]}trim(){const r=this.width,a=this.height=Qi(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,c){const h=[];let f=r.length%2==1?-r[r.length-1]*c:0,_=r[0]*c,x=!0;h.push({left:f,right:_,isDash:x,zeroLength:0===r[0]});let C=r[0];for(let T=1;T<r.length;T++){x=!x;const I=r[T];f=C*c,C+=I,_=C*c,h.push({left:f,right:_,isDash:x,zeroLength:0===I})}return h}addRoundDash(r,a,c){const h=a/2;for(let f=-c;f<=c;f++){const _=this.width*(this.nextRow+c+f);let x=0,C=r[x];for(let T=0;T<this.width;T++){T/C.right>1&&(C=r[++x]);const I=Math.abs(T-C.left),S=Math.abs(T-C.right),P=Math.min(I,S);let z;const N=f/c*(h+1);if(C.isDash){const H=h-Math.abs(N);z=Math.sqrt(P*P+H*H)}else z=h-Math.sqrt(P*P+N*N);this.image.data[_+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(r,a){for(let C=r.length-1;C>=0;--C){const T=r[C],I=r[C+1];T.zeroLength?r.splice(C,1):I&&I.isDash===T.isDash&&(I.left=T.left,r.splice(C,1))}const c=r[0],h=r[r.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const f=this.width*this.nextRow;let _=0,x=r[_];for(let C=0;C<this.width;C++){C/x.right>1&&(x=r[++_]);const T=Math.abs(C-x.left),I=Math.abs(C-x.right),S=Math.min(T,I);this.image.data[f+C]=Math.max(0,Math.min(255,(x.isDash?S:-S)+a+128))}}addDash(r,a){const c=this.getKey(r,a);if(this.positions[c])return this.positions[c];const h="round"===a,f=h?7:0,_=2*f+1;if(this.nextRow+_>this.height)return sr("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let I=0;I<r.length;I++)r[I]<0&&(sr("Negative value is found in line dasharray, replacing values with 0"),r[I]=0),x+=r[I];if(0!==x){const I=this.width/x,S=this.getDashRanges(r,this.width,I);h?this.addRoundDash(S,I,f):this.addRegularDash(S,"square"===a?.5*I:0)}const C=this.nextRow+f;this.nextRow+=_;const T={tl:[C,f],br:[x,0]};return this.positions[c]=T,T}}ut("LineAtlas",jg);class Ux{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const jx=Be.performance;function pv(i){const r=i?i.url.toString():void 0;return jx.getEntriesByName(r)}class Vx{constructor(){this.tasks={},this.taskQueue=[],nl(["process"],this),this.invoker=new Ux(this.process),this.nextId=0}add(r,a){const c=this.nextId++,h=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||_?"parseTile"!==f||_?"parseTile"===f&&_?300-x:"maybePrepare"===f&&_?400-x:500:200-x:100-x}(a);if(0===h){vo();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:a,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){vo();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<a&&(a=f.priority,r=h)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}function fv(i,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[i*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class qf{constructor(r,a,c){this.z=r,this.x=a,this.y=c,this.key=ns(0,r,r,a,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const c=(_=this.y,x=this.z,C=fv(256*(f=this.x),256*(_=Math.pow(2,x)-_-1),x),T=fv(256*(f+1),256*(_+1),x),C[0]+","+C[1]+","+T[0]+","+T[1]),h=function(f,_,x){let C,T="";for(let I=f;I>0;I--)C=1<<I-1,T+=(_&C?1:0)+(x&C?2:0);return T}(this.z,this.x,this.y);var f,_,x,C,T;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vg{constructor(r,a){this.wrap=r,this.canonical=a,this.key=ns(r,a.z,a.z,a.x,a.y)}}class co{constructor(r,a,c,h,f){this.overscaledZ=r,this.wrap=a,this.canonical=new qf(c,+h,+f),this.key=0===a&&r===c?this.canonical.key:ns(a,r,c,h,f)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new co(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new co(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return ns(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return ns(this.wrap*+a,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new co(a,this.wrap,a,c,h),new co(a,this.wrap,a,c+1,h),new co(a,this.wrap,a,c,h+1),new co(a,this.wrap,a,c+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new co(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ns(i,r,a,c,h){const f=1<<Math.min(a,22);let _=f*(h%f)+c%f;return i&&a<22&&(_+=f*f*((i<0?-2*i-1:2*i)%(1<<2*(22-a)))),16*(32*_+a)+(r-a)}ut("CanonicalTileID",qf),ut("OverscaledTileID",co,{omit:["projMatrix"]});class Ul{constructor(r,a,c){this.func=r,this.mask=a,this.range=c}}Ul.ReadOnly=!1,Ul.ReadWrite=!0,Ul.disabled=new Ul(519,Ul.ReadOnly,[0,1]);class np{constructor(r,a,c,h,f,_){this.test=r,this.ref=a,this.mask=c,this.fail=h,this.depthFail=f,this.pass=_}}np.disabled=new np({func:519,mask:0},0,0,7680,7680,7680);class rs{constructor(r,a,c){this.blendFunction=r,this.blendColor=a,this.mask=c}}rs.Replace=[1,0],rs.disabled=new rs(rs.Replace,dn.transparent,[!1,!1,!1,!1]),rs.unblended=new rs(rs.Replace,dn.transparent,[!0,!0,!0,!0]),rs.alphaBlended=new rs([1,771],dn.transparent,[!0,!0,!0,!0]);class ks{constructor(r,a,c){this.enable=r,this.mode=a,this.frontFace=c}}ks.disabled=new ks(!1,1029,2305),ks.backCCW=new ks(!0,1029,2305),ks.backCW=new ks(!0,1029,2304),ks.frontCW=new ks(!0,1028,2304),ks.frontCCW=new ks(!0,1028,2305);class Ua{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const c=r[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class Wf{constructor(r,a,c,h,f){this.type="Feature",this._vectorTileFeature=r,r._z=a,r._x=c,r._y=h,this.properties=r.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const a in this)"_geometry"!==a&&"_vectorTileFeature"!==a&&(r[a]=this[a]);return r}}class mv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,c){const h=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},ur(this.stateChanges[r][h],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const f in this.state[r])f!==h&&(this.deletedStates[r][f]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const f in this.state[r][h])c[f]||(this.deletedStates[r][h][f]=null)}else for(const f in c)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][f]&&delete this.deletedStates[r][h][f]}removeFeatureState(r,a,c){if(null===this.deletedStates[r])return;const h=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==a)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][c]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][h])for(c in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][c]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,a){const c=String(a),h=ur({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const f=this.deletedStates[r][a];if(null===f)return{};for(const _ in f)delete h[_]}return h}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),ur(this.state[h][_],this.stateChanges[h][_]),f[_]=this.state[h][_];c[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const _ in this.state[h])f[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];f[_]=this.state[h][_]}c[h]=c[h]||{},ur(c[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const h in r)r[h].setFeatureState(c,a)}}class ip{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const c=this.toIdx(r,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function $g(i,r,a,c){let h=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(a[_]<i[_]||a[_]>r[_])return null}else{const x=1/c[_];let C=(i[_]-a[_])*x,T=(r[_]-a[_])*x;if(C>T){const I=C;C=T,T=I}if(C>h&&(h=C),T<f&&(f=T),h>f)return null}return h}function Xf(i,r,a,c,h,f,_,x,C,T,I){const S=c-i,P=h-r,z=f-a,N=_-i,H=x-r,X=C-a,ne=I[1]*X-I[2]*H,ce=I[2]*N-I[0]*X,pe=I[0]*H-I[1]*N,_e=S*ne+P*ce+z*pe;if(Math.abs(_e)<1e-15)return null;const be=1/_e,we=T[0]-i,Fe=T[1]-r,Pe=T[2]-a,tt=(we*ne+Fe*ce+Pe*pe)*be;if(tt<0||tt>1)return null;const qe=Fe*z-Pe*P,Le=Pe*S-we*z,Ke=we*P-Fe*S,ot=(I[0]*qe+I[1]*Le+I[2]*Ke)*be;return ot<0||tt+ot>1?null:(N*qe+H*Le+X*Ke)*be}function Gg(i,r,a){return(i-r)/(a-r)}function Hg(i,r,a,c,h,f,_,x,C){const T=1<<a,I=f-c,S=_-h,P=(i+1)/T*I+c,z=(r+0)/T*S+h,N=(r+1)/T*S+h;x[0]=(i+0)/T*I+c,x[1]=z,C[0]=P,C[1]=N}class Fu{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let C=Math.ceil(Math.pow(2,_));const T=1/C,I=(z,N,H,X,ne)=>{const ce=X?1:0,pe=(z+1)*H-ce,_e=N*H,be=(N+1)*H-ce;ne[0]=z*H,ne[1]=_e,ne[2]=pe,ne[3]=be};let S=new ip(C);const P=[];for(let z=0;z<C*C;z++){I(z%C,Math.floor(z/C),T,!1,P);const N=ia(P[0],P[1],f),H=ia(P[2],P[1],f),X=ia(P[2],P[3],f),ne=ia(P[0],P[3],f);S.minimums.push(Math.min(N,H,X,ne)),S.maximums.push(Math.max(N,H,X,ne)),S.leaves.push(1)}for(x.push(S),C/=2;C>=1;C/=2){const z=x[x.length-1];S=new ip(C);for(let N=0;N<C*C;N++){I(N%C,Math.floor(N/C),2,!0,P);const H=z.getElevation(P[0],P[1]),X=z.getElevation(P[2],P[1]),ne=z.getElevation(P[2],P[3]),ce=z.getElevation(P[0],P[3]),pe=z.isLeaf(P[0],P[1]),_e=z.isLeaf(P[2],P[1]),be=z.isLeaf(P[2],P[3]),we=z.isLeaf(P[0],P[3]),Fe=Math.min(H.min,X.min,ne.min,ce.min),Pe=Math.max(H.max,X.max,ne.max,ce.max),tt=pe&&_e&&be&&we;S.maximums.push(Pe),S.minimums.push(Fe),S.leaves.push(Pe-Fe<=5&&tt?1:0)}x.push(S)}return x}(this.dem),c=a.length-1,h=a[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(r,a,c,h,f,_,x=1){return $g([r,a,-100],[c,h,this.maximums[0]*x],f,_)}raycast(r,a,c,h,f,_,x=1){if(!this.nodeCount)return null;const C=this.raycastRoot(r,a,c,h,f,_,x);if(null==C)return null;const T=[],I=[],S=[],P=[],z=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:H,nodex:X,nodey:ne,depth:ce}=z.pop();if(this.leaves[N]){Hg(X,ne,ce,r,a,c,h,S,P);const _e=1<<ce,be=(X+0)/_e,we=(X+1)/_e,Fe=(ne+0)/_e,Pe=(ne+1)/_e,tt=ia(be,Fe,this.dem)*x,qe=ia(we,Fe,this.dem)*x,Le=ia(we,Pe,this.dem)*x,Ke=ia(be,Pe,this.dem)*x,ot=Xf(S[0],S[1],tt,P[0],S[1],qe,P[0],P[1],Le,f,_),Ue=Xf(P[0],P[1],Le,S[0],P[1],Ke,S[0],S[1],tt,f,_),ct=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==Ue?Ue:Number.MAX_VALUE);if(ct!==Number.MAX_VALUE)return ct;{const dt=an([],f,_,H);if(Dc(tt,qe,Ke,Le,Gg(dt[0],S[0],P[0]),Gg(dt[1],S[1],P[1]))>=dt[2])return H}continue}let pe=0;for(let _e=0;_e<this._siblingOffset.length;_e++){Hg((X<<1)+this._siblingOffset[_e][0],(ne<<1)+this._siblingOffset[_e][1],ce+1,r,a,c,h,S,P),S[2]=-100,P[2]=this.maximums[this.childOffsets[N]+_e]*x;const be=$g(S,P,f,_);if(null!=be){const we=be;T[_e]=we;let Fe=!1;for(let Pe=0;Pe<pe&&!Fe;Pe++)we>=T[I[Pe]]&&(I.splice(Pe,0,_e),Fe=!0);Fe||(I[pe]=_e),pe++}}for(let _e=0;_e<pe;_e++){const be=I[_e];z.push({idx:this.childOffsets[N]+be,t:T[be],nodex:(X<<1)+this._siblingOffset[be][0],nodey:(ne<<1)+this._siblingOffset[be][1],depth:ce+1})}}return null}_addNode(r,a,c){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,c,h,f){if(1===r[h].isLeaf(a,c))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=h-1,x=r[_];let C,T=0;for(let I=0;I<this._siblingOffset.length;I++){const S=2*a+this._siblingOffset[I][0],P=2*c+this._siblingOffset[I][1],z=x.getElevation(S,P),N=x.isLeaf(S,P),H=this._addNode(z.min,z.max,N);N&&(T|=1<<I),C||(C=H)}for(let I=0;I<this._siblingOffset.length;I++)T&1<<I||this._construct(r,2*a+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],_,C+I)}}function Dc(i,r,a,c,h,f){return mn(mn(i,a,f),mn(r,c,f),h)}function ia(i,r,a){const c=a.dim,h=Ln(i*c-.5,0,c-1),f=Ln(r*c-.5,0,c-1),_=Math.floor(h),x=Math.floor(f),C=Math.min(_+1,c-1),T=Math.min(x+1,c-1);return Dc(a.get(_,x),a.get(C,x),a.get(_,T),a.get(C,T),h-_,f-x)}const Mc={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class jl{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,c,h=!1,f=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return sr(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2;if(this.data=new Uint32Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=h,!h){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Fu(this)}get(r,a,c=!1){const h=new Uint8Array(this.data.buffer);c&&(r=Ln(r,-1,this.dim),a=Ln(a,-1,this.dim));const f=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[f],h[f+1],h[f+2])}static getUnpackVector(r){return Mc[r]}get unpackVector(){return Mc[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,c){return(256*r*256+256*a+c)/10-1e4}_unpackTerrarium(r,a,c){return 256*r+a+c/256-32768}static pack(r,a){const c=[0,0,0,0],h=jl.getUnpackVector(a);let f=Math.floor((r+h[3])/h[2]);return c[2]=f%256,f=Math.floor(f/256),c[1]=f%256,f=Math.floor(f/256),c[0]=f,c}getPixels(){return new Ro({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,a,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,f=a*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(a){case-1:h=f-1;break;case 1:f=h+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}const C=-a*this.dim,T=-c*this.dim;for(let I=_;I<x;I++)for(let S=h;S<f;S++)this.data[this._idx(S,I)]=r.data[this._idx(S+C,I+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}ut("DEMData",jl),ut("DemMinMaxQuadTree",Fu,{omit:["dem"]});class zu{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,c){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:a,timeout:void 0};if(void 0!==c&&(f.timeout=setTimeout(()=>{this.remove(r,f)},c)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const c=r.wrapped().key,h=void 0===a?0:this.data[c].indexOf(a),f=this.data[c][h];return this.data[c].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(f.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const c in this.data)for(const h of this.data[c])r(h.value)||a.push(h);for(const c of a)this.remove(c.value.tileID,c)}}class Ic extends va{constructor(r,a,c){super(),this.id=r,this._onlySymbols=c,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new zu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new mv}onAdd(r){this.map=r,this._minTileCacheSize=r?r._minTileCacheSize:null,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const c=this._tiles[a];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return tl(this._tiles).map(r=>r.tileID).sort(Kf).map(r=>r.key)}getRenderableIds(r){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&a.push(this._tiles[c]);return r?a.sort((c,h)=>{const f=c.tileID,_=h.tileID,x=new at(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),C=new at(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||C.y-x.y||C.x-x.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(Kf).map(c=>c.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,r,a)))}_tileLoaded(r,a,c,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new nh(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=vr.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Vs("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const f=a[h];if(r.neighboringTiles&&r.neighboringTiles[f]){const _=this.getTileByID(f);c(r,_),c(_,r)}}function c(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,C=Math.pow(2,h.tileID.canonical.z),T=f.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+C)?_+=C:1===Math.abs(_-C)&&(_-=C)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,_,x),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,c,h){for(const f in this._tiles){let _=this._tiles[f];if(h[f]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(x=T)}let C=x;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),r[C.key]){h[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=r.overscaledZ-1;c>=a;c--){const h=r.scaledTo(c),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const c=Math.ceil(r.width/a)+1,h=Math.ceil(r.height/a)+1,f=Math.floor(c*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const c={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+a),c[f.tileID.key]=f}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,a,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let h;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new co(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const f=this._updateRetainedTiles(h);if(Yf(this._source.type)&&0!==h.length){const x={},C={},T=Object.keys(f);for(const S of T){const P=f[S],z=this._tiles[S];if(!z||z.fadeEndTime&&z.fadeEndTime<=vr.now())continue;const N=this.findLoadedParent(P,Math.max(P.overscaledZ-Ic.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),C[S]=P}const I=h[h.length-1].overscaledZ;for(const S in this._tiles){const P=this._tiles[S];if(f[S]||!P.hasData())continue;let z=P.tileID;for(;z.overscaledZ>I;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&C[z.key]){f[S]=P.tileID;break}}}for(const S in x)f[S]||(this._coveredTiles[S]=!0,f[S]=x[S])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,C){const T=[];for(const I in x)I in C||T.push(I);return T}(this._tiles,f);for(const x of _){const C=this._tiles[x];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const c={},h=r.reduce((T,I)=>Math.min(T,I.overscaledZ),1/0),f=r[0].overscaledZ,_=Math.max(f-Ic.maxOverzooming,this._source.minzoom),x=Math.max(f+Ic.maxUnderzooming,this._source.minzoom),C={};for(const T of r){const I=this._addTile(T);a[T.key]=T,I.hasData()||h<this._source.maxzoom&&(C[T.key]=T)}this._retainLoadedChildren(C,h,x,a);for(const T of r){let I=this._tiles[T.key];if(I.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const P=T.children(this._source.maxzoom)[0],z=this.getTile(P);if(z&&z.hasData()){a[P.key]=P;continue}}else{const P=T.children(this._source.maxzoom);if(a[P[0].key]&&a[P[1].key]&&a[P[2].key]&&a[P[3].key])continue}let S=I.wasRequested();for(let P=T.overscaledZ-1;P>=_;--P){const z=T.scaledTo(P);if(c[z.key]||(c[z.key]=!0,I=this.getTile(z),!I&&S&&(I=this._addTile(z)),I&&(a[z.key]=z,S=I.wasRequested(),I.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let c,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}a.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(f),c)break;h=f}for(const f of a)this._loadedParentTiles[f]=c}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const c=Boolean(a);if(!c){const h=this.map?this.map.painter:null,f="raster"===this._source.type||"raster-dem"===this._source.type;a=new em(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,f),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,c||this._source.fire(new Vs("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=a.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(r,a,c){const h=[],f=this.transform;if(!f)return h;for(const _ in this._tiles){const x=this._tiles[_];if(c&&x.clearQueryDebugViz(),x.holdingForFade())continue;const C=r.containsTile(x,f,a);C&&h.push(C)}return h}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Yf(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=vr.now())return!0}return!1}setFeatureState(r,a,c){this._state.updateState(r=r||"_geojsonTileLayer",a,c)}removeFeatureState(r,a,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,c)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,c){const h=this._tiles[r];h&&h.setDependencies(a,c)}reloadTilesForDependencies(r,a){for(const c in this._tiles)this._tiles[c].hasDependency(r,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,a))}_preloadTiles(r,a){const c=new Map,h=Array.isArray(r)?r:[r],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const T of h){const I=T.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of I)c.set(S.key,S);this.usedForTerrain&&T.updateElevation(!1)}const x=Array.from(c.values()),C="raster"===this._source.type||"raster-dem"===this._source.type;Bs(x,(T,I)=>{const S=new em(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,C);this._loadTile(S,P=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),I(P,S)})},a)}}function Kf(i,r){const a=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return i.overscaledZ-r.overscaledZ||c-a||r.canonical.y-i.canonical.y||r.canonical.x-i.canonical.x}function Yf(i){return"raster"===i||"image"===i||"video"===i}Ic.maxOverzooming=10,Ic.maxUnderzooming=3;class Bu{constructor(r,a,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(r,a,c){const h=c||r.findDEMTileFor(a);if(!h||!h.dem)return;const f=h.dem,_=h.tileID,x=1<<a.canonical.z-_.canonical.z;return new Bu(h,h.tileSize/Ht/x,[(a.canonical.x/x-_.canonical.x)*f.dim,(a.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(r,a){const c=a*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),f=Math.floor(c);return new at(h,f)}getElevationAt(r,a,c,h){const f=r*this._scale+this._offset[0],_=a*this._scale+this._offset[1],x=Math.floor(f),C=Math.floor(_),T=this._dem;return h=!!h,c?mn(mn(T.get(x,C,h),T.get(x,C+1,h),_-C),mn(T.get(x+1,C,h),T.get(x+1,C+1,h),_-C),f-x):T.get(x,C,h)}getElevationAtPixel(r,a,c){return this._dem.get(r,a,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Is(1,r)*this._dem.stride}}class op{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Es(Ht,16,0),this.featureIndexArray=new Xr,this.promoteId=a}insert(r,a,c,h,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,f,_);const C=this.grid;for(let T=0;T<a.length;T++){const I=a[T],S=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){const z=I[P];S[0]=Math.min(S[0],z.x),S[1]=Math.min(S[1],z.y),S[2]=Math.max(S[2],z.x),S[3]=Math.max(S[3],z.y)}S[0]<Ht&&S[1]<Ht&&S[2]>=0&&S[3]>=0&&C.insert(x,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bc.VectorTile(new Na(this.rawTileData)).layers,this.sourceLayerCoder=new Ua(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,c,h){this.loadVTLayers();const f=r.params||{},_=au(f.filter),x=r.tileResult,C=r.transform,T=x.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,H,X,ne)=>Ad(x.bufferedTilespaceGeometry,N,H,X,ne));I.sort(sp);let S=null;C.elevation&&I.length>0&&(S=Bu.create(C.elevation,this.tileID));const P={};let z;for(let N=0;N<I.length;N++){const H=I[N];if(H===z)continue;z=H;const X=this.featureIndexArray.get(H);let ne=null;this.loadMatchingFeature(P,X,_,f.layers,f.availableImages,a,c,h,(ce,pe,_e,be=0)=>(ne||(ne=ea(ce,this.tileID.canonical,r.tileTransform)),pe.queryIntersectsFeature(x,ce,_e,ne,this.z,r.transform,r.pixelPosMatrix,S,be)))}return P}loadMatchingFeature(r,a,c,h,f,_,x,C,T){const{featureIndex:I,bucketIndex:S,sourceLayerIndex:P,layoutVertexArrayOffset:z}=a,N=this.bucketLayerIDs[S];if(h&&!function(ce,pe){for(let _e=0;_e<ce.length;_e++)if(pe.indexOf(ce[_e])>=0)return!0;return!1}(h,N))return;const H=this.sourceLayerCoder.decode(P),X=this.vtLayers[H].feature(I);if(c.needGeometry){const ce=xc(X,!0);if(!c.filter(new Ot(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!c.filter(new Ot(this.tileID.overscaledZ),X))return;const ne=this.getId(X,H);for(let ce=0;ce<N.length;ce++){const pe=N[ce];if(h&&h.indexOf(pe)<0)continue;const _e=_[pe];if(!_e)continue;let be={};void 0!==ne&&C&&(be=C.getState(_e.sourceLayer||"_geojsonTileLayer",ne));const we=ur({},x[pe]);we.paint=Jf(we.paint,_e.paint,X,be,f),we.layout=Jf(we.layout,_e.layout,X,be,f);const Fe=!T||T(X,_e,be,z);if(!Fe)continue;const Pe=new Wf(X,this.z,this.x,this.y,ne);Pe.layer=we;let tt=r[pe];void 0===tt&&(tt=r[pe]=[]),tt.push({featureIndex:I,feature:Pe,intersectionZ:Fe})}}lookupSymbolFeatures(r,a,c,h,f,_,x,C){const T={};this.loadVTLayers();const I=au(f);for(const S of r)this.loadMatchingFeature(T,{bucketIndex:c,sourceLayerIndex:h,featureIndex:S,layoutVertexArrayOffset:0},I,_,x,C,a);return T}loadFeature(r){const{featureIndex:a,sourceLayerIndex:c}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),f=this.vtFeatures[h];if(f[a])return f[a];const _=this.vtLayers[h].feature(a);return f[a]=_,_}hasLayer(r){for(const a of this.bucketLayerIDs)for(const c of a)if(r===c)return!0;return!1}getId(r,a){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof c&&(c=Number(c))),c}}function Jf(i,r,a,c,h){return Ns(i,(f,_)=>{const x=r instanceof Jo?r.get(_):null;return x&&x.evaluate?x.evaluate(a,c,h):x})}function sp(i,r){return r-i}ut("FeatureIndex",op,{omit:["rawTileData","sourceLayerCoder"]});var gv=rr([{name:"a_pos",type:"Int16",components:2}]);const Va=new Uint16Array(8184);for(let i=0;i<2046;i++){let r=i+2,a=0,c=0,h=0,f=0,_=0,x=0;for(1&r?h=f=_=32:a=c=x=32;(r>>=1)>1;){const T=a+h>>1,I=c+f>>1;1&r?(h=a,f=c,a=_,c=x):(a=h,c=f,h=_,f=x),_=T,x=I}const C=4*i;Va[C+0]=a,Va[C+1]=c,Va[C+2]=h,Va[C+3]=f}const Rs=new Uint16Array(2178),Vl=new Uint8Array(1089),zh=new Uint16Array(1089);function qg(i){return 0===i?-.03125:32===i?.03125:0}var Qf=rr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const uo={type:2,extent:Ht,loadGeometry:()=>[[new at(0,0),new at(8193,0),new at(8193,8193),new at(0,8193),new at(0,0)]]};class em{constructor(r,a,c,h,f){this.tileID=r,this.uid=Zc(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<vr.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Sc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,f){const _={};if(!f)return _;for(const x of h){const C=x.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(0!==C.length){x.layers=C,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(T=>C.filter(I=>I.id===T)[0]));for(const T of C)_[T.id]=x}}return _}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof ra){if(this.hasSymbolBuckets=!0,!c)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof ra&&f.hasRTLText){this.hasRTLText=!0,cn.isLoading()||cn.isLoaded()||"deferred"!==Ao()||Fi();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(f))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Ym}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const h=this.buckets[c];h.uploadPending()&&h.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hf(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hf(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hf(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,c,h,f,_,x,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},r,a,c):{}}querySourceFeatures(r,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),f=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[f];if(!_)return;const x=au(a&&a.filter),{z:C,x:T,y:I}=this.tileID.canonical,S={z:C,x:T,y:I};for(let P=0;P<_.length;P++){const z=_.feature(P);if(x.needGeometry){const X=xc(z,!0);if(!x.filter(new Ot(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!x.filter(new Ot(this.tileID.overscaledZ),z))continue;const N=c.getId(z,f),H=new Wf(z,C,T,I,N);H.tile=S,r.push(H)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const c=ma(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const f=this.expirationTime-a;f?this.expirationTime=c+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",C=c[x],T=r[x];if(!C||!T||0===Object.keys(T).length)continue;if(_.update(T,C,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Ud||_ instanceof Bd){const S=a.style._getSourceCache(_.layers[0].source);a._terrain&&a._terrain.enabled&&S&&_.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(S.id,this.tileID)}const I=a&&a.style&&a.style.getLayer(f);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=vr.now()+r}setDependencies(r,a){const c={};for(const h of a)c[h]=!0;this.dependencies[r]=c}hasDependency(r,a){for(const c of r){const h=this.dependencies[c];if(h)for(const f of a)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const c=ea(uo,this.tileID.canonical,this.tileTransform)[0],h=new fc,f=new Zp;for(let _=0;_<c.length;_++){const{x,y:C}=c[_];h.emplaceBack(x,C),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(f),this._tileDebugBuffer=r.createVertexBuffer(h,Qf.members),this._tileDebugSegments=Er.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const c=ea(uo,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const _=function(x,C){const T=Sc(x,C),I=Math.pow(2,x.z);for(let X=0;X<33;X++)for(let ne=0;ne<33;ne++){const ce=Fa((x.x+(ne+qg(ne))/32)/I),pe=Qo((x.y+(X+qg(X))/32)/I),_e=C.project(ce,pe),be=33*X+ne;Rs[2*be+0]=Math.round((_e.x*T.scale-T.x)*Ht),Rs[2*be+1]=Math.round((_e.y*T.scale-T.y)*Ht)}Vl.fill(0),zh.fill(0);for(let X=2045;X>=0;X--){const ne=4*X,ce=Va[ne+0],pe=Va[ne+1],_e=Va[ne+2],be=Va[ne+3],we=ce+_e>>1,Fe=pe+be>>1,Pe=we+Fe-pe,tt=Fe+ce-we,qe=33*pe+ce,Le=33*be+_e,Ke=33*Fe+we,ot=Math.hypot((Rs[2*qe+0]+Rs[2*Le+0])/2-Rs[2*Ke+0],(Rs[2*qe+1]+Rs[2*Le+1])/2-Rs[2*Ke+1])>=16;if(Vl[Ke]=Vl[Ke]||(ot?1:0),X<1022){const Ue=33*(pe+tt>>1)+(ce+Pe>>1),ct=33*(be+tt>>1)+(_e+Pe>>1);Vl[Ke]=Vl[Ke]||Vl[Ue]||Vl[ct]}}const S=new mc,P=new Gi;let z=0;function N(X,ne){const ce=33*ne+X;return 0===zh[ce]&&(S.emplaceBack(Rs[2*ce+0],Rs[2*ce+1],X*Ht/32,ne*Ht/32),zh[ce]=++z),zh[ce]-1}function H(X,ne,ce,pe,_e,be){const we=X+ce>>1,Fe=ne+pe>>1;if(Math.abs(X-_e)+Math.abs(ne-be)>1&&Vl[33*Fe+we])H(_e,be,X,ne,we,Fe),H(ce,pe,_e,be,we,Fe);else{const Pe=N(X,ne),tt=N(ce,pe),qe=N(_e,be);P.emplaceBack(Pe,tt,qe)}}return H(0,0,32,32,32,0),H(32,32,0,0,0,32),{vertices:S,indices:P}}(this.tileID.canonical,a);h=_.vertices,f=_.indices}else{h=new mc,f=new Gi;for(const{x,y:C}of c)h.emplaceBack(x,C,0,0);const _=Ld(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,Qf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(f),this._tileBoundsSegments=Er.simpleSegment(0,0,h.length,f.length)}}const _v=rr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),$x=rr([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yv}=_v;function $l(i,r){const a=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*r:0,h=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),f=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-i._pitch-a,.01)),_=Math.sin(i._pitch)*f+h;return Math.min(1.01*_,h*(1/i._horizonShift))}const Zg=Ht/Math.PI/2,ho=-Zg,Bi=Zg,Wg=[new es([ho,ho,ho],[Bi,Bi,Bi]),new es([ho,ho,ho],[0,0,Bi]),new es([0,ho,ho],[Bi,0,Bi]),new es([ho,0,ho],[0,Bi,Bi]),new es([0,0,ho],[Bi,Bi,Bi])];function ap(i){if(i.z<=1)return Wg[i.z+2*i.y+i.x];const[r,a]=Xg(i),c=[Bh(r[0],r[1]),Bh(r[0],a[1]),Bh(a[0],r[1]),Bh(a[0],a[1])],h=[Bi,Bi,Bi],f=[ho,ho,ho];for(const _ of c)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),f[0]=Math.max(f[0],_[0]),f[1]=Math.max(f[1],_[1]),f[2]=Math.max(f[2],_[2]);return new es(h,f)}function Xg(i){const r=Math.pow(2,i.z),a=i.x/r,c=(i.x+1)/r,h=(i.y+1)/r;return[[Qo(i.y/r),Fa(a)],[Qo(h),Fa(c)]]}function tm(i,r,a,c){return a=Jt(a),c||(c=Zg),[i*Math.sin(a)*c,-r*c,i*Math.cos(a)*c]}function Bh(i,r,a){return tm(Math.cos(Jt(i)),Math.sin(Jt(i)),r,a)}function Kg(i){return 16383/Math.max(...da([],i.max,i.min))}function nm(i){const r=Vr(new Float64Array(16)),a=1/Kg(i);return U(r,r,i.min),$(r,r,[a,a,a]),r}function Yg(i,r,a){const c=r/(2*Math.PI),h=function(_){const x=Ht/(2*Math.PI);return _/(2*Math.PI)/x}(r);if(!a){const _=Ln(i.center.lat,-85.051129,Ei);a=[Ll(i.center.lng)*r,Qs(_)*r]}const f=Vr(new Float64Array(16));return U(f,f,[a[0],a[1],-c]),$(f,f,[h,h,h]),q(f,f,Jt(-i._center.lat)),ee(f,f,Jt(-i._center.lng)),f}class rm{constructor(r){const a=this._createGridIndices();this.gridIndexBuffer=r.createIndexBuffer(a,!0),this.gridSegments=Er.simpleSegment(0,0,4225,8192);const c=this._createPoleTriangleIndices();this.poleIndexBuffer=r.createIndexBuffer(c,!0),this.poleSegments=Er.simpleSegment(0,0,66,64);const h=new pu;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const f=new Gi;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.atmosphereVertexBuffer=r.createVertexBuffer(h,$x.members),this.atmosphereIndexBuffer=r.createIndexBuffer(f),this.atmosphereSegments=Er.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(r,a,c){const h=new pu,f=a/Math.PI/2;h.emplaceBack(0,-f,0,0,0,.5,c?0:1);const _=360/r,x=Math.cos(Jt(85)),C=Math.sin(Jt(85));for(let I=0;I<=64;I++){const S=I/64,P=tm(x,C,0*(1-(T=S))+_*T,f);h.emplaceBack(P[0],P[1],P[2],0,0,S,c?0:1)}var T;return h}_createPoleTriangleIndices(){const r=new Gi;for(let a=0;a<=64;a++)r.emplaceBack(0,a+1,a+2);return r}static createGridVertices(r){const a=Math.pow(2,r.z),c=(C,T,I)=>C*(1-I)+T*I,[h,f]=Xg(r),_=new pu,x=function(C){const T=Vr(new Float64Array(16)),I=Kg(C);var S,P;return $(T,T,[I,I,I]),U(T,T,((S=[])[0]=-(P=C.min)[0],S[1]=-P[1],S[2]=-P[2],S)),T}(ap(r));_.reserve(4096);for(let C=0;C<65;C++){const T=c(h[0],f[0],C/64),I=Qs(T),S=I*a-r.y,P=Math.sin(Jt(T)),z=Math.cos(Jt(T));for(let N=0;N<65;N++){const H=N/64,X=c(h[1],f[1],H),ne=tm(z,P,X);ln(ne,ne,x);const ce=Ll(X);_.emplaceBack(ne[0],ne[1],ne[2],ce,I,H,S)}}return _}_createGridIndices(){const r=new Gi,a=(c,h)=>{const f=65*h+c;r.emplaceBack(f+1,f,f+65),r.emplaceBack(f+65,f+65+1,f+1)};for(let c=0;c<64;c++)for(let h=0;h<64;h++)a(h,c);return r}getWirefameBuffer(r){if(!this.wireframeSegments){const a=this._createWireframeGrid();this.wireframeIndexBuffer=r.createIndexBuffer(a),this.wireframeSegments=Er.simpleSegment(0,0,4096,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const r=new Po,a=(c,h)=>{const f=65*h+c;r.emplaceBack(f,f+1),r.emplaceBack(f,f+65),r.emplaceBack(f,f+65+1)};for(let c=0;c<64;c++)for(let h=0;h<64;h++)a(h,c);return r}}function Sc(i,r){if(!r.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:r};const a=Math.pow(2,-i.z),c=i.x*a,h=(i.x+1)*a,f=i.y*a,_=(i.y+1)*a,x=Fa(c),C=Fa(h),T=Qo(f),I=Qo(_),S=r.project(x,T),P=r.project(C,T),z=r.project(C,I),N=r.project(x,I);let H=Math.min(S.x,P.x,z.x,N.x),X=Math.min(S.y,P.y,z.y,N.y),ne=Math.max(S.x,P.x,z.x,N.x),ce=Math.max(S.y,P.y,z.y,N.y);const pe=a/16;function _e(we,Fe,Pe,tt,qe,Le){const Ke=(Pe+qe)/2,ot=(tt+Le)/2,Ue=r.project(Fa(Ke),Qo(ot)),ct=Math.max(0,H-Ue.x,X-Ue.y,Ue.x-ne,Ue.y-ce);H=Math.min(H,Ue.x),ne=Math.max(ne,Ue.x),X=Math.min(X,Ue.y),ce=Math.max(ce,Ue.y),ct>pe&&(_e(we,Ue,Pe,tt,Ke,ot),_e(Ue,Fe,Ke,ot,qe,Le))}_e(S,P,c,f,h,f),_e(P,z,h,f,h,_),_e(z,N,h,_,c,_),_e(N,S,c,_,c,f),H-=pe,X-=pe,ne+=pe,ce+=pe;const be=1/Math.max(ne-H,ce-X);return{scale:be,x:H*be,y:X*be,x2:ne*be,y2:ce*be,projection:r}}class im{constructor(r){const a={},c=[];for(const x in r){const C=r[x],T=a[x]={};for(const I in C.glyphs){const S=C.glyphs[+I];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const P=S.metrics.localGlyph?2:1,z={x:0,y:0,w:S.bitmap.width+2*P,h:S.bitmap.height+2*P};c.push(z),T[I]=z}}const{w:h,h:f}=Tf(c),_=new zl({width:h||1,height:f||1});for(const x in r){const C=r[x];for(const T in C.glyphs){const I=C.glyphs[+T];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const S=a[x][T],P=I.metrics.localGlyph?2:1;zl.copy(I.bitmap,_,{x:0,y:0},{x:S.x+P,y:S.y+P},I.bitmap)}}this.image=_,this.positions=a}}ut("GlyphAtlas",im);class vv{constructor(r){this.tileID=new co(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Sc(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,c,h,f){this.status="parsing",this.data=r,this.collisionBoxArray=new Ym;const _=new Ua(Object.keys(r.layers).sort()),x=new op(this.tileID,this.promoteId);x.bucketLayerIDs=[];const C={},T=new jg(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:c},S=a.familiesBySource[this.source];for(const be in S){const we=r.layers[be];if(!we)continue;let Fe=!1,Pe=!1;for(const Le of S[be])"symbol"===Le[0].type?Fe=!0:Pe=!0;if(!0===this.isSymbolTile&&!Fe||!1===this.isSymbolTile&&!Pe)continue;1===we.version&&sr(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tt=_.encode(be),qe=[];for(let Le=0;Le<we.length;Le++){const Ke=we.feature(Le),ot=x.getId(Ke,be);qe.push({feature:Ke,id:ot,index:Le,sourceLayerIndex:tt})}for(const Le of S[be]){const Ke=Le[0];void 0!==this.isSymbolTile&&"symbol"===Ke.type!==this.isSymbolTile||Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||"none"!==Ke.visibility&&(is(Le,this.zoom,c),(C[Ke.id]=Ke.createBucket({index:x.bucketLayerIDs.length,layers:Le,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:c})).populate(qe,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Le.map(ot=>ot.id)))}}let P,z,N,H;T.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=Ns(I.glyphDependencies,be=>Object.keys(be).map(Number));Object.keys(ne).length?h.send("getGlyphs",{uid:this.uid,stacks:ne},(be,we)=>{P||(P=be,z=we,_e.call(this))},void 0,!1,X):z={};const ce=Object.keys(I.iconDependencies);ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},(be,we)=>{P||(P=be,N=we,_e.call(this))},void 0,!1,X):N={};const pe=Object.keys(I.patternDependencies);function _e(){if(P)return f(P);if(z&&N&&H){const be=new im(z),we=new Df(N,H);for(const Fe in C){const Pe=C[Fe];Pe instanceof ra?(is(Pe.layers,this.zoom,c),Og(Pe,z,be.positions,N,we.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection),Pe.projection=this.projection.name):Pe.hasPattern&&(Pe instanceof Ud||Pe instanceof Bd||Pe instanceof mf)&&(is(Pe.layers,this.zoom,c),Pe.addFeatures(I,this.tileID.canonical,we.patternPositions,c))}this.status="done",f(null,{buckets:tl(C).filter(Fe=>!Fe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:be.image,lineAtlas:T,imageAtlas:we,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?be.positions:null})}}pe.length?h.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"patterns"},(be,we)=>{P||(P=be,H=we,_e.call(this))},void 0,!1,X):H={},_e.call(this)}}function is(i,r,a){const c=new Ot(r);for(const h of i)h.recalculate(c,a)}class lp{constructor(r){this.entries={},this.scheduler=r}request(r,a,c,h){const f=this.entries[r]=this.entries[r]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},a):h(_,x),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=c((_,x)=>{f.result=[_,x];for(const C of f.callbacks)this.scheduler?this.scheduler.add(()=>{C(_,x)},a):C(_,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==h),f.callbacks.length||(f.cancel(),delete this.entries[r]))}}}function Jg(i,r,a){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const f=_a(i.request,(_,x,C,T)=>{_?h(_):x&&h(null,{vectorTile:a?void 0:new bc.VectorTile(new Na(x)),rawData:x,cacheControl:C,expires:T})});return()=>{f.cancel(),h()}},r)}const xv=Vr(new Float64Array(16));class Nu{constructor(r,a){this._tr=r,this._worldSize=a}createInversionMatrix(){return xv}createTileMatrix(r){let a,c,h;const f=r.canonical,_=Vr(new Float64Array(16)),x=this._tr.projection;if(x.isReprojectedInTileSpace){const C=Sc(f,x);a=1,c=C.x+r.wrap*C.scale,h=C.y,$(_,_,[a/C.scale,a/C.scale,this._tr.pixelsPerMeter/this._worldSize])}else a=this._worldSize/this._tr.zoomScale(f.z),c=(f.x+Math.pow(2,f.z)*r.wrap)*a,h=f.y*a;return U(_,_,[c,h,0]),$(_,_,[a/Ht,a/Ht,1]),_}pointCoordinate(r,a,c){const h=this._tr.horizonLineFromTop(!1),f=new at(r,Math.max(h,a));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(f,c))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Qg={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Cn(this.parallels,this.constants.parallels))return;const i=Math.sin(Jt(this.parallels[0])),r=(i+Math.sin(Jt(this.parallels[1])))/2,a=1+i*(2*r-i),c=Math.sqrt(a)/r;this.constants={n:r,c:a,r0:c,parallels:this.parallels}},project(i,r){this.initializeConstants();const a=Jt(i-this.center[0]),c=Jt(r),{n:h,c:f,r0:_}=this.constants,x=Math.sqrt(f-2*h*Math.sin(c))/h;return{x:x*Math.sin(a*h),y:x*Math.cos(a*h)-_,z:0}},unproject(i,r){this.initializeConstants();const{n:a,c,r0:h}=this.constants,f=h+r;let _=Math.atan2(i,Math.abs(f))*Math.sign(f);f*a<0&&(_-=Math.PI*Math.sign(i)*Math.sign(f));const x=Jt(this.center[0])*a;_=zs(_,-Math.PI-x,Math.PI-x);const C=Ji(_/a)+this.center[0],T=Math.asin(Ln((c-(i*i+f*f)*a*a)/(2*a),-1,1)),I=Ln(Ji(T),-85.051129,Ei);return new it(C,I)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)};const Nh=1.340264,Uh=-.081106,jh=893e-6,Ac=.003796,cp=Math.sqrt(3)/2;var bv={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,r){r=r/180*Math.PI,i=i/180*Math.PI;const a=Math.asin(cp*Math.sin(r)),c=a*a,h=c*c*c;return{x:.5*(i*Math.cos(a)/(cp*(Nh+3*Uh*c+h*(7*jh+9*Ac*c)))/Math.PI+.5),y:1-.5*(a*(Nh+Uh*c+h*(jh+Ac*c))/Math.PI+1),z:0}},unproject(i,r){i=(2*i-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,c=a*a,h=c*c*c;for(let T,I,S,P=0;P<12&&(I=a*(Nh+Uh*c+h*(jh+Ac*c))-r,S=Nh+3*Uh*c+h*(7*jh+9*Ac*c),T=I/S,a=Ln(a-T,-Math.PI/3,Math.PI/3),c=a*a,h=c*c*c,!(Math.abs(T)<1e-12));++P);const f=cp*i*(Nh+3*Uh*c+h*(7*jh+9*Ac*c))/Math.cos(a),_=Math.asin(Math.sin(a)/cp),x=Ln(180*f/Math.PI,-180,180),C=Ln(180*_/Math.PI,-85.051129,Ei);return new it(x,C)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)},up={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,r)=>({x:.5+i/360,y:.5-r/360,z:0}),unproject(i,r){const a=360*(i-.5),c=Ln(360*(.5-r),-85.051129,Ei);return new it(a,c)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)};const Gl=Math.PI/2;function hp(i){return Math.tan((Gl+i)/2)}var om={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Cn(this.parallels,this.constants.parallels))return;const i=Jt(this.parallels[0]),r=Jt(this.parallels[1]),a=Math.cos(i),c=i===r?Math.sin(i):Math.log(a/Math.cos(r))/Math.log(hp(r)/hp(i)),h=a*Math.pow(hp(i),c)/c;this.constants={n:c,f:h,parallels:this.parallels}},project(i,r){this.initializeConstants(),r=Jt(r),i=Jt(i-this.center[0]);const a=1e-6,{n:c,f:h}=this.constants;h>0?r<-Gl+a&&(r=-Gl+a):r>Gl-a&&(r=Gl-a);const f=h/Math.pow(hp(r),c),_=f*Math.sin(c*i),x=h-f*Math.cos(c*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}},unproject(i,r){this.initializeConstants(),i=(2*i-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:a,f:c}=this.constants,h=c-r,f=Math.sign(h),_=Math.sign(a)*Math.sqrt(i*i+h*h);let x=Math.atan2(i,Math.abs(h))*f;h*a<0&&(x-=Math.PI*Math.sign(i)*f);const C=Ln(Ji(x/a)+this.center[0],-180,180),T=Ln(Ji(2*Math.atan(Math.pow(c/_,1/a))-Gl),-85.051129,Ei);return new it(C,T)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)},sm={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,r)=>({x:Ll(i),y:Qs(r),z:0}),unproject(i,r){const a=Fa(i),c=Qo(r);return new it(a,c)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)};const am=Jt(Ei);var wv={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,r){const a=(r=Jt(r))*r,c=a*a;return{x:.5*((i=Jt(i))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}},unproject(i,r){i=(2*i-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,c=25,h=0,f=a*a;do{f=a*a;const C=f*f;h=(a*(1.007226+f*(.015085+C*(.028874*f-.044475-.005916*C)))-r)/(1.007226+f*(.045255+C*(.259866*f-.311325-.005916*11*C))),a=Ln(a-h,-am,am)}while(Math.abs(h)>1e-6&&--c>0);f=a*a;const _=Ln(Ji(i/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Ji(a);return new it(_,x)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)};const e_=Jt(Ei),dp={albers:Qg,equalEarth:bv,equirectangular:up,lambertConformalConic:om,mercator:sm,naturalEarth:wv,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,r){r=Jt(r),i=Jt(i);const a=Math.cos(r),c=2/Math.PI,h=Math.acos(a*Math.cos(i/2)),f=Math.sin(h)/h,_=.5*(i*c+2*a*Math.sin(i/2)/f)||0,x=.5*(r+Math.sin(r)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}},unproject(i,r){let a=i=(2*i-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,h=25;const f=1e-6;let _=0,x=0;do{const C=Math.cos(c),T=Math.sin(c),I=2*T*C,S=T*T,P=C*C,z=Math.cos(a/2),N=Math.sin(a/2),H=2*z*N,X=N*N,ne=1-P*z*z,ce=ne?1/ne:0,pe=ne?Math.acos(C*z)*Math.sqrt(1/ne):0,_e=.5*(2*pe*C*N+2*a/Math.PI)-i,be=.5*(pe*T+c)-r,we=.5*ce*(P*X+pe*C*z*S)+1/Math.PI,Fe=ce*(H*I/4-pe*T*N),Pe=.125*ce*(I*N-pe*T*P*H),tt=.5*ce*(S*z+pe*X*C)+.5,qe=Fe*Pe-tt*we;_=(be*Fe-_e*tt)/qe,x=(_e*Pe-be*we)/qe,a=Ln(a-_,-Math.PI,Math.PI),c=Ln(c-x,-e_,e_)}while((Math.abs(_)>f||Math.abs(x)>f)&&--h>0);return new it(Ji(a),Ji(c))},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Is(1,i)*r,farthestPixelDistance(i){return $l(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new Nu(i,r)}};p.ARRAY_TYPE=Vn,p.AUTH_ERR_MSG=Ce,p.Aabb=es,p.Actor=class{constructor(i,r,a){this.target=i,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},nl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=vo()?i:Be,this.scheduler=new Vx}send(i,r,a,c,h=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[_]=a);const x=xo(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!a,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:Fr(r,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(i){const r=i.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(r.mustQueue||vo()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),c&&c.metadata||{type:"message"})}else this.processTask(a,r)}processTask(i,r){if("<response>"===r.type){const a=this.callbacks[i];delete this.callbacks[i],a&&(r.error?a(hi(r.error)):a(null,hi(r.data)))}else{const a=xo(this.globalScope)?void 0:[],c=r.hasCallback?(f,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?Fr(f):null,data:Fr(_,a)},a)}:f=>{},h=hi(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,c);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],h.source)[f[1]](h,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=qf,p.Color=dn,p.ColorMode=rs,p.CullFaceMode=ks,p.DEMData=jl,p.DataConstantProperty=ft,p.DedupedRequest=lp,p.DepthMode=Ul,p.EXTENT=Ht,p.Elevation=class{getAtPointOrZero(i,r=0){return this.getAtPoint(i,r)||0}getAtPoint(i,r,a=!0){null==r&&(r=null);const c=this._source();if(!c||i.y<0||i.y>1)return r;const h=c.getSource().maxzoom,f=1<<h,_=Math.floor(i.x),x=i.x-_,C=new co(h,_,h,Math.floor(x*f),Math.floor(i.y*f)),T=this.findDEMTileFor(C);if(!T||!T.dem)return r;const I=T.dem,S=1<<T.tileID.canonical.z,P=(x*S-T.tileID.canonical.x)*I.dim,z=(i.y*S-T.tileID.canonical.y)*I.dim,N=Math.floor(P),H=Math.floor(z);return(a?this.exaggeration():1)*mn(mn(I.get(N,H),I.get(N,H+1),z-H),mn(I.get(N+1,H),I.get(N+1,H+1),z-H),P-N)}getAtTileOffset(i,r,a){const c=1<<i.canonical.z;return this.getAtPointOrZero(new wh(i.wrap+(i.canonical.x+r/Ht)/c,(i.canonical.y+a/Ht)/c))}getAtTileOffsetFunc(i,r){return a=>{const c=this.getAtTileOffset(i,a.x,a.y),h=r.upVector(i.canonical,a.x,a.y);return zn(h,h,c*r.upVectorScale(i.canonical)),h}}getForTilePoints(i,r,a,c){const h=Bu.create(this,i,c);return!!h&&(r.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],a)}),!0)}getMinMaxForTile(i){const r=this.findDEMTileFor(i);if(!r||!r.dem)return null;const a=r.dem.tree,c=r.tileID,h=1<<i.canonical.z-c.canonical.z;let f=i.canonical.x/h-c.canonical.x,_=i.canonical.y/h-c.canonical.y,x=0;for(let C=0;C<i.canonical.z-c.canonical.z&&!a.leaves[x];C++){f*=2,_*=2;const T=2*Math.floor(_)+Math.floor(f);x=a.childOffsets[x]+T,f%=1,_%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=nh,p.EvaluationParameters=Ot,p.Event=Vs,p.Evented=va,p.Frustum=kd,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GlobeSharedBuffers=rm,p.GlyphManager=Au,p.ImagePosition=qd,p.LineAtlas=jg,p.LngLat=it,p.LngLatBounds=Rl,p.LocalGlyphMode=Kd,p.MAX_MERCATOR_LATITUDE=Ei,p.MercatorCoordinate=wh,p.ONE_EM=24,p.OverscaledTileID=co,p.Properties=Cr,p.RGBAImage=Ro,p.Ray=class{constructor(i,r){this.pos=i,this.dir=r}intersectsPlane(i,r,a){const c=si(r,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((i[0]-this.pos[0])*r[0]+(i[1]-this.pos[1])*r[1]+(i[2]-this.pos[2])*r[2])/c;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,r,a){if(N=(P=this.pos)[0],H=P[1],X=P[2],ne=(z=i)[0],ce=z[1],pe=z[2],Math.abs(N-ne)<=jr*Math.max(1,Math.abs(N),Math.abs(ne))&&Math.abs(H-ce)<=jr*Math.max(1,Math.abs(H),Math.abs(ce))&&Math.abs(X-pe)<=jr*Math.max(1,Math.abs(X),Math.abs(pe))||0===r)return a[0]=a[1]=a[2]=0,!1;var P,z,N,H,X,ne,ce,pe;const[c,h,f]=this.dir,_=this.pos[0]-i[0],x=this.pos[1]-i[1],C=this.pos[2]-i[2],T=c*c+h*h+f*f,I=2*(_*c+x*h+C*f),S=I*I-4*T*(_*_+x*x+C*C-r*r);if(S<0){const P=Math.max(-I/2,0),z=_+c*P,N=x+h*P,H=C+f*P,X=Math.hypot(z,N,H);return a[0]=z*r/X,a[1]=N*r/X,a[2]=H*r/X,!1}{const P=(-I-Math.sqrt(S))/(2*T);if(P<0){const z=Math.hypot(_,x,C);return a[0]=_*r/z,a[1]=x*r/z,a[2]=C*r/z,!1}return a[0]=_+c*P,a[1]=x+h*P,a[2]=C+f*P,!0}}},p.RequestManager=class{constructor(i,r,a){this._transformRequestFn=i,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const i=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,r){return this._transformRequestFn&&this._transformRequestFn(i,r)||{url:i}}normalizeStyleURL(i,r){if(!Re(i))return i;const a=yt(i);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!Re(i))return i;const a=yt(i);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(i,r){if(!Re(i))return i;const a=yt(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)}normalizeSpriteURL(i,r,a,c){const h=yt(i);return Re(i)?(h.path=`/styles/v1${h.path}/sprite${r}${a}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${r}${a}`,Mt(h))}normalizeTileURL(i,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Re(i))return i;const c=yt(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==c.authority&&512===a?"@2x":""}${j.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${O.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${O.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(i,r){const a=yt(i);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return i;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=a.params;return r&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(i,r){const a=!!r&&Re(r),c=[];for(const h of i.tiles||[])ze(h)?c.push(this.canonicalizeTileURL(h,a)):c.push(h);return c}_makeAPIURL(i,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=yt(O.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,"http"===i.protocol){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if("/"!==c.path&&(i.path=`${c.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return Mt(i);if(r=r||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return i.params=i.params.filter(h=>-1===h.indexOf("access_token")),i.params.push(`access_token=${r||""}`),Mt(i)}},p.ResourceType=il,p.SegmentVector=Er,p.SourceCache=Ic,p.StencilMode=np,p.StructArrayLayout1ui2=Zp,p.StructArrayLayout2f1f2i16=Ml,p.StructArrayLayout2i4=fc,p.StructArrayLayout2ui4=Po,p.StructArrayLayout3f12=du,p.StructArrayLayout3ui6=Gi,p.StructArrayLayout4i8=mc,p.Texture=Hf,p.Tile=em,p.Transitionable=zi,p.Uniform1f=Kp,p.Uniform1i=class extends Pl{constructor(i,r){super(i,r),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},p.Uniform2f=class extends Pl{constructor(i,r){super(i,r),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},p.Uniform3f=class extends Pl{constructor(i,r){super(i,r),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},p.Uniform4f=Yp,p.UniformColor=ao,p.UniformMatrix2f=class extends Pl{constructor(i,r){super(i,r),this.current=Px}set(i){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},p.UniformMatrix3f=class extends Pl{constructor(i,r){super(i,r),this.current=_u}set(i){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},p.UniformMatrix4f=class extends Pl{constructor(i,r){super(i,r),this.current=Jp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},p.UnwrappedTileID=Vg,p.ValidationError=nt,p.VectorTileWorkerSource=class extends va{constructor(i,r,a,c,h){super(),this.actor=i,this.layerIndex=r,this.availableImages=a,this.loadVectorData=h||Jg,this.loading={},this.loaded={},this.deduped=new lp(i.scheduler),this.isSpriteLoaded=c,this.scheduler=i.scheduler}loadTile(i,r){const a=i.uid,c=i&&i.request,h=c&&c.collectResourceTiming,f=this.loading[a]=new vv(i);f.abort=this.loadVectorData(i,(_,x)=>{const C=!this.loading[a];if(delete this.loading[a],C||_||!x)return f.status="done",C||(this.loaded[a]=f),r(_);const T=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new bc.VectorTile(new Na(T));const S=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,z)=>{if(P||!z)return r(P);const N={};if(h){const H=pv(c);H.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(H)))}r(null,ur({rawTileData:T.slice(0)},z,I,N))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[a]=f})}reloadTile(i,r){const a=this.loaded,c=i.uid,h=this;if(a&&a[c]){const f=a[c];f.showCollisionBoxes=i.showCollisionBoxes,f.enableTerrain=!!i.enableTerrain,f.projection=i.projection;const _=(x,C)=>{const T=f.reloadCallback;T&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),r(x,C)};"parsing"===f.status?f.reloadCallback=_:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,r){const a=i.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),r()}removeTile(i,r){const a=this.loaded,c=i.uid;a&&a[c]&&delete a[c],r()}},p.WritingMode=ri,p.ZoomHistory=m,p.add=ht,p.addDynamicAttributes=ep,p.adjoint=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=r[4],x=r[5],C=r[6],T=r[7],I=r[8];return i[0]=_*I-x*T,i[1]=h*T-c*I,i[2]=c*x-h*_,i[3]=x*C-f*I,i[4]=a*I-h*C,i[5]=h*f-a*x,i[6]=f*T-_*C,i[7]=c*C-a*T,i[8]=a*_-c*f,i},p.asyncAll=Bs,p.bezier=Hc,p.bindAll=nl,p.boundsAttributes=Qf,p.bufferConvexPolygon=function(i,r){const a=[];for(let c=0;c<i.length;c++){const h=zs(c-1,-1,i.length-1),f=zs(c+1,-1,i.length-1),_=i[c],x=i[f],C=i[h].sub(_).unit(),T=x.sub(_).unit(),I=T.angleWithSep(C.x,C.y),S=C.add(T).unit().mult(-1*r/Math.sin(I/2));a.push(_.add(S))}return a},p.cacheEntryPossiblyAdded=function(i){Xc++,Xc>Pr&&(i.getActor().send("enforceCacheSizeLimit",td),Xc=0)},p.calculateGlobeMatrix=Yg,p.calculateGlobeMercatorMatrix=function(i){const r=i.worldSize,a=Ln(i.center.lat,-85.051129,Ei),c=new at(Ll(i.center.lng)*r,Qs(a)*r),h=Is(1,i.center.lat)*r,f=i.pixelsPerMeter,_=r/(h/i.pixelsPerMeter),x=Vr(new Float64Array(16));return U(x,x,[c.x,c.y,0]),$(x,x,[_,_,f]),x},p.clamp=Ln,p.clearTileCache=function(i){const r=Be.caches.delete(Qr);i&&r.catch(i).then(()=>i())},p.clipLine=Of,p.clone=function(i){var r=new Vn(16);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},p.clone$1=yo,p.collisionCircleLayout=Zy,p.config=O,p.conjugate=function(i,r){return i[0]=-r[0],i[1]=-r[1],i[2]=-r[2],i[3]=r[3],i},p.create=function(){var i=new Vn(16);return Vn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},p.create$1=Vo,p.createExpression=Mo,p.createLayout=rr,p.createStyleLayer=function(i){return"custom"===i.type?new uv(i):new hv[i.type](i)},p.cross=Rn,p.degToRad=Jt,p.div=function(i,r,a){return i[0]=r[0]/a[0],i[1]=r[1]/a[1],i[2]=r[2]/a[2],i},p.dot=si,p.ease=Jl,p.easeCubicInOut=Gc,p.emitValidationErrors=mh,p.endsWith=Ql,p.enforceCacheSizeLimit=function(i){tc(),bo&&bo.then(r=>{r.keys().then(a=>{for(let c=0;c<a.length-i;c++)r.delete(a[c])})})},p.evaluateSizeForFeature=yf,p.evaluateSizeForZoom=kh,p.evaluateVariableOffset=Mi,p.evented=Vi,p.exactEquals=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]},p.exactEquals$1=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]},p.exported=vr,p.exported$1=j,p.extend=ur,p.extend$1=$s,p.filterObject=ec,p.fromMat4=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],i},p.fromQuat=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=a+a,x=c+c,C=h+h,T=a*_,I=c*_,S=c*x,P=h*_,z=h*x,N=h*C,H=f*_,X=f*x,ne=f*C;return i[0]=1-S-N,i[1]=I+ne,i[2]=P-X,i[3]=0,i[4]=I-ne,i[5]=1-T-N,i[6]=z+H,i[7]=0,i[8]=P+X,i[9]=z-H,i[10]=1-T-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},p.fromRotation=function(i,r){var a=Math.sin(r),c=Math.cos(r);return i[0]=c,i[1]=a,i[2]=0,i[3]=-a,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},p.fromScaling=function(i,r){return i[0]=r[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},p.furthestTileCorner=function(i){const r=Math.round((i+45+360)%360/90)%4;return el[r]},p.getAABBPointSquareDist=function(i,r,a){let c=0;for(let h=0;h<2;++h){const f=a?a[h]:0;i[h]>f&&(c+=(i[h]-f)*(i[h]-f)),r[h]<f&&(c+=(f-r[h])*(f-r[h]))}return c},p.getAnchorAlignment=Iu,p.getAnchorJustification=Jd,p.getBounds=function(i){let r=1/0,a=1/0,c=-1/0,h=-1/0;for(const f of i)r=Math.min(r,f.x),a=Math.min(a,f.y),c=Math.max(c,f.x),h=Math.max(h,f.y);return{min:new at(r,a),max:new at(c,h)}},p.getColumn=function(i,r){return[i[4*r],i[4*r+1],i[4*r+2],i[4*r+3]]},p.getImage=Kc,p.getJSON=function(i,r){return rn(ur(i,{type:"json"}),r)},p.getMapSessionAPI=js,p.getPerformanceMeasurement=pv,p.getProjection=function(i){const r=dp[i.name];if(!r)throw new Error(`Invalid projection name: ${i.name}`);return r.conic?function(a,c){if(c.parallels&&Math.abs(c.parallels[0]+c.parallels[1])<.01){let h=function(f){const _=Math.max(.01,Math.cos(Jt(f))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(C,T){const I=Jt(C)*_,S=Math.sin(Jt(T))/_;return{x:I*x+.5,y:-S*x+.5,z:0}},unproject(C,T){const I=-(T-.5)/x,S=Ln(Ji((C-.5)/x)/_,-180,180),P=Math.asin(Ln(I*_,-1,1)),z=Ln(Ji(P),-85.051129,Ei);return new it(S,z)}}}(c.parallels[0]);if("lambertConformalConic"===c.name){const{project:f,unproject:_}=dp.mercator;h={wrap:!0,supportsWorldCopies:!0,project:f,unproject:_}}return ur({},a,c,h)}return ur({},a,c)}(r,i):r},p.getRTLTextPluginStatus=Ao,p.getReferrer=nc,p.getTilePoint=function(i,{x:r,y:a},c=0){return new at(((r-c)*i.scale-i.x)*Ht,(a*i.scale-i.y)*Ht)},p.getTileVec3=function(i,r,a=0){return st(((r.x-a)*i.scale-i.x)*Ht,(r.y*i.scale-i.y)*Ht,bh(r.z,r.y))},p.getVideo=function(i,r){const a=Be.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let c=0;c<i.length;c++){const h=Be.document.createElement("source");Wt(i[c])||(a.crossOrigin="Anonymous"),h.src=i[c],a.appendChild(h)}return{cancel:()=>{}}},p.globeBuffersForTileMesh=function(i,r,a,c){const h=i.context,f=i.transform;let _=r.globeGridBuffer,x=r.globePoleBuffer;if(!_){const C=rm.createGridVertices(a.canonical);_=r.globeGridBuffer=h.createVertexBuffer(C,yv,!1)}if(!x){const C=rm.createPoleTriangleVertices(c,f.tileSize*c,0===a.canonical.y);x=r.globePoleBuffer=h.createVertexBuffer(C,yv,!1)}return[_,x]},p.globeDenormalizeECEF=nm,p.globeMatrixForTile=function(i,r){const a=nm(ap(i)),c=((h=new Float64Array(16))[0]=(f=r)[0],h[1]=f[1],h[2]=f[2],h[3]=f[3],h[4]=f[4],h[5]=f[5],h[6]=f[6],h[7]=f[7],h[8]=f[8],h[9]=f[9],h[10]=f[10],h[11]=f[11],h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15],h);var h,f;return fe(c,c,a),c},p.globePoleMatrixForTile=function(i,r,a){const c=Vr(new Float64Array(16)),h=Math.pow(2,i.z),f=(i.x-h/2)/h*Math.PI*2,_=a.point,x=a.worldSize/(a.tileSize*h);return U(c,c,[_.x,_.y,-a.worldSize/Math.PI/2]),$(c,c,[x,x,x]),q(c,c,Jt(-a._center.lat)),ee(c,c,Jt(-a._center.lng)),ee(c,c,f),r&&$(c,c,[1,-1,1]),c},p.globeTileBounds=ap,p.globeToMercatorTransition=function(i){return ls(5,6,i)},p.identity=Vr,p.identity$1=Dr,p.invert=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=r[4],x=r[5],C=r[6],T=r[7],I=r[8],S=r[9],P=r[10],z=r[11],N=r[12],H=r[13],X=r[14],ne=r[15],ce=a*x-c*_,pe=a*C-h*_,_e=a*T-f*_,be=c*C-h*x,we=c*T-f*x,Fe=h*T-f*C,Pe=I*H-S*N,tt=I*X-P*N,qe=I*ne-z*N,Le=S*X-P*H,Ke=S*ne-z*H,ot=P*ne-z*X,Ue=ce*ot-pe*Ke+_e*Le+be*qe-we*tt+Fe*Pe;return Ue?(i[0]=(x*ot-C*Ke+T*Le)*(Ue=1/Ue),i[1]=(h*Ke-c*ot-f*Le)*Ue,i[2]=(H*Fe-X*we+ne*be)*Ue,i[3]=(P*we-S*Fe-z*be)*Ue,i[4]=(C*qe-_*ot-T*tt)*Ue,i[5]=(a*ot-h*qe+f*tt)*Ue,i[6]=(X*_e-N*Fe-ne*pe)*Ue,i[7]=(I*Fe-P*_e+z*pe)*Ue,i[8]=(_*Ke-x*qe+T*Pe)*Ue,i[9]=(c*qe-a*Ke-f*Pe)*Ue,i[10]=(N*we-H*_e+ne*ce)*Ue,i[11]=(S*_e-I*we-z*ce)*Ue,i[12]=(x*tt-_*Le-C*Pe)*Ue,i[13]=(a*Le-c*tt+h*Pe)*Ue,i[14]=(H*pe-N*be-X*ce)*Ue,i[15]=(I*be-S*pe+P*ce)*Ue,i):null},p.isMapAuthenticated=function(i){return hs.has(i)},p.isMapboxURL=Re,p.latFromMercatorY=Qo,p.len=pa,p.length=Ne,p.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},p.loadVectorTile=Jg,p.makeRequest=rn,p.mercatorXfromLng=Ll,p.mercatorYfromLat=Qs,p.mercatorZfromAltitude=Is,p.mul=fe,p.mul$1=mo,p.multiply=function(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3],x=r[4],C=r[5],T=r[6],I=r[7],S=r[8],P=a[0],z=a[1],N=a[2],H=a[3],X=a[4],ne=a[5],ce=a[6],pe=a[7],_e=a[8];return i[0]=P*c+z*_+N*T,i[1]=P*h+z*x+N*I,i[2]=P*f+z*C+N*S,i[3]=H*c+X*_+ne*T,i[4]=H*h+X*x+ne*I,i[5]=H*f+X*C+ne*S,i[6]=ce*c+pe*_+_e*T,i[7]=ce*h+pe*x+_e*I,i[8]=ce*f+pe*C+_e*S,i},p.multiply$1=as,p.multiply$2=bt,p.nextPowerOfTwo=Qi,p.normalize=$o,p.normalize$1=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=a*a+c*c+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),i[0]=a*_,i[1]=c*_,i[2]=h*_,i[3]=f*_,i},p.number=mn,p.ortho=function(i,r,a,c,h,f,_){var x=1/(r-a),C=1/(c-h),T=1/(f-_);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(r+a)*x,i[13]=(h+c)*C,i[14]=(_+f)*T,i[15]=1,i},p.pbf=Na,p.perspective=function(i,r,a,c,h){var f,_=1/Math.tan(r/2);return i[0]=_/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=h&&h!==1/0?(i[10]=(h+c)*(f=1/(c-h)),i[14]=2*h*c*f):(i[10]=-1,i[14]=-2*c),i},p.pick=function(i,r){const a={};for(let c=0;c<r.length;c++){const h=r[c];h in i&&(a[h]=i[h])}return a},p.plugin=cn,p.pointGeometry=at,p.polygonIntersectsBox=Ad,p.polygonIntersectsPolygon=vu,p.polygonizeBounds=function(i,r,a=0,c=!0){const h=new at(a,a),f=i.sub(h),_=r.add(h),x=[f,new at(_.x,f.y),_,new at(f.x,_.y)];return c&&x.push(f),x},p.posAttributes=gv,p.postMapLoadEvent=On,p.postTurnstileEvent=$n,p.potpack=Tf,p.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},p.radToDeg=Ji,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(i){return i({pluginStatus:At,pluginURL:qt}),Vi.on("pluginStateChange",i),i},p.removeAuthState=function(i){hs.delete(i)},p.renderColorRamp=of,p.rotateX=q,p.rotateX$1=$c,p.rotateY=ee,p.rotateZ=function(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[0],_=r[1],x=r[2],C=r[3],T=r[4],I=r[5],S=r[6],P=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=f*h+T*c,i[1]=_*h+I*c,i[2]=x*h+S*c,i[3]=C*h+P*c,i[4]=T*h-f*c,i[5]=I*h-_*c,i[6]=S*h-x*c,i[7]=P*h-C*c,i},p.rotateZ$1=function(i,r,a){a*=.5;var c=r[0],h=r[1],f=r[2],_=r[3],x=Math.sin(a),C=Math.cos(a);return i[0]=c*C+h*x,i[1]=h*C-c*x,i[2]=f*C+_*x,i[3]=_*C-f*x,i},p.scale=$,p.scale$1=function(i,r,a){return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=r[3]*a,i},p.scale$2=zn,p.scaleAndAdd=an,p.setCacheLimits=function(i,r){td=i,Pr=r},p.setColumn=function(i,r,a){i[4*r+0]=a[0],i[4*r+1]=a[1],i[4*r+2]=a[2],i[4*r+3]=a[3]},p.setRTLTextPlugin=function(i,r,a=!1){if(At===_t||At===Rt||At===In)throw new Error("setRTLTextPlugin cannot be called multiple times.");qt=vr.resolveURL(i),At=_t,Nn=r,Ir(),a||Fi()},p.smoothstep=ls,p.spec=Se,p.storeAuthState=function(i,r){r?hs.add(i):hs.delete(i)},p.sub=da,p.subtract=Pt,p.symbolSize=Cg,p.tileAABB=function(i,r,a,c,h,f,_,x,C){if("globe"===C.name){const z=ap(new Vg(f,new qf(a,c,h)).canonical).getCorners(),N=Number.MAX_VALUE,H=[-N,-N,-N],X=[N,N,N],ne=Yg(i,r);for(let ce=0;ce<z.length;ce++)ln(z[ce],z[ce],ne),I=X,S=z[ce],(T=X)[0]=Math.min(I[0],S[0]),T[1]=Math.min(I[1],S[1]),T[2]=Math.min(I[2],S[2]),gn(H,H,z[ce]);return new es(X,H)}var T,I,S;const P=Sc({z:a,x:c,y:h},C);return new es([(f+P.x/P.scale)*r,r*(P.y/P.scale),_],[(f+P.x2/P.scale)*r,r*(P.y2/P.scale),x])},p.tileTransform=Sc,p.transformMat3=function(i,r,a){var c=r[0],h=r[1],f=r[2];return i[0]=c*a[0]+h*a[3]+f*a[6],i[1]=c*a[1]+h*a[4]+f*a[7],i[2]=c*a[2]+h*a[5]+f*a[8],i},p.transformMat4=ln,p.transformMat4$1=go,p.transformQuat=Vc,p.translate=U,p.transpose=function(i,r){if(i===r){var a=r[1],c=r[2],h=r[5];i[1]=r[3],i[2]=r[6],i[3]=a,i[5]=r[7],i[6]=c,i[7]=h}else i[0]=r[0],i[1]=r[3],i[2]=r[6],i[3]=r[1],i[4]=r[4],i[5]=r[7],i[6]=r[2],i[7]=r[5],i[8]=r[8];return i},p.triggerPluginCompletionEvent=Jn,p.uniqueId=Zc,p.validateCustomStyleLayer=function(i){const r=[],a=i.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===i.render&&r.push({message:`layers.${a}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFog=xn,p.validateLight=We,p.validateStyle=Cl,p.values=tl,p.vectorTile=bc,p.version="2.7.0",p.warnOnce=sr,p.window=Be,p.wrap=zs}),ua(0,function(p){function Kn(te){const O=typeof te;if("number"===O||"boolean"===O||"string"===O||null==te)return JSON.stringify(te);if(Array.isArray(te)){let re="[";for(const de of te)re+=`${Kn(de)},`;return`${re}]`}const j=Object.keys(te).sort();let J="{";for(let re=0;re<j.length;re++)J+=`${JSON.stringify(j[re])}:${Kn(te[j[re]])},`;return`${J}}`}function Yi(te){let O="";for(const j of p.refProperties)O+=`/${Kn(te[j])}`;return O}class Tr{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,j){for(const re of O)this._layerConfigs[re.id]=re,(this._layers[re.id]=p.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of j)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const J=function(re,de){const Ee={};for(let me=0;me<re.length;me++){const Ce=de&&de[re[me].id]||Yi(re[me]);de&&(de[re[me].id]=Ce);let Re=Ee[Ce];Re||(Re=Ee[Ce]=[]),Re.push(re[me])}const xe=[];for(const me in Ee)xe.push(Ee[me]);return xe}(p.values(this._layerConfigs),this.keyCache);for(const re of J){const de=re.map(ze=>this._layers[ze.id]),Ee=de[0];if("none"===Ee.visibility)continue;const xe=Ee.source||"";let me=this.familiesBySource[xe];me||(me=this.familiesBySource[xe]={});const Ce=Ee.sourceLayer||"_geojsonTileLayer";let Re=me[Ce];Re||(Re=me[Ce]=[]),Re.push(de)}}}const{ImageBitmap:at}=p.window;class Lt{loadTile(O,j){const{uid:J,encoding:re,rawImageData:de,padding:Ee,buildQuadTree:xe}=O,me=at&&de instanceof at?this.getImageData(de,Ee):de;j(null,new p.DEMData(J,me,re,Ee<1,xe))}getImageData(O,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const J=this.offscreenCanvasContext.getImageData(-j,-j,O.width+2*j,O.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:J.width,height:J.height},J.data)}}var Be=function te(O,j){var J,re=O&&O.type;if("FeatureCollection"===re)for(J=0;J<O.features.length;J++)te(O.features[J],j);else if("GeometryCollection"===re)for(J=0;J<O.geometries.length;J++)te(O.geometries[J],j);else if("Feature"===re)te(O.geometry,j);else if("Polygon"===re)jr(O.coordinates,j);else if("MultiPolygon"===re)for(J=0;J<O.coordinates.length;J++)jr(O.coordinates[J],j);return O};function jr(te,O){if(0!==te.length){Vn(te[0],O);for(var j=1;j<te.length;j++)Vn(te[j],!O)}}function Vn(te,O){for(var j=0,J=0,re=0,de=te.length,Ee=de-1;re<de;Ee=re++){var xe=(te[re][0]-te[Ee][0])*(te[Ee][1]+te[re][1]),me=j+xe;J+=Math.abs(j)>=Math.abs(xe)?j-me+xe:xe-me+j,j=me}j+J>=0!=!!O&&te.reverse()}const Vo=p.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Vr{constructor(O){this._feature=O,this.extent=p.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(1===this._feature.type){const O=[];for(const j of this._feature.geometry)O.push([new p.pointGeometry(j[0],j[1])]);return O}{const O=[];for(const j of this._feature.geometry){const J=[];for(const re of j)J.push(new p.pointGeometry(re[0],re[1]));O.push(J)}return O}}toGeoJSON(O,j,J){return Vo.call(this,O,j,J)}}class as{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=O.length,this._features=O}feature(O){return new Vr(this._features[O])}}var U=p.vectorTile.VectorTileFeature,$=q;function q(te,O){this.options=O||{},this.features=te,this.length=te.length}function ee(te,O){this.id="number"==typeof te.id?te.id:void 0,this.type=te.type,this.rawGeometry=1===te.type?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=O||4096}q.prototype.feature=function(te){return new ee(this.features[te],this.options.extent)},ee.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var O=0;O<te.length;O++){for(var j=te[O],J=[],re=0;re<j.length;re++)J.push(new p.pointGeometry(j[re][0],j[re][1]));this.geometry.push(J)}return this.geometry},ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,O=1/0,j=-1/0,J=1/0,re=-1/0,de=0;de<te.length;de++)for(var Ee=te[de],xe=0;xe<Ee.length;xe++){var me=Ee[xe];O=Math.min(O,me.x),j=Math.max(j,me.x),J=Math.min(J,me.y),re=Math.max(re,me.y)}return[O,J,j,re]},ee.prototype.toGeoJSON=U.prototype.toGeoJSON;var fe=De,ge=$;function De(te){var O=new p.pbf;return function(j,J){for(var re in j.layers)J.writeMessage(3,Ne,j.layers[re])}(te,O),O.finish()}function Ne(te,O){var j;O.writeVarintField(15,te.version||1),O.writeStringField(1,te.name||""),O.writeVarintField(5,te.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<te.length;j++)J.feature=te.feature(j),O.writeMessage(2,st,J);var re=J.keys;for(j=0;j<re.length;j++)O.writeStringField(3,re[j]);var de=J.values;for(j=0;j<de.length;j++)O.writeMessage(4,zn,de[j])}function st(te,O){var j=te.feature;void 0!==j.id&&O.writeVarintField(1,j.id),O.writeMessage(2,ht,te),O.writeVarintField(3,j.type),O.writeMessage(4,gn,j)}function ht(te,O){var j=te.feature,J=te.keys,re=te.values,de=te.keycache,Ee=te.valuecache;for(var xe in j.properties){var me=j.properties[xe],Ce=de[xe];if(null!==me){void 0===Ce&&(J.push(xe),de[xe]=Ce=J.length-1),O.writeVarint(Ce);var Re=typeof me;"string"!==Re&&"boolean"!==Re&&"number"!==Re&&(me=JSON.stringify(me));var ze=Re+":"+me,He=Ee[ze];void 0===He&&(re.push(me),Ee[ze]=He=re.length-1),O.writeVarint(He)}}}function Pt(te,O){return(O<<3)+(7&te)}function bt(te){return te<<1^te>>31}function gn(te,O){for(var j=te.loadGeometry(),J=te.type,re=0,de=0,Ee=j.length,xe=0;xe<Ee;xe++){var me=j[xe],Ce=1;1===J&&(Ce=me.length),O.writeVarint(Pt(1,Ce));for(var Re=3===J?me.length-1:me.length,ze=0;ze<Re;ze++){1===ze&&1!==J&&O.writeVarint(Pt(2,Re-1));var He=me[ze].x-re,yt=me[ze].y-de;O.writeVarint(bt(He)),O.writeVarint(bt(yt)),re+=He,de+=yt}3===J&&O.writeVarint(Pt(7,1))}}function zn(te,O){var j=typeof te;"string"===j?O.writeStringField(1,te):"boolean"===j?O.writeBooleanField(7,te):"number"===j&&(te%1!=0?O.writeDoubleField(3,te):te<0?O.writeSVarintField(6,te):O.writeVarintField(5,te))}function an(te,O,j,J,re,de){if(re-J<=j)return;const Ee=J+re>>1;$o(te,O,Ee,J,re,de%2),an(te,O,j,J,Ee-1,de+1),an(te,O,j,Ee+1,re,de+1)}function $o(te,O,j,J,re,de){for(;re>J;){if(re-J>600){const Ce=re-J+1,Re=j-J+1,ze=Math.log(Ce),He=.5*Math.exp(2*ze/3),yt=.5*Math.sqrt(ze*He*(Ce-He)/Ce)*(Re-Ce/2<0?-1:1);$o(te,O,j,Math.max(J,Math.floor(j-Re*He/Ce+yt)),Math.min(re,Math.floor(j+(Ce-Re)*He/Ce+yt)),de)}const Ee=O[2*j+de];let xe=J,me=re;for(si(te,O,J,j),O[2*re+de]>Ee&&si(te,O,J,re);xe<me;){for(si(te,O,xe,me),xe++,me--;O[2*xe+de]<Ee;)xe++;for(;O[2*me+de]>Ee;)me--}O[2*J+de]===Ee?si(te,O,J,me):(me++,si(te,O,me,re)),me<=j&&(J=me+1),j<=me&&(re=me-1)}}function si(te,O,j,J){Rn(te,j,J),Rn(O,2*j,2*J),Rn(O,2*j+1,2*J+1)}function Rn(te,O,j){const J=te[O];te[O]=te[j],te[j]=J}function ln(te,O,j,J){const re=te-j,de=O-J;return re*re+de*de}fe.fromVectorTileJs=De,fe.fromGeojsonVt=function(te,O){O=O||{};var j={};for(var J in te)j[J]=new $(te[J].features,O),j[J].name=J,j[J].version=O.version,j[J].extent=O.extent;return De({layers:j})},fe.GeoJSONWrapper=ge;const Vc=te=>te[0],ha=te=>te[1];class da{constructor(O,j=Vc,J=ha,re=64,de=Float64Array){this.nodeSize=re,this.points=O;const Ee=O.length<65536?Uint16Array:Uint32Array,xe=this.ids=new Ee(O.length),me=this.coords=new de(2*O.length);for(let Ce=0;Ce<O.length;Ce++)xe[Ce]=Ce,me[2*Ce]=j(O[Ce]),me[2*Ce+1]=J(O[Ce]);an(xe,me,re,0,xe.length-1,0)}range(O,j,J,re){return function(de,Ee,xe,me,Ce,Re,ze){const He=[0,de.length-1,0],yt=[];let Mt,wt;for(;He.length;){const St=He.pop(),jt=He.pop(),$n=He.pop();if(jt-$n<=ze){for(let Yn=$n;Yn<=jt;Yn++)Mt=Ee[2*Yn],wt=Ee[2*Yn+1],Mt>=xe&&Mt<=Ce&&wt>=me&&wt<=Re&&yt.push(de[Yn]);continue}const Zn=Math.floor(($n+jt)/2);Mt=Ee[2*Zn],wt=Ee[2*Zn+1],Mt>=xe&&Mt<=Ce&&wt>=me&&wt<=Re&&yt.push(de[Zn]);const On=(St+1)%2;(0===St?xe<=Mt:me<=wt)&&(He.push($n),He.push(Zn-1),He.push(On)),(0===St?Ce>=Mt:Re>=wt)&&(He.push(Zn+1),He.push(jt),He.push(On))}return yt}(this.ids,this.coords,O,j,J,re,this.nodeSize)}within(O,j,J){return function(re,de,Ee,xe,me,Ce){const Re=[0,re.length-1,0],ze=[],He=me*me;for(;Re.length;){const yt=Re.pop(),Mt=Re.pop(),wt=Re.pop();if(Mt-wt<=Ce){for(let On=wt;On<=Mt;On++)ln(de[2*On],de[2*On+1],Ee,xe)<=He&&ze.push(re[On]);continue}const St=Math.floor((wt+Mt)/2),jt=de[2*St],$n=de[2*St+1];ln(jt,$n,Ee,xe)<=He&&ze.push(re[St]);const Zn=(yt+1)%2;(0===yt?Ee-me<=jt:xe-me<=$n)&&(Re.push(wt),Re.push(St-1),Re.push(Zn)),(0===yt?Ee+me>=jt:xe+me>=$n)&&(Re.push(St+1),Re.push(Mt),Re.push(Zn))}return ze}(this.ids,this.coords,O,j,J,this.nodeSize)}}const mo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},pa=Math.fround||(go=new Float32Array(1),te=>(go[0]=+te,go[0]));var go;class yr{constructor(O){this.options=el(Object.create(mo),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:j,minZoom:J,maxZoom:re,nodeSize:de}=this.options;j&&console.time("total time");const Ee=`prepare ${O.length} points`;j&&console.time(Ee),this.points=O;let xe=[];for(let me=0;me<O.length;me++)O[me].geometry&&xe.push($c(O[me],me));this.trees[re+1]=new da(xe,Gc,Hc,de,Float32Array),j&&console.timeEnd(Ee);for(let me=re;me>=J;me--){const Ce=+Date.now();xe=this._cluster(xe,me),this.trees[me]=new da(xe,Gc,Hc,de,Float32Array),j&&console.log("z%d: %d clusters in %dms",me,xe.length,+Date.now()-Ce)}return j&&console.timeEnd("total time"),this}getClusters(O,j){let J=((O[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,O[1]));let de=180===O[2]?180:((O[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)J=-180,de=180;else if(J>de){const Re=this.getClusters([J,re,180,Ee],j),ze=this.getClusters([-180,re,de,Ee],j);return Re.concat(ze)}const xe=this.trees[this._limitZoom(j)],me=xe.range(Yl(J),Jt(Ee),Yl(de),Jt(re)),Ce=[];for(const Re of me){const ze=xe.points[Re];Ce.push(ze.numPoints?Cn(ze):this.points[ze.index])}return Ce}getChildren(O){const j=this._getOriginId(O),J=this._getOriginZoom(O),re="No cluster with the specified id.",de=this.trees[J];if(!de)throw new Error(re);const Ee=de.points[j];if(!Ee)throw new Error(re);const xe=this.options.radius/(this.options.extent*Math.pow(2,J-1)),me=de.within(Ee.x,Ee.y,xe),Ce=[];for(const Re of me){const ze=de.points[Re];ze.parentId===O&&Ce.push(ze.numPoints?Cn(ze):this.points[ze.index])}if(0===Ce.length)throw new Error(re);return Ce}getLeaves(O,j,J){const re=[];return this._appendLeaves(re,O,j=j||10,J=J||0,0),re}getTile(O,j,J){const re=this.trees[this._limitZoom(O)],de=Math.pow(2,O),{extent:Ee,radius:xe}=this.options,me=xe/Ee,Ce=(J-me)/de,Re=(J+1+me)/de,ze={features:[]};return this._addTileFeatures(re.range((j-me)/de,Ce,(j+1+me)/de,Re),re.points,j,J,de,ze),0===j&&this._addTileFeatures(re.range(1-me/de,Ce,1,Re),re.points,de,J,de,ze),j===de-1&&this._addTileFeatures(re.range(0,Ce,me/de,Re),re.points,-1,J,de,ze),ze.features.length?ze:null}getClusterExpansionZoom(O){let j=this._getOriginZoom(O)-1;for(;j<=this.options.maxZoom;){const J=this.getChildren(O);if(j++,1!==J.length)break;O=J[0].properties.cluster_id}return j}_appendLeaves(O,j,J,re,de){const Ee=this.getChildren(j);for(const xe of Ee){const me=xe.properties;if(me&&me.cluster?de+me.point_count<=re?de+=me.point_count:de=this._appendLeaves(O,me.cluster_id,J,re,de):de<re?de++:O.push(xe),O.length===J)break}return de}_addTileFeatures(O,j,J,re,de,Ee){for(const xe of O){const me=j[xe],Ce=me.numPoints;let Re,ze,He;if(Ce)Re=Qa(me),ze=me.x,He=me.y;else{const wt=this.points[me.index];Re=wt.properties,ze=Yl(wt.geometry.coordinates[0]),He=Jt(wt.geometry.coordinates[1])}const yt={type:1,geometry:[[Math.round(this.options.extent*(ze*de-J)),Math.round(this.options.extent*(He*de-re))]],tags:Re};let Mt;Ce?Mt=me.id:this.options.generateId?Mt=me.index:this.points[me.index].id&&(Mt=this.points[me.index].id),void 0!==Mt&&(yt.id=Mt),Ee.features.push(yt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,j){const J=[],{radius:re,extent:de,reduce:Ee,minPoints:xe}=this.options,me=re/(de*Math.pow(2,j));for(let Ce=0;Ce<O.length;Ce++){const Re=O[Ce];if(Re.zoom<=j)continue;Re.zoom=j;const ze=this.trees[j+1],He=ze.within(Re.x,Re.y,me),yt=Re.numPoints||1;let Mt=yt;for(const wt of He){const St=ze.points[wt];St.zoom>j&&(Mt+=St.numPoints||1)}if(Mt>yt&&Mt>=xe){let wt=Re.x*yt,St=Re.y*yt,jt=Ee&&yt>1?this._map(Re,!0):null;const $n=(Ce<<5)+(j+1)+this.points.length;for(const Zn of He){const On=ze.points[Zn];if(On.zoom<=j)continue;On.zoom=j;const Yn=On.numPoints||1;wt+=On.x*Yn,St+=On.y*Yn,On.parentId=$n,Ee&&(jt||(jt=this._map(Re,!0)),Ee(jt,this._map(On)))}Re.parentId=$n,J.push(Dr(wt/Mt,St/Mt,$n,Mt,jt))}else if(J.push(Re),Mt>1)for(const wt of He){const St=ze.points[wt];St.zoom<=j||(St.zoom=j,J.push(St))}}return J}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,j){if(O.numPoints)return j?el({},O.properties):O.properties;const J=this.points[O.index].properties,re=this.options.map(J);return j&&re===J?el({},re):re}}function Dr(te,O,j,J,re){return{x:pa(te),y:pa(O),zoom:1/0,id:j,parentId:-1,numPoints:J,properties:re}}function $c(te,O){const[j,J]=te.geometry.coordinates;return{x:pa(Yl(j)),y:pa(Jt(J)),zoom:1/0,index:O,parentId:-1}}function Cn(te){return{type:"Feature",id:te.id,properties:Qa(te),geometry:{type:"Point",coordinates:[(O=te.x,360*(O-.5)),Ji(te.y)]}};var O}function Qa(te){const O=te.numPoints,j=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return el(el({},te.properties),{cluster:!0,cluster_id:te.id,point_count:O,point_count_abbreviated:j})}function Yl(te){return te/360+.5}function Jt(te){const O=Math.sin(te*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function Ji(te){const O=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function el(te,O){for(const j in O)te[j]=O[j];return te}function Gc(te){return te.x}function Hc(te){return te.y}function Jl(te,O,j,J){for(var re,de=J,Ee=j-O>>1,xe=j-O,me=te[O],Ce=te[O+1],Re=te[j],ze=te[j+1],He=O+3;He<j;He+=3){var yt=Ln(te[He],te[He+1],me,Ce,Re,ze);if(yt>de)re=He,de=yt;else if(yt===de){var Mt=Math.abs(He-Ee);Mt<xe&&(re=He,xe=Mt)}}de>J&&(re-O>3&&Jl(te,O,re,J),te[re+2]=de,j-re>3&&Jl(te,re,j,J))}function Ln(te,O,j,J,re,de){var Ee=re-j,xe=de-J;if(0!==Ee||0!==xe){var me=((te-j)*Ee+(O-J)*xe)/(Ee*Ee+xe*xe);me>1?(j=re,J=de):me>0&&(j+=Ee*me,J+=xe*me)}return(Ee=te-j)*Ee+(xe=O-J)*xe}function ls(te,O,j,J){var re={id:void 0===te?null:te,type:O,geometry:j,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Ee=de.geometry,xe=de.type;if("Point"===xe||"MultiPoint"===xe||"LineString"===xe)zs(de,Ee);else if("Polygon"===xe||"MultiLineString"===xe)for(var me=0;me<Ee.length;me++)zs(de,Ee[me]);else if("MultiPolygon"===xe)for(me=0;me<Ee.length;me++)for(var Ce=0;Ce<Ee[me].length;Ce++)zs(de,Ee[me][Ce])}(re),re}function zs(te,O){for(var j=0;j<O.length;j+=3)te.minX=Math.min(te.minX,O[j]),te.minY=Math.min(te.minY,O[j+1]),te.maxX=Math.max(te.maxX,O[j]),te.maxY=Math.max(te.maxY,O[j+1])}function Bs(te,O,j,J){if(O.geometry){var re=O.geometry.coordinates,de=O.geometry.type,Ee=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),xe=[],me=O.id;if(j.promoteId?me=O.properties[j.promoteId]:j.generateId&&(me=J||0),"Point"===de)tl(re,xe);else if("MultiPoint"===de)for(var Ce=0;Ce<re.length;Ce++)tl(re[Ce],xe);else if("LineString"===de)ur(re,xe,Ee,!1);else if("MultiLineString"===de){if(j.lineMetrics){for(Ce=0;Ce<re.length;Ce++)ur(re[Ce],xe=[],Ee,!1),te.push(ls(me,"LineString",xe,O.properties));return}qc(re,xe,Ee,!1)}else if("Polygon"===de)qc(re,xe,Ee,!0);else{if("MultiPolygon"!==de){if("GeometryCollection"===de){for(Ce=0;Ce<O.geometry.geometries.length;Ce++)Bs(te,{id:me,geometry:O.geometry.geometries[Ce],properties:O.properties},j,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<re.length;Ce++){var Re=[];qc(re[Ce],Re,Ee,!0),xe.push(Re)}}te.push(ls(me,de,xe,O.properties))}}function tl(te,O){O.push(Zc(te[0])),O.push(_o(te[1])),O.push(0)}function ur(te,O,j,J){for(var re,de,Ee=0,xe=0;xe<te.length;xe++){var me=Zc(te[xe][0]),Ce=_o(te[xe][1]);O.push(me),O.push(Ce),O.push(0),xe>0&&(Ee+=J?(re*Ce-me*de)/2:Math.sqrt(Math.pow(me-re,2)+Math.pow(Ce-de,2))),re=me,de=Ce}var Re=O.length-3;O[2]=1,Jl(O,0,Re,j),O[Re+2]=1,O.size=Math.abs(Ee),O.start=0,O.end=O.size}function qc(te,O,j,J){for(var re=0;re<te.length;re++){var de=[];ur(te[re],de,j,J),O.push(de)}}function Zc(te){return te/360+.5}function _o(te){var O=Math.sin(te*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function Qi(te,O,j,J,re,de,Ee,xe){if(J/=O,de>=(j/=O)&&Ee<J)return te;if(Ee<j||de>=J)return null;for(var me=[],Ce=0;Ce<te.length;Ce++){var Re=te[Ce],ze=Re.geometry,He=Re.type,yt=0===re?Re.minX:Re.minY,Mt=0===re?Re.maxX:Re.maxY;if(yt>=j&&Mt<J)me.push(Re);else if(!(Mt<j||yt>=J)){var wt=[];if("Point"===He||"MultiPoint"===He)Qu(ze,wt,j,J,re);else if("LineString"===He)nl(ze,wt,j,J,re,!1,xe.lineMetrics);else if("MultiLineString"===He)Ns(ze,wt,j,J,re,!1);else if("Polygon"===He)Ns(ze,wt,j,J,re,!0);else if("MultiPolygon"===He)for(var St=0;St<ze.length;St++){var jt=[];Ns(ze[St],jt,j,J,re,!0),jt.length&&wt.push(jt)}if(wt.length){if(xe.lineMetrics&&"LineString"===He){for(St=0;St<wt.length;St++)me.push(ls(Re.id,He,wt[St],Re.tags));continue}"LineString"!==He&&"MultiLineString"!==He||(1===wt.length?(He="LineString",wt=wt[0]):He="MultiLineString"),"Point"!==He&&"MultiPoint"!==He||(He=3===wt.length?"Point":"MultiPoint"),me.push(ls(Re.id,He,wt,Re.tags))}}}return me.length?me:null}function Qu(te,O,j,J,re){for(var de=0;de<te.length;de+=3){var Ee=te[de+re];Ee>=j&&Ee<=J&&(O.push(te[de]),O.push(te[de+1]),O.push(te[de+2]))}}function nl(te,O,j,J,re,de,Ee){for(var xe,me,Ce=Ql(te),Re=0===re?yo:eh,ze=te.start,He=0;He<te.length-3;He+=3){var yt=te[He],Mt=te[He+1],wt=te[He+2],St=te[He+3],jt=te[He+4],$n=0===re?yt:Mt,Zn=0===re?St:jt,On=!1;Ee&&(xe=Math.sqrt(Math.pow(yt-St,2)+Math.pow(Mt-jt,2))),$n<j?Zn>j&&(me=Re(Ce,yt,Mt,St,jt,j),Ee&&(Ce.start=ze+xe*me)):$n>J?Zn<J&&(me=Re(Ce,yt,Mt,St,jt,J),Ee&&(Ce.start=ze+xe*me)):ec(Ce,yt,Mt,wt),Zn<j&&$n>=j&&(me=Re(Ce,yt,Mt,St,jt,j),On=!0),Zn>J&&$n<=J&&(me=Re(Ce,yt,Mt,St,jt,J),On=!0),!de&&On&&(Ee&&(Ce.end=ze+xe*me),O.push(Ce),Ce=Ql(te)),Ee&&(ze+=xe)}var Yn=te.length-3;yt=te[Yn],Mt=te[Yn+1],wt=te[Yn+2],($n=0===re?yt:Mt)>=j&&$n<=J&&ec(Ce,yt,Mt,wt),Yn=Ce.length-3,de&&Yn>=3&&(Ce[Yn]!==Ce[0]||Ce[Yn+1]!==Ce[1])&&ec(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&O.push(Ce)}function Ql(te){var O=[];return O.size=te.size,O.start=te.start,O.end=te.end,O}function Ns(te,O,j,J,re,de){for(var Ee=0;Ee<te.length;Ee++)nl(te[Ee],O,j,J,re,de,!1)}function ec(te,O,j,J){te.push(O),te.push(j),te.push(J)}function yo(te,O,j,J,re,de){var Ee=(de-O)/(J-O);return te.push(de),te.push(j+(re-j)*Ee),te.push(1),Ee}function eh(te,O,j,J,re,de){var Ee=(de-j)/(re-j);return te.push(O+(J-O)*Ee),te.push(de),te.push(1),Ee}function sr(te,O){for(var j=[],J=0;J<te.length;J++){var re,de=te[J],Ee=de.type;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)re=Ui(de.geometry,O);else if("MultiLineString"===Ee||"Polygon"===Ee){re=[];for(var xe=0;xe<de.geometry.length;xe++)re.push(Ui(de.geometry[xe],O))}else if("MultiPolygon"===Ee)for(re=[],xe=0;xe<de.geometry.length;xe++){for(var me=[],Ce=0;Ce<de.geometry[xe].length;Ce++)me.push(Ui(de.geometry[xe][Ce],O));re.push(me)}j.push(ls(de.id,Ee,re,de.tags))}return j}function Ui(te,O){var j=[];j.size=te.size,void 0!==te.start&&(j.start=te.start,j.end=te.end);for(var J=0;J<te.length;J+=3)j.push(te[J]+O,te[J+1],te[J+2]);return j}function fa(te,O){if(te.transformed)return te;var j,J,re,de=1<<te.z,Ee=te.x,xe=te.y;for(j=0;j<te.features.length;j++){var me=te.features[j],Ce=me.geometry,Re=me.type;if(me.geometry=[],1===Re)for(J=0;J<Ce.length;J+=2)me.geometry.push(vo(Ce[J],Ce[J+1],O,de,Ee,xe));else for(J=0;J<Ce.length;J++){var ze=[];for(re=0;re<Ce[J].length;re+=2)ze.push(vo(Ce[J][re],Ce[J][re+1],O,de,Ee,xe));me.geometry.push(ze)}}return te.transformed=!0,te}function vo(te,O,j,J,re,de){return[Math.round(j*(te*J-re)),Math.round(j*(O*J-de))]}function ma(te,O,j,J,re){for(var de=O===re.maxZoom?0:re.tolerance/((1<<O)*re.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:J,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<te.length;xe++){Ee.numFeatures++,Us(Ee,te[xe],de,re);var me=te[xe].minX,Ce=te[xe].minY,Re=te[xe].maxX,ze=te[xe].maxY;me<Ee.minX&&(Ee.minX=me),Ce<Ee.minY&&(Ee.minY=Ce),Re>Ee.maxX&&(Ee.maxX=Re),ze>Ee.maxY&&(Ee.maxY=ze)}return Ee}function Us(te,O,j,J){var re=O.geometry,de=O.type,Ee=[];if("Point"===de||"MultiPoint"===de)for(var xe=0;xe<re.length;xe+=3)Ee.push(re[xe]),Ee.push(re[xe+1]),te.numPoints++,te.numSimplified++;else if("LineString"===de)cs(Ee,re,te,j,!1,!1);else if("MultiLineString"===de||"Polygon"===de)for(xe=0;xe<re.length;xe++)cs(Ee,re[xe],te,j,"Polygon"===de,0===xe);else if("MultiPolygon"===de)for(var me=0;me<re.length;me++){var Ce=re[me];for(xe=0;xe<Ce.length;xe++)cs(Ee,Ce[xe],te,j,!0,0===xe)}if(Ee.length){var Re=O.tags||null;if("LineString"===de&&J.lineMetrics){for(var ze in Re={},O.tags)Re[ze]=O.tags[ze];Re.mapbox_clip_start=re.start/re.size,Re.mapbox_clip_end=re.end/re.size}var He={geometry:Ee,type:"Polygon"===de||"MultiPolygon"===de?3:"LineString"===de||"MultiLineString"===de?2:1,tags:Re};null!==O.id&&(He.id=O.id),te.features.push(He)}}function cs(te,O,j,J,re,de){var Ee=J*J;if(J>0&&O.size<(re?Ee:J))j.numPoints+=O.length/3;else{for(var xe=[],me=0;me<O.length;me+=3)(0===J||O[me+2]>Ee)&&(j.numSimplified++,xe.push(O[me]),xe.push(O[me+1])),j.numPoints++;re&&function(Ce,Re){for(var ze=0,He=0,yt=Ce.length,Mt=yt-2;He<yt;Mt=He,He+=2)ze+=(Ce[He]-Ce[Mt])*(Ce[He+1]+Ce[Mt+1]);if(ze>0===Re)for(He=0,yt=Ce.length;He<yt/2;He+=2){var wt=Ce[He],St=Ce[He+1];Ce[He]=Ce[yt-2-He],Ce[He+1]=Ce[yt-1-He],Ce[yt-2-He]=wt,Ce[yt-1-He]=St}}(xe,de),te.push(xe)}}function eo(te,O){var j=(O=this.options=function(re,de){for(var Ee in de)re[Ee]=de[Ee];return re}(Object.create(this.options),O)).debug;if(j&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var re,de,Ee,xe,me,Ce,J=function(re,de){var Ee=[];if("FeatureCollection"===re.type)for(var xe=0;xe<re.features.length;xe++)Bs(Ee,re.features[xe],de,xe);else Bs(Ee,"Feature"===re.type?re:{geometry:re},de);return Ee}(te,O);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(re=J,de=O,Ee=de.buffer/de.extent,xe=re,me=Qi(re,1,-1-Ee,Ee,0,-1,2,de),Ce=Qi(re,1,1-Ee,2+Ee,0,-1,2,de),(me||Ce)&&(xe=Qi(re,1,-Ee,1+Ee,0,-1,2,de)||[],me&&(xe=sr(me,1).concat(xe)),Ce&&(xe=xe.concat(sr(Ce,-1)))),J=xe).length&&this.splitTile(J,0,0,0),j&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function us(te,O,j){return 32*((1<<te)*j+O)+te}function xo(te,O){const j=te.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return O(null,null);const re=new as(J.features);let de=fe(re);0===de.byteOffset&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),O(null,{vectorTile:re,rawData:de.buffer})}eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(te,O,j,J,re,de,Ee){for(var xe=[te,O,j,J],me=this.options,Ce=me.debug;xe.length;){J=xe.pop(),j=xe.pop(),O=xe.pop(),te=xe.pop();var Re=1<<O,ze=us(O,j,J),He=this.tiles[ze];if(!He&&(Ce>1&&console.time("creation"),He=this.tiles[ze]=ma(te,O,j,J,me),this.tileCoords.push({z:O,x:j,y:J}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,j,J,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));var yt="z"+O;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(He.source=te,re){if(O===me.maxZoom||O===re)continue;var Mt=1<<re-O;if(j!==Math.floor(de/Mt)||J!==Math.floor(Ee/Mt))continue}else if(O===me.indexMaxZoom||He.numPoints<=me.indexMaxPoints)continue;if(He.source=null,0!==te.length){Ce>1&&console.time("clipping");var wt,St,jt,$n,Zn,On,Yn=.5*me.buffer/me.extent,js=.5-Yn,hs=.5+Yn,Qr=1+Yn;wt=St=jt=$n=null,Zn=Qi(te,Re,j-Yn,j+hs,0,He.minX,He.maxX,me),On=Qi(te,Re,j+js,j+Qr,0,He.minX,He.maxX,me),te=null,Zn&&(wt=Qi(Zn,Re,J-Yn,J+hs,1,He.minY,He.maxY,me),St=Qi(Zn,Re,J+js,J+Qr,1,He.minY,He.maxY,me),Zn=null),On&&(jt=Qi(On,Re,J-Yn,J+hs,1,He.minY,He.maxY,me),$n=Qi(On,Re,J+js,J+Qr,1,He.minY,He.maxY,me),On=null),Ce>1&&console.timeEnd("clipping"),xe.push(wt||[],O+1,2*j,2*J),xe.push(St||[],O+1,2*j,2*J+1),xe.push(jt||[],O+1,2*j+1,2*J),xe.push($n||[],O+1,2*j+1,2*J+1)}}},eo.prototype.getTile=function(te,O,j){var J=this.options,re=J.extent,de=J.debug;if(te<0||te>24)return null;var Ee=1<<te,xe=us(te,O=(O%Ee+Ee)%Ee,j);if(this.tiles[xe])return fa(this.tiles[xe],re);de>1&&console.log("drilling down to z%d-%d-%d",te,O,j);for(var me,Ce=te,Re=O,ze=j;!me&&Ce>0;)Ce--,Re=Math.floor(Re/2),ze=Math.floor(ze/2),me=this.tiles[us(Ce,Re,ze)];return me&&me.source?(de>1&&console.log("found parent tile z%d-%d-%d",Ce,Re,ze),de>1&&console.time("drilling down"),this.splitTile(me.source,Ce,Re,ze,te,O,j),de>1&&console.timeEnd("drilling down"),this.tiles[xe]?fa(this.tiles[xe],re):null):null};class ga extends p.VectorTileWorkerSource{constructor(O,j,J,re,de){super(O,j,J,re,xo),de&&(this.loadGeoJSON=de)}loadData(O,j){const J=O&&O.request,re=J&&J.collectResourceTiming;this.loadGeoJSON(O,(de,Ee)=>{if(de||!Ee)return j(de);if("object"!=typeof Ee)return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{Be(Ee,!0);try{if(O.filter){const me=p.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===me.result)throw new Error(me.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));const Ce=Ee.features.filter(Re=>me.value.evaluate({zoom:0},Re));Ee={type:"FeatureCollection",features:Ce}}this._geoJSONIndex=O.cluster?new yr(function({superclusterOptions:me,clusterProperties:Ce}){if(!Ce||!me)return me;const Re={},ze={},He={accumulated:null,zoom:0},yt={properties:null},Mt=Object.keys(Ce);for(const wt of Mt){const[St,jt]=Ce[wt],$n=p.createExpression(jt),Zn=p.createExpression("string"==typeof St?[St,["accumulated"],["get",wt]]:St);Re[wt]=$n.value,ze[wt]=Zn.value}return me.map=wt=>{yt.properties=wt;const St={};for(const jt of Mt)St[jt]=Re[jt].evaluate(He,yt);return St},me.reduce=(wt,St)=>{yt.properties=St;for(const jt of Mt)He.accumulated=wt[jt],wt[jt]=ze[jt].evaluate(He,yt)},me}(O)).load(Ee.features):new eo(me=Ee,O.geojsonVtOptions)}catch(me){return j(me)}this.loaded={};const xe={};if(re){const me=p.getPerformanceMeasurement(J);me&&(xe.resourceTiming={},xe.resourceTiming[O.source]=JSON.parse(JSON.stringify(me)))}j(null,xe)}var me})}reloadTile(O,j){const J=this.loaded;return J&&J[O.uid]?super.reloadTile(O,j):this.loadTile(O,j)}loadGeoJSON(O,j){if(O.request)p.getJSON(O.request,j);else{if("string"!=typeof O.data)return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(O.data))}catch(J){return j(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(J){j(J)}}getClusterChildren(O,j){try{j(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(J){j(J)}}getClusterLeaves(O,j){try{j(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(J){j(J)}}}class vr{constructor(O){this.self=O,this.actor=new p.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:ga},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,J)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=J},this.self.registerRTLTextPlugin=j=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=j.applyArabicShaping,p.plugin.processBidirectionalText=j.processBidirectionalText,p.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(O,j,J){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],J()}checkIfReady(O,j,J){J()}setReferrer(O,j){this.referrer=j}spriteLoaded(O,j){this.isSpriteLoaded[O]=j;for(const J in this.workerSources[O]){const re=this.workerSources[O][J];for(const de in re)re[de]instanceof p.VectorTileWorkerSource&&(re[de].isSpriteLoaded=j,re[de].fire(new p.Event("isSpriteLoaded")))}}setImages(O,j,J){this.availableImages[O]=j;for(const re in this.workerSources[O]){const de=this.workerSources[O][re];for(const Ee in de)de[Ee].availableImages=j}J()}enableTerrain(O,j,J){this.terrain=j,J()}setProjection(O,j){this.projections[O]=p.getProjection(j)}setLayers(O,j,J){this.getLayerIndex(O).replace(j),J()}updateLayers(O,j,J){this.getLayerIndex(O).update(j.layers,j.removedIds),J()}loadTile(O,j,J){const re=this.enableTerrain?p.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,j.type,j.source).loadTile(re,J)}loadDEMTile(O,j,J){const re=this.enableTerrain?p.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(O,j.source).loadTile(re,J)}reloadTile(O,j,J){const re=this.enableTerrain?p.extend({enableTerrain:this.terrain},j):j;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,j.type,j.source).reloadTile(re,J)}abortTile(O,j,J){this.getWorkerSource(O,j.type,j.source).abortTile(j,J)}removeTile(O,j,J){this.getWorkerSource(O,j.type,j.source).removeTile(j,J)}removeSource(O,j,J){if(!this.workerSources[O]||!this.workerSources[O][j.type]||!this.workerSources[O][j.type][j.source])return;const re=this.workerSources[O][j.type][j.source];delete this.workerSources[O][j.type][j.source],void 0!==re.removeSource?re.removeSource(j,J):J()}loadWorkerSource(O,j,J){try{this.self.importScripts(j.url),J()}catch(re){J(re.toString())}}syncRTLPluginState(O,j,J){try{p.plugin.setState(j);const re=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=re){this.self.importScripts(re);const de=p.plugin.isParsed();J(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),de)}}catch(re){J(re.toString())}}getAvailableImages(O){let j=this.availableImages[O];return j||(j=[]),j}getLayerIndex(O){let j=this.layerIndexes[O];return j||(j=this.layerIndexes[O]=new Tr),j}getWorkerSource(O,j,J){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][j]||(this.workerSources[O][j]={}),this.workerSources[O][j][J]||(this.workerSources[O][j][J]=new this.workerSourceTypes[j]({send:(re,de,Ee,xe,me,Ce)=>{this.actor.send(re,de,Ee,O,me,Ce)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][j][J]}getDEMWorkerSource(O,j){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][j]||(this.demWorkerSources[O][j]=new Lt),this.demWorkerSources[O][j]}enforceCacheSizeLimit(O,j){p.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(O,j,J){J(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new vr(self)),vr}),ua(0,function(p){var Kn=Yi;function Yi(m){return o=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{v=new Worker(E),g=!0}catch(M){g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===Tr[u=o&&o.failIfMajorPerformanceCaveat]&&(Tr[u]=function(g){var v,E,M,k,b=(E=g,M=document.createElement("canvas"),(k=Object.create(Yi.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,M.getContext("webgl",k)||M.getContext("experimental-webgl",k));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch(E){return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!Tr[u]||document.documentMode));var o,u}var Tr={};function at(m,o){var u=o[0],g=o[1],v=o[2],b=o[3],E=u*b-v*g;return E?(m[0]=b*(E=1/E),m[1]=-g*E,m[2]=-v*E,m[3]=u*E,m):null}function Lt(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let u=0;u<m.length;u++)if(!Lt(m[u],o[u]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==o){if("object"!=typeof o||Object.keys(m).length!==Object.keys(o).length)return!1;for(const u in m)if(!Lt(m[u],o[u]))return!1;return!0}return m===o}Yi.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Be={create:function(m,o,u){const g=p.window.document.createElement(m);return void 0!==o&&(g.className=o),u&&u.appendChild(g),g},createSVG:function(m,o,u){const g=p.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(o))g.setAttributeNS(null,v,o[v]);return u&&u.appendChild(g),g}},jr=p.window.document&&p.window.document.documentElement.style,Vn=jr&&void 0!==jr.userSelect?"userSelect":"WebkitUserSelect";let Vo;Be.disableDrag=function(){jr&&Vn&&(Vo=jr[Vn],jr[Vn]="none")},Be.enableDrag=function(){jr&&Vn&&(jr[Vn]=Vo)};const Vr=function(m){m.preventDefault(),m.stopPropagation(),p.window.removeEventListener("click",Vr,!0)};function as(m,o,u){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new p.pointGeometry((u.clientX-o.left)*g,(u.clientY-o.top)*g)}function U(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}Be.suppressClick=function(){p.window.addEventListener("click",Vr,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Vr,!0)},0)},Be.mousePos=function(m,o){const u=m.getBoundingClientRect();return as(m,u,o)},Be.touchPos=function(m,o){const u=m.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(as(m,u,o[v]));return g},Be.mouseButton=function(m){return void 0!==p.window.InstallTrigger&&2===m.button&&m.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button};class $ extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const v of o){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(o,u){return!(o&&(4!==o.length||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let g=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const g={};for(const v of o){this.images[v]||this.fire(new p.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:p.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],g=this.getImage(o);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new p.ImagePosition(v,g);this.patterns[o]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:g}=p.potpack(o),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],M=E.x+1,k=E.y+1,R=this.images[b].data,L=R.width,B=R.height;p.RGBAImage.copy(R,v,{x:0,y:0},{x:M,y:k},{width:L,height:B}),p.RGBAImage.copy(R,v,{x:0,y:B-1},{x:M,y:k-1},{width:L,height:1}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:M,y:k+B},{width:L,height:1}),p.RGBAImage.copy(R,v,{x:L-1,y:0},{x:M-1,y:k},{width:1,height:B}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:M+L,y:k},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];U(g)&&this.updateImage(u,g)}}}const q=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(m,o){return function([u,g,v]){const b=p.degToRad(g+90),E=p.degToRad(v);return{x:u*Math.cos(b)*Math.sin(E),y:u*Math.sin(b)*Math.sin(E),z:u*Math.cos(E),azimuthal:g,polar:v}}(m.expression.evaluate(o))}interpolate(m,o,u){return{x:p.number(m.x,o.x,u),y:p.number(m.y,o.y,u),z:p.number(m.z,o.z,u),azimuthal:p.number(m.azimuthal,o.azimuthal,u),polar:p.number(m.polar,o.polar,u)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),ee="-transition";class fe extends p.Evented{constructor(o){super(),this._transitionable=new p.Transitionable(q),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(p.validateLight,o,u))for(const g in o){const v=o[g];p.endsWith(g,ee)?this._transitionable.setTransition(g.slice(0,-ee.length),v):this._transitionable.setValue(g,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ge=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),De="-transition";class Ne extends p.Evented{constructor(o,u){super(),this._transitionable=new p.Transitionable(ge),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(o){for(const u in o){const g=o[u];p.endsWith(u,De)?this._transitionable.setTransition(u.slice(0,-De.length),g):this._transitionable.setValue(u,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function st(m,o,u,g){const v=p.smoothstep(45,65,u),[b,E]=ht(m,g),M=p.length(o);let k=1-Math.min(1,Math.exp((M-b)/(E-b)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*m.alpha}function ht(m,o){const u=.5/Math.tan(.5*o);return[m.range[0]+u,m.range[1]+u]}const Pt=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"])}),bt="-transition";class gn extends p.Evented{constructor(o,u){super(),this._transitionable=new p.Transitionable(Pt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u={}){if(!this._validate(p.validateFog,o,u))for(const g in o){const v=o[g];p.endsWith(g,bt)?this._transitionable.setTransition(g.slice(0,-bt.length),v):this._transitionable.setValue(g,v)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return p.smoothstep(45,65,o)*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(g,v,b){const E=p.MercatorCoordinate.fromLngLat(v),M=b.elevation?b.elevation.getAtPointOrZero(E):0,k=[E.x,E.y,M];return p.transformMat4(k,k,b.mercatorFogMatrix),st(g,k,b.pitch,b._fov)}(this.state,o,u):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ht(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class zn{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new zn.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,u,g){p.asyncAll(this.actors,(v,b)=>{v.send(o,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function an(m,o,u){return o*(p.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}zn.Actor=p.Actor;class $o{constructor(o,u,g){this.context=o;const v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const si={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rn{constructor(o,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],E=u.attributes[b.name];void 0!==E&&o.vertexAttribPointer(E,b.components,o[si[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ln{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vc extends ln{getDefault(){return p.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ha extends ln{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class da extends ln{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class mo extends ln{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class pa extends ln{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class go extends ln{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class yr extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Dr extends ln{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class $c extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Cn extends ln{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Qa extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class Yl extends ln{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Jt extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Ji extends ln{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class el extends ln{getDefault(){return p.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Gc extends ln{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Hc extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class Jl extends ln{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ln extends ln{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class ls extends ln{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class zs extends ln{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Bs extends ln{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class tl extends ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ur extends ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class qc extends ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Zc extends ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _o extends ln{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Qi extends ln{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Qu extends ln{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class nl extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Ql extends ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ns extends ln{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class ec extends Ns{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class yo extends Ns{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class eh extends yo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class sr{constructor(o,u,g,v){this.context=o,this.width=u,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new ec(o,b),v&&(this.depthAttachment=new yo(o,b))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class Ui{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Vc(this),this.clearDepth=new ha(this),this.clearStencil=new da(this),this.colorMask=new mo(this),this.depthMask=new pa(this),this.stencilMask=new go(this),this.stencilFunc=new yr(this),this.stencilOp=new Dr(this),this.stencilTest=new $c(this),this.depthRange=new Cn(this),this.depthTest=new Qa(this),this.depthFunc=new Yl(this),this.blend=new Jt(this),this.blendFunc=new Ji(this),this.blendColor=new el(this),this.blendEquation=new Gc(this),this.cullFace=new Hc(this),this.cullFaceSide=new Jl(this),this.frontFace=new Ln(this),this.program=new ls(this),this.activeTexture=new zs(this),this.viewport=new Bs(this),this.bindFramebuffer=new tl(this),this.bindRenderbuffer=new ur(this),this.bindTexture=new qc(this),this.bindVertexBuffer=new Zc(this),this.bindElementBuffer=new _o(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Qi(this),this.pixelStoreUnpack=new Qu(this),this.pixelStoreUnpackPremultiplyAlpha=new nl(this),this.pixelStoreUnpackFlipY=new Ql(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new $o(this,o,u)}createVertexBuffer(o,u,g){return new Rn(this,o,u,g)}createRenderbuffer(o,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,g){return new sr(this,o,u,g)}clear({color:o,depth:u,stencil:g}){const v=this.gl;let b=0;o&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){Lt(o.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class fa{constructor(o,u,g,v){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>v.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,u){let g,v;if(o instanceof p.pointGeometry||"number"==typeof o[0]){const b=p.pointGeometry.convert(o);g=[p.pointGeometry.convert(o)],v=u.isPointAboveHorizon(b)}else{const b=p.pointGeometry.convert(o[0]),E=p.pointGeometry.convert(o[1]);g=[b,E],v=p.polygonizeBounds(b,E).every(M=>u.isPointAboveHorizon(M))}return new fa(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],v=p.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),p.bufferConvexPolygon(v,o)}containsTile(o,u,g){const v=o.queryPadding+1,b=o.tileID.wrap,E=g?this._bufferedCameraMercator(v,u).map(Z=>p.getTilePoint(o.tileTransform,Z,b)):this._bufferedScreenMercator(v,u).map(Z=>p.getTilePoint(o.tileTransform,Z,b)),M=this.screenGeometryMercator.map(Z=>p.getTileVec3(o.tileTransform,Z,b)),k=M.map(Z=>new p.pointGeometry(Z[0],Z[1])),R=u.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),L=p.getTileVec3(o.tileTransform,R,b),B=M.map(Z=>{const Y=p.sub(Z,Z,L);return p.normalize(Y,Y),new p.Ray(L,Y)}),G=an(o,1,u.zoom);if(p.polygonIntersectsBox(E,0,0,p.EXTENT,p.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:B,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(K=p.getBounds(E),K.min.x=p.clamp(K.min.x,0,p.EXTENT),K.min.y=p.clamp(K.min.y,0,p.EXTENT),K.max.x=p.clamp(K.max.x,0,p.EXTENT),K.max.y=p.clamp(K.max.y,0,p.EXTENT),K),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:G};var K}_bufferedScreenMercator(o,u){const g=vo(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const v=this.bufferedScreenGeometry(o).map(b=>u.pointCoordinate3D(b));return this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,u){const g=vo(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const v=this.bufferedCameraGeometry(o).map(b=>u.pointCoordinate3D(b));return this._cameraRaycastCache[g]=v,v}}}function vo(m){return 100*m|0}function ma(m,o,u){const g=function(v,b){if(v)return u(v);if(b){const E=p.pick(p.extend(b,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(M=>M.id)),E.tiles=o.canonicalizeTileset(E,m.url),u(null,E)}};return m.url?p.getJSON(o.transformRequest(o.normalizeSourceURL(m.url),p.ResourceType.Source),g):p.exported.frame(()=>g(null,m))}class Us{constructor(o,u,g){this.bounds=p.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),g=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),E=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=g&&o.x<b&&o.y>=v&&o.y<E}}class cs extends p.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},u),p.extend(this,p.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ma(this._options,this.map._requestManager,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):u&&(p.extend(this,u),u.bounds&&(this.tileBounds=new Us(u.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(u.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const g=p.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(v,p.ResourceType.Tile),(b,E,M,k)=>{if(delete o.request,o.aborted)o.state="unloaded",u(null);else if(b)o.state="errored",u(b);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:M,expires:k});const R=this.map.painter.context,L=R.gl;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new p.Texture(R,E,L.RGBA,{useMipmap:!0}),o.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE),R.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}}let eo;function us(m,o,u,g,v,b,E,M){const k=[m,u,v,o,g,b,1,1,1],R=[E,M,1],L=p.adjoint([],k),[B,G,K]=p.transformMat3(R,R,p.transpose(L,L));return p.multiply(k,[B,0,0,0,G,0,0,0,K],k)}class xo extends p.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o,u){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(g,v)=>{this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):v&&(this.image=p.exported.getImageData(v),this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o,delete this._boundsArray;const u=o.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,E=-1/0,M=-1/0;for(const B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),E=Math.max(E,B.x),M=Math.max(M,B.y);const k=Math.max(E-v,M-b),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,R);return new p.CanonicalTileID(R,Math.floor((v+E)/2*L),Math.floor((b+M)/2*L))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const o=p.tileTransform(this.tileID,this.map.transform.projection),[u,g,v,b]=this.coordinates.map(E=>{const M=o.projection.project(E[0],E[1]);return p.getTilePoint(o,M)._round()});return this.perspectiveTransform=function(E,M,k,R,L,B,G,K,Z,Y){const he=us(0,0,E,0,0,M,E,M),W=us(k,R,L,B,G,K,Z,Y);return p.multiply(W,p.adjoint(he,he),W),[W[6]/W[8]*E/p.EXTENT,W[7]/W[8]*M/p.EXTENT]}(this.width,this.height,u.x,u.y,g.x,g.y,b.x,b.y,v.x,v.y),this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(u.x,u.y,0,0),this._boundsArray.emplaceBack(g.x,g.y,p.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,p.EXTENT),this._boundsArray.emplaceBack(v.x,v.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ga={vector:class extends p.Evented{constructor(m,o,u,g){if(super(),this.id=m,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(o,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ma(this._options,this.map._requestManager,(m,o)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new p.ErrorEvent(m)):o&&(p.extend(this,o),o.bounds&&(this.tileBounds=new Us(o.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const o=this.map.style._getSourceCaches(this.id);for(const u of o)u.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,p.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=o:m.request=m.actor.send("reloadTile",g,v.bind(this));else if(m.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=p.loadVectorTile.call({deduped:this._deduped},g,(E,M)=>{E||!M?v.call(this,E):(g.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},m.actor&&m.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);m.request={cancel:b}}function v(b,E){return delete m.request,m.aborted?o(null):b&&404!==b.status?o(b):(E&&E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadVectorData(E,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:cs,"raster-dem":class extends cs{constructor(m,o,u,g){super(m,o,u,g),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(m.state="errored",o(v)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=p.getImage(this.map._requestManager.transformRequest(u,p.ResourceType.Tile),function(v,b,E,M){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(v)m.state="errored",o(v);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:M});const k=p.window.ImageBitmap&&b instanceof p.window.ImageBitmap&&(null==eo&&(eo=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),eo),R=1-(b.width-p.prevPowerOfTwo(b.width))/2;R<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const L=k?b:p.exported.getImageData(b,R),B={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,u=Math.pow(2,o.z),g=(o.x-1+u)%u,v=0===o.x?m.wrap-1:m.wrap,b=(o.x+1+u)%u,E=o.x+1===u?m.wrap+1:m.wrap,M={};return M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,E,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,E,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<u&&(M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,E,o.z,b,o.y+1).key]={backfilled:!1}),M}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends p.Evented{constructor(m,o,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=o.data,this._options=p.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*v,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*v,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},o),this}getClusterLeaves(m,o,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:o,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=p.extend({},this.workerOptions),o=this._data;"string"==typeof o?(m.request=this.map._requestManager.transformRequest(p.exported.resolveURL(o),p.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new p.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new p.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,o){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(u,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete m.request,m.unloadVectorData(),m.aborted?o(null):g?o(g):(m.loadVectorData(v,this.map.painter,"reloadTile"===u),o(null))),void 0,"loadTile"===u)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xo{constructor(m,o,u,g){super(m,o,u,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,p.ResourceType.Source).url);p.getVideo(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(m,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2));for(const u in this.tiles){const g=this.tiles[u];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xo,canvas:class extends xo{constructor(m,o,u,g){super(m,o,u,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,u=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(o,this.canvas,u.RGBA,{premultiply:!0});for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}}},vr=function(m,o,u,g){const v=new ga[o.type](m,o,u,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],v),v};function te(m,o){const u=p.identity([]);return p.scale(u,u,[.5*m.width,.5*-m.height,1]),p.translate(u,u,[1,-1,0]),p.multiply$1(u,u,m.calculateProjMatrix(o.toUnwrapped()))}function O(m,o,u,g,v,b,E,M=!1){const k=m.tilesIn(g,E,M);k.sort(J);const R=[];for(const B of k)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,m._state,B,v,b,te(m.transform,B.tile.tileID),M)});const L=function(B){const G={},K={};for(const Z of B){const Y=Z.queryResults,he=Z.wrappedTileID,W=K[he]=K[he]||{};for(const ae in Y){const le=Y[ae],se=W[ae]=W[ae]||{},ie=G[ae]=G[ae]||[];for(const ue of le)se[ue.featureIndex]||(se[ue.featureIndex]=!0,ie.push(ue))}}return G}(R);for(const B in L)L[B].forEach(G=>{const K=G.feature,Z=m.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=Z});return L}function j(m,o){const u=m.getRenderableIds().map(b=>m.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const E=u[b],M=E.tileID.canonical.key;v[M]||(v[M]=!0,E.querySourceFeatures(g,o))}return g}function J(m,o){const u=m.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function re(){return null!=hi.workerClass?new hi.workerClass:new p.window.Worker(hi.workerUrl)}const de="mapboxgl_preloaded_worker_pool";class Ee{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Ee.workerCount;)this.workers.push(new re);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[de]}numActive(){return Object.keys(this.active).length}}let xe;function me(){return xe||(xe=new Ee),xe}function Ce(m,o){const u={};for(const g in m)"ref"!==g&&(u[g]=m[g]);return p.refProperties.forEach(g=>{g in o&&(u[g]=o[g])}),u}function Re(m){m=m.slice();const o=Object.create(null);for(let u=0;u<m.length;u++)o[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Ce(m[u],o[m[u].ref]));return m}Ee.workerCount=2;const ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function He(m,o,u){u.push({command:ze.addSource,args:[m,o[m]]})}function yt(m,o,u){o.push({command:ze.removeSource,args:[m]}),u[m]=!0}function Mt(m,o,u,g){yt(m,u,g),He(m,o,u)}function wt(m,o,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&"data"!==g&&!Lt(m[u][g],o[u][g]))return!1;for(g in o[u])if(o[u].hasOwnProperty(g)&&"data"!==g&&!Lt(m[u][g],o[u][g]))return!1;return!0}function St(m,o,u,g,v,b){let E;for(E in o=o||{},m=m||{})m.hasOwnProperty(E)&&(Lt(m[E],o[E])||u.push({command:b,args:[g,E,o[E],v]}));for(E in o)o.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(Lt(m[E],o[E])||u.push({command:b,args:[g,E,o[E],v]}))}function jt(m){return m.id}function $n(m,o){return m[o.id]=o,m}class Zn{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=p.clamp(o,0,1);let u=1,g=this._distances[u];const v=o*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,E=this._distances[b],M=g-E,k=M>0?(v-E)/M:0;return this.points[b].mult(1-k).add(this.points[u].mult(k))}}class On{constructor(o,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(o,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,u,g,v,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,u,g,v,b,E){this.circleCells[b].push(E)}_query(o,u,g,v,b,E){if(g<0||o>this.width||v<0||u>this.height)return!b&&[];const M=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const R=this.circles[3*k],L=this.circles[3*k+1],B=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:R-B,y1:L-B,x2:R+B,y2:L+B})}return E?M.filter(E):M}return this._forEachCell(o,u,g,v,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?M.length>0:M}_queryCircle(o,u,g,v,b){const E=o-g,M=o+g,k=u-g,R=u+g;if(M<0||E>this.width||R<0||k>this.height)return!v&&[];const L=[];return this._forEachCell(E,k,M,R,this._queryCellCircle,L,{hitTest:v,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?L.length>0:L}query(o,u,g,v,b){return this._query(o,u,g,v,!1,b)}hitTest(o,u,g,v,b){return this._query(o,u,g,v,!0,b)}hitTestCircle(o,u,g,v){return this._queryCircle(o,u,g,!0,v)}_queryCell(o,u,g,v,b,E,M,k){const R=M.seenUids,L=this.boxCells[b];if(null!==L){const G=this.bboxes;for(const K of L)if(!R.box[K]){R.box[K]=!0;const Z=4*K;if(o<=G[Z+2]&&u<=G[Z+3]&&g>=G[Z+0]&&v>=G[Z+1]&&(!k||k(this.boxKeys[K]))){if(M.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[K],x1:G[Z],y1:G[Z+1],x2:G[Z+2],y2:G[Z+3]})}}}const B=this.circleCells[b];if(null!==B){const G=this.circles;for(const K of B)if(!R.circle[K]){R.circle[K]=!0;const Z=3*K;if(this._circleAndRectCollide(G[Z],G[Z+1],G[Z+2],o,u,g,v)&&(!k||k(this.circleKeys[K]))){if(M.hitTest)return E.push(!0),!0;{const Y=G[Z],he=G[Z+1],W=G[Z+2];E.push({key:this.circleKeys[K],x1:Y-W,y1:he-W,x2:Y+W,y2:he+W})}}}}}_queryCellCircle(o,u,g,v,b,E,M,k){const R=M.circle,L=M.seenUids,B=this.boxCells[b];if(null!==B){const K=this.bboxes;for(const Z of B)if(!L.box[Z]){L.box[Z]=!0;const Y=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,K[Y+0],K[Y+1],K[Y+2],K[Y+3])&&(!k||k(this.boxKeys[Z])))return E.push(!0),!0}}const G=this.circleCells[b];if(null!==G){const K=this.circles;for(const Z of G)if(!L.circle[Z]){L.circle[Z]=!0;const Y=3*Z;if(this._circlesCollide(K[Y],K[Y+1],K[Y+2],R.x,R.y,R.radius)&&(!k||k(this.circleKeys[Z])))return E.push(!0),!0}}}_forEachCell(o,u,g,v,b,E,M,k){const R=this._convertToXCellCoord(o),L=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),G=this._convertToYCellCoord(v);for(let K=R;K<=B;K++)for(let Z=L;Z<=G;Z++)if(b.call(this,o,u,g,v,this.xCellCount*Z+K,E,M,k))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,v,b,E){const M=v-o,k=b-u,R=g+E;return R*R>M*M+k*k}_circleAndRectCollide(o,u,g,v,b,E,M){const k=(E-v)/2,R=Math.abs(o-(v+k));if(R>k+g)return!1;const L=(M-b)/2,B=Math.abs(u-(b+L));if(B>L+g)return!1;if(R<=k||B<=L)return!0;const G=R-k,K=B-L;return G*G+K*K<=g*g}}const Yn=Math.tan(85*Math.PI/180);function js(m,o,u,g,v,b){let E=p.create();if(u){if("globe"===v.projection.name)E=p.calculateGlobeMatrix(v,v.worldSize/v._projectionScaler,[0,0]),p.multiply$1(E,E,p.globeDenormalizeECEF(p.globeTileBounds(o)));else{const M=at([],b);E[0]=M[0],E[1]=M[1],E[4]=M[2],E[5]=M[3]}g||p.rotateZ(E,E,v.angle)}else p.multiply$1(E,v.labelPlaneMatrix,m);return E}function hs(m,o,u,g,v,b){if(u){if("globe"===v.projection.name){const E=js(m,o,u,g,v,b);return p.invert(E,E),p.multiply$1(E,m,E),E}{const E=p.clone(m),M=p.identity([]);return M[0]=b[0],M[1]=b[1],M[4]=b[2],M[5]=b[3],p.multiply$1(E,E,M),g||p.rotateZ(E,E,-v.angle),E}}return v.glCoordMatrix}function Qr(m,o,u=0){const g=[m.x,m.y,u,1];u?p.transformMat4$1(g,g,o):_a(g,g,o);const v=g[3];return{point:new p.pointGeometry(g[0]/v,g[1]/v),signedDistanceFromCamera:v}}function bo(m,o){return Math.min(.5+m/o*.5,1.5)}function Wc(m,o){const u=m[0]/m[3],g=m[1]/m[3];return u>=-o[0]&&u<=o[0]&&g>=-o[1]&&g<=o[1]}function td(m,o,u,g,v,b,E,M,k,R){const L=u.transform,B=g?m.textSizeData:m.iconSizeData,G=p.evaluateSizeForZoom(B,u.transform.zoom),K=[256/u.width*2+1,256/u.height*2+1],Z=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Z.clear();const Y=m.lineVertexArray,he=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,W=u.transform.width/u.transform.height;let ae=!1;for(let le=0;le<he.length;le++){const se=he.get(le);if(se.writingMode!==p.WritingMode.vertical||ae||0!==le&&he.get(le-1).writingMode===p.WritingMode.horizontal||(ae=!0),se.hidden||se.writingMode===p.WritingMode.vertical&&!ae){rn(se.numGlyphs,Z);continue}ae=!1;const ie=new p.pointGeometry(se.tileAnchorX,se.tileAnchorY),ue=k?k(ie):[0,0,0],ye=L.projection.projectTilePoint(ie.x,ie.y,R.canonical),Ie=[ye.x+ue[0],ye.y+ue[1],ye.z+ue[2]],Qe=[...Ie,1];if(p.transformMat4$1(Qe,Qe,o),!Wc(Qe,K)){rn(se.numGlyphs,Z);continue}const Ge=bo(u.transform.cameraToCenterDistance,Qe[3]),$e=p.evaluateSizeForFeature(B,G,se),Ae=E?$e/Ge:$e*Ge,Me=Qr(new p.pointGeometry(Ie[0],Ie[1]),v,Ie[2]);if(Me.signedDistanceFromCamera<=0){rn(se.numGlyphs,Z);continue}let Ve={};const Oe=E?null:k,mt=rl(se,Ae,!1,M,o,v,b,m.glyphOffsetArray,Y,Z,Me.point,ie,Ve,W,Oe,L.projection,R);ae=mt.useVertical,Oe&&mt.needsFlipping&&(Ve={}),(mt.notEnoughRoom||ae||mt.needsFlipping&&rl(se,Ae,!0,M,o,v,b,m.glyphOffsetArray,Y,Z,Me.point,ie,Ve,W,Oe,L.projection,R).notEnoughRoom)&&rn(se.numGlyphs,Z)}g?m.text.dynamicLayoutVertexBuffer.updateData(Z):m.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Pr(m,o,u,g,v,b,E,M,k,R,L,B,G,K,Z){const Y=M.glyphStartIndex+M.numGlyphs,he=M.lineStartIndex,W=M.lineStartIndex+M.lineLength,ae=o.getoffsetX(M.glyphStartIndex),le=o.getoffsetX(Y-1),se=Pn(m*ae,u,g,v,b,E,M.segment,he,W,k,R,L,B,G,!0,K,Z);if(!se)return null;const ie=Pn(m*le,u,g,v,b,E,M.segment,he,W,k,R,L,B,G,!0,K,Z);return ie?{first:se,last:ie}:null}function tc(m,o,u,g){return m.writingMode===p.WritingMode.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*g?{useVertical:!0}:m.writingMode===p.WritingMode.vertical?o.y<u.y?{needsFlipping:!0}:null:0!==m.flipState&&function(v,b,E){const M=(b.x-v.x)*E;return 0===M||Math.abs((b.y-v.y)/M)>Yn}(o,u,g)?1===m.flipState?{needsFlipping:!0}:null:o.x>u.x?{needsFlipping:!0}:null}function rl(m,o,u,g,v,b,E,M,k,R,L,B,G,K,Z,Y,he){const W=o/24,ae=m.lineOffsetX*W,le=m.lineOffsetY*W;let se;if(m.numGlyphs>1){const ie=m.glyphStartIndex+m.numGlyphs,ue=m.lineStartIndex,ye=m.lineStartIndex+m.lineLength,Ie=Pr(W,M,ae,le,u,L,B,m,k,b,G,Z,!1,Y,he);if(!Ie)return{notEnoughRoom:!0};const Qe=Qr(Ie.first.point,E).point,Ge=Qr(Ie.last.point,E).point;if(g&&!u){const $e=tc(m,Qe,Ge,K);if(m.flipState=$e&&$e.needsFlipping?1:2,$e)return $e}se=[Ie.first];for(let $e=m.glyphStartIndex+1;$e<ie-1;$e++)se.push(Pn(W*M.getoffsetX($e),ae,le,u,L,B,m.segment,ue,ye,k,b,G,Z,!1,!1,Y,he));se.push(Ie.last)}else{if(g&&!u){const ue=Qr(B,v).point,ye=m.lineStartIndex+m.segment+1,Ie=new p.pointGeometry(k.getx(ye),k.gety(ye)),Qe=Qr(Ie,v),Ge=tc(m,ue,Qe.signedDistanceFromCamera>0?Qe.point:il(B,Ie,ue,1,v,void 0,Y,he.canonical),K);if(m.flipState=Ge&&Ge.needsFlipping?1:2,Ge)return Ge}const ie=Pn(W*M.getoffsetX(m.glyphStartIndex),ae,le,u,L,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,k,b,G,Z,!1,!1,Y,he);if(!ie)return{notEnoughRoom:!0};se=[ie]}for(const ie of se)p.addDynamicAttributes(R,ie.point,ie.angle);return{}}function Xc(m,o,u,g,v){const b=g.projectTilePoint(m.x,m.y,o);if(!v)return Qr(b,u,b.z);const E=v(m);return Qr(new p.pointGeometry(b.x+E[0],b.y+E[1]),u,b.z+E[2])}function il(m,o,u,g,v,b,E,M){const k=Xc(m.add(m.sub(o)._unit()),M,v,E,b).point,R=u.sub(k);return u.add(R._mult(g/R.mag()))}function Pn(m,o,u,g,v,b,E,M,k,R,L,B,G,K,Z,Y,he){const W=g?m-o:m+o;let ae=W>0?1:-1,le=0;g&&(ae*=-1,le=Math.PI),ae<0&&(le+=Math.PI);let se=ae>0?M+E:M+E+1,ie=v,ue=v,ye=0,Ie=0;const Qe=Math.abs(W),Ge=[],$e=[];let Ae=b;const Me=()=>{const Ye=se-ae;return 0===ye?b:new p.pointGeometry(R.getx(Ye),R.gety(Ye))},Ve=()=>il(Me(),Ae,ue,Qe-ye+1,L,G,Y,he.canonical);for(;ye+Ie<=Qe;){if(se+=ae,se<M||se>=k)return null;if(ue=ie,Ge.push(ie),K&&$e.push(Ae||Me()),ie=B[se],void 0===ie){Ae=new p.pointGeometry(R.getx(se),R.gety(se));const Ye=Xc(Ae,he.canonical,L,Y,G);ie=Ye.signedDistanceFromCamera>0?B[se]=Ye.point:Ve()}else Ae=null;ye+=Ie,Ie=ue.dist(ie)}Z&&G&&(Ae=Ae||new p.pointGeometry(R.getx(se),R.gety(se)),B[se]=ie=void 0===B[se]?ie:Ve(),Ie=ue.dist(ie));const Oe=(Qe-ye)/Ie,mt=ie.sub(ue),Dt=mt.mult(Oe)._add(ue);u&&Dt._add(mt._unit()._perp()._mult(u*ae));const Gt=le+Math.atan2(ie.y-ue.y,ie.x-ue.x);return Ge.push(Dt),K&&(Ae=Ae||new p.pointGeometry(R.getx(se),R.gety(se)),$e.push(function(Ye,_t,Rt){const In=1-Rt;return new p.pointGeometry(Ye.x*In+_t.x*Rt,Ye.y*In+_t.y*Rt)}($e.length>0?$e[$e.length-1]:Ae,Ae,Oe))),{point:Dt,angle:Gt,path:Ge,tilePath:$e}}const nc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rn(m,o){for(let u=0;u<m;u++){const g=o.length;o.resize(g+4),o.float32.set(nc,3*g)}}function _a(m,o,u){const g=o[0],v=o[1];return m[0]=u[0]*g+u[4]*v+u[12],m[1]=u[1]*g+u[5]*v+u[13],m[3]=u[3]*g+u[7]*v+u[15],m}const Go=100;class th{constructor(o,u,g=new On(o.width+200,o.height+200,25),v=new On(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Go,this.screenBottomBoundary=o.height+Go,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,g,v,b,E,M){let k=u.projectedAnchorX,R=u.projectedAnchorY,L=u.projectedAnchorZ;const B=u.elevation,G=u.tileID;if(B&&G){const se=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ie=se.upVector(G.canonical,u.tileAnchorX,u.tileAnchorY),ue=se.upVectorScale(G.canonical);k+=ie[0]*B*ue,R+=ie[1]*B*ue,L+=ie[2]*B*ue}const K=this.projectAndGetPerspectiveRatio(E,k,R,L,u.tileID),Z=b*K.perspectiveRatio,Y=(u.x1*o+g.x-u.padding)*Z+K.point.x,he=(u.y1*o+g.y-u.padding)*Z+K.point.y,W=(u.x2*o+g.x+u.padding)*Z+K.point.x,ae=(u.y2*o+g.y+u.padding)*Z+K.point.y,le=K.perspectiveRatio<=.55||K.aboveHorizon;return!this.isInsideGrid(Y,he,W,ae)||!v&&this.grid.hitTest(Y,he,W,ae,M)||le?{box:[],offscreen:!1}:{box:[Y,he,W,ae],offscreen:this.isOffscreen(Y,he,W,ae)}}placeCollisionCircles(o,u,g,v,b,E,M,k,R,L,B,G,K,Z){const Y=[],he=this.transform.elevation,W=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ae=he?he.getAtTileOffsetFunc(Z,W):Oe=>[0,0,0],le=new p.pointGeometry(u.tileAnchorX,u.tileAnchorY),se=this.transform.projection.projectTilePoint(u.tileAnchorX,u.tileAnchorY,Z.canonical),ie=ae(le),ue=[se.x+ie[0],se.y+ie[1],se.z+ie[2]],ye=this.projectAndGetPerspectiveRatio(E,ue[0],ue[1],ue[2],Z),{perspectiveRatio:Ie}=ye,Qe=(L?b/Ie:b*Ie)/p.ONE_EM,Ge=Qr(new p.pointGeometry(ue[0],ue[1]),M,ue[2]).point,$e=ye.signedDistanceFromCamera>0?Pr(Qe,v,u.lineOffsetX*Qe,u.lineOffsetY*Qe,!1,Ge,le,u,g,M,{},he&&!L?ae:null,L&&!!he,this.transform.projection,Z):null;let Ae=!1,Me=!1,Ve=!0;if($e&&!ye.aboveHorizon){const Oe=.5*G*Ie+K,mt=new p.pointGeometry(-100,-100),Dt=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Gt=new Zn,Ye=$e.first,_t=$e.last;let Rt=[];for(let At=Ye.path.length-1;At>=1;At--)Rt.push(Ye.path[At]);for(let At=1;At<_t.path.length;At++)Rt.push(_t.path[At]);const In=2.5*Oe;if(k){const At=Rt.map(he?(qt,Jn)=>{const Ir=ae(Jn<Ye.path.length-1?Ye.tilePath[Ye.path.length-1-Jn]:_t.tilePath[Jn-Ye.path.length+2]);return Qr(qt,k,Ir[2])}:qt=>Qr(qt,k));Rt=At.some(qt=>qt.signedDistanceFromCamera<=0)?[]:At.map(qt=>qt.point)}let Nn=[];if(Rt.length>0){const At=Rt[0].clone(),qt=Rt[0].clone();for(let Jn=1;Jn<Rt.length;Jn++)At.x=Math.min(At.x,Rt[Jn].x),At.y=Math.min(At.y,Rt[Jn].y),qt.x=Math.max(qt.x,Rt[Jn].x),qt.y=Math.max(qt.y,Rt[Jn].y);Nn=At.x>=mt.x&&qt.x<=Dt.x&&At.y>=mt.y&&qt.y<=Dt.y?[Rt]:qt.x<mt.x||At.x>Dt.x||qt.y<mt.y||At.y>Dt.y?[]:p.clipLine([Rt],mt.x,mt.y,Dt.x,Dt.y)}for(const At of Nn){Gt.reset(At,.25*Oe);let qt=0;qt=Gt.length<=.5*Oe?1:Math.ceil(Gt.paddedLength/In)+1;for(let Jn=0;Jn<qt;Jn++){const Ir=Jn/Math.max(qt-1,1),Vi=Gt.lerp(Ir),Ao=Vi.x+Go,Fi=Vi.y+Go;Y.push(Ao,Fi,Oe,0);const cn=Ao-Oe,Ot=Fi-Oe,Kt=Ao+Oe,tr=Fi+Oe;if(Ve=Ve&&this.isOffscreen(cn,Ot,Kt,tr),Me=Me||this.isInsideGrid(cn,Ot,Kt,tr),!o&&this.grid.hitTestCircle(Ao,Fi,Oe,B)&&(Ae=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!R&&Ae||!Me?[]:Y,offscreen:Ve,collisionDetected:Ae}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,E=-1/0;for(const L of o){const B=new p.pointGeometry(L.x+Go,L.y+Go);g=Math.min(g,B.x),v=Math.min(v,B.y),b=Math.max(b,B.x),E=Math.max(E,B.y),u.push(B)}const M=this.grid.query(g,v,b,E).concat(this.ignoredGrid.query(g,v,b,E)),k={},R={};for(const L of M){const B=L.key;if(void 0===k[B.bucketInstanceId]&&(k[B.bucketInstanceId]={}),k[B.bucketInstanceId][B.featureIndex])continue;const G=[new p.pointGeometry(L.x1,L.y1),new p.pointGeometry(L.x2,L.y1),new p.pointGeometry(L.x2,L.y2),new p.pointGeometry(L.x1,L.y2)];p.polygonIntersectsPolygon(u,G)&&(k[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(o,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,v,b){const E=u?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let k=0;k<o.length;k+=4)E.insertCircle(M,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,u,g,v,b){const E=[u,g,v||0,1];let M=!1;if(v||this.transform.pitch>0){p.transformMat4$1(E,E,o);let k=!1;this.fogState&&b&&(k=function(R,L,B,G,K,Z){const Y=Z.calculateFogTileMatrix(K),he=[L,B,G];return p.transformMat4(he,he,Y),st(R,he,Z.pitch,Z._fov)}(this.fogState,u,g,v||0,b.toUnwrapped(),this.transform)>.9),M=E[2]>E[3]||k}else _a(E,E,o);return{point:new p.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+Go,(-E[1]/E[3]+1)/2*this.transform.height+Go),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:M}}isOffscreen(o,u,g,v){return g<Go||o>=this.screenRightBoundary||v<Go||u>this.screenBottomBoundary}isInsideGrid(o,u,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=p.identity([]);return p.translate(o,o,[-100,-100,0]),o}}class Wt{constructor(o,u,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class ya{constructor(o,u,g,v,b,E=!1){this.text=new Wt(o?o.text:null,u,g,b),this.icon=new Wt(o?o.icon:null,u,v,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rc{constructor(o,u,g,v=!1){this.text=o,this.icon=u,this.skipFade=g,this.clipped=v}}class _n{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Kc{constructor(o,u,g,v,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Vt{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function $r(m,o,u,g,v){const{horizontalAlign:b,verticalAlign:E}=p.getAnchorAlignment(m),M=-(b-.5)*o,k=-(E-.5)*u,R=p.evaluateVariableOffset(m,g);return new p.pointGeometry(M+R[0]*v,k+R[1]*v)}function Vs(m,o,u,g,v){const b=new p.pointGeometry(m,o);return u&&b._rotate(g?v:-v),b}class nh{constructor(o,u,g,v,b){this.transform=o.clone(),this.collisionIndex=new th(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Vt(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,g,v){const b=g.getBucket(u),E=g.latestFeatureIndex;if(!b||!E||u.id!==b.layerIds[0])return;const M=b.layers[0].layout,k=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/p.EXTENT,B=g.tileID.toUnwrapped(),G=this.transform.calculateProjMatrix(B),K="map"===M.get("text-pitch-alignment"),Z="map"===M.get("text-rotation-alignment");u.compileFilter();const Y=u.dynamicFilter(),he=u.dynamicFilterNeedsFeature(),W=this.transform.calculatePixelsToTileUnitsMatrix(g),ae=js(G,g.tileID.canonical,K,Z,this.transform,W);let le=null;if(K){const ue=hs(G,g.tileID.canonical,K,Z,this.transform,W);le=p.multiply$1([],this.transform.labelPlaneMatrix,ue)}let se=null;Y&&g.latestFeatureIndex&&(se={unwrappedTileID:B,dynamicFilter:Y,dynamicFilterNeedsFeature:he,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Kc(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,g.tileID);const ie={bucket:b,layout:M,posMatrix:G,textLabelPlaneMatrix:ae,labelToScreenMatrix:le,clippingData:se,scale:R,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const ue of b.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Ie,symbolInstanceEnd:Qe}=ue;o.push({sortKey:ye,symbolInstanceStart:Ie,symbolInstanceEnd:Qe,parameters:ie})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(o,u,g,v,b,E,M,k,R,L,B,G,K,Z,Y,he,W,ae){const le=[G.textOffset0,G.textOffset1],se=$r(o,g,v,le,b),ie=this.collisionIndex.placeCollisionBox(b,u,Vs(se.x,se.y,E,M,this.transform.angle),B,k,R,L.predicate);if((!he||0!==this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(ae,this.transform.zoom,K),he,Vs(se.x,se.y,E,M,this.transform.angle),B,k,R,L.predicate).box.length)&&ie.box.length>0){let ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ue=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:le,width:g,height:v,anchor:o,textScale:b,prevAnchor:ue},this.markUsedJustification(Z,o,G,Y),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,Y,G),this.placedOrientations[G.crossTileID]=Y),{shift:se,placedGlyphBoxes:ie}}}placeLayerBucketPart(o,u,g,v){const{bucket:b,layout:E,posMatrix:M,textLabelPlaneMatrix:k,labelToScreenMatrix:R,clippingData:L,textPixelRatio:B,holdingForFade:G,collisionBoxArray:K,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:Y,collisionGroup:he}=o.parameters,W=E.get("text-optional"),ae=E.get("icon-optional"),le=E.get("text-allow-overlap"),se=E.get("icon-allow-overlap"),ie="map"===E.get("text-rotation-alignment"),ue="map"===E.get("text-pitch-alignment"),ye="none"!==E.get("icon-text-fit"),Ie="viewport-y"===E.get("symbol-z-order"),Qe=le&&(se||!b.hasIconData()||ae),Ge=se&&(le||!b.hasTextData()||W);!b.collisionArrays&&K&&b.deserializeCollisionBoxes(K),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,K);const $e=(Ae,Me,Ve)=>{if(L){const cn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ot=null;if(L.dynamicFilterNeedsFeature){const Kt=this.retainedQueryData[b.bucketInstanceId];Ot=L.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:Kt.bucketIndex,sourceLayerIndex:Kt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(cn,Ot,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new p.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Ae.crossTileID]=new rc(!1,!1,!1,!0),void(u[Ae.crossTileID]=!0)}if(u[Ae.crossTileID])return;if(G)return void(this.placements[Ae.crossTileID]=new rc(!1,!1,!1));let Oe=!1,mt=!1,Dt=!0,Gt=null,Ye={box:null,offscreen:null},_t={box:null,offscreen:null},Rt=null,In=null,Nn=null,At=0,qt=0,Jn=0;Ve.textFeatureIndex?At=Ve.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(At=Ae.featureIndex),Ve.verticalTextFeatureIndex&&(qt=Ve.verticalTextFeatureIndex);const Ir=cn=>{cn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||cn.elevation)&&(cn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,cn.tileAnchorX,cn.tileAnchorY):0)},Vi=Ve.textBox;if(Vi){Ir(Vi);const cn=Kt=>{let tr=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Kt&&this.prevPlacement){const zi=this.prevPlacement.placedOrientations[Ae.crossTileID];zi&&(this.placedOrientations[Ae.crossTileID]=zi,tr=zi,this.markUsedOrientation(b,tr,Ae))}return tr},Ot=(Kt,tr)=>{if(b.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Ve.verticalTextBox){for(const zi of b.writingModes)if(zi===p.WritingMode.vertical?(Ye=tr(),_t=Ye):Ye=Kt(),Ye&&Ye.box&&Ye.box.length)break}else Ye=Kt()};if(E.get("text-variable-anchor")){let Kt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Sn=this.prevPlacement.variableOffsets[Ae.crossTileID];Kt.indexOf(Sn.anchor)>0&&(Kt=Kt.filter($i=>$i!==Sn.anchor),Kt.unshift(Sn.anchor))}const tr=(Sn,$i,Yo)=>{const di=b.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Me),Jo=(Sn.x2-Sn.x1)*di+2*Sn.padding,ft=(Sn.y2-Sn.y1)*di+2*Sn.padding,Ct=ye&&!se?$i:null;Ct&&Ir(Ct);let zr={box:[],offscreen:!1};const ka=le?2*Kt.length:Kt.length;for(let Ks=0;Ks<ka;++Ks){const Cr=this.attemptAnchorPlacement(Kt[Ks%Kt.length],Sn,Jo,ft,di,ie,ue,B,M,he,Ks>=Kt.length,Ae,Me,b,Yo,Ct,Z,Y);if(Cr&&(zr=Cr.placedGlyphBoxes,zr&&zr.box&&zr.box.length)){Oe=!0,Gt=Cr.shift;break}}return zr};Ot(()=>tr(Vi,Ve.iconBox,p.WritingMode.horizontal),()=>{const Sn=Ve.verticalTextBox;return Sn&&Ir(Sn),b.allowVerticalPlacement&&!(Ye&&Ye.box&&Ye.box.length)&&Ae.numVerticalGlyphVertices>0&&Sn?tr(Sn,Ve.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Ye&&(Oe=Ye.box,Dt=Ye.offscreen);const zi=cn(Ye&&Ye.box);if(!Oe&&this.prevPlacement){const Sn=this.prevPlacement.variableOffsets[Ae.crossTileID];Sn&&(this.variableOffsets[Ae.crossTileID]=Sn,this.markUsedJustification(b,Sn.anchor,Ae,zi))}}else{const Kt=(tr,zi)=>{const Sn=b.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Me),$i=this.collisionIndex.placeCollisionBox(Sn,tr,new p.pointGeometry(0,0),le,B,M,he.predicate);return $i&&$i.box&&$i.box.length&&(this.markUsedOrientation(b,zi,Ae),this.placedOrientations[Ae.crossTileID]=zi),$i};Ot(()=>Kt(Vi,p.WritingMode.horizontal),()=>{const tr=Ve.verticalTextBox;return b.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&tr?(Ir(tr),Kt(tr,p.WritingMode.vertical)):{box:null,offscreen:null}}),cn(Ye&&Ye.box&&Ye.box.length)}}if(Rt=Ye,Oe=Rt&&Rt.box&&Rt.box.length>0,Dt=Rt&&Rt.offscreen,Ae.useRuntimeCollisionCircles){const cn=b.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),Ot=p.evaluateSizeForFeature(b.textSizeData,Z,cn),Kt=E.get("text-padding");In=this.collisionIndex.placeCollisionCircles(le,cn,b.lineVertexArray,b.glyphOffsetArray,Ot,M,k,R,g,ue,he.predicate,Ae.collisionCircleDiameter*Ot/p.ONE_EM,Kt,this.retainedQueryData[b.bucketInstanceId].tileID),Oe=le||In.circles.length>0&&!In.collisionDetected,Dt=Dt&&In.offscreen}if(Ve.iconFeatureIndex&&(Jn=Ve.iconFeatureIndex),Ve.iconBox){const cn=Ot=>{Ir(Ot);const Kt=ye&&Gt?Vs(Gt.x,Gt.y,ie,ue,this.transform.angle):new p.pointGeometry(0,0),tr=b.getSymbolInstanceIconSize(Y,this.transform.zoom,Me);return this.collisionIndex.placeCollisionBox(tr,Ot,Kt,se,B,M,he.predicate)};_t&&_t.box&&_t.box.length&&Ve.verticalIconBox?(Nn=cn(Ve.verticalIconBox),mt=Nn.box.length>0):(Nn=cn(Ve.iconBox),mt=Nn.box.length>0),Dt=Dt&&Nn.offscreen}const Ao=W||0===Ae.numHorizontalGlyphVertices&&0===Ae.numVerticalGlyphVertices,Fi=ae||0===Ae.numIconVertices;if(Ao||Fi?Fi?Ao||(mt=mt&&Oe):Oe=mt&&Oe:mt=Oe=mt&&Oe,Oe&&Rt&&Rt.box&&this.collisionIndex.insertCollisionBox(Rt.box,E.get("text-ignore-placement"),b.bucketInstanceId,_t&&_t.box&&qt?qt:At,he.ID),mt&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,E.get("icon-ignore-placement"),b.bucketInstanceId,Jn,he.ID),In&&(Oe&&this.collisionIndex.insertCollisionCircles(In.circles,E.get("text-ignore-placement"),b.bucketInstanceId,At,he.ID),g)){const cn=b.bucketInstanceId;let Ot=this.collisionCircleArrays[cn];void 0===Ot&&(Ot=this.collisionCircleArrays[cn]=new _n);for(let Kt=0;Kt<In.circles.length;Kt+=4)Ot.circles.push(In.circles[Kt+0]),Ot.circles.push(In.circles[Kt+1]),Ot.circles.push(In.circles[Kt+2]),Ot.circles.push(In.collisionDetected?1:0)}this.placements[Ae.crossTileID]=new rc(Oe||Qe,mt||Ge,Dt||b.justReloaded),u[Ae.crossTileID]=!0};if(Ie){const Ae=b.getSortedSymbolIndexes(this.transform.angle);for(let Me=Ae.length-1;Me>=0;--Me){const Ve=Ae[Me];$e(b.symbolInstances.get(Ve),Ve,b.collisionArrays[Ve])}}else for(let Ae=o.symbolInstanceStart;Ae<o.symbolInstanceEnd;Ae++)$e(b.symbolInstances.get(Ae),Ae,b.collisionArrays[Ae]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[b.bucketInstanceId];p.invert(Ae.invProjMatrix,M),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,u,g,v){let b;b=v===p.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const M of E)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:g.crossTileID)}markUsedOrientation(o,u,g){const v=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,b=u===p.WritingMode.vertical?u:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const M of E)o.text.placedSymbolArray.get(M).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},E=u?u.variableOffsets:{},M=u?u.placedOrientations:{};for(const k in this.placements){const R=this.placements[k],L=b[k];L?(this.opacities[k]=new ya(L,v,R.text,R.icon,null,R.clipped),g=g||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[k]=new ya(null,v,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const k in b){const R=b[k];if(!this.opacities[k]){const L=new ya(R,v,!1,!1);L.isHidden()||(this.opacities[k]=L,g=g||R.text.placed||R.icon.placed)}}for(const k in E)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=E[k]);for(const k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const g={};for(const v of u){const b=v.getBucket(o);b&&v.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(o,u,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),E=new ya(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),k=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),L="map"===v.get("text-rotation-alignment"),B="map"===v.get("text-pitch-alignment"),G="none"!==v.get("icon-text-fit"),K=new ya(null,0,M&&(k||!o.hasIconData()||v.get("icon-optional")),k&&(M||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const Z=(he,W,ae)=>{for(let le=0;le<W/4;le++)he.opacityVertexArray.emplaceBack(ae)};let Y=0;for(let he=0;he<o.symbolInstances.length;he++){const W=o.symbolInstances.get(he),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:le,crossTileID:se}=W;let ie=this.opacities[se];u[se]?ie=E:ie||(ie=K,this.opacities[se]=ie),u[se]=!0;const ue=ae>0||le>0,ye=W.numIconVertices>0,Ie=this.placedOrientations[W.crossTileID],Qe=Ie===p.WritingMode.vertical,Ge=Ie===p.WritingMode.horizontal||Ie===p.WritingMode.horizontalOnly;if(!ue&&!ye||ie.isHidden()||Y++,ue){const $e=rh(ie.text);Z(o.text,ae,Qe?xa:$e),Z(o.text,le,Ge?xa:$e);const Ae=ie.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(o.text.placedSymbolArray.get(Oe).hidden=Ae||Qe?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ae||Ge?1:0);const Me=this.variableOffsets[W.crossTileID];Me&&this.markUsedJustification(o,Me.anchor,W,Ie);const Ve=this.placedOrientations[W.crossTileID];Ve&&(this.markUsedJustification(o,"left",W,Ve),this.markUsedOrientation(o,Ve,W))}if(ye){const $e=rh(ie.icon);W.placedIconSymbolIndex>=0&&(Z(o.icon,W.numIconVertices,Qe?xa:$e),o.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ie.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Z(o.icon,W.numVerticalIconVertices,Ge?xa:$e),o.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const $e=o.collisionArrays[he];if($e){let Ae=new p.pointGeometry(0,0),Me=!0;if($e.textBox||$e.verticalTextBox){if(R){const Oe=this.variableOffsets[se];Oe?(Ae=$r(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textScale),L&&Ae._rotate(B?this.transform.angle:-this.transform.angle)):Me=!1}b&&(Me=!ie.clipped),$e.textBox&&va(o.textCollisionBox.collisionVertexArray,ie.text.placed,!Me||Qe,Ae.x,Ae.y),$e.verticalTextBox&&va(o.textCollisionBox.collisionVertexArray,ie.text.placed,!Me||Ge,Ae.x,Ae.y)}const Ve=Me&&Boolean(!Ge&&$e.verticalIconBox);$e.iconBox&&va(o.iconCollisionBox.collisionVertexArray,ie.icon.placed,Ve,G?Ae.x:0,G?Ae.y:0),$e.verticalIconBox&&va(o.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Ve,G?Ae.x:0,G?Ae.y:0)}}}if(o.fullyClipped=0===Y,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=he.invProjMatrix,o.placementViewportMatrix=he.viewportMatrix,o.collisionCircleArray=he.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function va(m,o,u,g,v){m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0)}const Se=Math.pow(2,25),nt=Math.pow(2,24),Fp=Math.pow(2,17),$s=Math.pow(2,16),xr=Math.pow(2,9),ei=Math.pow(2,8),ds=Math.pow(2,1);function rh(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const o=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Se+o*nt+u*Fp+o*$s+u*xr+o*ei+u*ds+o}const xa=0;class lt{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,g,v,b){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(E,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,k)=>M.sortKey-k.sortKey));this._currentPartIndex<E.length;){const M=E[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,g,0===M.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class on{constructor(o,u,g,v,b,E,M,k){this.placement=new nh(o,b,E,M,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g){const v=p.exported.now(),b=()=>{const E=p.exported.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=u[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=M)&&(!E.maxzoom||E.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new lt(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Qt=512/p.EXTENT/2;class Ho{constructor(o,u,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const b=u.get(v),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,u){const g=Qt/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+o.tileAnchorX)*g),y:Math.floor((u.canonical.y*p.EXTENT+o.tileAnchorY)*g)}}findMatches(o,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const E=o.get(b);if(E.crossTileID)continue;const M=this.indexedSymbolInstances[E.key];if(!M)continue;const k=this.getScaledCoordinates(E,u);for(const R of M)if(Math.abs(R.coord.x-k.x)<=v&&Math.abs(R.coord.y-k.y)<=v&&!g[R.crossTileID]){g[R.crossTileID]=!0,E.crossTileID=R.crossTileID;break}}}}class ic{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const E in v){const M=v[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+u),b[M.tileID.key]=M}this.indexes[g]=b}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const v=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>o.overscaledZ)for(const M in E){const k=E[M];k.tileID.isChildOf(o)&&k.findMatches(u.symbolInstances,o,v)}else{const M=E[o.scaledTo(Number(b)).key];M&&M.findMatches(u.symbolInstances,o,v)}}for(let b=0;b<u.symbolInstances.length;b++){const E=u.symbolInstances.get(b);E.crossTileID||(E.crossTileID=g.generate(),v[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ho(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][v.crossTileID]}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)o[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class Bn{constructor(){this.layerIndexes={},this.crossTileIDs=new ic,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g,v){let b=this.layerIndexes[o.id];void 0===b&&(b=this.layerIndexes[o.id]=new kt);let E=!1;const M={};"globe"!==v.name&&b.handleWrapJump(g);for(const k of u){const R=k.getBucket(o);R&&o.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,R,this.crossTileIDs)&&(E=!0),M[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(E=!0),E}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const ba=(m,o)=>p.emitValidationErrors(m,o&&o.filter(u=>"source.canvas"!==u.identifier)),Yc=p.pick(ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),wo=p.pick(ze,["setCenter","setZoom","setBearing","setPitch"]),gt=function(){const m={},o=p.spec.$version;for(const u in p.spec.$root){const g=p.spec.$root[u];if(g.required){let v=null;v="version"===u?o:"array"===g.type?[]:{},null!=v&&(m[u]=v)}}return m}(),qm={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ar extends p.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new zn(me(),this),this.imageManager=new $,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(o._requestManager,u.localFontFamily?p.LocalGlyphMode.all:u.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new p.LineAtlas(256,512),this.crossTileSymbolIndex=new Bn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const g=this;this._rtlTextPluginCallback=ar.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,E)=>{if(p.triggerPluginCompletionEvent(b),E&&E.every(M=>M))for(const M in g._sourceCaches){const k=g._sourceCaches[M],R=k.getSource().type;"vector"!==R&&"geojson"!==R||k.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===b.id&&this._validateLayer(M)}})}loadURL(o,u={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,u.accessToken);const v=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(v,(b,E)=>{this._request=null,b?this.fire(new p.ErrorEvent(b)):E&&this._load(E,g)})}loadJSON(o,u={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(o,!1!==u.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(gt,!1)}_updateLayerCount(o,u){const g=u?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,u){if(u&&ba(this,p.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this.updateProjection();for(const v in o.sources)this.addSource(v,o.sources[v],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=Re(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=p.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new fe(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const o=this.map.transform.projection,u=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),g=this.map.transform.projection;if(this._loaded&&(g.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),u){if(g.isReprojectedInTileSpace||o.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(o){this._spriteRequest=function(u,g,v){let b,E,M;const k=p.exported.devicePixelRatio>1?"@2x":"";let R=p.getJSON(g.transformRequest(g.normalizeSpriteURL(u,k,".json"),p.ResourceType.SpriteJSON),(G,K)=>{R=null,M||(M=G,b=K,B())}),L=p.getImage(g.transformRequest(g.normalizeSpriteURL(u,k,".png"),p.ResourceType.SpriteImage),(G,K)=>{L=null,M||(M=G,E=K,B())});function B(){if(M)v(M);else if(b&&E){const G=p.exported.getImageData(E),K={};for(const Z in b){const{width:Y,height:he,x:W,y:ae,sdf:le,pixelRatio:se,stretchX:ie,stretchY:ue,content:ye}=b[Z],Ie=new p.RGBAImage({width:Y,height:he});p.RGBAImage.copy(G,Ie,{x:W,y:ae},{x:0,y:0},{width:Y,height:he}),K[Z]={data:Ie,pixelRatio:se,sdf:le,stretchX:ie,stretchY:ue,content:ye}}v(null,K)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new p.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.getSource(o.source);if(!u)return;const g=o.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const g of o){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&qm[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const E in this._updatedSources){const M=this._updatedSources[E];"reload"===M?this._reloadSource(E):"clear"===M&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const E=this.map.painter;if(E){const M=b.getProgramIds();if(!M)continue;const k=b.getProgramConfiguration(o.zoom);for(const R of M)E.useProgram(R,k)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),ba(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=Re(o.layers);const u=function(v,b){if(!v)return[{command:ze.setStyle,args:[b]}];let E=[];try{if(!Lt(v.version,b.version))return[{command:ze.setStyle,args:[b]}];Lt(v.center,b.center)||E.push({command:ze.setCenter,args:[b.center]}),Lt(v.zoom,b.zoom)||E.push({command:ze.setZoom,args:[b.zoom]}),Lt(v.bearing,b.bearing)||E.push({command:ze.setBearing,args:[b.bearing]}),Lt(v.pitch,b.pitch)||E.push({command:ze.setPitch,args:[b.pitch]}),Lt(v.sprite,b.sprite)||E.push({command:ze.setSprite,args:[b.sprite]}),Lt(v.glyphs,b.glyphs)||E.push({command:ze.setGlyphs,args:[b.glyphs]}),Lt(v.transition,b.transition)||E.push({command:ze.setTransition,args:[b.transition]}),Lt(v.light,b.light)||E.push({command:ze.setLight,args:[b.light]}),Lt(v.fog,b.fog)||E.push({command:ze.setFog,args:[b.fog]}),Lt(v.projection,b.projection)||E.push({command:ze.setProjection,args:[b.projection]});const M={},k=[];!function(B,G,K,Z){let Y;for(Y in G=G||{},B=B||{})B.hasOwnProperty(Y)&&(G.hasOwnProperty(Y)||yt(Y,K,Z));for(Y in G)G.hasOwnProperty(Y)&&(B.hasOwnProperty(Y)?Lt(B[Y],G[Y])||("geojson"===B[Y].type&&"geojson"===G[Y].type&&wt(B,G,Y)?K.push({command:ze.setGeoJSONSourceData,args:[Y,G[Y].data]}):Mt(Y,G,K,Z)):He(Y,G,K))}(v.sources,b.sources,k,M);const R=[];v.layers&&v.layers.forEach(B=>{M[B.source]?E.push({command:ze.removeLayer,args:[B.id]}):R.push(B)});let L=v.terrain;L&&M[L.source]&&(E.push({command:ze.setTerrain,args:[void 0]}),L=void 0),E=E.concat(k),Lt(L,b.terrain)||E.push({command:ze.setTerrain,args:[b.terrain]}),function(B,G,K){G=G||[];const Z=(B=B||[]).map(jt),Y=G.map(jt),he=B.reduce($n,{}),W=G.reduce($n,{}),ae=Z.slice(),le=Object.create(null);let se,ie,ue,ye,Ie,Qe,Ge;for(se=0,ie=0;se<Z.length;se++)ue=Z[se],W.hasOwnProperty(ue)?ie++:(K.push({command:ze.removeLayer,args:[ue]}),ae.splice(ae.indexOf(ue,ie),1));for(se=0,ie=0;se<Y.length;se++)ue=Y[Y.length-1-se],ae[ae.length-1-se]!==ue&&(he.hasOwnProperty(ue)?(K.push({command:ze.removeLayer,args:[ue]}),ae.splice(ae.lastIndexOf(ue,ae.length-ie),1)):ie++,Qe=ae[ae.length-se],K.push({command:ze.addLayer,args:[W[ue],Qe]}),ae.splice(ae.length-se,0,ue),le[ue]=!0);for(se=0;se<Y.length;se++)if(ue=Y[se],ye=he[ue],Ie=W[ue],!le[ue]&&!Lt(ye,Ie))if(Lt(ye.source,Ie.source)&&Lt(ye["source-layer"],Ie["source-layer"])&&Lt(ye.type,Ie.type)){for(Ge in St(ye.layout,Ie.layout,K,ue,null,ze.setLayoutProperty),St(ye.paint,Ie.paint,K,ue,null,ze.setPaintProperty),Lt(ye.filter,Ie.filter)||K.push({command:ze.setFilter,args:[ue,Ie.filter]}),Lt(ye.minzoom,Ie.minzoom)&&Lt(ye.maxzoom,Ie.maxzoom)||K.push({command:ze.setLayerZoomRange,args:[ue,Ie.minzoom,Ie.maxzoom]}),ye)ye.hasOwnProperty(Ge)&&"layout"!==Ge&&"paint"!==Ge&&"filter"!==Ge&&"metadata"!==Ge&&"minzoom"!==Ge&&"maxzoom"!==Ge&&(0===Ge.indexOf("paint.")?St(ye[Ge],Ie[Ge],K,ue,Ge.slice(6),ze.setPaintProperty):Lt(ye[Ge],Ie[Ge])||K.push({command:ze.setLayerProperty,args:[ue,Ge,Ie[Ge]]}));for(Ge in Ie)Ie.hasOwnProperty(Ge)&&!ye.hasOwnProperty(Ge)&&"layout"!==Ge&&"paint"!==Ge&&"filter"!==Ge&&"metadata"!==Ge&&"minzoom"!==Ge&&"maxzoom"!==Ge&&(0===Ge.indexOf("paint.")?St(ye[Ge],Ie[Ge],K,ue,Ge.slice(6),ze.setPaintProperty):Lt(ye[Ge],Ie[Ge])||K.push({command:ze.setLayerProperty,args:[ue,Ge,Ie[Ge]]}))}else K.push({command:ze.removeLayer,args:[ue]}),Qe=ae[ae.lastIndexOf(ue)+1],K.push({command:ze.addLayer,args:[Ie,Qe]})}(R,b.layers,E)}catch(M){console.warn("Unable to compute style diff:",M),E=[{command:ze.setStyle,args:[b]}]}return E}(this.serialize(),o).filter(v=>!(v.command in wo));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in Yc));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=o,this.updateProjection(),!0}addImage(o,u){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(p.validateStyle.source,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=vr(o,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:o}));const b=E=>{const M=(E?"symbol:":"other:")+o,k=this._sourceCaches[M]=new p.SourceCache(M,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=k,k.style=this,k.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const u=this.getSource(o);if(void 0===u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getSource(o).setData(u),this._changed=!0}getSource(o){const u=this._getSourceCache(o);return u&&u.getSource()}addLayer(o,u,g={}){this._checkLoaded();const v=o.id;if(this.getLayer(v))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===o.type){if(ba(this,p.validateCustomStyleLayer(o)))return;b=p.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(v,o.source),o=p.clone$1(o),o=p.extend(o,{source:v})),this._validate(p.validateStyle.layer,`layers.${v}`,o,{arrayIndex:-1},g))return;b=p.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const E=u?this._order.indexOf(u):this._order.length;if(u&&-1===E)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&M&&"custom"!==b.type){const k=this._removedLayers[v];delete this._removedLayers[v],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const g=this._order.indexOf(o);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,g){this._checkLoaded();const v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,u,g={}){this._checkLoaded();const v=this.getLayer(o);if(v){if(!Lt(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(p.validateStyle.filter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=p.clone$1(u),this._updateLayer(v)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return p.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?Lt(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,u){const g=this.getLayer(o);if(g)return g.getLayoutProperty(u);this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?Lt(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const g=o.source,v=o.sourceLayer,b=this.getSource(g);if(void 0===b)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const E=b.type;if("geojson"===E&&v)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!v)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(g);for(const k of M)k.setFeatureState(v,o.id,u)}removeFeatureState(o,u){this._checkLoaded();const g=o.source,v=this.getSource(g);if(void 0===v)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,E="vector"===b?o.sourceLayer:void 0;if("vector"===b&&!E)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(g);for(const k of M)k.removeFeatureState(E,o.id,u)}getFeatureState(o){this._checkLoaded();const u=o.source,g=o.sourceLayer,v=this.getSource(u);if(void 0!==v){if("vector"!==v.type||g)return void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();o[g.id]||(o[g.id]=g.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(o){this._updatedLayers[o.id]=!0;const u=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[o.source]="reload",u.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=E=>"fill-extrusion"===this._layers[E].type,g={},v=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(u(M)){g[M]=E;for(const k of o){const R=k[M];if(R)for(const L of R)v.push(L)}}}v.sort((E,M)=>M.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(u(M))for(let k=v.length-1;k>=0;k--){const R=v[k].feature;if(g[R.layer.id]<E)break;b.push(R),v.pop()}else for(const k of o){const R=k[M];if(R)for(const L of R)b.push(L.feature)}}return b}queryRenderedFeatures(o,u,g){u&&u.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of u.layers){const R=this._layers[k];if(!R)return this.fire(new p.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];v[R.source]=!0}}const b=[];u.availableImages=this._availableImages;const E=u&&u.layers?u.layers.some(k=>{const R=this.getLayer(k);return R&&R.is3D()}):this.has3DLayers(),M=fa.createFromScreenPoints(o,g);for(const k in this._sourceCaches){const R=this._sourceCaches[k].getSource().id;u.layers&&!v[R]||b.push(O(this._sourceCaches[k],this._layers,this._serializedLayers,M,u,g,E,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(k,R,L,B,G,K,Z){const Y={},he=K.queryRenderedSymbols(B),W=[];for(const ae of Object.keys(he).map(Number))W.push(Z[ae]);W.sort(J);for(const ae of W){const le=ae.featureIndex.lookupSymbolFeatures(he[ae.bucketInstanceId],R,ae.bucketIndex,ae.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const se in le){const ie=Y[se]=Y[se]||[],ue=le[se];ue.sort((ye,Ie)=>{const Qe=ae.featureSortOrder;if(Qe){const Ge=Qe.indexOf(ye.featureIndex);return Qe.indexOf(Ie.featureIndex)-Ge}return Ie.featureIndex-ye.featureIndex});for(const ye of ue)ie.push(ye)}}for(const ae in Y)Y[ae].forEach(le=>{const se=le.feature,ie=L(k[ae]).getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ie});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(o);let v=[];for(const b of g)v=v.concat(j(b,u));return v}addSourceType(o,u,g){return ar.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(ar.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const E in o)if(!Lt(o[E],g[E])){v=!0;break}if(!v)return;const b={now:p.exported.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,u=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof o.source){const g="terrain-dem-src";this.addSource(g,o.source),o=p.clone$1(o),o=p.extend(o,{source:g})}if(this._validate(p.validateStyle.terrain,"terrain",o))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(o,u);else{const g=this.terrain,v=g.get();for(const b in o)if(!Lt(o[b],v[b])){g.set(o),this.stylesheet.terrain=o;const E={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new gn(o,this.map.transform);this.stylesheet.fog=o;const g={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();for(const v in o)if(!Lt(o[v],g[v])){u.set(o),this.stylesheet.fog=o;const b={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const g=this.terrain=new Ne(o,u);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"symbol"===u.type&&this._updateLayer(u)}}_validate(o,u,g,v,b={}){return(!b||!1!==b.validate)&&ba(this,o.call(p.validateStyle,p.extend({key:u,style:this.serialize(),value:g,styleSpec:p.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const u=this._getSourceCaches(o);for(const g of u)g.clearTiles()}_reloadSource(o){const u=this._getSourceCaches(o);for(const g of u)g.resume(),g.reload()}_updateSources(o){for(const u in this._sourceCaches)this._sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,g,v,b=!1){let E=!1,M=!1;const k={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!k[L.source]){const G=this._getLayerSourceCache(L);if(!G)continue;k[L.source]=G.getRenderableIds(!0).map(K=>G.getTileByID(K)).sort((K,Z)=>Z.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Z.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,k[L.source],o.center.lng,o.projection);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),o.zoom))&&(this.pauseablePlacement=new on(o,this._order,b,u,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),M=!0),E&&this.pauseablePlacement.placement.setStale()),M||E)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(o,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(o,u,g){return p.makeRequest(u,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ar.getSourceType=function(m){return ga[m]},ar.setSourceType=function(m,o){ga[m]=o},ar.registerForPluginStateChange=p.registerForPluginStateChange;var ol="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",wa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let sl={},al={};sl=Bt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),al=Bt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const dn=Bt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ca=ol;var oc={background:Bt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Bt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Bt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Bt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Bt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Bt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Bt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Bt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Bt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Bt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Bt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Bt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Bt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Bt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Bt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Bt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Bt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Bt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Bt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Bt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Bt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Bt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",wa),skyboxGradient:Bt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",wa),skyboxCapture:Bt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Bt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Bt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Bt(m,o,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=m.match(v),M=o.match(v),k=ol.match(v);let R=M?M.concat(E):E;u||(sl.staticUniforms&&(R=sl.staticUniforms.concat(R)),al.staticUniforms&&(R=al.staticUniforms.concat(R))),R&&(R=R.concat(k));const L={};return{fragmentSource:m=m.replace(g,(B,G,K,Z,Y)=>(L[Y]=!0,"define"===G?`\n#ifndef HAS_UNIFORM_u_${Y}\nvarying ${K} ${Z} ${Y};\n#else\nuniform ${K} ${Z} u_${Y};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Y}\n    ${K} ${Z} ${Y} = u_${Y};\n#endif\n`)),vertexSource:o=o.replace(g,(B,G,K,Z,Y)=>{const he="float"===Z?"vec2":"vec4",W=Y.match(/color/)?"color":he;return L[Y]?"define"===G?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${K} ${he} a_${Y};\nvarying ${K} ${Z} ${Y};\n#else\nuniform ${K} ${Z} u_${Y};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = a_${Y};\n#else\n    ${K} ${Z} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = unpack_mix_${W}(a_${Y}, u_${Y}_t);\n#else\n    ${K} ${Z} ${Y} = u_${Y};\n#endif\n`:"define"===G?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${K} ${he} a_${Y};\n#else\nuniform ${K} ${Z} u_${Y};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${K} ${Z} ${Y} = a_${Y};\n#else\n    ${K} ${Z} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${K} ${Z} ${Y} = unpack_mix_${W}(a_${Y}, u_${Y}_t);\n#else\n    ${K} ${Z} ${Y} = u_${Y};\n#endif\n`}),staticAttributes:b,staticUniforms:R}}class to{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,g,v,b,E,M,k){this.context=o;let R=this.boundPaintVertexBuffers.length!==v.length;for(let L=0;!R&&L<v.length;L++)this.boundPaintVertexBuffers[L]!==v[L]&&(R=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===k?(o.bindVertexArrayOES.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind()):this.freshBind(u,g,v,b,E,M,k)}freshBind(o,u,g,v,b,E,M){let k;const R=o.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=M;else{k=L.currentNumAttributes||0;for(let G=R;G<k;G++)B.disableVertexAttribArray(G)}u.enableAttributes(B,o);for(const G of g)G.enableAttributes(B,o);E&&E.enableAttributes(B,o),M&&M.enableAttributes(B,o),u.bind(),u.setVertexAttribPointers(B,o,b);for(const G of g)G.bind(),G.setVertexAttribPointers(B,o,b);E&&(E.bind(),E.setVertexAttribPointers(B,o,b)),v&&v.bind(),M&&(M.bind(),M.setVertexAttribPointers(B,o,b)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ut(m,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new p.MercatorCoordinate(0,g/u).toLngLat().lat,new p.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function ll(m,o,u,g,v,b,E){const M=m.context,k=M.gl,R=u.fbo;if(!R)return;m.prepareDrawTile(o);const L=m.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.colorAttachment.get());const B=((Y,he,W,ae)=>{const le=W.paint.get("hillshade-shadow-color"),se=W.paint.get("hillshade-highlight-color"),ie=W.paint.get("hillshade-accent-color");let ue=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(ue-=Y.transform.angle);const ye=!Y.options.moving;return{u_matrix:ae||Y.transform.calculateProjMatrix(he.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Ut(0,he.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ue],u_shadow:le,u_highlight:se,u_accent:ie}})(m,u,g,m.terrain?o.projMatrix:null);m.prepareDrawProgram(M,L,o.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:K,tileBoundsSegments:Z}=m.getTileBoundsBuffers(u);L.draw(M,k.TRIANGLES,v,b,E,p.CullFaceMode.disabled,B,g.id,G,K,Z)}function br(m,o,u){if(!o.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(u.stride);const b=u.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new p.Texture(g,b,v.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function no(m,o,u,g,v,b){const E=m.context,M=E.gl;if(!o.dem)return;const k=o.dem;if(E.activeTexture.set(M.TEXTURE1),br(m,o,k),!o.demTexture)return;o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const R=k.dim;E.activeTexture.set(M.TEXTURE0);let L=o.fbo;if(!L){const Z=new p.Texture(E,{width:R,height:R,data:null},M.RGBA);Z.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=o.fbo=E.createFramebuffer(R,R,!0),L.colorAttachment.set(Z.texture)}E.bindFramebuffer.set(L.framebuffer),E.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:K}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(E,M.TRIANGLES,g,v,b,p.CullFaceMode.disabled,((Z,Y)=>{const he=Y.stride,W=p.create();return p.ortho(W,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(W,W,[0,-p.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[he,he],u_zoom:Z.overscaledZ,u_unpack:Y.unpackVector}})(o.tileID,k),u.id,B,G,K),o.needsHillshadePrepare=!1}const ps=(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image0:new p.Uniform1i(m,o.u_image0),u_skirt_height:new p.Uniform1f(m,o.u_skirt_height)}),ti=(m,o)=>({u_matrix:m,u_image0:0,u_skirt_height:o}),Co=(m,o,u,g,v)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_merc_matrix:u,u_zoom_transition:g,u_merc_center:v,u_image0:0});function hr(m,o){return null!=m&&null!=o&&!(!m.hasData()||!o.hasData())&&null!=m.demTexture&&null!=o.demTexture&&m.tileID.key!==o.tileID.key}const fs=new class{constructor(){this.operations={}}newMorphing(m,o,u,g,v){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:v,from:o,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const u=this.operations[o];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},cl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function qo(m,o){const u=1<<m.z;return!o&&(0===m.x||m.x===u-1)||0===m.y||m.y===u-1}const Zo=m=>({u_matrix:m});function nd(m,o,u,g,v){if(v>0){const b=p.exported.now(),E=(b-m.timeAdded)/v,M=o?(b-o.timeAdded)/v:-1,k=u.getSource(),R=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),B=L&&m.refreshedUponExpiration?1:p.clamp(L?E:1-M,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class rd extends p.SourceCache{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new zn(me(),null),v=vr("mock-dem",u,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class ro extends p.SourceCache{constructor(o){const u=vr("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new zn(me(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,g){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const M=new p.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);M.state="loaded",this._tiles[E.key]=M}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const u=this.proxyCachedFBO[o];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Mn extends p.OverscaledTileID{constructor(o,u,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class Ea extends p.Elevation{constructor(o,u){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(k){const R=new p.StructArrayLayout4i8,L=new p.StructArrayLayout3ui6,B=131;R.reserve(17161),L.reserve(33800);const G=p.EXTENT/128,K=p.EXTENT+G/2,Z=K+G;for(let he=-G;he<Z;he+=G)for(let W=-G;W<Z;W+=G){const ae=W<0||W>K||he<0||he>K?24575:0,le=p.clamp(Math.round(W),0,p.EXTENT),se=p.clamp(Math.round(he),0,p.EXTENT);R.emplaceBack(le+ae,se,le,se)}const Y=(he,W)=>{const ae=W*B+he;L.emplaceBack(ae+1,ae,ae+B),L.emplaceBack(ae+B,ae+B+1,ae+1)};for(let he=1;he<129;he++)for(let W=1;W<129;W++)Y(W,he);return[0,129].forEach(he=>{for(let W=0;W<130;W++)Y(W,he),Y(he,W)}),[R,L,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,p.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=p.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ro(u.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,0,p.EXTENT,0,p.EXTENT,0,1);const M=E.gl;this._overlapStencilMode=new p.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new rd(u.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,u,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const v=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(u,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(k=>{const R=u.getTileByID(k).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(k,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new p.pointGeometry(L.x,L.y);k.sort((G,K)=>{if(K.overscaledZ-G.overscaledZ)return K.overscaledZ-G.overscaledZ;const Z=new p.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Y=new p.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),he=B.mult(1<<G.canonical.z);return he.x-=.5,he.y-=.5,he.distSqr(Z)-he.distSqr(Y)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const k in E){const R=E[k];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,o[k],b),R.usedForTerrain))continue;const L=o[k];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=v.map(k=>new Mn(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const M={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const R=this.terrainTileForTile[k.key];if(!R)continue;const L=R.tileID.key;L in M||(this._visibleDemTiles.push(R),M[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),br(this.painter,v,b))}}_prepareDemTileUniforms(o,u,g,v){if(!u||null==u.demTexture)return!1;const b=o.tileID.canonical,E=Math.pow(2,u.tileID.canonical.z-b.z),M=v||"";return g[`u_dem_tl${M}`]=[b.x*E%1,b.y*E%1],g[`u_dem_scale${M}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,u=o.gl;if(!this._emptyDepthBufferTexture){const g={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new p.Texture(o,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(p.DEMData.pack(g,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new p.Texture(o,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(o,u,g){const v=this.painter.context,b=v.gl,E=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const k=this.painter.transform,R=k.projection.createTileTransform(k,k.worldSize),L=o.tileID.canonical;E.u_tile_tl_up=R.upVector(L,0,0),E.u_tile_tr_up=R.upVector(L,p.EXTENT,0),E.u_tile_br_up=R.upVector(L,p.EXTENT,p.EXTENT),E.u_tile_bl_up=R.upVector(L,0,p.EXTENT),E.u_tile_up_scale=R.upVectorScale(L);let B=null,G=null,K=1;if(g&&g.morphing&&this._useVertexMorphing){const Z=g.morphing.srcDemTile,Y=g.morphing.dstDemTile;K=g.morphing.phase,Z&&Y&&(this._prepareDemTileUniforms(o,Z,E,"_prev")&&(G=Z),this._prepareDemTileUniforms(o,Y,E)&&(B=Y))}if(G&&B?(v.activeTexture.set(b.TEXTURE2),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),G.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),E.u_dem_lerp=K):(B=this.terrainTileForTile[o.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,B,E)?B.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const Z=(1<<B.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=Z}g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,E)}renderToBackBuffer(o){const u=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),this.renderingToTexture=!1,function(v,b,E,M,k){if("globe"===v.transform.projection.name)!function(R,L,B,G,K){const Z=R.context,Y=Z.gl;let he,W;const ae=R.options.showTerrainWireframe?2:0,le=($e,Ae)=>{if(W===$e)return;const Me=[];Ae&&Me.push(cl[ae]),Me.push(cl[$e]),Me.push("PROJECTION_GLOBE_VIEW"),he=R.useProgram("globeRaster",null,Me),W=$e},se=R.colorModeForRenderPass(),ie=new p.DepthMode(Y.LEQUAL,p.DepthMode.ReadWrite,R.depthRangeFor3D);fs.update(K);const ue=R.transform,ye=p.calculateGlobeMatrix(ue,ue.worldSize),Ie=p.calculateGlobeMercatorMatrix(ue),Qe=[p.mercatorXfromLng(ue.center.lng),p.mercatorYfromLat(ue.center.lat)],Ge=R.globeSharedBuffers;(ae?[!1,!0]:[!1]).forEach($e=>{W=-1;const Ae=$e?Y.LINES:Y.TRIANGLES;for(const Me of G){const Ve=B.getTile(Me),Oe=Math.pow(2,Me.canonical.z),[mt,Dt]=p.globeBuffersForTileMesh(R,Ve,Me,Oe),Gt=p.StencilMode.disabled,Ye=L.prevTerrainTileForTile[Me.key],_t=L.terrainTileForTile[Me.key];hr(Ye,_t)&&fs.newMorphing(Me.key,Ye,_t,K,250),Z.activeTexture.set(Y.TEXTURE0),Ve.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const Rt=fs.getMorphValuesForProxy(Me.key),In=Rt?1:0,Nn={};Rt&&p.extend$1(Nn,{morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:p.easeCubicInOut(Rt.phase)}});const At=p.globeMatrixForTile(Me.canonical,ye),qt=Co(ue.projMatrix,At,Ie,p.globeToMercatorTransition(ue.zoom),Qe);if(le(In,$e),L.setupElevationDraw(Ve,he,Nn),R.prepareDrawProgram(Z,he,Me.toUnwrapped()),Ge){const[Jn,Ir]=$e?Ge.getWirefameBuffer(R.context):[Ge.gridIndexBuffer,Ge.gridSegments];he.draw(Z,Ae,ie,Gt,se,p.CullFaceMode.backCCW,qt,"globe_raster",mt,Jn,Ir)}if(!$e){const Jn=[0===Me.canonical.y?p.globePoleMatrixForTile(Me.canonical,!1,ue):null,Me.canonical.y===Oe-1?p.globePoleMatrixForTile(Me.canonical,!0,ue):null];for(const Ir of Jn){if(!Ir)continue;const Vi=Co(ue.projMatrix,Ir,Ir,0,Qe);Ge&&he.draw(Z,Ae,ie,Gt,se,p.CullFaceMode.disabled,Vi,"globe_pole_raster",Dt,Ge.poleIndexBuffer,Ge.poleSegments)}}}})}(v,b,E,M,k);else{const R=v.context,L=R.gl;let B,G;const K=v.options.showTerrainWireframe?2:0,Z=(le,se)=>{if(G===le)return;const ie=[cl[le]];se&&ie.push(cl[K]),B=v.useProgram("terrainRaster",null,ie),G=le},Y=v.colorModeForRenderPass(),he=new p.DepthMode(L.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);fs.update(k);const W=v.transform,ae=6*Math.pow(1.5,22-W.zoom)*b.exaggeration();(K?[!1,!0]:[!1]).forEach(le=>{G=-1;const se=le?L.LINES:L.TRIANGLES,[ie,ue]=le?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ye of M){const Ie=E.getTile(ye),Qe=p.StencilMode.disabled,Ge=b.prevTerrainTileForTile[ye.key],$e=b.terrainTileForTile[ye.key];hr(Ge,$e)&&fs.newMorphing(ye.key,Ge,$e,k,250),R.activeTexture.set(L.TEXTURE0),Ie.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Ae=fs.getMorphValuesForProxy(ye.key),Me=Ae?1:0;let Ve;Ae&&(Ve={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:p.easeCubicInOut(Ae.phase)}});const Oe=ti(ye.projMatrix,qo(ye.canonical,W.renderWorldCopies)?ae/10:ae);Z(Me,le),b.setupElevationDraw(Ie,B,Ve),v.prepareDrawProgram(R,B,ye.toUnwrapped()),B.draw(R,se,he,Qe,Y,p.CullFaceMode.backCCW,Oe,"terrain_raster",b.gridBuffer,ie,ue)}})}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),M=[],k=u.style.order;let R=0;for(const L of b){const B=v.getTileByID(L.proxyTileKey),G=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][o]:void 0,K=void 0!==G?v.renderCache[G]:this.pool[R++],Z=void 0!==G;if(B.texture=K.tex,Z&&!K.dirty){M.push(B.tileID);continue}let Y;g.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(g.clear({color:p.Color.transparent,stencil:0}),K.dirty=!1);for(let he=E.start;he<=E.end;++he){const W=u.style._layers[k[he]];if(W.isHidden(u.transform.zoom))continue;const ae=u.style._getLayerSourceCache(W),le=ae?this.proxyToSource[L.key][ae.id]:[L];if(!le)continue;const se=le;g.viewport.set([0,0,K.fb.width,K.fb.height]),Y!==(ae?ae.id:null)&&(this._setupStencil(K,le,W,ae),Y=ae?ae.id:null),u.renderLayer(u,ae,W,se)}this.renderedToTile?(K.dirty=!0,M.push(B.tileID)):Z||--R,5===R&&(R=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const u=o.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,E=!1;for(let M=0;M<u;++M){const k=o._layers[o.order[M]];this._style.isLayerDraped(k)?(E&&++v,++b):E||(E=!0,g=k.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,M=Math.pow(2,E.overscaledZ),{x:k,y:R}=E.canonical,L=k/M,B=(k+1)/M,G=R/M,K=(R+1)/M;return{minx:L,miny:G,maxx:B,maxy:K,t:b.dem.tree.raycastRoot(L,G,B,K,o,u,g),tile:b}});v.sort((b,E)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,u,g);if(null!=E)return E}return null}_createFBO(){const o=this.painter.context,u=o.gl,g=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const v=new p.Texture(o,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new eh(o,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._layers[o],g=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),b=!!v&&1!==v.t,E=u.hasTransition();return"custom"!==u.type&&!g&&(b||E)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof cs){o=!0;break}if(o)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!b)continue;const E=g.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const k=this.proxyToSource[M.key][b.id];if(k)for(const R of k){const L=nd(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,E);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){const o=this._style.order,u=o.length;if(0===u)return;const g=[];let v,b=0,E=this._style._layers[o[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<u;)E=this._style._layers[o[b]];for(;b<u;++b){const M=this._style._layers[o[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const E=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let M=0;M<E.length;++M){const k=Object.values(E[M]);u.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const M=g[E];if(u.getTileByID(M.key),void 0!==u.proxyCachedFBO[M.key]){const k=o[M.key],R=this.proxyToSource[M.key];let L=0;for(const B in R){const G=R[B],K=k[B];if(!K||K.length!==G.length||G.some((Z,Y)=>Z!==K[Y]||v[B]&&v[B].hasOwnProperty(Z.key))){L=-1;break}++L}for(const B in u.proxyCachedFBO[M.key])u.renderCache[u.proxyCachedFBO[M.key][B]].dirty=L<0||L!==Object.values(k).length}}const b=[...this._drapedRenderBatches];b.sort((E,M)=>M.end-M.start-(E.end-E.start));for(const E of b)for(const M of g){if(u.proxyCachedFBO[M.key])continue;let k=u.renderCachePool.pop();void 0===k&&u.renderCache.length<50&&(k=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==k&&(u.proxyCachedFBO[M.key]={},u.proxyCachedFBO[M.key][E.start]=k,u.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let M;if(g.isTileClipped())M=u.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(o,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const E=g.useProgram("clippingMask");for(const M of o){const k=g._tileClippingMaskIDs[M.key]=--u;E.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Zo(M.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const g=[o.x,o.y,1,1];p.transformMat4$1(g,g,u.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=p.mercatorZfromAltitude(1,u.center.lat),E=[v[0],v[1],v[2]/b,0],M=p.subtract([],g.slice(0,3),E);p.normalize(M,M);const k=this.raycast(E,M,this._exaggeration);return null!==k&&k?(p.scaleAndAdd(E,E,M,k),E[3]=E[2],E[2]*=b,E):null}drawDepth(){const o=this.painter,u=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=u.gl,M=u.createFramebuffer(v,b,!0);u.activeTexture.set(E.TEXTURE0);const k=new p.Texture(u,{width:v,height:b,data:null},E.RGBA);k.bind(E.NEAREST,E.CLAMP_TO_EDGE),M.colorAttachment.set(k.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);M.depthAttachment.set(R),this._depthFBO=M,this._depthTexture=k}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(E,M,k,R){if("globe"===E.transform.projection.name)return;const L=E.context,B=L.gl;L.clear({depth:1});const G=E.useProgram("terrainDepth"),K=new p.DepthMode(B.LESS,p.DepthMode.ReadWrite,E.depthRangeFor3D);for(const Z of R){const Y=k.getTile(Z),he=ti(Z.projMatrix,0);M.setupElevationDraw(Y,G),G.draw(L,B.TRIANGLES,K,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,he,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,u,g){if(o.getSource()instanceof xo)return this._setupProxiedCoordsForImageSource(o,u,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const k=b[M],R=this._findTileCoveringTileID(k,o);if(R){const L=this._createProxiedId(k,R,g[k.key]&&g[k.key][o.id]);v.push(L),this.proxyToSource[k.key][o.id]=[L]}}let E=!1;for(let M=0;M<u.length;M++){const k=o.getTile(u[M]);if(!k||!k.hasData())continue;const R=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][o.id],B=this._createProxiedId(R.tileID,k,g[R.tileID.key]&&g[R.tileID.key][o.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[R.tileID.key][o.id]=[B],v.push(B),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,u,g){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords,E=o.getSource(),M=new p.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),k=E.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-M.x),L.min.y=Math.min(L.min.y,B.y-M.y),L.max.x=Math.max(L.max.x,B.x-M.x),L.max.y=Math.max(L.max.y,B.y-M.y),L),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,B)=>{const G=L.wrap+L.canonical.x/(1<<L.canonical.z),K=L.canonical.y/(1<<L.canonical.z),Z=p.EXTENT/(1<<L.canonical.z),Y=B.wrap+B.canonical.x/(1<<B.canonical.z),he=B.canonical.y/(1<<B.canonical.z);return G+Z<Y+k.min.x||G>Y+k.max.x||K+Z<he+k.min.y||K>he+k.max.y};for(let L=0;L<b.length;L++){const B=b[L];for(let G=0;G<u.length;G++){const K=o.getTile(u[G]);if(!K||!K.hasData()||R(B,K.tileID))continue;const Z=this._createProxiedId(B,K,g[B.key]&&g[B.key][o.id]),Y=this.proxyToSource[B.key][o.id];Y?Y.push(Z):this.proxyToSource[B.key][o.id]=[Z],v.push(Z)}}}_createProxiedId(o,u,g){let v=this.orthoMatrix;if(g){const b=g.find(E=>E.key===u.tileID.key);if(b)return b}if(u.tileID.key!==o.key){const b=o.canonical.z-u.tileID.canonical.z;let E,M,k;v=p.create();const R=u.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(E=p.EXTENT>>b,M=E*((u.tileID.canonical.x<<b)-o.canonical.x+R),k=E*((u.tileID.canonical.y<<b)-o.canonical.y)):(E=p.EXTENT<<-b,M=p.EXTENT*(u.tileID.canonical.x-(o.canonical.x+R<<-b)),k=p.EXTENT*(u.tileID.canonical.y-(o.canonical.y<<-b))),p.ortho(v,0,E,0,E,0,1),p.translate(v,v,[M,k,0])}return new Mn(u.tileID,o.key,v)}_findTileCoveringTileID(o,u){let g=u.getTile(o);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[o.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let E=g?g.tileID:o,M=E.overscaledZ;const k=u.getSource().minzoom,R=[];if(!b){const B=u.getSource().maxzoom;if(o.canonical.z>=B){const G=o.canonical.z-B;u.getSource().reparseOverscaled?(M=Math.max(o.canonical.z+2,u.transform.tileZoom),E=new p.OverscaledTileID(M,o.wrap,B,o.canonical.x>>G,o.canonical.y>>G)):0!==G&&(M=B,E=new p.OverscaledTileID(M,o.wrap,B,o.canonical.x>>G,o.canonical.y>>G))}E.key!==o.key&&(R.push(E.key),g=u.getTile(E))}const L=B=>{R.forEach(G=>{v[G]=B}),R.length=0};for(M-=1;M>=k&&(!g||!g.hasData());M--){g&&L(g.tileID.key);const B=E.calculateScaledKey(M);if(g=u.getTileByID(B),g&&g.hasData())break;const G=v[B];if(null===G)break;void 0===G?R.push(B):g=u.getTileByID(G)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(u){let g,v,b;const E=new p.StructArrayLayout2ui4,M=131;for(v=1;v<129;v++){for(g=1;g<129;g++)b=v*M+g,E.emplaceBack(b,b+1),E.emplaceBack(b,b+M),E.emplaceBack(b+1,b+M),128===v&&E.emplaceBack(b+M,b+M+1);E.emplaceBack(b+1,b+1+M)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ih(m){const o=[];for(let u=0;u<m.length;u++){if(null===m[u])continue;const g=m[u].split(" ");o.push(g.pop())}return o}class Wo{static cacheKey(o,u,g){let v=`${o}${g?g.cacheKey:""}`;for(const b of u)v+=`/${b}`;return v}constructor(o,u,g,v,b,E){const M=o.gl;this.program=M.createProgram();const k=ih(g.staticAttributes),R=v?v.getBinderAttributes():[],L=k.concat(R),B=g.staticUniforms?ih(g.staticUniforms):[],G=v?v.getBinderUniforms():[],K=B.concat(G),Z=[];for(const ie of K)Z.indexOf(ie)<0&&Z.push(ie);let Y=v?v.defines():[];Y=Y.concat(E.map(ie=>`#define ${ie}`));const he=Y.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ca,dn.fragmentSource,al.fragmentSource,g.fragmentSource).join("\n"),W=Y.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ca,dn.vertexSource,al.vertexSource,sl.vertexSource,g.vertexSource).join("\n"),ae=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ae,he),M.compileShader(ae),M.attachShader(this.program,ae);const le=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(le,W),M.compileShader(le),M.attachShader(this.program,le),this.attributes={};const se={};this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)L[ie]&&(M.bindAttribLocation(this.program,ie,L[ie]),this.attributes[L[ie]]=ie);M.linkProgram(this.program),M.deleteShader(le),M.deleteShader(ae);for(let ie=0;ie<Z.length;ie++){const ue=Z[ie];if(ue&&!se[ue]){const ye=M.getUniformLocation(this.program,ue);ye&&(se[ue]=ye)}}var ie,ue;this.fixedUniforms=b(o,se),this.binderUniforms=v?v.getUniforms(o,se):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(ie=o,(ue=se).u_dem),u_dem_prev:new p.Uniform1i(ie,ue.u_dem_prev),u_dem_unpack:new p.Uniform4f(ie,ue.u_dem_unpack),u_dem_tl:new p.Uniform2f(ie,ue.u_dem_tl),u_dem_scale:new p.Uniform1f(ie,ue.u_dem_scale),u_dem_tl_prev:new p.Uniform2f(ie,ue.u_dem_tl_prev),u_dem_scale_prev:new p.Uniform1f(ie,ue.u_dem_scale_prev),u_dem_size:new p.Uniform1f(ie,ue.u_dem_size),u_dem_lerp:new p.Uniform1f(ie,ue.u_dem_lerp),u_exaggeration:new p.Uniform1f(ie,ue.u_exaggeration),u_depth:new p.Uniform1i(ie,ue.u_depth),u_depth_size_inv:new p.Uniform2f(ie,ue.u_depth_size_inv),u_meter_to_dem:new p.Uniform1f(ie,ue.u_meter_to_dem),u_label_plane_matrix_inv:new p.UniformMatrix4f(ie,ue.u_label_plane_matrix_inv),u_tile_tl_up:new p.Uniform3f(ie,ue.u_tile_tl_up),u_tile_tr_up:new p.Uniform3f(ie,ue.u_tile_tr_up),u_tile_br_up:new p.Uniform3f(ie,ue.u_tile_br_up),u_tile_bl_up:new p.Uniform3f(ie,ue.u_tile_bl_up),u_tile_up_scale:new p.Uniform1f(ie,ue.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((ie,ue)=>({u_fog_matrix:new p.UniformMatrix4f(ie,ue.u_fog_matrix),u_fog_range:new p.Uniform2f(ie,ue.u_fog_range),u_fog_color:new p.Uniform4f(ie,ue.u_fog_color),u_fog_horizon_blend:new p.Uniform1f(ie,ue.u_fog_horizon_blend),u_fog_temporal_offset:new p.Uniform1f(ie,ue.u_fog_temporal_offset)}))(o,se))}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].set(u[v])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].location&&g[v].set(u[v])}}draw(o,u,g,v,b,E,M,k,R,L,B,G,K,Z,Y,he){const W=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(v),o.setColorMode(b),o.setCullFace(E);for(const le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(M[le]);Z&&Z.setUniforms(o,this.binderUniforms,G,{zoom:K});const ae={[W.LINES]:2,[W.TRIANGLES]:3,[W.LINE_STRIP]:1}[u];for(const le of B.get()){const se=le.vaos||(le.vaos={});(se[k]||(se[k]=new to)).bind(o,this,R,Z?Z.getPaintVertexBuffers():[],L,le.vertexOffset,Y,he),W.drawElements(u,le.primitiveLength*ae,W.UNSIGNED_SHORT,le.primitiveOffset*ae*2)}}}function Gn(m,o,u){const g=1/an(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,E=b*(u.tileID.canonical.x+u.tileID.wrap*v),M=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const sc=(m,o,u,g)=>{const v=o.style.light,b=v.properties.get("position"),E=[b.x,b.y,b.z],M=p.create$1();"viewport"===v.properties.get("anchor")&&(p.fromRotation(M,-o.transform.angle),p.transformMat3(E,E,M));const k=v.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+u,u_opacity:g}},ac=(m,o,u,g,v,b,E)=>p.extend(sc(m,o,u,g),Gn(b,o,E),{u_height_factor:-Math.pow(2,v.overscaledZ)/E.tileSize/8}),Jc=m=>({u_matrix:m}),Qc=(m,o,u,g)=>p.extend(Jc(m),Gn(u,o,g)),ms=(m,o)=>({u_matrix:m,u_world:o}),ul=(m,o,u,g,v)=>p.extend(Qc(m,o,u,g),{u_world:v}),zp=(m,o,u,g)=>{const v=m.transform;let b;return b="map"===g.paint.get("circle-pitch-alignment")?v.calculatePixelsToTileUnitsMatrix(u):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:m.translatePosMatrix(o.projMatrix,u,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:b}},Gr=m=>{const o=[];return"map"===m.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},id=(m,o,u)=>{const g=p.EXTENT/u.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/g,o.pixelsToGLUnits[1]/g]}},eu=(m,o,u=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:u}),oh=(m,o,u,g)=>({u_matrix:m,u_extrude_scale:an(o,1,u),u_intensity:g}),sh=(m,o,u,g,v,b)=>{const E=m.transform,M=E.calculatePixelsToTileUnitsMatrix(o),k={u_matrix:dl(m,o,u,v),u_pixels_to_tile_units:M,u_device_pixel_ratio:p.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Mr(u)){const R=hl(o,m.transform);k.u_texsize=o.lineAtlasTexture.size,k.u_scale=[R,g.fromScale,g.toScale],k.u_mix=g.t}return k},wi=(m,o,u,g,v)=>{const b=m.transform,E=hl(o,b);return{u_matrix:dl(m,o,u,v),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:p.exported.devicePixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function hl(m,o){return 1/an(m,1,o.tileZoom)}function dl(m,o,u,g){return m.translatePosMatrix(g||o.tileID.projMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Mr(m){const o=m.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Hr=(m,o,u,g,v,b)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(M=v.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:kr(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var E,M};function kr(m){m*=Math.PI/180;const o=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Eo=(m,o,u,g,v,b,E,M,k,R,L,B,G,K)=>{const Z=v.transform;return{u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+g,u_texsize:R,u_tile_id:L,u_zoom_transition:B,u_inv_rot_matrix:G,u_merc_center:K,u_texture:0}},To=(m,o,u,g,v,b,E,M,k,R,L,B,G,K,Z)=>{const{cameraToCenterDistance:Y,_pitch:he}=v.transform;return p.extend(Eo(m,o,u,g,v,b,E,M,k,R,B,G,K,Z),{u_gamma_scale:g?Y*Math.cos(v.terrain?0:he):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+L})},ai=(m,o,u,g,v,b,E,M,k,R,L,B,G,K)=>p.extend(To(m,o,u,g,v,b,E,M,!0,k,!0,L,B,G,K),{u_texsize_icon:R,u_texture_icon:1}),mn=(m,o,u)=>({u_matrix:m,u_opacity:o,u_color:u}),pl=(m,o,u,g,v,b)=>p.extend(function(E,M,k,R){const L=k.imageManager.getPattern(E.from.toString()),B=k.imageManager.getPattern(E.to.toString()),{width:G,height:K}=k.imageManager.getPixelSize(),Z=Math.pow(2,R.tileID.overscaledZ),Y=R.tileSize*Math.pow(2,k.transform.tileZoom)/Z,he=Y*(R.tileID.canonical.x+R.tileID.wrap*Z),W=Y*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[G,K],u_mix:M.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/an(R,1,k.transform.tileZoom),u_pixel_coord_upper:[he>>16,W>>16],u_pixel_coord_lower:[65535&he,65535&W]}}(g,b,u,v),{u_matrix:m,u_opacity:o}),fl={fillExtrusion:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_opacity:new p.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new p.Uniform1f(m,o.u_height_factor),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_opacity:new p.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.UniformMatrix2f(m,o.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.Uniform2f(m,o.u_extrude_scale)}),collisionCircle:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new p.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new p.UniformColor(m,o.u_color),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_overlay:new p.Uniform1i(m,o.u_overlay),u_overlay_scale:new p.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new p.Uniform1f(m,o.u_extrude_scale),u_intensity:new p.Uniform1f(m,o.u_intensity),u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_image:new p.Uniform1i(m,o.u_image),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_opacity:new p.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_latrange:new p.Uniform2f(m,o.u_latrange),u_light:new p.Uniform2f(m,o.u_light),u_shadow:new p.UniformColor(m,o.u_shadow),u_highlight:new p.UniformColor(m,o.u_highlight),u_accent:new p.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_dimension:new p.Uniform2f(m,o.u_dimension),u_zoom:new p.Uniform1f(m,o.u_zoom),u_unpack:new p.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_dash_image:new p.Uniform1i(m,o.u_dash_image),u_gradient_image:new p.Uniform1i(m,o.u_gradient_image),u_image_height:new p.Uniform1f(m,o.u_image_height),u_texsize:new p.Uniform2f(m,o.u_texsize),u_scale:new p.Uniform3f(m,o.u_scale),u_mix:new p.Uniform1f(m,o.u_mix),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),linePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_image:new p.Uniform1i(m,o.u_image),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),raster:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new p.Uniform2f(m,o.u_tl_parent),u_scale_parent:new p.Uniform1f(m,o.u_scale_parent),u_fade_t:new p.Uniform1f(m,o.u_fade_t),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image0:new p.Uniform1i(m,o.u_image0),u_image1:new p.Uniform1i(m,o.u_image1),u_brightness_low:new p.Uniform1f(m,o.u_brightness_low),u_brightness_high:new p.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new p.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new p.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new p.Uniform3f(m,o.u_spin_weights),u_perspective_transform:new p.Uniform2f(m,o.u_perspective_transform)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_texture:new p.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texture:new p.Uniform1i(m,o.u_texture),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texsize_icon:new p.Uniform2f(m,o.u_texsize_icon),u_texture:new p.Uniform1i(m,o.u_texture),u_texture_icon:new p.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_color:new p.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image:new p.Uniform1i(m,o.u_image),u_pattern_tl_a:new p.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(m,o.u_pattern_br_b),u_texsize:new p.Uniform2f(m,o.u_texsize),u_mix:new p.Uniform1f(m,o.u_mix),u_pattern_size_a:new p.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new p.Uniform1f(m,o.u_scale_a),u_scale_b:new p.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(m,o.u_tile_units_to_pixels)}),terrainRaster:ps,terrainDepth:ps,skybox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_cubemap:new p.Uniform1i(m,o.u_cubemap),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxGradient:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_center_direction:new p.Uniform3f(m,o.u_center_direction),u_radius:new p.Uniform1f(m,o.u_radius),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxCapture:(m,o)=>({u_matrix_3f:new p.UniformMatrix3f(m,o.u_matrix_3f),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_sun_intensity:new p.Uniform1f(m,o.u_sun_intensity),u_color_tint_r:new p.Uniform4f(m,o.u_color_tint_r),u_color_tint_m:new p.Uniform4f(m,o.u_color_tint_m),u_luminance:new p.Uniform1f(m,o.u_luminance)}),globeRaster:(m,o)=>({u_proj_matrix:new p.UniformMatrix4f(m,o.u_proj_matrix),u_globe_matrix:new p.UniformMatrix4f(m,o.u_globe_matrix),u_merc_matrix:new p.UniformMatrix4f(m,o.u_merc_matrix),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_image0:new p.Uniform1i(m,o.u_image0)}),globeAtmosphere:(m,o)=>({u_center:new p.Uniform2f(m,o.u_center),u_radius:new p.Uniform1f(m,o.u_radius),u_screen_size:new p.Uniform2f(m,o.u_screen_size),u_pixel_ratio:new p.Uniform1f(m,o.u_pixel_ratio),u_opacity:new p.Uniform1f(m,o.u_opacity),u_fadeout_range:new p.Uniform1f(m,o.u_fadeout_range),u_start_color:new p.Uniform3f(m,o.u_start_color),u_end_color:new p.Uniform3f(m,o.u_end_color)})};let Gs;function gs(m,o,u,g,v,b,E){const M=m.context,k=M.gl,R=m.useProgram("collisionBox"),L=[];let B=0,G=0;for(let le=0;le<g.length;le++){const se=g[le],ie=o.getTile(se),ue=ie.getBucket(u);if(!ue)continue;let ye=se.projMatrix;0===v[0]&&0===v[1]||(ye=m.translatePosMatrix(se.projMatrix,ie,v,b));const Ie=E?ue.textCollisionBox:ue.iconCollisionBox,Qe=ue.collisionCircleArray;if(Qe.length>0){const Ge=p.create(),$e=ye;p.mul(Ge,ue.placementInvProjMatrix,m.transform.glCoordMatrix),p.mul(Ge,Ge,ue.placementViewportMatrix),L.push({circleArray:Qe,circleOffset:G,transform:$e,invTransform:Ge}),B+=Qe.length/4,G=B}Ie&&(m.terrain&&m.terrain.setupElevationDraw(ie,R),R.draw(M,k.LINES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,id(ye,m.transform,ie),u.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,m.transform.zoom,null,Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt))}if(!E||!L.length)return;const K=m.useProgram("collisionCircle"),Z=new p.StructArrayLayout2f1f2i16;Z.resize(4*B),Z._trim();let Y=0;for(const le of L)for(let se=0;se<le.circleArray.length/4;se++){const ie=4*se,ue=le.circleArray[ie+0],ye=le.circleArray[ie+1],Ie=le.circleArray[ie+2],Qe=le.circleArray[ie+3];Z.emplace(Y++,ue,ye,Ie,Qe,0),Z.emplace(Y++,ue,ye,Ie,Qe,1),Z.emplace(Y++,ue,ye,Ie,Qe,2),Z.emplace(Y++,ue,ye,Ie,Qe,3)}(!Gs||Gs.length<2*B)&&(Gs=function(le){const se=2*le,ie=new p.StructArrayLayout3ui6;ie.resize(se),ie._trim();for(let ue=0;ue<se;ue++){const ye=6*ue;ie.uint16[ye+0]=4*ue+0,ie.uint16[ye+1]=4*ue+1,ie.uint16[ye+2]=4*ue+2,ie.uint16[ye+3]=4*ue+2,ie.uint16[ye+4]=4*ue+3,ie.uint16[ye+5]=4*ue+0}return ie}(B));const he=M.createIndexBuffer(Gs,!0),W=M.createVertexBuffer(Z,p.collisionCircleLayout.members,!0);for(const le of L){const se={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(ae=m.transform).cameraToCenterDistance,u_viewport_size:[ae.width,ae.height]};K.draw(M,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,se,u.id,W,he,p.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ae;W.destroy(),he.destroy()}const Rr=p.identity(new Float32Array(16));function od(m,o,u,g,v,b){const{horizontalAlign:E,verticalAlign:M}=p.getAnchorAlignment(m),k=-(E-.5)*o,R=-(M-.5)*u,L=p.evaluateVariableOffset(m,g);return new p.pointGeometry((k/v+L[0])*b,(R/v+L[1])*b)}function io(m,o,u,g,v,b,E,M,k,R,L,B){const G=m.text.placedSymbolArray,K=m.text.dynamicLayoutVertexArray,Z=m.icon.dynamicLayoutVertexArray,Y={},he=M.projMatrix,W=b.elevation,ae=W?W.getAtTileOffsetFunc(M,B):le=>[0,0,0];K.clear();for(let le=0;le<G.length;le++){const se=G.get(le),ie=m.allowVerticalPlacement&&!se.placedOrientation,ue=se.hidden||!se.crossTileID||ie?null:g[se.crossTileID];if(ue){const ye=new p.pointGeometry(se.tileAnchorX,se.tileAnchorY),Ie=ae(ye),Qe=Qr(ye,u?he:E,Ie[2]),Ge=bo(b.cameraToCenterDistance,Qe.signedDistanceFromCamera);let $e=v.evaluateSizeForFeature(m.textSizeData,R,se)*Ge/p.ONE_EM;u&&($e*=m.tilePixelRatio/k);const{width:Ae,height:Me,anchor:Ve,textOffset:Oe,textScale:mt}=ue,Dt=od(Ve,Ae,Me,Oe,mt,$e),Gt=u?Qr(ye.add(Dt),E,Ie[2]).point:Qe.point.add(o?Dt.rotate(-b.angle):Dt),Ye=m.allowVerticalPlacement&&se.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<se.numGlyphs;_t++)p.addDynamicAttributes(K,Gt,Ye);L&&se.associatedIconIndex>=0&&(Y[se.associatedIconIndex]={shiftedAnchor:Gt,angle:Ye})}else rn(se.numGlyphs,K)}if(L){Z.clear();const le=m.icon.placedSymbolArray;for(let se=0;se<le.length;se++){const ie=le.get(se);if(ie.hidden)rn(ie.numGlyphs,Z);else{const ue=Y[se];if(ue)for(let ye=0;ye<ie.numGlyphs;ye++)p.addDynamicAttributes(Z,ue.shiftedAnchor,ue.angle);else rn(ie.numGlyphs,Z)}}m.icon.dynamicLayoutVertexBuffer.updateData(Z)}m.text.dynamicLayoutVertexBuffer.updateData(K)}function pt(m,o,u){return u.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function en(m,o,u,g,v,b,E,M,k,R,L,B){const G=m.context,K=G.gl,Z=m.transform,Y=Z.projection.createTileTransform(Z,Z.worldSize),he="map"===M,W="map"===k,ae=he&&"point"!==u.layout.get("symbol-placement"),le=he&&!W&&!ae,se=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let ie=!1;const ue=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),ye=[p.mercatorXfromLng(Z.center.lng),p.mercatorYfromLat(Z.center.lat)],Ie=u.layout.get("text-variable-anchor"),Qe="globe"===Z.projection.name,Ge=Qe?p.globeToMercatorTransition(Z.zoom):0,$e=[],Ae=[];m.terrain&&W&&Ae.push("PITCH_WITH_MAP_TERRAIN"),Qe&&Ae.push("PROJECTION_GLOBE_VIEW"),ae&&Ae.push("PROJECTED_POS_ON_VIEWPORT");for(const Me of g){const Ve=o.getTile(Me),Oe=Ve.getBucket(u);if(!Oe||Oe.projection!==Z.projection.name)continue;const mt=v?Oe.text:Oe.icon;if(!mt||Oe.fullyClipped||!mt.segments.get().length)continue;const Dt=mt.programConfigurations.get(u.id),Gt=v||Oe.sdfIcons,Ye=v?Oe.textSizeData:Oe.iconSizeData,_t=W||0!==Z.pitch,Rt=m.useProgram(pt(Gt,v,Oe),Dt,Ae),In=p.evaluateSizeForZoom(Ye,Z.zoom),Nn=[Me.canonical.x,Me.canonical.y,1<<Me.canonical.z];let At,qt,Jn,Ir,Vi=[0,0],Ao=null;if(v){if(qt=Ve.glyphAtlasTexture,Jn=K.LINEAR,At=Ve.glyphAtlasTexture.size,Oe.iconsInText){Vi=Ve.imageAtlasTexture.size,Ao=Ve.imageAtlasTexture;const zr="composite"===Ye.kind||"camera"===Ye.kind;Ir=_t||m.options.rotating||m.options.zooming||zr?K.LINEAR:K.NEAREST}}else{const zr=1!==u.layout.get("icon-size").constantOr(0)||Oe.iconsNeedLinear;qt=Ve.imageAtlasTexture,Jn=Gt||m.options.rotating||m.options.zooming||zr||_t?K.LINEAR:K.NEAREST,At=Ve.imageAtlasTexture.size}const Fi=m.transform.calculatePixelsToTileUnitsMatrix(Ve),cn=js(Me.projMatrix,Ve.tileID.canonical,W,he,m.transform,Fi),Ot=m.terrain&&W&&ae?p.invert(new Float32Array(16),cn):Rr,Kt=hs(Me.projMatrix,Ve.tileID.canonical,W,he,m.transform,Fi),tr=Ie&&Oe.hasTextData(),zi="none"!==u.layout.get("icon-text-fit")&&tr&&Oe.hasIconData();if(ae){const zr=Z.elevation,ka=zr?zr.getAtTileOffsetFunc(Me,Y):Ks=>[0,0,0];td(Oe,Me.projMatrix,m,v,cn,Kt,W,R,ka,Me)}const Sn=m.translatePosMatrix(Me.projMatrix,Ve,b,E),$i=ae||v&&Ie||zi?Rr:cn,Yo=m.translatePosMatrix(Kt,Ve,b,E,!0),di=Gt&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Jo;const ft=Y.createInversionMatrix(Me.toUnwrapped());Jo=Gt?Oe.iconsInText?ai(Ye.kind,In,le,W,m,Sn,$i,Yo,At,Vi,Nn,Ge,ft,ye):To(Ye.kind,In,le,W,m,Sn,$i,Yo,v,At,!0,Nn,Ge,ft,ye):Eo(Ye.kind,In,le,W,m,Sn,$i,Yo,v,At,Nn,Ge,ft,ye);const Ct={program:Rt,buffers:mt,uniformValues:Jo,atlasTexture:qt,atlasTextureIcon:Ao,atlasInterpolation:Jn,atlasInterpolationIcon:Ir,isSDF:Gt,hasHalo:di,tile:Ve,labelPlaneMatrixInv:Ot};if(se&&Oe.canOverlap){ie=!0;const zr=mt.segments.get();for(const ka of zr)$e.push({segments:new p.SegmentVector([ka]),sortKey:ka.sortKey,state:Ct})}else $e.push({segments:mt.segments,sortKey:0,state:Ct})}ie&&$e.sort((Me,Ve)=>Me.sortKey-Ve.sortKey);for(const Me of $e){const Ve=Me.state;if(m.terrain&&m.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!Qe,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),G.activeTexture.set(K.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,K.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(G.activeTexture.set(K.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Ve.isSDF){const Oe=Ve.uniformValues;Ve.hasHalo&&(Oe.u_is_halo=1,Wn(Ve.buffers,Me.segments,u,m,Ve.program,ue,L,B,Oe)),Oe.u_is_halo=0}Wn(Ve.buffers,Me.segments,u,m,Ve.program,ue,L,B,Ve.uniformValues)}}function Wn(m,o,u,g,v,b,E,M,k){const R=g.context;v.draw(R,R.gl.TRIANGLES,b,E,M,p.CullFaceMode.disabled,k,u.id,m.layoutVertexBuffer,m.indexBuffer,o,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function li(m,o,u,g,v,b,E){const M=m.context.gl,k=u.paint.get("fill-pattern"),R=k&&k.constantOr(1),L=u.getCrossfadeParameters();let B,G,K,Z,Y;E?(G=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=M.LINES):(G=R?"fillPattern":"fill",B=M.TRIANGLES);for(const he of g){const W=o.getTile(he);if(R&&!W.patternsLoaded())continue;const ae=W.getBucket(u);if(!ae)continue;m.prepareDrawTile(he);const le=ae.programConfigurations.get(u.id),se=m.useProgram(G,le);R&&(m.context.activeTexture.set(M.TEXTURE0),W.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),le.updatePaintBuffers(L));const ie=k.constantOr(null);if(ie&&W.imageAtlas){const ye=W.imageAtlas,Ie=ye.patternPositions[ie.to.toString()],Qe=ye.patternPositions[ie.from.toString()];Ie&&Qe&&le.setConstantPatternPositions(Ie,Qe)}const ue=m.translatePosMatrix(he.projMatrix,W,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(E){Z=ae.indexBuffer2,Y=ae.segments2;const ye=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];K="fillOutlinePattern"===G&&R?ul(ue,m,L,W,ye):ms(ue,ye)}else Z=ae.indexBuffer,Y=ae.segments,K=R?Qc(ue,m,L,W):Jc(ue);m.prepareDrawProgram(m.context,se,he.toUnwrapped()),se.draw(m.context,B,v,m.stencilModeForClipping(he),b,p.CullFaceMode.disabled,K,u.id,ae.layoutVertexBuffer,Z,Y,u.paint,m.transform.zoom,le)}}function Do(m,o,u,g,v,b,E){const M=m.context,k=M.gl,R=u.paint.get("fill-extrusion-pattern"),L=R.constantOr(1),B=u.getCrossfadeParameters(),G=u.paint.get("fill-extrusion-opacity");for(const K of g){const Z=o.getTile(K),Y=Z.getBucket(u);if(!Y)continue;const he=Y.programConfigurations.get(u.id),W=m.useProgram(L?"fillExtrusionPattern":"fillExtrusion",he);if(m.terrain){const ue=m.terrain;if(!Y.enableTerrain)continue;if(ue.setupElevationDraw(Z,W,{useMeterToDem:!0}),Lr(M,o,K,Y,u,ue),!Y.centroidVertexBuffer){const ye=W.attributes.a_centroid_pos;void 0!==ye&&k.vertexAttrib2f(ye,0,0)}}L&&(m.context.activeTexture.set(k.TEXTURE0),Z.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),he.updatePaintBuffers(B));const ae=R.constantOr(null);if(ae&&Z.imageAtlas){const ue=Z.imageAtlas,ye=ue.patternPositions[ae.to.toString()],Ie=ue.patternPositions[ae.from.toString()];ye&&Ie&&he.setConstantPatternPositions(ye,Ie)}const le=m.translatePosMatrix(K.projMatrix,Z,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),se=u.paint.get("fill-extrusion-vertical-gradient"),ie=L?ac(le,m,se,G,K,B,Z):sc(le,m,se,G);m.prepareDrawProgram(M,W,K.toUnwrapped()),W.draw(M,M.gl.TRIANGLES,v,b,E,p.CullFaceMode.backCCW,ie,u.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,u.paint,m.transform.zoom,he,m.terrain?Y.centroidVertexBuffer:null)}}function Lr(m,o,u,g,v,b){const E=[W=>{let ae=W.canonical.x-1,le=W.wrap;return ae<0&&(ae=(1<<W.canonical.z)-1,le--),new p.OverscaledTileID(W.overscaledZ,le,W.canonical.z,ae,W.canonical.y)},W=>{let ae=W.canonical.x+1,le=W.wrap;return ae===1<<W.canonical.z&&(ae=0,le++),new p.OverscaledTileID(W.overscaledZ,le,W.canonical.z,ae,W.canonical.y)},W=>new p.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new p.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],M=W=>{const ae=o.getSource().maxzoom,le=ye=>{const Ie=o.getTileByID(ye);if(Ie&&Ie.hasData())return Ie.getBucket(v)};let se,ie,ue;return(W.overscaledZ===W.canonical.z||W.overscaledZ>=ae)&&(se=le(W.key)),W.overscaledZ>=ae&&(ie=le(W.calculateScaledKey(W.overscaledZ+1))),W.overscaledZ>ae&&(ue=le(W.calculateScaledKey(W.overscaledZ-1))),se||ie||ue},k=[0,0,0],R=(W,ae)=>(k[0]=Math.min(W.min.y,ae.min.y),k[1]=Math.max(W.max.y,ae.max.y),k[2]=p.EXTENT-ae.min.x>W.max.x?ae.min.x-p.EXTENT:W.max.x,k),L=(W,ae)=>(k[0]=Math.min(W.min.x,ae.min.x),k[1]=Math.max(W.max.x,ae.max.x),k[2]=p.EXTENT-ae.min.y>W.max.y?ae.min.y-p.EXTENT:W.max.y,k),B=[(W,ae)=>R(W,ae),(W,ae)=>R(ae,W),(W,ae)=>L(W,ae),(W,ae)=>L(ae,W)],G=new p.pointGeometry(0,0);let K,Z,Y;const he=(W,ae,le,se,ie)=>{const ue=[[se?le:W,se?W:le,0],[se?le:ae,se?ae:le,0]],ye=ie<0?p.EXTENT+ie:ie,Ie=[se?ye:(W+ae)/2,se?(W+ae)/2:ye,0];return 0===le&&ie<0||0!==le&&ie>0?b.getForTilePoints(Y,[Ie],!0,Z):ue.push(Ie),b.getForTilePoints(u,ue,!0,K),Math.max(ue[0][2],ue[1][2],Ie[2])/b.exaggeration()};for(let W=0;W<4;W++){const ae=g.borders[W];if(0===ae.length&&(g.borderDone[W]=!0),g.borderDone[W])continue;const le=Y=E[W](u),se=M(le);if(!(se&&se.enableTerrain&&(Z=b.findDEMTileFor(le),Z&&Z.dem)))continue;if(!K){const Ie=b.findDEMTileFor(u);if(!Ie||!Ie.dem)return;K=Ie}const ie=(W<2?1:5)-W,ue=se.borders[ie];let ye=0;for(let Ie=0;Ie<ae.length;Ie++){const Qe=g.featuresOnBorder[ae[Ie]],Ge=Qe.borders[W];let $e;for(;ye<ue.length&&($e=se.featuresOnBorder[ue[ye]],!($e.borders[ie][1]>Ge[0]+3));)se.borderDone[ie]||se.encodeCentroid(void 0,$e,!1),ye++;if($e&&ye<ue.length){const Ae=ye;let Me=0;for(;!($e.borders[ie][0]>Ge[1]-3)&&(Me++,++ye!==ue.length);)$e=se.featuresOnBorder[ue[ye]];if($e=se.featuresOnBorder[ue[Ae]],Qe.intersectsCount()>1||$e.intersectsCount()>1||1!==Me){1!==Me&&(ye=Ae),g.encodeCentroid(void 0,Qe,!1),se.borderDone[ie]||se.encodeCentroid(void 0,$e,!1);continue}const Ve=B[W](Qe,$e),Oe=W%2?p.EXTENT-1:0;G.x=he(Ve[0],Math.min(p.EXTENT-1,Ve[1]),Oe,W<2,Ve[2]),G.y=0,g.encodeCentroid(G,Qe,!1),se.borderDone[ie]||se.encodeCentroid(G,$e,!1)}else g.encodeCentroid(void 0,Qe,!1)}g.borderDone[W]=g.needsCentroidUpdate=!0,se.borderDone[ie]||(se.borderDone[ie]=se.needsCentroidUpdate=!0)}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(m)}const Hs=new p.Color(1,0,0,1),wr=new p.Color(0,1,0,1),_s=new p.Color(0,0,1,1),Xo=new p.Color(1,0,1,1),Xt=new p.Color(0,1,1,1);function ni(m,o,u,g){vs(m,0,o+u/2,m.transform.width,u,g)}function ys(m,o,u,g){vs(m,o-u/2,0,u,m.transform.height,g)}function vs(m,o,u,g,v,b){const E=m.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*p.exported.devicePixelRatio,u*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio),E.clear({color:b}),M.disable(M.SCISSOR_TEST)}function xs(m,o,u){const g=m.context,v=g.gl,b=u.projMatrix,E=m.useProgram("debug"),M=o.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(M,E);const k=p.DepthMode.disabled,R=p.StencilMode.disabled,L=m.colorModeForRenderPass(),B="$debug";g.activeTexture.set(v.TEXTURE0),m.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),M._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const G=M._tileDebugBuffer||m.debugBuffer,K=M._tileDebugIndexBuffer||m.debugIndexBuffer,Z=M._tileDebugSegments||m.debugSegments;E.draw(g,v.LINE_STRIP,k,R,L,p.CullFaceMode.disabled,eu(b,p.Color.red),B,G,K,Z);const Y=M.latestRawTileData,he=Math.floor((Y&&Y.byteLength||0)/1024),W=o.getTile(u).tileSize,ae=512/Math.min(W,512)*(u.overscaledZ/m.transform.zoom)*.5;let le=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(le+=` => ${u.overscaledZ}`),function(se,ie){se.initDebugOverlayCanvas();const ue=se.debugOverlayCanvas,ye=se.context.gl,Ie=se.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,ue.width,ue.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(ie,5,5),Ie.strokeText(ie,5,5),se.debugOverlayTexture.update(ue),se.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(m,`${le} ${he}kb`),E.draw(g,v.TRIANGLES,k,R,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,eu(b,p.Color.transparent,ae),B,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const ci=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ta}=ci;function ui(m,o,u,g){m.emplaceBack(o,u,g)}class Ri{constructor(o){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,ui(this.vertexArray,-1,-1,1),ui(this.vertexArray,1,-1,1),ui(this.vertexArray,-1,1,1),ui(this.vertexArray,1,1,1),ui(this.vertexArray,-1,-1,-1),ui(this.vertexArray,1,-1,-1),ui(this.vertexArray,-1,1,-1),ui(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Ta),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function En(m,o,u,g,v,b){const E=m.gl,M=o.paint.get("sky-atmosphere-color"),k=o.paint.get("sky-atmosphere-halo-color"),R=o.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:p.fromMat4([],g),u_sun_direction:v,u_sun_intensity:R,u_color_tint_r:[(Z=M).r,Z.g,Z.b,Z.a],u_color_tint_m:[(Y=k).r,Y.g,Y.b,Y.a],u_luminance:5e-5};var Z,Y;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),u.draw(m,E.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const lc={symbol:function(m,o,u,g,v){if("translucent"!==m.renderPass)return;const b=p.StencilMode.disabled,E=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(M,k,R,L,B,G,K){const Z=k.transform,Y="map"===B,he="map"===G,W=Z.projection.createTileTransform(Z,Z.worldSize);for(const ae of M){const le=L.getTile(ae),se=le.getBucket(R);if(!se||se.projection!==Z.projection.name||!se.text||!se.text.segments.get().length)continue;const ie=p.evaluateSizeForZoom(se.textSizeData,Z.zoom),ue=k.transform.calculatePixelsToTileUnitsMatrix(le),ye=js(ae.projMatrix,le.tileID.canonical,he,Y,k.transform,ue),Ie="none"!==R.layout.get("icon-text-fit")&&se.hasIconData();if(ie){const Qe=Math.pow(2,Z.zoom-le.tileID.overscaledZ);io(se,Y,he,K,p.symbolSize,Z,ye,ae,Qe,ie,Ie,W)}}}(g,m,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&en(m,o,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,E),0!==u.paint.get("text-opacity").constantOr(1)&&en(m,o,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,E),o.map.showCollisionBoxes&&(gs(m,o,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),gs(m,o,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,u,g){if("translucent"!==m.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),E=u.paint.get("circle-stroke-opacity"),M=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===E.constantOr(1)))return;const k=m.context,R=k.gl,L=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),B=p.StencilMode.disabled,G=m.colorModeForRenderPass(),K=[];for(let Y=0;Y<g.length;Y++){const he=g[Y],W=o.getTile(he),ae=W.getBucket(u);if(!ae)continue;const le=ae.programConfigurations.get(u.id),se=Gr(u),ie={programConfiguration:le,program:m.useProgram("circle",le,se),layoutVertexBuffer:ae.layoutVertexBuffer,indexBuffer:ae.indexBuffer,uniformValues:zp(m,he,W,u),tile:W};if(M){const ue=ae.segments.get();for(const ye of ue)K.push({segments:new p.SegmentVector([ye]),sortKey:ye.sortKey,state:ie})}else K.push({segments:ae.segments,sortKey:0,state:ie})}M&&K.sort((Y,he)=>Y.sortKey-he.sortKey);const Z={useDepthForOcclusion:"globe"!==m.transform.projection.name};for(const Y of K){const{programConfiguration:he,program:W,layoutVertexBuffer:ae,indexBuffer:le,uniformValues:se,tile:ie}=Y.state,ue=Y.segments;m.terrain&&m.terrain.setupElevationDraw(ie,W,Z),m.prepareDrawProgram(k,W,ie.tileID.toUnwrapped()),W.draw(k,R.TRIANGLES,L,B,G,p.CullFaceMode.disabled,se,u.id,ae,le,ue,u.paint,m.transform.zoom,he)}},heatmap:function(m,o,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const v=m.context,b=v.gl,E=p.StencilMode.disabled,M=new p.ColorMode([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(k,R,L){const B=k.gl;k.activeTexture.set(B.TEXTURE1),k.viewport.set([0,0,R.width/4,R.height/4]);let G=L.heatmapFbo;if(G)B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),k.bindFramebuffer.set(G.framebuffer);else{const K=B.createTexture();B.bindTexture(B.TEXTURE_2D,K),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),G=L.heatmapFbo=k.createFramebuffer(R.width/4,R.height/4,!1),function(Z,Y,he,W){const ae=Z.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,Y.width/4,Y.height/4,0,ae.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),W.colorAttachment.set(he)}(k,R,K,G)}})(v,m,u),v.clear({color:p.Color.transparent});for(let k=0;k<g.length;k++){const R=g[k];if(o.hasRenderableParent(R))continue;const L=o.getTile(R),B=L.getBucket(u);if(!B)continue;const G=B.programConfigurations.get(u.id),K=m.useProgram("heatmap",G),{zoom:Z}=m.transform;m.terrain&&m.terrain.setupElevationDraw(L,K),m.prepareDrawProgram(v,K,R.toUnwrapped()),K.draw(v,b.TRIANGLES,p.DepthMode.disabled,E,M,p.CullFaceMode.disabled,oh(R.projMatrix,L,Z,u.paint.get("heatmap-intensity")),u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,m.transform.zoom,G)}v.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,b){const E=v.context,M=E.gl,k=b.heatmapFbo;if(!k)return;E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),E.activeTexture.set(M.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new p.Texture(E,b.colorRamp,M.RGBA)),R.bind(M.LINEAR,M.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(E,M.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(m,u))},line:function(m,o,u,g){if("translucent"!==m.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const E=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),M=m.colorModeForRenderPass(),k=u.paint.get("line-dasharray"),R=k.constantOr(1),L=u.layout.get("line-cap"),B=u.paint.get("line-pattern"),G=B.constantOr(1),K=u.paint.get("line-gradient"),Z=u.getCrossfadeParameters(),Y=G?"linePattern":"line",he=m.context,W=he.gl,ae=(se=>{const ie=[];Mr(se)&&ie.push("RENDER_LINE_DASH"),se.paint.get("line-gradient")&&ie.push("RENDER_LINE_GRADIENT");const ue=se.paint.get("line-pattern").constantOr(1),ye=1!==se.paint.get("line-opacity").constantOr(1);return!ue&&ye&&ie.push("RENDER_LINE_ALPHA_DISCARD"),ie})(u);let le=ae.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const se of g){const ie=o.getTile(se);if(G&&!ie.patternsLoaded())continue;const ue=ie.getBucket(u);if(!ue)continue;m.prepareDrawTile(se);const ye=ue.programConfigurations.get(u.id),Ie=m.useProgram(Y,ye,ae),Qe=B.constantOr(null);if(Qe&&ie.imageAtlas){const Oe=ie.imageAtlas,mt=Oe.patternPositions[Qe.to.toString()],Dt=Oe.patternPositions[Qe.from.toString()];mt&&Dt&&ye.setConstantPatternPositions(mt,Dt)}const Ge=k.constantOr(null),$e=L.constantOr(null);if(!G&&Ge&&$e&&ie.lineAtlas){const Oe=ie.lineAtlas,mt=Oe.getDash(Ge.to,$e),Dt=Oe.getDash(Ge.from,$e);mt&&Dt&&ye.setConstantPatternPositions(mt,Dt)}const Ae=m.terrain?se.projMatrix:null,Me=G?wi(m,ie,u,Z,Ae):sh(m,ie,u,Z,Ae,ue.lineClipsArray.length);if(K){const Oe=ue.gradients[u.id];let mt=Oe.texture;if(u.gradientVersion!==Oe.version){let Dt=256;if(u.stepInterpolant){const Gt=o.getSource().maxzoom,Ye=se.canonical.z===Gt?Math.ceil(1<<m.transform.maxZoom-se.canonical.z):1;Dt=p.clamp(p.nextPowerOfTwo(ue.maxLineLength/p.EXTENT*1024*Ye),256,he.maxTextureSize)}Oe.gradient=p.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:Oe.gradient||void 0,clips:ue.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new p.Texture(he,Oe.gradient,W.RGBA),Oe.version=u.gradientVersion,mt=Oe.texture}he.activeTexture.set(W.TEXTURE1),mt.bind(u.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}R&&(he.activeTexture.set(W.TEXTURE0),ie.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ye.updatePaintBuffers(Z)),G&&(he.activeTexture.set(W.TEXTURE0),ie.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ye.updatePaintBuffers(Z)),m.prepareDrawProgram(he,Ie,se.toUnwrapped());const Ve=Oe=>{Ie.draw(he,W.TRIANGLES,E,Oe,M,p.CullFaceMode.disabled,Me,u.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,u.paint,m.transform.zoom,ye,ue.layoutVertexBuffer2)};if(le){const Oe=m.stencilModeForClipping(se).ref;0===Oe&&m.terrain&&he.clear({stencil:0});const mt={func:W.EQUAL,mask:255};Me.u_alpha_discard_threshold=.8,Ve(new p.StencilMode(mt,Oe,255,W.KEEP,W.KEEP,W.INVERT)),Me.u_alpha_discard_threshold=0,Ve(new p.StencilMode(mt,Oe,255,W.KEEP,W.KEEP,W.KEEP))}else Ve(m.stencilModeForClipping(se))}le&&(m.resetStencilClippingMasks(),m.terrain&&he.clear({stencil:0}))},fill:function(m,o,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const E=m.colorModeForRenderPass(),M=u.paint.get("fill-pattern"),k=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===v.constantOr(p.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(m.renderPass===k){const R=m.depthModeForSublayer(1,"opaque"===m.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);li(m,o,u,g,R,E,!1)}if("translucent"===m.renderPass&&u.paint.get("fill-antialias")){const R=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);li(m,o,u,g,R,E,!0)}},"fill-extrusion":function(m,o,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===m.renderPass){const b=new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))Do(m,o,u,g,b,p.StencilMode.disabled,p.ColorMode.disabled),Do(m,o,u,g,b,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const E=m.colorModeForRenderPass();Do(m,o,u,g,b,p.StencilMode.disabled,E)}}},hillshade:function(m,o,u,g){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const v=m.context,b=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),E=m.colorModeForRenderPass(),M=m.terrain&&m.terrain.renderingToTexture,[k,R]="translucent"!==m.renderPass||M?[{},g]:m.stencilConfigForOverlap(g);for(const L of R){const B=o.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===m.renderPass)no(m,B,u,b,p.StencilMode.disabled,E);else if("translucent"===m.renderPass){const G=M&&m.terrain?m.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];ll(m,L,B,u,b,G,E)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,u,g,v,b){if("translucent"!==m.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const E=m.context,M=E.gl,k=o.getSource(),R=m.useProgram("raster"),L=m.colorModeForRenderPass(),B=m.terrain&&m.terrain.renderingToTexture,[G,K]=k instanceof xo||B?[{},g]:m.stencilConfigForOverlap(g),Z=K[K.length-1].overscaledZ,Y=!m.options.moving;for(const he of K){const W=B?p.DepthMode.disabled:m.depthModeForSublayer(he.overscaledZ-Z,1===u.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,M.LESS),ae=he.toUnwrapped(),le=o.getTile(he);if(B&&(!le||!le.hasData()))continue;const se=B?he.projMatrix:m.transform.calculateProjMatrix(ae,Y),ie=m.terrain&&B?m.terrain.stencilModeForRTTOverlap(he):G[he.overscaledZ],ue=b?0:u.paint.get("raster-fade-duration");le.registerFadeDuration(ue);const ye=o.findLoadedParent(he,0),Ie=nd(le,ye,o,m.transform,ue);let Qe,Ge;m.terrain&&m.terrain.prepareDrawTile(he);const $e="nearest"===u.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;E.activeTexture.set(M.TEXTURE0),le.texture.bind($e,M.CLAMP_TO_EDGE),E.activeTexture.set(M.TEXTURE1),ye?(ye.texture.bind($e,M.CLAMP_TO_EDGE),Qe=Math.pow(2,ye.tileID.overscaledZ-le.tileID.overscaledZ),Ge=[le.tileID.canonical.x*Qe%1,le.tileID.canonical.y*Qe%1]):le.texture.bind($e,M.CLAMP_TO_EDGE);const Ae=Hr(se,Ge||[0,0],Qe||1,Ie,u,k instanceof xo?k.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(E,R,ae),k instanceof xo)R.draw(E,M.TRIANGLES,W,p.StencilMode.disabled,L,p.CullFaceMode.disabled,Ae,u.id,k.boundsBuffer,m.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:Ve,tileBoundsSegments:Oe}=m.getTileBoundsBuffers(le);R.draw(E,M.TRIANGLES,W,ie,L,p.CullFaceMode.disabled,Ae,u.id,Me,Ve,Oe)}}m.resetStencilClippingMasks()},background:function(m,o,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const E=m.context,M=E.gl,k=m.transform,R=k.tileSize,L=u.paint.get("background-pattern");if(m.isPatternMissing(L))return;const B=!L&&1===v.a&&1===b&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const G=p.StencilMode.disabled,K=m.depthModeForSublayer(0,"opaque"===B?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Z=m.colorModeForRenderPass(),Y=m.useProgram(L?"backgroundPattern":"background");let he,W=g;W||(he=m.getBackgroundTiles(),W=Object.values(he).map(le=>le.tileID)),L&&(E.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context));const ae=u.getCrossfadeParameters();for(const le of W){const se=le.toUnwrapped(),ie=g?le.projMatrix:m.transform.calculateProjMatrix(se);m.prepareDrawTile(le);const ue=o?o.getTile(le):he?he[le.key]:new p.Tile(le,R,k.zoom,m),ye=L?pl(ie,b,m,L,{tileID:le,tileSize:R},ae):mn(ie,b,v);m.prepareDrawProgram(E,Y,se);const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:Qe,tileBoundsSegments:Ge}=m.getTileBoundsBuffers(ue);Y.draw(E,M.TRIANGLES,K,G,Z,p.CullFaceMode.disabled,ye,u.id,Ie,Qe,Ge)}},sky:function(m,o,u){const g=m.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:p.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const E=m.context,M=u.paint.get("sky-type"),k=new p.DepthMode(E.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),R=m.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===m.renderPass?u.needsSkyboxCapture(m)&&(function(L,B,G,K){const Z=L.context,Y=Z.gl;let he=B.skyboxFbo;if(!he){he=B.skyboxFbo=Z.createFramebuffer(32,32,!1),B.skyboxGeometry=new Ri(Z),B.skyboxTexture=Z.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,B.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let se=0;se<6;++se)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(he.framebuffer),Z.viewport.set([0,0,32,32]);const W=B.getCenter(L,!0),ae=L.useProgram("skyboxCapture"),le=new Float64Array(16);p.identity(le),p.rotateY(le,le,.5*-Math.PI),En(Z,B,ae,le,W,0),p.identity(le),p.rotateY(le,le,.5*Math.PI),En(Z,B,ae,le,W,1),p.identity(le),p.rotateX(le,le,.5*-Math.PI),En(Z,B,ae,le,W,2),p.identity(le),p.rotateX(le,le,.5*Math.PI),En(Z,B,ae,le,W,3),p.identity(le),En(Z,B,ae,le,W,4),p.identity(le),p.rotateY(le,le,Math.PI),En(Z,B,ae,le,W,5),Z.viewport.set([0,0,L.width,L.height])}(m,u),u.markSkyboxValid(m)):"sky"===m.renderPass&&function(L,B,G,K,Z){const Y=L.context,he=Y.gl,W=L.transform,ae=L.useProgram("skybox");Y.activeTexture.set(he.TEXTURE0),he.bindTexture(he.TEXTURE_CUBE_MAP,B.skyboxTexture);const le={u_matrix:W.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:Z};L.prepareDrawProgram(Y,ae),ae.draw(Y,he.TRIANGLES,G,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,le,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,u,k,b,R):"gradient"===M&&"sky"===m.renderPass&&function(L,B,G,K,Z){const Y=L.context,he=Y.gl,W=L.transform,ae=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Ri(Y)),Y.activeTexture.set(he.TEXTURE0);let le=B.colorRampTexture;le||(le=B.colorRampTexture=new p.Texture(Y,B.colorRamp,he.RGBA)),le.bind(he.LINEAR,he.CLAMP_TO_EDGE);const se=(ie=W.skyboxMatrix,ue=B.getCenter(L,!1),ye=B.paint.get("sky-gradient-radius"),Ie=K,Qe=Z,{u_matrix:ie,u_color_ramp:0,u_center_direction:ue,u_radius:p.degToRad(ye),u_opacity:Ie,u_temporal_offset:Qe});var ie,ue,ye,Ie,Qe;L.prepareDrawProgram(Y,ae),ae.draw(Y,he.TRIANGLES,G,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,se,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,u,k,b,R)},debug:function(m,o,u){for(let g=0;g<u.length;g++)xs(m,o,u[g])},custom:function(m,o,u){const g=m.context,v=u.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const b=v.prerender;b&&(m.setCustomLayerDefaults(),g.setColorMode(m.colorModeForRenderPass()),b.call(v,g.gl,m.transform.customLayerMatrix()),g.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),g.setColorMode(m.colorModeForRenderPass()),g.setStencilMode(p.StencilMode.disabled);const b="3d"===v.renderingMode?new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,p.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,m.transform.customLayerMatrix()),g.setDirty(),m.setBaseState(),g.bindFramebuffer.set(null)}}};class sd{constructor(o,u){this.context=new Ui(o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bn,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,u){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ea(this,o));const v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,u)}_updateFog(o){const u=o.fog;if(!u||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,u){if(this.width=o*p.exported.devicePixelRatio,this.height=u*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=o.createVertexBuffer(g,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const v=new p.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const b=new p.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(p.EXTENT,0,p.EXTENT,0),b.emplaceBack(0,p.EXTENT,0,p.EXTENT),b.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const E=new p.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const M=new p.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])M.emplaceBack(R);this.debugIndexBuffer=o.createIndexBuffer(M),this.emptyTexture=new p.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=p.create();const k=this.context.gl;this.stencilClearMode=new p.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(p.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,u.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Zo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,g){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const k of g)if(void 0===this._tileClippingMaskIDs[k.key]){M=!0;break}if(!M)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of g){const k=u.getTile(M),R=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:G}=this.getTileBoundsBuffers(k);E.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Zo(M.projMatrix),"$clipping",L,B,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new p.StencilMode({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new p.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,g=o.sort((E,M)=>M.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let M=0;M<b;M++)E[M+v]=new p.StencilMode({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[E,g]}return[{[v]:p.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([o.CONSTANT_COLOR,o.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(o,u,g){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new p.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const R in v){const L=v[R];L.used&&L.prepare(this.context)}const b={},E={},M={};for(const R in v){const L=v[R];b[R]=L.getVisibleCoordinates(),E[R]=b[R].slice().reverse(),M[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of g){const L=this.style._layers[R],B=o._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const G=B?E[B.id]:void 0;("custom"===L.type||L.isSky()||G&&G.length)&&this.renderLayer(this,B,L,G)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=p.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:u.showOverdrawInspector?p.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);if(R.isSky())continue;const B=L?E[L.id]:void 0;this._renderTileClippingMasks(R,L,B),this.renderLayer(this,L,R,B)}if(this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?E[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const L=R.context,B=L.gl,G=R.transform,K=new p.DepthMode(B.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Z=R.useProgram("globeAtmosphere"),Y=G._camera.getWorldToCamera(G.worldSize,1),he=G._camera.getCameraToClipPerspective(G._fov,G.width/G.height,G._nearZ,G._farZ),W=p.mul([],Y,p.calculateGlobeMatrix(G,G.worldSize)),ae=p.mul([],G.labelPlaneMatrix,he),le=p.transformMat4([],[0,0,0],W),se=p.add([],le,[G.worldSize/Math.PI/2,0,0]),ie=p.transformMat4([],le,ae),ue=p.transformMat4([],se,ae),ye=p.length(p.sub([],ue,ie)),Ie=1-p.globeToMercatorTransition(G.zoom),Qe={u_center:ie,u_radius:ye,u_screen_size:[G.width,G.height],u_pixel_ratio:p.exported.devicePixelRatio,u_opacity:Ie,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(L,Z);const Ge=R.globeSharedBuffers;Ge&&Z.draw(L,B.TRIANGLES,K,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Qe,"skybox",Ge.atmosphereVertexBuffer,Ge.atmosphereIndexBuffer,Ge.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===R.type?M:E)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?b[L.id]:void 0),this.renderLayer(this,L,R,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;p.values(this.style._layers).forEach(L=>{const B=o._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<B.getSource().maxzoom)&&(R=B)}),R&&this.options.showTileBoundaries&&lc.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;ni(R,R.transform.height-(L.top||0),3,Hs),ni(R,L.bottom||0,3,wr),ys(R,L.left||0,3,_s),ys(R,R.transform.width-(L.right||0),3,Xo);const B=R.transform.centerPoint;var G,K,Z,Y;vs(G=R,(K=B.x)-1,(Z=R.transform.height-B.y)-10,2,20,Y=Xt),vs(G,K-10,Z-1,20,2,Y)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||lc[g.type](o,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const u={};for(const g in o){const v=o[g],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=E}return u}translatePosMatrix(o,u,g,v,b){if(!g[0]&&!g[1])return o;const E=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(E){const R=Math.sin(E),L=Math.cos(E);g=[g[0]*L-g[1]*R,g[0]*R+g[1]*L]}const M=[b?g[0]:an(u,g[0],this.transform.zoom),b?g[1]:an(u,g[1],this.transform.zoom),0],k=new Float32Array(16);return p.translate(k,o,M),k}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!u||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!o&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),E=Wo.cacheKey(o,b,u);return this.cache[E]||(this.cache[E]=new Wo(this.context,o,oc[o],u,fl[o],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch);0!==b&&u.setFogUniformValues(o,((E,M,k,R)=>{const L=M.properties.get("color"),B=E.frameCounter/1e3%1,G=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:k?E.transform.calculateFogTileMatrix(k):E.identityMat,u_fog_range:M.getFovAdjustedRange(E.transform._fov),u_fog_color:G,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,v,g,b))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=o[v.key]||new p.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ji{constructor(o=0,u=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=v}interpolate(o,u,g){return null!=u.top&&null!=o.top&&(this.top=p.number(o.top,u.top,g)),null!=u.bottom&&null!=o.bottom&&(this.bottom=p.number(o.bottom,u.bottom,g)),null!=u.left&&null!=o.left&&(this.left=p.number(o.left,u.left,g)),null!=u.right&&null!=o.right&&(this.right=p.number(o.right,u.right,g)),this}getCenter(o,u){const g=p.clamp((this.left+o-this.right)/2,0,o),v=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.pointGeometry(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ji(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qr(m,o){const u=p.getColumn(m,3);p.fromQuat(m,o),p.setColumn(m,3,u)}function tu(m,o){p.setColumn(m,3,[o[0],o[1],o[2],1])}function ml(m,o){const u=p.identity$1([]);return p.rotateZ$1(u,u,-o),p.rotateX$1(u,u,-m),u}function gl(m,o){const u=[m[0],m[1],0],g=[o[0],o[1],0];if(p.length(u)>=1e-15){const E=p.normalize([],u);p.scale$2(g,E,p.dot(g,E)),o[0]=g[0],o[1]=g[1]}const v=p.cross([],o,m);if(p.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return ml(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}class oo{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(u){if(!u)return;const g=Array.isArray(u)?new p.MercatorCoordinate(u[0],u[1],u[2]):u;return g.x=p.wrap(g.x,0,1),g}(o):o}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(o)):0,v=this.position,b=p.MercatorCoordinate.fromLngLat(o,g),E=[b.x-v.x,b.y-v.y,b.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=gl(E,u)}setPitchBearing(o,u){this.orientation=ml(p.degToRad(o),p.degToRad(-u))}}class ah{constructor(o,u){this._transform=p.identity([]),this._orientation=p.identity$1([]),u&&(this._orientation=u,qr(this._transform,this._orientation)),o&&tu(this._transform,o)}get mercatorPosition(){const o=this.position;return new p.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=p.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){tu(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,qr(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=ml(o,u),qr(this._transform,this._orientation)}forward(){const o=p.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=p.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=p.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const g=new Float64Array(16);return p.invert(g,this.getWorldToCamera(o,u)),g}getWorldToCameraPosition(o,u,g){const v=this.position;p.scale$2(v,v,-o);const b=new Float64Array(16);return p.fromScaling(b,[g,g,g]),p.translate(b,b,v),b[10]*=u,b}getWorldToCamera(o,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return p.conjugate(v,this._orientation),p.scale$2(b,b,-o),p.fromQuat(g,v),p.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(o,u,g,v){const b=new Float64Array(16);return p.perspective(b,o,u,g,v),b}getDistanceToElevation(o){const u=0===o?0:p.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new ah([...this.position],[...this.orientation])}}function Bp(m,o){const u=ru(m),g=function(b,E,M,k,R){const L=new p.LngLat(M.lng-180*Ko,M.lat),B=new p.LngLat(M.lng+180*Ko,M.lat),G=b.project(L.lng,L.lat),K=b.project(B.lng,B.lat),Z=-Math.atan2(K.y-G.y,K.x-G.x),Y=p.MercatorCoordinate.fromLngLat(M);Y.y=p.clamp(Y.y,-.999975,.999975);const he=Y.toLngLat(),W=b.project(he.lng,he.lat),ae=p.MercatorCoordinate.fromLngLat(he);ae.x+=Ko;const le=ae.toLngLat(),se=b.project(le.lng,le.lat),ie=ld(se.x-W.x,se.y-W.y,Z),ue=p.MercatorCoordinate.fromLngLat(he);ue.y+=Ko;const ye=ue.toLngLat(),Ie=b.project(ye.lng,ye.lat),Qe=ld(Ie.x-W.x,Ie.y-W.y,Z),Ge=Math.abs(ie.x)/Math.abs(Qe.y),$e=p.identity([]);p.rotateZ($e,$e,-Z*(1-(R?0:k)));const Ae=p.identity([]);return p.scale(Ae,Ae,[1,1-(1-Ge)*k,1]),Ae[4]=-Qe.x/Qe.y*k,p.rotateZ(Ae,Ae,Z),p.multiply$1(Ae,$e,Ae),Ae}(m.projection,0,m.center,u,o),v=nu(m);return p.scale(g,g,[v,v,1]),g}function nu(m){const o=m.projection,u=ru(m),g=ad(o,m.center),v=ad(o,p.LngLat.convert(o.center));return Math.pow(2,g*u+(1-u)*v)}function ru(m){const o=m.projection.range;if(!o)return 0;const u=Math.max(m.width,m.height),g=Math.log(u/1024)/Math.LN2;return p.smoothstep(o[0]+g,o[1]+g,m.zoom)}const Ko=1/4e4;function ad(m,o){const u=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=new p.LngLat(o.lng-180*Ko,u),v=new p.LngLat(o.lng+180*Ko,u),b=m.project(g.lng,u),E=m.project(v.lng,u),M=p.MercatorCoordinate.fromLngLat(g),k=p.MercatorCoordinate.fromLngLat(v),R=E.x-b.x,L=E.y-b.y,B=k.x-M.x,G=k.y-M.y,K=Math.sqrt((B*B+G*G)/(R*R+L*L));return Math.log(K)/Math.LN2}function ld(m,o,u){const g=Math.cos(u),v=Math.sin(u);return{x:m*g-o*v,y:m*v+o*g}}class iu{constructor(o,u,g,v,b){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=null==g?0:g,this._maxPitch=null==v?60:v,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ji,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ah,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new iu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.setProjection(this.getProjection()),o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.setMaxBounds(this.getMaxBounds()),o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const u=this.projection?this.getProjection():void 0;return this.projection=p.getProjection(o),!Lt(u,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;var g,v,b,E,M,k,R,L,B,G;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,E=this.angle,M=(b=this.rotationMatrix)[0],k=b[1],R=b[2],L=b[3],B=Math.sin(E),G=Math.cos(E),v[0]=M*G+R*B,v[1]=k*G+L*B,v[2]=M*-B+R*G,v[3]=k*-B+L*G)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=p.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let E=0;E<u.length;E++){const M=new p.pointGeometry(u[E][0]*this.width,g+u[E][1]*(this.height-g)),k=o.pointCoordinate(M);if(!k)continue;const R=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);v+=k[3]*R,b+=R}return 0===b?NaN:v/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const v=p.length(p.sub([],this._camera.position,g));return p.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!p.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];p.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new oo;return u.position=new p.MercatorCoordinate(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!p.length$1(o))return!1;p.normalize$1(o,o);const u=p.transformQuat([],[0,0,-1],o),g=p.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const v=gl(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=p.clamp(o[2],v/g,v/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new p.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new p.pointGeometry(0,0)),v=this.pointCoordinate(new p.pointGeometry(this.width,0)),b=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new p.pointGeometry(0,this.height)),M=Math.floor(Math.min(g.x,v.x,b.x,E.x)),k=Math.floor(Math.max(g.x,v.x,b.x,E.x)),R=1;for(let L=M-R;L<=k+R;L++)0!==L&&u.push(new p.UnwrappedTileID(L,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const g=u,v=this.elevation&&!o.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==o.minzoom&&u<o.minzoom)return[];void 0!==o.maxzoom&&u>o.maxzoom&&(u=o.maxzoom);const E=this.locationCoordinate(this.center),M=1<<u,k=[M*E.x,M*E.y,0],R=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,"globe"!==this.projection.name),L=this.pointCoordinate(this.getCameraPoint()),B=M*p.mercatorZfromAltitude(1,this.center.lat),G=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),K=[M*L.x,M*L.y,G],Z=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,he=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,W=o.isTerrainDEM?-he:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?nu(this):1,le=Me=>{const Oe=new p.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),mt=new p.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),Dt=Me.toLngLat(),Gt=Oe.toLngLat(),Ye=mt.toLngLat(),_t=this.locationCoordinate(Dt),Rt=this.locationCoordinate(Gt),In=this.locationCoordinate(Ye),Nn=Math.hypot(Rt.x-_t.x,Rt.y-_t.y),At=Math.hypot(In.x-_t.x,In.y-_t.y);return Math.sqrt(Nn*At)*ae/25e-6},se=Me=>{const Ve=he,Oe=W;return{aabb:p.tileAABB(this,M,0,0,0,Me,Oe,Ve,this.projection),zoom:0,x:0,y:0,minZ:Oe,maxZ:Ve,wrap:Me,fullyVisible:!1}},ie=[];let ue=[];const ye=u,Ie=o.reparseOverscaled?g:u,Qe=Me=>Me*Me,Ge=Qe((G-this._centerAltitude)*B),$e=Me=>{if(!this._elevation||!Me.tileID||!b)return;const Ve=this._elevation.getMinMaxForTile(Me.tileID),Oe=Me.aabb;Ve?(Oe.min[2]=Ve.min,Oe.max[2]=Ve.max,Oe.center[2]=(Oe.min[2]+Oe.max[2])/2):(Me.shouldSplit=Ae(Me),Me.shouldSplit||(Oe.min[2]=Oe.max[2]=Oe.center[2]=this._centerAltitude))},Ae=Me=>{if(Me.zoom<Y)return!0;if(Me.zoom===ye)return!1;if(null!=Me.shouldSplit)return Me.shouldSplit;const Ve=Me.aabb.distanceX(K),Oe=Me.aabb.distanceY(K);let mt=Ge;v&&(mt=Qe(Me.aabb.distanceZ(K)*B));let Dt=1;if(this.projection.isReprojectedInTileSpace&&g<=5){const Ye=Math.pow(2,Me.zoom),_t=le(new p.MercatorCoordinate((Me.x+.5)/Ye,(Me.y+.5)/Ye));Dt=_t>.85?1:_t}const Gt=Ve*Ve+Oe*Oe+mt;return Gt<Qe((1<<ye-Me.zoom)*Z*Dt*((Ye,_t)=>{if(_t*Qe(.707)<Ye)return 1;const Rt=Math.sqrt(_t/Ye);return Rt/(1.4144271570014144+(Math.pow(1.1,Rt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(mt,Ge),Gt))};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)ie.push(se(-Me)),ie.push(se(Me));for(ie.push(se(0));ie.length>0;){const Me=ie.pop(),Ve=Me.x,Oe=Me.y;let mt=Me.fullyVisible;if(!mt){const Dt=Me.aabb.intersects(R);if(0===Dt)continue;mt=2===Dt}if(Me.zoom!==ye&&Ae(Me))for(let Dt=0;Dt<4;Dt++){const Gt=(Ve<<1)+Dt%2,Ye=(Oe<<1)+(Dt>>1),_t={aabb:b?Me.aabb.quadrant(Dt):p.tileAABB(this,M,Me.zoom+1,Gt,Ye,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:Gt,y:Ye,wrap:Me.wrap,fullyVisible:mt,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};v&&(_t.tileID=new p.OverscaledTileID(Me.zoom+1===ye?Ie:Me.zoom+1,Me.wrap,Me.zoom+1,Gt,Ye),$e(_t)),ie.push(_t)}else{const Dt=Me.zoom===ye?Ie:Me.zoom;if(o.minzoom&&o.minzoom>Dt)continue;const Gt=k[0]-(.5+Ve+(Me.wrap<<Me.zoom))*(1<<u-Me.zoom),Ye=k[1]-.5-Oe,_t=Me.tileID?Me.tileID:new p.OverscaledTileID(Dt,Me.wrap,Me.zoom,Ve,Oe);ue.push({tileID:_t,distanceSq:Gt*Gt+Ye*Ye})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,Ve=this.horizonLineFromTop();ue=ue.filter(Oe=>{const mt=[0,0,0,1],Dt=[p.EXTENT,p.EXTENT,0,1],Gt=this.calculateFogTileMatrix(Oe.tileID.toUnwrapped());p.transformMat4$1(mt,mt,Gt),p.transformMat4$1(Dt,Dt,Gt);const Ye=p.getAABBPointSquareDist(mt,Dt);if(0===Ye)return!0;let _t=!1;const Rt=this._elevation;if(Rt&&Ye>Me&&0!==Ve){const In=this.calculateProjMatrix(Oe.tileID.toUnwrapped());let Nn;o.isTerrainDEM||(Nn=Rt.getMinMaxForTile(Oe.tileID)),Nn||(Nn={min:W,max:he});const At=p.furthestTileCorner(this.rotation),qt=[At[0]*p.EXTENT,At[1]*p.EXTENT,Nn.max];p.transformMat4(qt,qt,In),_t=(1-qt[1])*this.height*.5<Ve}return Ye<Me||_t})}return ue.sort((Me,Ve)=>Me.distanceSq-Ve.distanceSq).map(Me=>Me.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,u);return new p.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,u){const g=this.pointCoordinate(u),v=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o);this.setLocation(new p.MercatorCoordinate(b.x-(g.x-v.x),b.y-(g.y-v.y)))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,u){const g=u?p.mercatorZfromAltitude(u,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new p.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const g=null!=u?u:this._centerAltitude,v=[o.x,o.y,0,1],b=[o.x,o.y,1,1];p.transformMat4$1(v,v,this.pixelMatrixInverse),p.transformMat4$1(b,b,this.pixelMatrixInverse);const E=b[3];p.scale$1(v,v,1/v[3]),p.scale$1(b,b,1/E);const M=v[2],k=b[2];return{p0:v,p1:b,t:M===k?0:(g-M)/(k-M)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return p.transformMat4$1(u,u,this.pixelMatrixInverse),p.transformMat4$1(g,g,this.pixelMatrixInverse),p.scale$1(u,u,1/u[3]),p.scale$1(g,g,1/g[3]),u[2]=p.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,p.scale$1(u,u,1/this.worldSize),p.scale$1(g,g,1/this.worldSize),new p.Ray([u[0],u[1],u[2]],p.normalize([],p.sub([],g,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:g,t:v}=o,b=p.mercatorZfromAltitude(u[2],this._center.lat),E=p.mercatorZfromAltitude(g[2],this._center.lat);return new p.MercatorCoordinate(p.number(u[0],g[0],v)/this.worldSize,p.number(u[1],g[1],v)/this.worldSize,p.number(b,E,v))}pointCoordinate(o,u=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(o.x,o.y,u)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const u=this.elevation;let g=this.elevation.pointCoordinate(o);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let v=0,b=this.horizonLineFromTop();if(o.y>b)return this.pointCoordinate(o);const E=.02*b,M=o.clone();for(let k=0;k<10&&b-v>E;k++){M.y=p.number(v,b,.66);const R=u.pointCoordinate(M);R?(b=M.y,g=R):v=M.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const u=this.horizonLineFromTop();return o.y<u}}_coordinatePoint(o,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return p.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new p.pointGeometry(v[0]/v[3],v[1]/v[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,u){const g=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(g,o),k=this.pointCoordinate(v,o);const R=this.pointCoordinate(b,u),L=this.pointCoordinate(E,u),B=(G,K)=>(K.y-G.y)/(K.x-G.x);return M.y>1&&k.y>=0?M=new p.MercatorCoordinate((1-L.y)/B(L,M)+L.x,1):M.y<0&&k.y<=1&&(M=new p.MercatorCoordinate(-L.y/B(L,M)+L.x,0)),k.y>1&&M.y>=0?k=new p.MercatorCoordinate((1-R.y)/B(R,k)+R.x,1):k.y<0&&M.y<=1&&(k=new p.MercatorCoordinate(-R.y/B(R,k)+R.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const u=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileTransform(this,u).createTileMatrix(o)}calculateDistanceTileData(o){const u=o.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=o.canonical,b=1/this.height,E=this.cameraWorldSize/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*o.wrap)*E,k=v.y*E,R=this.point,L=this.angle,B=Math.sin(-L),G=-Math.cos(-L);return g[u]={bearing:[B,G],center:[(R.x-M)*b,(R.y-k)*b],scale:E/p.EXTENT*b},g[u]}calculateFogTileMatrix(o){const u=o.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.calculatePosMatrix(o,this.cameraWorldSize);return p.multiply$1(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(o,u=!1){const g=o.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(o,this.worldSize);return p.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,E){const{scale:M}=b.tileTransform,k=M*p.EXTENT/(b.tileSize*Math.pow(2,E.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return R=new Float32Array(4),G=(L=E.inverseAdjustmentMatrix)[1],K=L[2],Z=L[3],he=(B=[k,k])[1],R[0]=L[0]*(Y=B[0]),R[1]=G*Y,R[2]=K*he,R[3]=Z*he,R;var R,L,B,G,K,Z,Y,he}(o,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=p.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,p.normalize(v,v);const E=o.raycast(g,v,o.exaggeration());if(E){const M=p.scaleAndAdd([],g,v,E),k=new p.MercatorCoordinate(M[0],M[1],p.mercatorZfromAltitude(M[2],p.latFromMercatorY(M[1]))),R=(k.z+p.length([k.x-g[0],k.y-g[1],k.z-g[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=o.getAtPointOrZero(new p.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(E<b){const M=this.locationCoordinate(this._center,this._centerAltitude),k=[M.x-g[0],M.y-g[1],M.z-g[2]],R=p.length(k);k[2]-=(b-E)/this._projectionScaler;const L=p.length(k);if(0===L)return;p.scale$2(k,k,R/L*this._projectionScaler),this._camera.position=[M.x-k[0],M.y-k[1],M.z*this._projectionScaler-k[2]],this._camera.orientation=gl(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=p.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=p.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:g}=this.point;let v=0,b=u,E=g;const M=this.width/2,k=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(g-k<R&&(E=R+k),g+k>L&&(E=L-k),L-R<this.height&&(v=Math.max(v,this.height/(L-R)),E=(L+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,K=this.worldSize/2-(B+G)/2;b=(u+K+this.worldSize)%this.worldSize-K,b-M<B&&(b=B+M),b+M>G&&(b=G-M),G-B<this.width&&(v=Math.max(v,this.width/(G-B)),b=(G+B)/2)}b===u&&E===g||(this.center=this.unproject(new p.pointGeometry(b,E))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,u=this.centerOffset,g=this.pixelsPerMeter;this._projectionScaler=g/(p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-u.x/this.width,b[9]=2*u.y/this.height;let E=p.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const se=this.locationCoordinate(this.center),ie=p.identity([]);p.translate(ie,ie,[se.x*this.worldSize,se.y*this.worldSize,0]),p.multiply$1(ie,ie,Bp(this)),p.translate(ie,ie,[-se.x*this.worldSize,-se.y*this.worldSize,0]),p.multiply$1(E,E,ie),this.inverseAdjustmentMatrix=function(ue){const ye=Bp(ue,!0);return at([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],E,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=E,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const M=new Float32Array(16);p.identity(M),p.scale(M,M,[1,-1,1]),p.rotateX(M,M,this._pitch),p.rotateZ(M,M,this.angle);const k=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-u.x/this.width,k[9]=2*(u.y+R)/this.height,this.skyboxMatrix=p.multiply$1(M,k,M);const L=this.point,B=L.x,G=L.y,K=this.width%2/2,Z=this.height%2/2,Y=Math.cos(this.angle),he=Math.sin(this.angle),W=B-Math.round(B)+Y*K+he*Z,ae=G-Math.round(G)+Y*Z+he*K,le=new Float64Array(E);if(p.translate(le,le,[W>.5?W-1:W,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=le,E=p.create(),p.scale(E,E,[this.width/2,-this.height/2,1]),p.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=p.create(),p.scale(E,E,[1,-1,1]),p.translate(E,E,[-1,-1,0]),p.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=p.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=p.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height,b=[o,o,u];p.scale$2(b,b,v),p.scale$2(g,g,-1),p.multiply$2(g,g,b);const E=p.create();p.translate(E,E,g),p.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,v)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let v=1;g>0&&(v=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),M=Math.max((o[2]-b)/Math.cos(g),E),k=this._zoomFromMercatorZ(M);p.scaleAndAdd(o,o,u,M),this._pitch=p.clamp(g,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(v,-Math.PI,Math.PI),this._setZoom(p.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new p.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,u){const g=Math.min(o.x,u.x),v=Math.max(o.x,u.x),b=Math.min(o.y,u.y),E=Math.max(o.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new p.pointGeometry(g,b),new p.pointGeometry(v,E),new p.pointGeometry(g,E),new p.pointGeometry(v,b)],k=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of M){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const G=this.rayIntersectionCoordinate(B);if(G.x<k||G.y<0||G.x>R||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,u){const g=p.length(p.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,o))}}function Da(m,o){let u=!1,g=null;const v=()=>{g=null,u&&(m(),g=setTimeout(v,o),u=!1)};return()=>(u=!0,g||v(),g)}class Np{constructor(o){this._hashName=o&&encodeURIComponent(o),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Da(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const u=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),E=Math.round(u.lng*b)/b,M=Math.round(u.lat*b)/b,k=this._map.getBearing(),R=this._map.getPitch();let L="";if(L+=o?`/${E}/${M}/${g}`:`${g}/${M}/${E}`,(k||R)&&(L+="/"+Math.round(10*k)/10),R&&(L+=`/${Math.round(R)}`),this._hashName){const B=this._hashName;let G=!1;const K=p.window.location.hash.slice(1).split("&").map(Z=>{const Y=Z.split("=")[0];return Y===B?(G=!0,`${Y}=${L}`):Z}).filter(Z=>Z);return G||K.push(`${B}=${L}`),`#${K.join("&")}`}return`#${L}`}_getCurrentHash(){const o=p.window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,o)}}const qs={linearity:.3,easing:p.bezier(0,0,.3,1)},cc=p.extend({deceleration:2500,maxSpeed:1400},qs),Up=p.extend({deceleration:20,maxSpeed:1400},qs),cd=p.extend({deceleration:1e3,maxSpeed:360},qs),Tn=p.extend({deceleration:1e3,maxSpeed:90},qs);class lh{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=p.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=ou(u.pan.mag(),g,p.extend({},cc,o||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,ch(v,b)}if(u.zoom){const b=ou(u.zoom,g,Up);v.zoom=this._map.transform.zoom+b.amount,ch(v,b)}if(u.bearing){const b=ou(u.bearing,g,cd);v.bearing=this._map.transform.bearing+p.clamp(b.amount,-179,179),ch(v,b)}if(u.pitch){const b=ou(u.pitch,g,Tn);v.pitch=this._map.transform.pitch+b.amount,ch(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),p.extend(v,{noMoveStart:!0})}}function ch(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function ou(m,o,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,E=p.clamp(m*v/(o/1e3),-g,g),M=Math.abs(E)/(b*v);return{easing:u.easing,duration:1e3*M,amount:E*(M/2)}}class Zr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,v={}){const b=Be.mousePos(u.getCanvasContainer(),g),E=u.unproject(b);super(o,p.extend({point:b,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class _l extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const v="touchend"===o?g.changedTouches:g.touches,b=Be.touchPos(u.getCanvasContainer(),v),E=b.map(k=>u.unproject(k)),M=b.reduce((k,R,L,B)=>k.add(R.div(B.length)),new p.pointGeometry(0,0));super(o,{points:b,point:M,lngLats:E,lngLat:u.unproject(M),originalEvent:g}),this._defaultPrevented=!1}}class Zm extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class jp{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Zm(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new Zr(o.type,this._map,o))}mouseup(o){this._map.fire(new Zr(o.type,this._map,o))}preclick(o){const u=p.extend({},o);u.type="preclick",this._map.fire(new Zr(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Zr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Zr(o.type,this._map,o))}mouseover(o){this._map.fire(new Zr(o.type,this._map,o))}mouseout(o){this._map.fire(new Zr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new _l(o.type,this._map,o))}touchmove(o){this._map.fire(new _l(o.type,this._map,o))}touchend(o){this._map.fire(new _l(o.type,this._map,o))}touchcancel(o){this._map.fire(new _l(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wm{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Zr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Zr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bs{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(Be.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=Be.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(v.x,g.x),E=Math.max(v.x,g.x),M=Math.min(v.y,g.y),k=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${M}px)`,this._box.style.width=E-b+"px",this._box.style.height=k-M+"px")})}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const g=this._startPos,v=u;if(this.reset(),Be.suppressClick(),g.x!==v.x||g.y!==v.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Be.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new p.Event(o,{originalEvent:u}))}}function yl(m,o){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=o[g];return u}class Mo{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new p.pointGeometry(0,0);for(const E of v)b._add(E);return b.div(v.length)}(u),this.touches=yl(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const v=yl(g,u);for(const b in this.touches){const E=this.touches[b],M=v[b];(!M||M.dist(E)>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class vl{constructor(o){this.singleTap=new Mo(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const v=this.singleTap.touchend(o,u,g);if(v){const b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class uh{constructor(){this._zoomIn=new vl({numTouches:1,numTaps:2}),this._zoomOut=new vl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const v=this._zoomIn.touchend(o,u,g),b=this._zoomOut.touchend(o,u,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ud={0:1,2:2};class Ma{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const g=Be.mouseButton(o);this._correctButton(o,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(o,u){const g=this._lastPoint;if(g)if(o.preventDefault(),function(v,b){const E=ud[b];return void 0===v.buttons||(v.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(o){this._lastPoint&&Be.mouseButton(o)===this._eventButton&&(this._moved&&Be.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uc extends Ma{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return 0===u&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class so extends Ma{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=.8*(u.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class hc extends Ma{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=-.5*(u.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class hd{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,u,g)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const v=yl(g,u),b=new p.pointGeometry(0,0),E=new p.pointGeometry(0,0);let M=0;for(const R in v){const L=v[R],B=this._touches[R];B&&(b._add(L),E._add(L.sub(B)),M++,v[R]=L)}if(this._touches=v,M<this._minTouches||!E.mag())return;const k=E.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ci{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,u,g){return{}}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){if(!this._firstTwoTouches)return;o.preventDefault();const[v,b]=this._firstTwoTouches,E=Io(g,u,v),M=Io(g,u,b);if(!E||!M)return;const k=this._aroundCenter?null:E.add(M).div(2);return this._move([E,M],k,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,E=Io(g,u,v),M=Io(g,u,b);E&&M||(this._active&&Be.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Io(m,o,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return o[g]}function hh(m,o){return Math.log(m/o)/Math.LN2}class xl extends Ci{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(hh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hh(this._distance,g),pinchAround:u}}}function su(m,o){return 180*m.angleWith(o)/Math.PI}class au extends Ci{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:su(this._vector,g),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=su(o,this._startVector);return Math.abs(g)<u}}function bl(m){return Math.abs(m.y)>Math.abs(m.x)}class dd extends Ci{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,bl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){const v=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&g.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,b,g.timeStamp),this._valid))return this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5}}gestureBeginsVertically(o,u,g){if(void 0!==this._valid)return this._valid;const v=o.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==u.y>0;return bl(o)&&bl(u)&&E}}const Zs={panStep:100,bearingStep:15,pitchStep:10};class Xm{constructor(){const o=Zs;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,v=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:M=>{const k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:dr,zoom:u?Math.round(k)+u*(o.shiftKey?2:1):k,bearing:M.getBearing()+g*this._bearingStep,pitch:M.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:M.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dr(m){return m*(2-m)}const lu=4.000244140625;class cu{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=p.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%lu==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Be.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>lu?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==R&&(R=1/R);const L=u(),B=Math.pow(2,L),G="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(G*R))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let E,M=!1;if("wheel"===this._type&&v&&b){const k=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),R=b(k);E=p.number(v,g,R),k<1?this._frameId||(this._frameId=!0):M=!0}else E=g,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:E-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=p.ease;if(this._prevEase){const g=this._prevEase,v=(p.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-E*E);u=p.bezier(E,M,.25,1)}return this._prevEase={start:p.exported.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!p.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class pr{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vp{constructor(){this._tap=new vl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,u,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,u,g))}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,u,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Li{constructor(o,u,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fd{constructor(o,u,g,v){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Sa=m=>m.zoom||m.drag||m.pitch||m.rotate;class Aa extends p.Event{}class Oi{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const g=p.sub([],u,o);this.radius=p.length(g[2]<0?p.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){p.div(o,o,this.constants),p.normalize(o,o),p.mul$1(o,o,this.constants);const u=p.scale$2([],o,this.radius);if(u[2]>0){const g=p.scale$2([],[0,0,1],p.dot(u,[0,0,1])),v=p.scale$2([],p.normalize([],[u[0],u[1],0]),this.radius),b=p.add([],u,p.scale$2([],p.sub([],p.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function wl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Ws{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lh(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Oi,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[v,b,E]of this._listeners)v.addEventListener(b,v===p.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,u,g]of this._listeners)o.removeEventListener(u,o===p.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new jp(u,o));const v=u.boxZoom=new bs(u,o);this._add("boxZoom",v);const b=new uh,E=new pd;u.doubleClickZoom=new pr(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const M=new Vp;this._add("tapDragZoom",M);const k=u.touchPitch=new dd(u);this._add("touchPitch",k);const R=new so(o),L=new hc(o);u.dragRotate=new Li(o,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new uc(o),G=new hd(u,o);u.dragPan=new Ia(g,B,G),this._add("mousePan",B),this._add("touchPan",G,["touchZoom","touchRotate"]);const K=new au,Z=new xl;u.touchZoomRotate=new fd(g,Z,K,M),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wm(u));const Y=u.scrollZoom=new cu(u,this);this._add("scrollZoom",Y,["mousePan"]);const he=u.keyboard=new Xm;this._add("keyboard",he);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[W]&&u[W].enable(o[W])}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Sa(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,u,g){for(const v in o)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}handleEvent(o,u){this._updatingCamera=!0;const g="renderFrame"===o.type,v=g?void 0:o,b={needsRenderFrame:!1},E={},M={},k=o.touches?this._getMapTouches(o.touches):void 0,R=k?Be.touchPos(this._el,k):g?void 0:Be.mousePos(this._el,o);for(const{handlerName:G,handler:K,allowed:Z}of this._handlers){if(!K.isEnabled())continue;let Y;this._blockedByActive(M,Z,G)?K.reset():K[u||o.type]&&(Y=K[u||o.type](o,R,k),this.mergeHandlerResult(b,E,Y,G,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||K.isActive())&&(M[G]=K)}const L={};for(const G in this._previousActiveHandlers)M[G]||(L[G]=v);this._previousActiveHandlers=M,(Object.keys(L).length||wl(b))&&(this._changes.push([b,E,L]),this._triggerRenderFrame()),(Object.keys(M).length||wl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,u,g,v,b){if(!g)return;p.extend(o,g);const E={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=E),void 0!==g.panDelta&&(u.drag=E),void 0!==g.pitchDelta&&(u.pitch=E),void 0!==g.bearingDelta&&(u.rotate=E)}_applyChanges(){const o={},u={},g={};for(const[v,b,E]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new p.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(o.around=v.around),void 0!==v.aroundCoord&&(o.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),p.extend(u,b),p.extend(g,E);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const v=this._map,b=v.transform,E=ae=>[ae.x,ae.y,ae.z];if((ae=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!wl(o)){const ae=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ae!==b.zoom&&this._map._update(!0)}if(!wl(o))return this._fireEvents(u,g,!0);let{panDelta:M,zoomDelta:k,bearingDelta:R,pitchDelta:L,around:B,aroundCoord:G,pinchAround:K}=o;void 0!==K&&(B=K),(ae=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=E(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,R&&(b.bearing+=R),L&&(b.pitch+=L),b._updateCameraState();const Z=[0,0,0];if(M){const ae=b.pointCoordinate(B),le=b.pointCoordinate(B.sub(M));ae&&le&&(Z[0]=le.x-ae.x,Z[1]=le.y-ae.y)}const Y=b.zoom,he=[0,0,0];if(k){const ae=E(G||b.pointCoordinate3D(B)),le={dir:p.normalize([],p.sub([],ae,b._camera.position))};if(le.dir[2]<0){const se=b.zoomDeltaToMovement(ae,k);p.scale$2(he,le.dir,se)}}const W=p.add(Z,Z,he);b._translateCameraConstrained(W),k&&Math.abs(b.zoom-Y)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_fireEvents(o,u,g){const v=Sa(this._eventsInProgress),b=Sa(o),E={};for(const L in o){const{originalEvent:B}=o[L];this._eventsInProgress[L]||(E[`${L}start`]=B),this._eventsInProgress[L]=o[L]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in E)this._fireEvent(L,E[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in o){const{originalEvent:B}=o[L];this._fireEvent(L,B)}const M={};let k;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],k=u[B]||G,M[`${L}end`]=k)}for(const L in M)this._fireEvent(L,M[L]);const R=Sa(this._eventsInProgress);if(g&&(v||b)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>0!==G&&-this._bearingSnap<G&&G<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new p.Event("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new p.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Aa("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const dh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ws extends p.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,g){return o=p.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},u),g)}panTo(o,u,g){return this.easeTo(p.extend({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(p.extend({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(p.extend({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,p.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=p.LngLatBounds.convert(o);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,u)}_extendCameraOptions(o){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=p.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=p.extend(u,o.padding),o}_cameraForBoxAndBearing(o,u,g,v){const b=this._extendCameraOptions(v),E=this.transform,M=E.padding,k=E.project(p.LngLat.convert(o)),R=E.project(p.LngLat.convert(u)),L=k.rotate(-p.degToRad(g)),B=R.rotate(-p.degToRad(g)),G=new p.pointGeometry(Math.max(L.x,B.x),Math.max(L.y,B.y)),K=new p.pointGeometry(Math.min(L.x,B.x),Math.min(L.y,B.y)),Z=G.sub(K),Y=(E.width-(M.left+M.right+b.padding.left+b.padding.right))/Z.x,he=(E.height-(M.top+M.bottom+b.padding.top+b.padding.bottom))/Z.y;if(he<0||Y<0)return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const W=Math.min(E.scaleZoom(E.scale*Math.min(Y,he)),b.maxZoom),ae="number"==typeof b.offset.x?new p.pointGeometry(b.offset.x,b.offset.y):p.pointGeometry.convert(b.offset),le=new p.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),se=ae.add(le).mult(E.scale/E.zoomScale(W));return{center:E.unproject(k.add(R).div(2).sub(se)),zoom:W,bearing:g}}_cameraForBox(o,u,g,v,b){const E=this._extendCameraOptions(b);g=g||0,v=v||0,o=p.LngLat.convert(o),u=p.LngLat.convert(u);const M=this.transform.clone();M.padding=E.padding;const k=this.getFreeCameraOptions(),R=new p.LngLat(.5*(o.lng+u.lng),.5*(o.lat+u.lat)),L=.5*(g+v);if(M._camera.position[2]<p.mercatorZfromAltitude(L,R.lat))return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(R),M.setFreeCameraOptions(k);const B=p.MercatorCoordinate.fromLngLat(o),G=p.MercatorCoordinate.fromLngLat(u),K=M.pointRayIntersection(M.centerPoint,L),Z=[(Y=M.rayIntersectionCoordinate(K)).x,Y.y,Y.z];var Y;const he=M.screenPointToMercatorRay(M.centerPoint),W="globe"!==M.projection.name;let ae,le=0;do{const se=Math.floor(M.zoom),ie=1<<se,ue=Math.min(ie*B.x,ie*G.x),ye=Math.min(ie*B.y,ie*G.y),Ie=Math.max(ie*B.x,ie*G.x),Qe=Math.max(ie*B.y,ie*G.y),Ge=new p.Aabb([ue,ye,g],[Ie,Qe,v]),$e=p.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,se,W);if(2!==Ge.intersects($e)){ae&&(M._camera.position=p.scaleAndAdd([],M._camera.position,he.dir,-ae),M._updateStateFromCamera());break}const Ae=p.sub([],M._camera.position,Z);ae=.5*p.length(Ae),M._camera.position=p.scaleAndAdd([],M._camera.position,he.dir,ae);try{M._updateStateFromCamera()}catch(Me){return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++le<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(o,u,g){return this._fitInternal(this.cameraForBounds(o,u),u,g)}_raycastElevationBox(o,u){const g=this.transform.elevation;if(!g)return;const v=new p.pointGeometry(o.x,u.y),b=new p.pointGeometry(u.x,o.y),E=g.pointCoordinate(o);if(!E)return;const M=g.pointCoordinate(u);if(!M)return;const k=g.pointCoordinate(v);if(!k)return;const R=g.pointCoordinate(b);if(!R)return;const L=new p.MercatorCoordinate(E[0],E[1]).toLngLat(),B=new p.MercatorCoordinate(M[0],M[1]).toLngLat(),G=new p.MercatorCoordinate(k[0],k[1]).toLngLat(),K=new p.MercatorCoordinate(R[0],R[1]).toLngLat(),Z=Math.min(L.lng,Math.min(B.lng,Math.min(G.lng,K.lng))),Y=Math.min(L.lat,Math.min(B.lat,Math.min(G.lat,K.lat))),he=Math.max(L.lng,Math.max(B.lng,Math.max(G.lng,K.lng))),W=Math.max(L.lat,Math.max(B.lat,Math.max(G.lat,K.lat))),ae=Math.min(E[3],Math.min(M[3],Math.min(k[3],R[3]))),le=Math.max(E[3],Math.max(M[3],Math.max(k[3],R[3])));return{minLngLat:new p.LngLat(Z,Y),maxLngLat:new p.LngLat(he,W),minAltitude:ae,maxAltitude:le}}fitScreenCoordinates(o,u,g,v,b){let E,M,k,R;const L=p.pointGeometry.convert(o),B=p.pointGeometry.convert(u),G=this._raycastElevationBox(L,B);if(G)E=G.minLngLat,M=G.maxLngLat,k=G.minAltitude,R=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;E=this.transform.pointLocation(L),M=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(p.pointGeometry.convert(o)),this.transform.pointLocation(p.pointGeometry.convert(u)),g,v):this._cameraForBox(E,M,k,R,v),v,b)}_fitInternal(o,u,g){return o?(delete(u=p.extend(o,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(o,u){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,E=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=p.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),v&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),b&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),E&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(dh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return void p.warnOnce(dh);this.stop();const v=g.zoom,b=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const M=v!==g.zoom,k=b!==g.pitch,R=E!==g.bearing;return this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),M&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),R&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),k&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate||!o.essential&&p.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),E=this.getPitch(),M=this.getPadding(),k="zoom"in o?+o.zoom:v,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:g.padding,G=p.pointGeometry.convert(o.offset);let K=g.centerPoint.add(G);const Z="globe"===g.projection.name?g.pointCoordinate(K).toLngLat():g.pointLocation(K),Y=p.LngLat.convert(o.center||Z);this._normalizeCenter(Y);const he=g.project(Z),W=g.project(Y).sub(he),ae=g.zoomScale(k-v);let le,se;o.around&&(le=p.LngLat.convert(o.around),se=g.locationPoint(le));const ie=this._zooming||k!==v,ue=this._rotating||b!==R,ye=this._pitching||L!==E,Ie=!g.isPaddingEqual(B),Qe=$e=>Ae=>{if(ie&&($e.zoom=p.number(v,k,Ae)),ue&&($e.bearing=p.number(b,R,Ae)),ye&&($e.pitch=p.number(E,L,Ae)),Ie&&($e.interpolatePadding(M,B,Ae),K=$e.centerPoint.add(G)),le)$e.setLocationAtPoint(le,se);else{const Me=$e.zoomScale($e.zoom-v),Ve=k>v?Math.min(2,ae):Math.max(.5,ae),Oe=Math.pow(Ve,1-Ae),mt=$e.unproject(he.add(W.mult(Ae*Oe)).mult(Me));$e.setLocationAtPoint($e.renderWorldCopies?mt.wrap():mt,K)}return o.preloadOnly||this._fireMoveEvents(u),$e};if(o.preloadOnly){const $e=this._emulate(Qe,o.duration,g);return this._preloadTiles($e),this}const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=ue,this._pitching=ye,this._padding=Ie,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Ge),this._ease(Qe(g),$e=>{g.recenterOnTerrain(),this._afterEase(u,$e)},o),this}_prepareEase(o,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",o)),v&&this.fire(new p.Event("rotateend",o)),b&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}flyTo(o,u){if(!o.essential&&p.exported.prefersReducedMotion){const Ye=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,u)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);const g=this.transform,v=this.getZoom(),b=this.getBearing(),E=this.getPitch(),M=this.getPadding(),k="zoom"in o?p.clamp(+o.zoom,g.minZoom,g.maxZoom):v,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:E,B="padding"in o?o.padding:g.padding,G=g.zoomScale(k-v),K=p.pointGeometry.convert(o.offset);let Z=g.centerPoint.add(K);const Y=g.pointLocation(Z),he=p.LngLat.convert(o.center||Y);this._normalizeCenter(he);const W=g.project(Y),ae=g.project(he).sub(W);let le=o.curve;const se=Math.max(g.width,g.height),ie=se/G,ue=ae.mag();if("minZoom"in o){const Ye=p.clamp(Math.min(o.minZoom,v,k),g.minZoom,g.maxZoom),_t=se/g.zoomScale(Ye-v);le=Math.sqrt(_t/ue*2)}const ye=le*le;function Ie(Ye){const _t=(ie*ie-se*se+(Ye?-1:1)*ye*ye*ue*ue)/(2*(Ye?ie:se)*ye*ue);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Qe(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Ge(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const $e=Ie(0);let Ae=function(Ye){return Ge($e)/Ge($e+le*Ye)},Me=function(Ye){return se*((Ge($e)*(Qe(_t=$e+le*Ye)/Ge(_t))-Qe($e))/ye)/ue;var _t},Ve=(Ie(1)-$e)/le;if(Math.abs(ue)<1e-6||!isFinite(Ve)){if(Math.abs(se-ie)<1e-6)return this.easeTo(o,u);const Ye=ie<se?-1:1;Ve=Math.abs(Math.log(ie/se))/le,Me=function(){return 0},Ae=function(_t){return Math.exp(Ye*le*_t)}}o.duration="duration"in o?+o.duration:1e3*Ve/("screenSpeed"in o?+o.screenSpeed/le:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Oe=b!==R,mt=L!==E,Dt=!g.isPaddingEqual(B),Gt=Ye=>_t=>{const Rt=_t*Ve,In=1/Ae(Rt);Ye.zoom=1===_t?k:v+Ye.scaleZoom(In),Oe&&(Ye.bearing=p.number(b,R,_t)),mt&&(Ye.pitch=p.number(E,L,_t)),Dt&&(Ye.interpolatePadding(M,B,_t),Z=Ye.centerPoint.add(K));const Nn=1===_t?he:Ye.unproject(W.add(ae.mult(Me(Rt))).mult(In));return Ye.setLocationAtPoint(Ye.renderWorldCopies?Nn.wrap():Nn,Z),Ye._updateCenterElevation(),o.preloadOnly||this._fireMoveEvents(u),Ye};if(o.preloadOnly){const Ye=this._emulate(Gt,o.duration,g);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=Oe,this._pitching=mt,this._padding=Dt,this._prepareEase(u,!1),this._ease(Gt(g),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,u,g){!1===g.animate||0===g.duration?(o(1),u()):(this._easeStart=p.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=p.wrap(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=o.lng-u.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,u,g){const v=Math.ceil(15*u/1e3),b=[],E=o(g.clone());for(let M=0;M<=v;M++){const k=E(M/v);b.push(k.clone())}return b}}class uu{constructor(o={}){this.options=o,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact;return this._map=o,this._container=Be.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Be.create("button","mapboxgl-ctrl-attrib-button",this._container),Be.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Be.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const g=this._map._getUIString(`AttributionControl.${u}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(o){const g=u.reduce((v,b,E)=>(b.value&&(v+=`${b.key}=${b.value}${E<u.length-1?"&":""}`),v),"?");o.href=`${p.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((v,b)=>v.length-b.length),o=o.filter((v,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class dc{constructor(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=Be.create("div","mapboxgl-ctrl");const u=Be.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const u in o){const g=o[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class zt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function md(m,o,u){if(m=new p.LngLat(m.lng,m.lat),o){const g=new p.LngLat(m.lng-360,m.lat),v=new p.LngLat(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),E=u.locationPoint(m).distSqr(o),M=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint(g).distSqr(o)<E&&(M||Math.abs(g.lng-u.center.lng)<b)?m=g:u.locationPoint(v).distSqr(o)<E&&(M||Math.abs(v.lng-u.center.lng)<b)&&(m=v)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const Wr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ph extends p.Evented{constructor(o,u){if(super(),(o instanceof p.window.HTMLElement||u)&&(o=p.extend({element:o},u)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=p.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Be.create("div");const v=41,b=27,E=Be.createSVG("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),M=Be.createSVG("radialGradient",{id:"shadowGradient"},Be.createSVG("defs",{},E));Be.createSVG("stop",{offset:"10%","stop-opacity":.4},M),Be.createSVG("stop",{offset:"100%","stop-opacity":.05},M),Be.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Be.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Be.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Be.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=p.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Wr)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,g=o.charCode||o.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const u=this._map.unproject(o);let g=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const E=b.position.toLngLat();g=E.distanceTo(u)<.9*E.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(u))*(g?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const u=this._map.transform;return!!o&&o.x>=0&&o.x<u.width&&o.y>=0&&o.y<u.height}_updateDOM(){const o=this._pos||new p.pointGeometry(0,0),u=this._calculatePitch(),g=this._calculateRotation();this._element.style.transform=`${Wr[this._anchor]} translate(${o.x}px, ${o.y}px) rotateX(${u}deg) rotateZ(${g}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){p.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=md(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===o?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,u=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&u._rotate(o.angle),"map"===this._pitchAlignment&&(u.y*=Math.cos(o._pitch)),u}getOffset(){return this._offset}setOffset(o){return this._offset=p.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Cs{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=p.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,g){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+g}}const fh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:So,HTMLElement:Cl,ImageBitmap:We}=p.window,xn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function El(m){m.parentNode&&m.parentNode.removeChild(m)}const Or={showCompass:!0,showZoom:!0,visualizePitch:!1};class mh{constructor(o,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new so({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new hc({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),Be.disableDrag()}move(o,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(o,u);if(v&&v.bearingDelta&&g.setBearing(g.getBearing()+v.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,u);b&&b.pitchDelta&&g.setPitch(g.getPitch()+b.pitchDelta)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Be.enableDrag(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(p.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Be.mousePos(this.element,o)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Be.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Be.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Be.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Es={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let er,Pa=0,Xs=!1;const hu={maxWidth:100,unit:"metric"};function ut(m,o,u){const g=u&&u.maxWidth||100,v=m._containerHeight/2,b=m.unproject([0,v]),E=m.unproject([g,v]),M=b.distanceTo(E);if(u&&"imperial"===u.unit){const k=3.2808*M;k>5280?Ts(o,g,k/5280,m._getUIString("ScaleControl.Miles"),m):Ts(o,g,k,m._getUIString("ScaleControl.Feet"),m)}else u&&"nautical"===u.unit?Ts(o,g,M/1852,m._getUIString("ScaleControl.NauticalMiles"),m):M>=1e3?Ts(o,g,M/1e3,m._getUIString("ScaleControl.Kilometers"),m):Ts(o,g,M,m._getUIString("ScaleControl.Meters"),m)}function Ts(m,o,u,g,v){const b=function(M){const k=Math.pow(10,`${Math.floor(M)}`.length-1);let R=M/k;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(R),k*R}(u),E=b/u;v._requestDomTask(()=>{m.style.width=o*E+"px",m.innerHTML=`${b}&nbsp;${g}`})}const pc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),hi={version:p.version,supported:Kn,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends ws{constructor(m){if(null!=(m=p.extend({},xn,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new iu(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new zt,this._domRenderTaskQueue=new zt,this._controls=[],this._markers=[],this._mapId=p.uniqueId(),this._locale=p.extend({},fh,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Cs(0),this._requestManager=new p.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=p.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof Cl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ws(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Np("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,p.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new uu({customAttribution:m.customAttribution})),this._logoControl=new dc,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new p.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new p.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(m,o){if(void 0===o&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),this.fire(new p.Event("resize",m)),o&&this.fire(new p.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(p.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this.transform.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),"string"==typeof m&&(m={name:m}),this._runtimeProjection=m,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(m){return this.transform.locationPoint3D(p.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(p.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(m,o,u){if("mouseenter"===m||"mouseover"===m){let g=!1;const v=E=>{const M=o.filter(R=>this.getLayer(R)),k=M.length?this.queryRenderedFeatures(E.point,{layers:M}):[];k.length?g||(g=!0,u.call(this,new Zr(m,this,E.originalEvent,{features:k}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===m||"mouseout"===m){let g=!1;const v=E=>{const M=o.filter(k=>this.getLayer(k));(M.length?this.queryRenderedFeatures(E.point,{layers:M}):[]).length?g=!0:g&&(g=!1,u.call(this,new Zr(m,this,E.originalEvent)))},b=E=>{g&&(g=!1,u.call(this,new Zr(m,this,E.originalEvent)))};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=o.filter(M=>this.getLayer(M)),E=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];E.length&&(v.features=E,u.call(this,v),delete v.features)};return{layers:new Set(o),listener:u,delegates:{[m]:g}}}}on(m,o,u){if(void 0===u)return super.on(m,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(m,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,o,u){if(void 0===u)return super.once(m,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(m,o,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,o,u){if(void 0===u)return super.off(m,o);o=new Set(Array.isArray(o)?o:[o]);const g=(b,E)=>{if(b.size!==E.size)return!1;for(const M of b)if(!E.has(M))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[m]:void 0;return v&&(b=>{for(let E=0;E<b.length;E++){const M=b[E];if(M.listener===u&&g(M.layers,o)){for(const k in M.delegates)this.off(k,M.delegates[k]);return b.splice(E,1),this}}})(v),this}queryRenderedFeatures(m,o){return this.style?(void 0!==o||void 0===m||m instanceof p.pointGeometry||Array.isArray(m)||(o=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}queryTerrainElevation(m,o){const u=this.transform.elevation;return u?(o=p.extend({},{exaggerated:!0},o),u.getAtPoint(p.MercatorCoordinate.fromLngLat(m),null,o.exaggerated)):null}setStyle(m,o){return!1!==(o=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(null==o)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),m&&(this.style=new ar(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ar(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if("string"==typeof m){const u=this._requestManager.normalizeStyleURL(m),g=this._requestManager.transformRequest(u,p.ResourceType.Style);p.getJSON(g,(v,b)=>{v?this.fire(new p.ErrorEvent(v)):b&&this._updateDiff(b,o)})}else"object"==typeof m&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(u){p.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style._getSourceCaches(m);if(0!==o.length)return o.every(u=>u.loaded());this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const o in m){const u=m[o]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(m,o,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,u)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof So||We&&o instanceof We){const{width:M,height:k,data:R}=p.exported.getImageData(o);this.style.addImage(m,{data:new p.RGBAImage({width:M,height:k},R),pixelRatio:u,stretchX:v,stretchY:b,content:E,sdf:g,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:k,data:R}=o,L=o;this.style.addImage(m,{data:new p.RGBAImage({width:M,height:k},new Uint8Array(R)),pixelRatio:u,stretchX:v,stretchY:b,content:E,sdf:g,version:0,userImage:L}),L.onAdd&&L.onAdd(this,m)}}}updateImage(m,o){const u=this.style.getImage(m);if(!u)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof So||We&&o instanceof We?p.exported.getImageData(o):o,{width:v,height:b,data:E}=g;return void 0===v||void 0===b?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==u.data.width||b!==u.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(u.data.replace(E,!(o instanceof So||We&&o instanceof We)),void this.style.updateImage(m,u))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){p.getImage(this._requestManager.transformRequest(m,p.ResourceType.Image),(u,g)=>{o(u,g instanceof So?p.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,u){return this.style.setLayerZoomRange(m,o,u),this._update(!0)}setFilter(m,o,u={}){return this.style.setFilter(m,o,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,u,g={}){return this.style.setPaintProperty(m,o,u,g),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,u,g={}){return this.style.setLayoutProperty(m,o,u,g),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(m),this.transform):0}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,g=this._container;for(;g&&!u;){const v=p.window.getComputedStyle(g).transform;v&&"none"!==v&&(u=v.match(/matrix.*\((.+)\)/)[1].split(", ")),g=g.parentElement}u?(this._containerWidth=u[0]&&"0"!==u[0]?Math.abs(m/u[0]):m,this._containerHeight=u[3]&&"0"!==u[3]?Math.abs(o/u[3]):o):(this._containerWidth=m,this._containerHeight=o)}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Be.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Be.create("div","mapboxgl-canvas-container",m);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Be.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Be.create("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Be.create("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const u=p.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const m=p.extend({},Kn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(p.storeAuthState(o,!0),this.painter=new sd(o,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(o)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;const u=this.painter.context.extTimerQuery,g=p.exported.now();this.listens("gpu-timing-frame")&&(o=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,o));let v=this._updateAverageElevation(g);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjection();let b=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,R=this.transform.pitch,L=p.exported.now();this.style.zoomHistory.update(k,L);const B=new p.EvaluationParameters(k,{now:L,fadeDuration:E,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=B.crossFadingFactor();1===G&&G===this._crossFadingFactor||(b=!0,this._crossFadingFactor=G),this.style.update(B)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=p.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,o),setTimeout(()=>{const R=u.getQueryObjectEXT(o,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(o),this.fire(new p.Event("gpu-timing-frame",{cpuTime:k,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(k);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(M||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(v=this._updateAverageElevation(g,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,o=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=m;const b=Math.abs(g-v);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,m,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===p.AUTH_ERR_MSG||401===m.status)){const o=this.painter.context.gl;p.storeAuthState(o,!1),this._logoControl instanceof dc&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const E=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,E),E}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(m,o,u){let g=u[1]-u[0];const v=m.length/4;for(let b=0;b<o.length;b++){const E=o[b];let M=0;for(let k=0;k<E.length;k+=4)E[k]===m[k]&&E[k+1]===m[k+1]&&E[k+2]===m[k+2]&&E[k+3]===m[k+3]&&(M+=1);g+=(u[b+2]-u[b+1])*(1-M/v)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),El(this._canvasContainer),El(this._controlContainer),El(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=p.exported.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(m){const o=this.style&&Object.values(this.style._sourceCaches)||[];return p.asyncAll(o,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){p.setCacheLimits(m,o)}get version(){return p.version}},NavigationControl:class{constructor(m){this.options=p.extend({},Or,m),this._container=Be.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Be.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Be.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Be.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),u=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=m)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const u=Be.create("button",m,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(m,o){const u=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends p.Evented{constructor(m){super(),this.options=p.extend({},Es,m),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Da(this._updateMarkerRotation,20)}onAdd(m){var o;return this._map=m,this._container=Be.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==er?o(er):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(u=>{er="denied"!==u.state,o(er)}):(er=!!p.window.navigator.geolocation,o(er)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Pa=0,Xs=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),u=m.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),v=p.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),v,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,o=this._map.unproject([0,m]),u=this._map.unproject([100,m]),g=o.distanceTo(u)/100,v=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&Xs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Be.create("button","mapboxgl-ctrl-geolocate",this._container),Be.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===m){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Be.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Be.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Be.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ph({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Be.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ph({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pa--,Xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pa++,Pa>1?(m={maximumAge:6e5,timeout:0},Xs=!0):(m=this.options.positionOptions,Xs=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&m()}).catch(console.error):m()}_clearWatch(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:uu,ScaleControl:class{constructor(m){this.options=p.extend({},hu,m),p.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ut(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=Be.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,ut(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof p.window.HTMLElement?this._container=m.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Be.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Be.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Be.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(m){super(),this.options=p.extend(Object.create(pc),m),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=p.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(p.window.document.createTextNode(m))}setHTML(m){const o=p.window.document.createDocumentFragment(),u=p.window.document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Be.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._container&&this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._container&&this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=Be.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._pos,u=this._container.offsetWidth,g=this._container.offsetHeight;let v;return v=o.y+m.bottom.y<g?["top"]:o.y>this._map.transform.height-g?["bottom"]:[],o.x<u/2?v.push("left"):o.x>this._map.transform.width-u/2&&v.push("right"),0===v.length?"bottom":v.join("-")}_updateClassList(){const m=[...this._classList];m.push("mapboxgl-popup"),this._anchor&&m.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&m.push("mapboxgl-popup-track-pointer"),this._container.className=m.join(" ")}_update(m){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Be.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Be.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=md(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||m){const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat),u=function(b){if(b||(b=new p.pointGeometry(0,0)),"number"==typeof b){const E=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new p.pointGeometry(0,0),top:new p.pointGeometry(0,b),"top-left":new p.pointGeometry(E,E),"top-right":new p.pointGeometry(-E,E),bottom:new p.pointGeometry(0,-b),"bottom-left":new p.pointGeometry(E,-E),"bottom-right":new p.pointGeometry(-E,-E),left:new p.pointGeometry(b,0),right:new p.pointGeometry(-b,0)}}if(b instanceof p.pointGeometry||Array.isArray(b)){const E=p.pointGeometry.convert(b);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:p.pointGeometry.convert(b.center||[0,0]),top:p.pointGeometry.convert(b.top||[0,0]),"top-left":p.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":p.pointGeometry.convert(b["top-right"]||[0,0]),bottom:p.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":p.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":p.pointGeometry.convert(b["bottom-right"]||[0,0]),left:p.pointGeometry.convert(b.left||[0,0]),right:p.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),g=this._anchor=this._getAnchor(u),v=o.add(u[g]).round();this._map._requestDomTask(()=>{this._container&&g&&(this._container.style.transform=`${Wr[g]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Fr);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:ph,Style:ar,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:oo,Evented:p.Evented,config:p.config,prewarm:function(){me().acquire(de)},clearPrewarmedResources:function(){const m=xe;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(de),xe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(m){p.config.ACCESS_TOKEN=m},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(m){p.config.API_URL=m},get workerCount(){return Ee.workerCount},set workerCount(m){Ee.workerCount=m},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){p.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){p.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return hi}),jn}()},400:(Ya,Ja,ca)=>{"use strict";var ua,ve={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(U){this.toString=function(){return"CORRUPT: "+this.message},this.message=U},invalid:function(U){this.toString=function(){return"INVALID: "+this.message},this.message=U},bug:function(U){this.toString=function(){return"BUG: "+this.message},this.message=U},notReady:function(U){this.toString=function(){return"NOT READY: "+this.message},this.message=U}}};function p(U,$,q){if(4!==$.length)throw new ve.exception.invalid("invalid aes block size");var ee=U.b[q],fe=$[0]^ee[0],ge=$[q?3:1]^ee[1],De=$[2]^ee[2];$=$[q?1:3]^ee[3];var Ne,st,ht,bt,Pt=ee.length/4-2,gn=4,zn=[0,0,0,0];U=(Ne=U.s[q])[0];var an=Ne[1],$o=Ne[2],si=Ne[3],Rn=Ne[4];for(bt=0;bt<Pt;bt++)Ne=U[fe>>>24]^an[ge>>16&255]^$o[De>>8&255]^si[255&$]^ee[gn],st=U[ge>>>24]^an[De>>16&255]^$o[$>>8&255]^si[255&fe]^ee[gn+1],ht=U[De>>>24]^an[$>>16&255]^$o[fe>>8&255]^si[255&ge]^ee[gn+2],$=U[$>>>24]^an[fe>>16&255]^$o[ge>>8&255]^si[255&De]^ee[gn+3],gn+=4,fe=Ne,ge=st,De=ht;for(bt=0;4>bt;bt++)zn[q?3&-bt:bt]=Rn[fe>>>24]<<24^Rn[ge>>16&255]<<16^Rn[De>>8&255]<<8^Rn[255&$]^ee[gn++],Ne=fe,fe=ge,ge=De,De=$,$=Ne;return zn}function Kn(U,$){var q,ee,fe,ge=U.F,De=U.b,Ne=ge[0],st=ge[1],ht=ge[2],Pt=ge[3],bt=ge[4],gn=ge[5],zn=ge[6],an=ge[7];for(q=0;64>q;q++)ee=(ee=16>q?$[q]:$[15&q]=((ee=$[q+1&15])>>>7^ee>>>18^ee>>>3^ee<<25^ee<<14)+((fe=$[q+14&15])>>>17^fe>>>19^fe>>>10^fe<<15^fe<<13)+$[15&q]+$[q+9&15]|0)+an+(bt>>>6^bt>>>11^bt>>>25^bt<<26^bt<<21^bt<<7)+(zn^bt&(gn^zn))+De[q],an=zn,zn=gn,gn=bt,bt=Pt+ee|0,Pt=ht,ht=st,Ne=ee+((st=Ne)&ht^Pt&(st^ht))+(st>>>2^st>>>13^st>>>22^st<<30^st<<19^st<<10)|0;ge[0]=ge[0]+Ne|0,ge[1]=ge[1]+st|0,ge[2]=ge[2]+ht|0,ge[3]=ge[3]+Pt|0,ge[4]=ge[4]+bt|0,ge[5]=ge[5]+gn|0,ge[6]=ge[6]+zn|0,ge[7]=ge[7]+an|0}function Yi(U,$){var q,ee=ve.random.K[U],fe=[];for(q in ee)ee.hasOwnProperty(q)&&fe.push(ee[q]);for(q=0;q<fe.length;q++)fe[q]($)}function Tr(U,$){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?U.addEntropy(window.performance.now(),$,"loadtime"):U.addEntropy((new Date).valueOf(),$,"loadtime")}function at(U){U.b=Lt(U).concat(Lt(U)),U.L=new ve.cipher.aes(U.b)}function Lt(U){for(var $=0;4>$&&(U.h[$]=U.h[$]+1|0,!U.h[$]);$++);return U.L.encrypt(U.h)}function Be(U,$){return function(){$.apply(U,arguments)}}ve.cipher.aes=function(U){this.s[0][0][0]||this.O();var $,q,ee,fe,ge=this.s[0][4],De=this.s[1],Ne=1;if(4!==($=U.length)&&6!==$&&8!==$)throw new ve.exception.invalid("invalid aes key size");for(this.b=[ee=U.slice(0),fe=[]],U=$;U<4*$+28;U++)q=ee[U-1],(U%$==0||8===$&&U%$==4)&&(q=ge[q>>>24]<<24^ge[q>>16&255]<<16^ge[q>>8&255]<<8^ge[255&q],U%$==0&&(q=q<<8^q>>>24^Ne<<24,Ne=Ne<<1^283*(Ne>>7))),ee[U]=ee[U-$]^q;for($=0;U;$++,U--)q=ee[3&$?U:U-4],fe[$]=4>=U||4>$?q:De[0][ge[q>>>24]]^De[1][ge[q>>16&255]]^De[2][ge[q>>8&255]]^De[3][ge[255&q]]},ve.cipher.aes.prototype={encrypt:function(U){return p(this,U,0)},decrypt:function(U){return p(this,U,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var fe,ge,De,ht,Pt,bt,gn,U=this.s[0],$=this.s[1],q=U[4],ee=$[4],Ne=[],st=[];for(fe=0;256>fe;fe++)st[(Ne[fe]=fe<<1^283*(fe>>7))^fe]=fe;for(ge=De=0;!q[ge];ge^=ht||1,De=st[De]||1)for(q[ge]=bt=(bt=De^De<<1^De<<2^De<<3^De<<4)>>8^255&bt^99,ee[bt]=ge,gn=16843009*(Pt=Ne[fe=Ne[ht=Ne[ge]]])^65537*fe^257*ht^16843008*ge,Pt=257*Ne[bt]^16843008*bt,fe=0;4>fe;fe++)U[fe][ge]=Pt=Pt<<24^Pt>>>8,$[fe][bt]=gn=gn<<24^gn>>>8;for(fe=0;5>fe;fe++)U[fe]=U[fe].slice(0),$[fe]=$[fe].slice(0)}},ve.bitArray={bitSlice:function(U,$,q){return U=ve.bitArray.$(U.slice($/32),32-(31&$)).slice(1),void 0===q?U:ve.bitArray.clamp(U,q-$)},extract:function(U,$,q){var ee=Math.floor(-$-q&31);return(-32&($+q-1^$)?U[$/32|0]<<32-ee^U[$/32+1|0]>>>ee:U[$/32|0]>>>ee)&(1<<q)-1},concat:function(U,$){if(0===U.length||0===$.length)return U.concat($);var q=U[U.length-1],ee=ve.bitArray.getPartial(q);return 32===ee?U.concat($):ve.bitArray.$($,ee,0|q,U.slice(0,U.length-1))},bitLength:function(U){var $=U.length;return 0===$?0:32*($-1)+ve.bitArray.getPartial(U[$-1])},clamp:function(U,$){if(32*U.length<$)return U;var q=(U=U.slice(0,Math.ceil($/32))).length;return $&=31,0<q&&$&&(U[q-1]=ve.bitArray.partial($,U[q-1]&2147483648>>$-1,1)),U},partial:function(U,$,q){return 32===U?$:(q?0|$:$<<32-U)+1099511627776*U},getPartial:function(U){return Math.round(U/1099511627776)||32},equal:function(U,$){if(ve.bitArray.bitLength(U)!==ve.bitArray.bitLength($))return!1;var ee,q=0;for(ee=0;ee<U.length;ee++)q|=U[ee]^$[ee];return 0===q},$:function(U,$,q,ee){var fe;for(fe=0,void 0===ee&&(ee=[]);32<=$;$-=32)ee.push(q),q=0;if(0===$)return ee.concat(U);for(fe=0;fe<U.length;fe++)ee.push(q|U[fe]>>>$),q=U[fe]<<32-$;return U=ve.bitArray.getPartial(fe=U.length?U[U.length-1]:0),ee.push(ve.bitArray.partial($+U&31,32<$+U?q:ee.pop(),1)),ee},i:function(U,$){return[U[0]^$[0],U[1]^$[1],U[2]^$[2],U[3]^$[3]]},byteswapM:function(U){var $,q;for($=0;$<U.length;++$)U[$]=(q=U[$])>>>24|q>>>8&65280|(65280&q)<<8|q<<24;return U}},ve.codec.utf8String={fromBits:function(U){var ee,fe,$="",q=ve.bitArray.bitLength(U);for(ee=0;ee<q/8;ee++)0==(3&ee)&&(fe=U[ee/4]),$+=String.fromCharCode(fe>>>8>>>8>>>8),fe<<=8;return decodeURIComponent(escape($))},toBits:function(U){U=unescape(encodeURIComponent(U));var q,$=[],ee=0;for(q=0;q<U.length;q++)ee=ee<<8|U.charCodeAt(q),3==(3&q)&&($.push(ee),ee=0);return 3&q&&$.push(ve.bitArray.partial(8*(3&q),ee)),$}},ve.codec.hex={fromBits:function(U){var q,$="";for(q=0;q<U.length;q++)$+=(0xf00000000000+(0|U[q])).toString(16).substr(4);return $.substr(0,ve.bitArray.bitLength(U)/4)},toBits:function(U){var $,ee,q=[];for(ee=(U=U.replace(/\s|0x/g,"")).length,U+="00000000",$=0;$<U.length;$+=8)q.push(0^parseInt(U.substr($,8),16));return ve.bitArray.clamp(q,4*ee)}},ve.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(U,$,q){var ee=ve.codec.base32.BASE,fe=ve.codec.base32.REMAINING,ge="",De=0,Ne=ve.codec.base32.B,st=0,ht=ve.bitArray.bitLength(U);for(q&&(Ne=ve.codec.base32.X),q=0;ge.length*ee<ht;)ge+=Ne.charAt((st^U[q]>>>De)>>>fe),De<ee?(st=U[q]<<ee-De,De+=fe,q++):(st<<=ee,De-=ee);for(;7&ge.length&&!$;)ge+="=";return ge},toBits:function(U,$){U=U.replace(/\s|=/g,"").toUpperCase();var De,Pt,q=ve.codec.base32.BITS,ee=ve.codec.base32.BASE,fe=ve.codec.base32.REMAINING,ge=[],Ne=0,st=ve.codec.base32.B,ht=0,bt="base32";for($&&(st=ve.codec.base32.X,bt="base32hex"),De=0;De<U.length;De++){if(0>(Pt=st.indexOf(U.charAt(De)))){if(!$)try{return ve.codec.base32hex.toBits(U)}catch(gn){}throw new ve.exception.invalid("this isn't "+bt+"!")}Ne>fe?(ge.push(ht^Pt>>>(Ne-=fe)),ht=Pt<<q-Ne):ht^=Pt<<q-(Ne+=ee)}return 56&Ne&&ge.push(ve.bitArray.partial(56&Ne,ht,1)),ge}},ve.codec.base32hex={fromBits:function(U,$){return ve.codec.base32.fromBits(U,$,1)},toBits:function(U){return ve.codec.base32.toBits(U,1)}},ve.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(U,$,q){var ee="",fe=0,ge=ve.codec.base64.B,De=0,Ne=ve.bitArray.bitLength(U);for(q&&(ge=ge.substr(0,62)+"-_"),q=0;6*ee.length<Ne;)ee+=ge.charAt((De^U[q]>>>fe)>>>26),6>fe?(De=U[q]<<6-fe,fe+=26,q++):(De<<=6,fe-=6);for(;3&ee.length&&!$;)ee+="=";return ee},toBits:function(U,$){U=U.replace(/\s|=/g,"");var ee,Ne,q=[],fe=0,ge=ve.codec.base64.B,De=0;for($&&(ge=ge.substr(0,62)+"-_"),ee=0;ee<U.length;ee++){if(0>(Ne=ge.indexOf(U.charAt(ee))))throw new ve.exception.invalid("this isn't base64!");26<fe?(q.push(De^Ne>>>(fe-=26)),De=Ne<<32-fe):De^=Ne<<32-(fe+=6)}return 56&fe&&q.push(ve.bitArray.partial(56&fe,De,1)),q}},ve.codec.base64url={fromBits:function(U){return ve.codec.base64.fromBits(U,1,1)},toBits:function(U){return ve.codec.base64.toBits(U,1)}},ve.hash.sha256=function(U){this.b[0]||this.O(),U?(this.F=U.F.slice(0),this.A=U.A.slice(0),this.l=U.l):this.reset()},ve.hash.sha256.hash=function(U){return(new ve.hash.sha256).update(U).finalize()},ve.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(U){"string"==typeof U&&(U=ve.codec.utf8String.toBits(U));var $,q=this.A=ve.bitArray.concat(this.A,U);if(9007199254740991<(U=this.l=($=this.l)+ve.bitArray.bitLength(U)))throw new ve.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var ee=new Uint32Array(q),fe=0;for($=512+$-(512+$&511);$<=U;$+=512)Kn(this,ee.subarray(16*fe,16*(fe+1))),fe+=1;q.splice(0,16*fe)}else for($=512+$-(512+$&511);$<=U;$+=512)Kn(this,q.splice(0,16));return this},finalize:function(){var U,q,$=this.F;for(U=(q=ve.bitArray.concat(q=this.A,[ve.bitArray.partial(1,1)])).length+2;15&U;U++)q.push(0);for(q.push(Math.floor(this.l/4294967296)),q.push(0|this.l);q.length;)Kn(this,q.splice(0,16));return this.reset(),$},Y:[],b:[],O:function(){function U(ge){return 4294967296*(ge-Math.floor(ge))|0}for(var ee,fe,$=0,q=2;64>$;q++){for(fe=!0,ee=2;ee*ee<=q;ee++)if(q%ee==0){fe=!1;break}fe&&(8>$&&(this.Y[$]=U(Math.pow(q,.5))),this.b[$]=U(Math.pow(q,1/3)),$++)}}},ve.mode.ccm={name:"ccm",G:[],listenProgress:function(U){ve.mode.ccm.G.push(U)},unListenProgress:function(U){-1<(U=ve.mode.ccm.G.indexOf(U))&&ve.mode.ccm.G.splice(U,1)},fa:function(U){var q,$=ve.mode.ccm.G.slice();for(q=0;q<$.length;q+=1)$[q](U)},encrypt:function(U,$,q,ee,fe){var ge,De=$.slice(0),Ne=ve.bitArray,st=Ne.bitLength(q)/8,ht=Ne.bitLength(De)/8;if(fe=fe||64,ee=ee||[],7>st)throw new ve.exception.invalid("ccm: iv must be at least 7 bytes");for(ge=2;4>ge&&ht>>>8*ge;ge++);return ge<15-st&&(ge=15-st),q=Ne.clamp(q,8*(15-ge)),$=ve.mode.ccm.V(U,$,q,ee,fe,ge),De=ve.mode.ccm.C(U,De,q,$,fe,ge),Ne.concat(De.data,De.tag)},decrypt:function(U,$,q,ee,fe){fe=fe||64,ee=ee||[];var ge=ve.bitArray,De=ge.bitLength(q)/8,ht=ge.bitLength($),Ne=ge.clamp($,ht-fe),st=ge.bitSlice($,ht-fe);if(ht=(ht-fe)/8,7>De)throw new ve.exception.invalid("ccm: iv must be at least 7 bytes");for($=2;4>$&&ht>>>8*$;$++);if($<15-De&&($=15-De),q=ge.clamp(q,8*(15-$)),Ne=ve.mode.ccm.C(U,Ne,q,st,fe,$),U=ve.mode.ccm.V(U,Ne.data,q,ee,fe,$),!ge.equal(Ne.tag,U))throw new ve.exception.corrupt("ccm: tag doesn't match");return Ne.data},na:function(U,$,q,ee,fe,ge){var De=[],Ne=ve.bitArray,st=Ne.i;if(ee=[Ne.partial(8,($.length?64:0)|ee-2<<2|ge-1)],(ee=Ne.concat(ee,q))[3]|=fe,ee=U.encrypt(ee),$.length)for(65279>=(q=Ne.bitLength($)/8)?De=[Ne.partial(16,q)]:4294967295>=q&&(De=Ne.concat([Ne.partial(16,65534)],[q])),De=Ne.concat(De,$),$=0;$<De.length;$+=4)ee=U.encrypt(st(ee,De.slice($,$+4).concat([0,0,0])));return ee},V:function(U,$,q,ee,fe,ge){var De=ve.bitArray,Ne=De.i;if((fe/=8)%2||4>fe||16<fe)throw new ve.exception.invalid("ccm: invalid tag length");if(4294967295<ee.length||4294967295<$.length)throw new ve.exception.bug("ccm: can't deal with 4GiB or more data");for(q=ve.mode.ccm.na(U,ee,q,fe,De.bitLength($)/8,ge),ee=0;ee<$.length;ee+=4)q=U.encrypt(Ne(q,$.slice(ee,ee+4).concat([0,0,0])));return De.clamp(q,8*fe)},C:function(U,$,q,ee,fe,ge){var De,Ne=ve.bitArray;De=Ne.i;var st=$.length,ht=Ne.bitLength($),Pt=st/50,bt=Pt;if(q=Ne.concat([Ne.partial(8,ge-1)],q).concat([0,0,0]).slice(0,4),ee=Ne.bitSlice(De(ee,U.encrypt(q)),0,fe),!st)return{tag:ee,data:[]};for(De=0;De<st;De+=4)De>Pt&&(ve.mode.ccm.fa(De/st),Pt+=bt),q[3]++,fe=U.encrypt(q),$[De]^=fe[0],$[De+1]^=fe[1],$[De+2]^=fe[2],$[De+3]^=fe[3];return{tag:ee,data:Ne.clamp($,ht)}}},ve.mode.ocb2={name:"ocb2",encrypt:function(U,$,q,ee,fe,ge){if(128!==ve.bitArray.bitLength(q))throw new ve.exception.invalid("ocb iv must be 128 bits");var De,Ne=ve.mode.ocb2.S,st=ve.bitArray,ht=st.i,Pt=[0,0,0,0];q=Ne(U.encrypt(q));var bt,gn=[];for(ee=ee||[],fe=fe||64,De=0;De+4<$.length;De+=4)Pt=ht(Pt,bt=$.slice(De,De+4)),gn=gn.concat(ht(q,U.encrypt(ht(q,bt)))),q=Ne(q);return bt=$.slice(De),$=st.bitLength(bt),De=U.encrypt(ht(q,[0,0,0,$])),bt=st.clamp(ht(bt.concat([0,0,0]),De),$),Pt=ht(Pt,ht(bt.concat([0,0,0]),De)),Pt=U.encrypt(ht(Pt,ht(q,Ne(q)))),ee.length&&(Pt=ht(Pt,ge?ee:ve.mode.ocb2.pmac(U,ee))),gn.concat(st.concat(bt,st.clamp(Pt,fe)))},decrypt:function(U,$,q,ee,fe,ge){if(128!==ve.bitArray.bitLength(q))throw new ve.exception.invalid("ocb iv must be 128 bits");fe=fe||64;var bt,gn,De=ve.mode.ocb2.S,Ne=ve.bitArray,st=Ne.i,ht=[0,0,0,0],Pt=De(U.encrypt(q)),zn=ve.bitArray.bitLength($)-fe,an=[];for(ee=ee||[],q=0;q+4<zn/32;q+=4)bt=st(Pt,U.decrypt(st(Pt,$.slice(q,q+4)))),ht=st(ht,bt),an=an.concat(bt),Pt=De(Pt);if(bt=U.encrypt(st(Pt,[0,0,0,gn=zn-32*q])),bt=st(bt,Ne.clamp($.slice(q),gn).concat([0,0,0])),ht=st(ht,bt),ht=U.encrypt(st(ht,st(Pt,De(Pt)))),ee.length&&(ht=st(ht,ge?ee:ve.mode.ocb2.pmac(U,ee))),!Ne.equal(Ne.clamp(ht,fe),Ne.bitSlice($,zn)))throw new ve.exception.corrupt("ocb: tag doesn't match");return an.concat(Ne.clamp(bt,gn))},pmac:function(U,$){var q,ee=ve.mode.ocb2.S,fe=ve.bitArray,ge=fe.i,De=[0,0,0,0],Ne=ge(Ne=U.encrypt([0,0,0,0]),ee(ee(Ne)));for(q=0;q+4<$.length;q+=4)Ne=ee(Ne),De=ge(De,U.encrypt(ge(Ne,$.slice(q,q+4))));return q=$.slice(q),128>fe.bitLength(q)&&(Ne=ge(Ne,ee(Ne)),q=fe.concat(q,[-2147483648,0,0,0])),De=ge(De,q),U.encrypt(ge(ee(ge(Ne,ee(Ne))),De))},S:function(U){return[U[0]<<1^U[1]>>>31,U[1]<<1^U[2]>>>31,U[2]<<1^U[3]>>>31,U[3]<<1^135*(U[0]>>>31)]}},ve.mode.gcm={name:"gcm",encrypt:function(U,$,q,ee,fe){var ge=$.slice(0);return $=ve.bitArray,U=ve.mode.gcm.C(!0,U,ge,ee=ee||[],q,fe||128),$.concat(U.data,U.tag)},decrypt:function(U,$,q,ee,fe){var ge=$.slice(0),De=ve.bitArray,Ne=De.bitLength(ge);if(ee=ee||[],(fe=fe||128)<=Ne?($=De.bitSlice(ge,Ne-fe),ge=De.bitSlice(ge,0,Ne-fe)):($=ge,ge=[]),U=ve.mode.gcm.C(!1,U,ge,ee,q,fe),!De.equal(U.tag,$))throw new ve.exception.corrupt("gcm: tag doesn't match");return U.data},ka:function(U,$){var q,ee,fe,ge,De,Ne=ve.bitArray.i;for(fe=[0,0,0,0],ge=$.slice(0),q=0;128>q;q++){for((ee=0!=(U[Math.floor(q/32)]&1<<31-q%32))&&(fe=Ne(fe,ge)),De=0!=(1&ge[3]),ee=3;0<ee;ee--)ge[ee]=ge[ee]>>>1|(1&ge[ee-1])<<31;ge[0]>>>=1,De&&(ge[0]^=-520093696)}return fe},j:function(U,$,q){var ee,fe=q.length;for($=$.slice(0),ee=0;ee<fe;ee+=4)$[0]^=4294967295&q[ee],$[1]^=4294967295&q[ee+1],$[2]^=4294967295&q[ee+2],$[3]^=4294967295&q[ee+3],$=ve.mode.gcm.ka($,U);return $},C:function(U,$,q,ee,fe,ge){var De,Ne,st,ht,Pt,bt,gn,zn,an=ve.bitArray;for(bt=q.length,gn=an.bitLength(q),zn=an.bitLength(ee),Ne=an.bitLength(fe),De=$.encrypt([0,0,0,0]),96===Ne?(fe=fe.slice(0),fe=an.concat(fe,[1])):(fe=ve.mode.gcm.j(De,[0,0,0,0],fe),fe=ve.mode.gcm.j(De,fe,[0,0,Math.floor(Ne/4294967296),4294967295&Ne])),Ne=ve.mode.gcm.j(De,[0,0,0,0],ee),Pt=fe.slice(0),ee=Ne.slice(0),U||(ee=ve.mode.gcm.j(De,Ne,q)),ht=0;ht<bt;ht+=4)Pt[3]++,st=$.encrypt(Pt),q[ht]^=st[0],q[ht+1]^=st[1],q[ht+2]^=st[2],q[ht+3]^=st[3];return q=an.clamp(q,gn),U&&(ee=ve.mode.gcm.j(De,Ne,q)),U=[Math.floor(zn/4294967296),4294967295&zn,Math.floor(gn/4294967296),4294967295&gn],ee=ve.mode.gcm.j(De,ee,U),st=$.encrypt(fe),ee[0]^=st[0],ee[1]^=st[1],ee[2]^=st[2],ee[3]^=st[3],{tag:an.bitSlice(ee,0,ge),data:q}}},ve.misc.hmac=function(U,$){this.W=$=$||ve.hash.sha256;var ee,q=[[],[]],fe=$.prototype.blockSize/32;for(this.w=[new $,new $],U.length>fe&&(U=$.hash(U)),ee=0;ee<fe;ee++)q[0][ee]=909522486^U[ee],q[1][ee]=1549556828^U[ee];this.w[0].update(q[0]),this.w[1].update(q[1]),this.R=new $(this.w[0])},ve.misc.hmac.prototype.encrypt=ve.misc.hmac.prototype.mac=function(U){if(this.aa)throw new ve.exception.invalid("encrypt on already updated hmac called!");return this.update(U),this.digest(U)},ve.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1},ve.misc.hmac.prototype.update=function(U){this.aa=!0,this.R.update(U)},ve.misc.hmac.prototype.digest=function(){var U=this.R.finalize();return U=new this.W(this.w[1]).update(U).finalize(),this.reset(),U},ve.misc.pbkdf2=function(U,$,q,ee,fe){if(q=q||1e4,0>ee||0>q)throw new ve.exception.invalid("invalid params to pbkdf2");"string"==typeof U&&(U=ve.codec.utf8String.toBits(U)),"string"==typeof $&&($=ve.codec.utf8String.toBits($)),U=new(fe=fe||ve.misc.hmac)(U);var ge,De,Ne,st,ht=[],Pt=ve.bitArray;for(st=1;32*ht.length<(ee||1);st++){for(fe=ge=U.encrypt(Pt.concat($,[st])),De=1;De<q;De++)for(ge=U.encrypt(ge),Ne=0;Ne<ge.length;Ne++)fe[Ne]^=ge[Ne];ht=ht.concat(fe)}return ee&&(ht=Pt.clamp(ht,ee)),ht},ve.prng=function(U){this.c=[new ve.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=U,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80},ve.prng.prototype={randomWords:function(U,$){var ee,fe,q=[];if((ee=this.isReady($))===this.u)throw new ve.exception.notReady("generator isn't seeded");if(ee&this.J){ee=!(ee&this.I);var De,ge=0;for(this.Z=(fe=[])[0]=(new Date).valueOf()+this.da,De=0;16>De;De++)fe.push(4294967296*Math.random()|0);for(De=0;De<this.c.length&&(fe=fe.concat(this.c[De].finalize()),ge+=this.m[De],this.m[De]=0,ee||!(this.P&1<<De));De++);for(this.P>=1<<this.c.length&&(this.c.push(new ve.hash.sha256),this.m.push(0)),this.f-=ge,ge>this.o&&(this.o=ge),this.P++,this.b=ve.hash.sha256.hash(this.b.concat(fe)),this.L=new ve.cipher.aes(this.b),ee=0;4>ee&&(this.h[ee]=this.h[ee]+1|0,!this.h[ee]);ee++);}for(ee=0;ee<U;ee+=4)(ee+1)%this.ca==0&&at(this),fe=Lt(this),q.push(fe[0],fe[1],fe[2],fe[3]);return at(this),q.slice(0,U)},setDefaultParanoia:function(U,$){if(0===U&&"Setting paranoia=0 will ruin your security; use it only for testing"!==$)throw new ve.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=U},addEntropy:function(U,$,q){q=q||"user";var ee,fe,ge=(new Date).valueOf(),De=this.H[q],Ne=this.isReady(),st=0;switch(void 0===(ee=this.U[q])&&(ee=this.U[q]=this.ha++),void 0===De&&(De=this.H[q]=0),this.H[q]=(this.H[q]+1)%this.c.length,typeof U){case"number":void 0===$&&($=1),this.c[De].update([ee,this.N++,1,$,ge,1,0|U]);break;case"object":if("[object Uint32Array]"===(q=Object.prototype.toString.call(U))){for(fe=[],q=0;q<U.length;q++)fe.push(U[q]);U=fe}else for("[object Array]"!==q&&(st=1),q=0;q<U.length&&!st;q++)"number"!=typeof U[q]&&(st=1);if(!st){if(void 0===$)for(q=$=0;q<U.length;q++)for(fe=U[q];0<fe;)$++,fe>>>=1;this.c[De].update([ee,this.N++,2,$,ge,U.length].concat(U))}break;case"string":void 0===$&&($=U.length),this.c[De].update([ee,this.N++,3,$,ge,U.length]),this.c[De].update(U);break;default:st=1}if(st)throw new ve.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[De]+=$,this.f+=$,Ne===this.u&&(this.isReady()!==this.u&&Yi("seeded",Math.max(this.o,this.f)),Yi("progress",this.getProgress()))},isReady:function(U){return U=this.T[void 0!==U?U:this.M],this.o&&this.o>=U?this.m[0]>this.ba&&(new Date).valueOf()>this.Z?this.J|this.I:this.I:this.f>=U?this.J|this.u:this.u},getProgress:function(U){return this.o>=(U=this.T[U||this.M])||this.f>U?1:this.f/U},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:Be(this,this.ma),mouseCollector:Be(this,this.oa),keyboardCollector:Be(this,this.la),accelerometerCollector:Be(this,this.ea),touchCollector:Be(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else{if(!document.attachEvent)throw new ve.exception.bug("can't attach event");document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)}this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(U,$){this.K[U][this.ga++]=$},removeEventListener:function(U,$){var q,ee,fe=this.K[U],ge=[];for(ee in fe)fe.hasOwnProperty(ee)&&fe[ee]===$&&ge.push(ee);for(q=0;q<ge.length;q++)delete fe[ee=ge[q]]},la:function(){Tr(this,1)},oa:function(U){var $,q;try{$=U.x||U.clientX||U.offsetX||0,q=U.y||U.clientY||U.offsetY||0}catch(ee){q=$=0}0!=$&&0!=q&&this.addEntropy([$,q],2,"mouse"),Tr(this,0)},qa:function(U){this.addEntropy([(U=U.touches[0]||U.changedTouches[0]).pageX||U.clientX,U.pageY||U.clientY],1,"touch"),Tr(this,0)},ma:function(){Tr(this,2)},ea:function(U){if(U=U.accelerationIncludingGravity.x||U.accelerationIncludingGravity.y||U.accelerationIncludingGravity.z,window.orientation){var $=window.orientation;"number"==typeof $&&this.addEntropy($,1,"accelerometer")}U&&this.addEntropy(U,2,"accelerometer"),Tr(this,0)}},ve.random=new ve.prng(6);e:try{var jr,Vn,Vo,Vr;if(Vr=Ya.exports){var as;try{as=ca(Object(function(){var $=new Error("Cannot find module 'crypto'");throw $.code="MODULE_NOT_FOUND",$}()))}catch(U){as=null}Vr=Vn=as}if(Vr&&Vn.randomBytes)jr=Vn.randomBytes(128),jr=new Uint32Array(new Uint8Array(jr).buffer),ve.random.addEntropy(jr,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(Vo=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(Vo);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break e;window.msCrypto.getRandomValues(Vo)}ve.random.addEntropy(Vo,1024,"crypto['getRandomValues']")}}catch(U){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(U))}ve.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(U,$,q,ee){q=q||{},ee=ee||{};var De,fe=ve.json,ge=fe.g({iv:ve.random.randomWords(4,0)},fe.defaults);if(fe.g(ge,q),q=ge.adata,"string"==typeof ge.salt&&(ge.salt=ve.codec.base64.toBits(ge.salt)),"string"==typeof ge.iv&&(ge.iv=ve.codec.base64.toBits(ge.iv)),!ve.mode[ge.mode]||!ve.cipher[ge.cipher]||"string"==typeof U&&100>=ge.iter||64!==ge.ts&&96!==ge.ts&&128!==ge.ts||128!==ge.ks&&192!==ge.ks&&256!==ge.ks||2>ge.iv.length||4<ge.iv.length)throw new ve.exception.invalid("json encrypt: invalid parameters");return"string"==typeof U?(U=(De=ve.misc.cachedPbkdf2(U,ge)).key.slice(0,ge.ks/32),ge.salt=De.salt):ve.ecc&&U instanceof ve.ecc.elGamal.publicKey&&(De=U.kem(),ge.kemtag=De.tag,U=De.key.slice(0,ge.ks/32)),"string"==typeof $&&($=ve.codec.utf8String.toBits($)),"string"==typeof q&&(ge.adata=q=ve.codec.utf8String.toBits(q)),De=new ve.cipher[ge.cipher](U),fe.g(ee,ge),ee.key=U,ge.ct="ccm"===ge.mode&&ve.arrayBuffer&&ve.arrayBuffer.ccm&&$ instanceof ArrayBuffer?ve.arrayBuffer.ccm.encrypt(De,$,ge.iv,q,ge.ts):ve.mode[ge.mode].encrypt(De,$,ge.iv,q,ge.ts),ge},encrypt:function(U,$,q,ee){var fe=ve.json,ge=fe.ja.apply(fe,arguments);return fe.encode(ge)},ia:function(U,$,q,ee){q=q||{},ee=ee||{};var ge,De,fe=ve.json;if(ge=($=fe.g(fe.g(fe.g({},fe.defaults),$),q,!0)).adata,"string"==typeof $.salt&&($.salt=ve.codec.base64.toBits($.salt)),"string"==typeof $.iv&&($.iv=ve.codec.base64.toBits($.iv)),!ve.mode[$.mode]||!ve.cipher[$.cipher]||"string"==typeof U&&100>=$.iter||64!==$.ts&&96!==$.ts&&128!==$.ts||128!==$.ks&&192!==$.ks&&256!==$.ks||!$.iv||2>$.iv.length||4<$.iv.length)throw new ve.exception.invalid("json decrypt: invalid parameters");return"string"==typeof U?(U=(De=ve.misc.cachedPbkdf2(U,$)).key.slice(0,$.ks/32),$.salt=De.salt):ve.ecc&&U instanceof ve.ecc.elGamal.secretKey&&(U=U.unkem(ve.codec.base64.toBits($.kemtag)).slice(0,$.ks/32)),"string"==typeof ge&&(ge=ve.codec.utf8String.toBits(ge)),De=new ve.cipher[$.cipher](U),ge="ccm"===$.mode&&ve.arrayBuffer&&ve.arrayBuffer.ccm&&$.ct instanceof ArrayBuffer?ve.arrayBuffer.ccm.decrypt(De,$.ct,$.iv,$.tag,ge,$.ts):ve.mode[$.mode].decrypt(De,$.ct,$.iv,ge,$.ts),fe.g(ee,$),ee.key=U,1===q.raw?ge:ve.codec.utf8String.fromBits(ge)},decrypt:function(U,$,q,ee){var fe=ve.json;return fe.ia(U,fe.decode($),q,ee)},encode:function(U){var $,q="{",ee="";for($ in U)if(U.hasOwnProperty($)){if(!$.match(/^[a-z0-9]+$/i))throw new ve.exception.invalid("json encode: invalid property name");switch(q+=ee+'"'+$+'":',ee=",",typeof U[$]){case"number":case"boolean":q+=U[$];break;case"string":q+='"'+escape(U[$])+'"';break;case"object":q+='"'+ve.codec.base64.fromBits(U[$],0)+'"';break;default:throw new ve.exception.bug("json encode: unsupported type")}}return q+"}"},decode:function(U){if(!(U=U.replace(/\s/g,"")).match(/^\{.*\}$/))throw new ve.exception.invalid("json decode: this isn't json!");U=U.replace(/^\{|\}$/g,"").split(/,/);var q,ee,$={};for(q=0;q<U.length;q++){if(!(ee=U[q].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new ve.exception.invalid("json decode: this isn't json!");null!=ee[3]?$[ee[2]]=parseInt(ee[3],10):null!=ee[4]?$[ee[2]]=ee[2].match(/^(ct|adata|salt|iv)$/)?ve.codec.base64.toBits(ee[4]):unescape(ee[4]):null!=ee[5]&&($[ee[2]]="true"===ee[5])}return $},g:function(U,$,q){if(void 0===U&&(U={}),void 0===$)return U;for(var ee in $)if($.hasOwnProperty(ee)){if(q&&void 0!==U[ee]&&U[ee]!==$[ee])throw new ve.exception.invalid("required parameter overridden");U[ee]=$[ee]}return U},sa:function(U,$){var ee,q={};for(ee in U)U.hasOwnProperty(ee)&&U[ee]!==$[ee]&&(q[ee]=U[ee]);return q},ra:function(U,$){var ee,q={};for(ee=0;ee<$.length;ee++)void 0!==U[$[ee]]&&(q[$[ee]]=U[$[ee]]);return q}},ve.encrypt=ve.json.encrypt,ve.decrypt=ve.json.decrypt,ve.misc.pa={},ve.misc.cachedPbkdf2=function(U,$){var ee,q=ve.misc.pa;return ee=($=$||{}).iter||1e3,(ee=(q=q[U]=q[U]||{})[ee]=q[ee]||{firstSalt:$.salt&&$.salt.length?$.salt.slice(0):ve.random.randomWords(2,0)})[q=void 0===$.salt?ee.firstSalt:$.salt]=ee[q]||ve.misc.pbkdf2(U,q,$.iter),{key:ee[q].slice(0),salt:q.slice(0)}},Ya.exports&&(Ya.exports=ve),void 0!==(ua=function(){return ve}.apply(Ja,[]))&&(Ya.exports=ua)}},Ya=>{Ya(Ya.s=193)}]);